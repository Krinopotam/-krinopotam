import{j as b,bn as B,r as s,a as z}from"./index-9944374f.js";import{f as O,G as R,h as W,i as l,H as G,j as L,m as I,k as N,D as V,c as Y,M as X,l as U,u as $,e as K}from"./index-df6b3fec.js";const{useToken:_}=B,q=({onMouseResize:t,resizable:e,children:c,style:n,colorType:i})=>{const{token:u}=_(),h=M(u,i);return b.jsxs("div",{children:[b.jsx("div",{style:{borderTopWidth:1,borderTopStyle:"solid",borderTopColor:h,...n},children:c}),e?b.jsx(J,{onMouseDown:t}):null]})},J=t=>b.jsx("div",{className:"resize-handle",...t,children:b.jsx("div",{className:"resize-handle-inner"})}),M=(t,e)=>{let c=t.colorFillSecondary;return e==="info"?c=t.colorInfoHover:e==="success"?c=t.colorSuccessHover:e==="warning"?c=t.colorWarningHover:e==="danger"&&(c=t.colorErrorHover),c};/**
 * @Modal
 * @version 0.0.0.3
 * @link omegatester@gmail.com
 * @author Maksim Zaytsev
 * @license MIT
 */const Q=(t,e)=>{s.useEffect(()=>(e?O.pushToStack(t):O.removeFromStack(t),()=>{O.removeFromStack(t)}),[e,t])},Z=(t,e,c,n,i,u,h)=>{const[S,g]=s.useState(!1),[a,x]=s.useState({initWidth:0,initBodyHeight:0,mouseDownX:0,mouseDownY:0}),j=s.useCallback(y=>{var f;if(y.preventDefault(),!e&&y.target instanceof HTMLElement){const C=(f=y.target.closest(".custom-antd-modal"))==null?void 0:f.querySelector(".ant-modal-body");C&&(e=C.clientHeight)}if(!t&&y.target instanceof HTMLElement){const C=y.target.closest(".custom-antd-modal");C&&(t=C.clientWidth)}x({initWidth:t,initBodyHeight:e,mouseDownX:y.clientX,mouseDownY:y.clientY}),g(!0)},[t,e,g,x]);return s.useEffect(()=>{const y=f=>{if(S){const{initWidth:C,mouseDownX:E,initBodyHeight:H,mouseDownY:k}=a,v=f.clientX-E,T=f.clientY-k;let D=C+v*2;i&&D>i&&(D=i),n&&D<n&&(D=n);let w=H+T*2;return h&&w>h&&(w=h),u&&w<u&&(w=u),c({width:D,bodyHeight:w})}};return window.addEventListener("mousemove",y,{passive:!0}),()=>window.removeEventListener("mousemove",y)},[a,S,c,n,i,u,h]),s.useEffect(()=>{const y=()=>{g(!1)};return window.addEventListener("mouseup",y),()=>window.removeEventListener("mouseup",y)},[g]),j},d=({resizable:t=!0,headerStyle:e,footerStyle:c,...n})=>{const[i]=s.useState(n.modalId??"modal-"+R());Q(i,!!n.open);const u=s.useRef({}),h=s.useRef();s.useEffect(()=>{n.open&&(h.current=document.activeElement)},[n.open]);const S=s.useCallback(k=>{var v,T,D,w;k?(T=(v=u.current)==null?void 0:v.onParentComponentRendered)==null||T.call(v):(D=h.current)==null||D.focus(),(w=n.onAfterOpenChange)==null||w.call(n,k)},[n]),[g,a]=s.useState({width:n.width??0,bodyHeight:n.bodyHeight??0}),x=Z(g.width,g.bodyHeight,a,n.minWidth??200,n.maxWidth??5e3,n.bodyMinHeight??50,n.bodyMaxHeight??5e3),j=A({bodyStyle:n.bodyStyle,bodyHeight:g.bodyHeight,bodyMaxHeight:n.bodyMaxHeight,bodyMinHeight:n.bodyMinHeight,notScrollable:n.notScrollable}),y=24,f=24,C={paddingLeft:y,paddingRight:f,paddingTop:5,paddingBottom:5,...e},E={paddingTop:20,paddingLeft:y,paddingRight:f,paddingBottom:20,...c},[H]=s.useState("draggable-"+R());return b.jsx(W,{...n,width:g.width||void 0,styles:{body:j,footer:{margin:0}},className:z("custom-antd-modal",n.className),modalRender:k=>l(k,H,u),title:b.jsx(G,{draggableId:H,icon:n.headerIcon,title:n.title,colorType:n.colorType,style:C}),footer:b.jsx(q,{onMouseResize:x,resizable:t,style:E,colorType:n.colorType,children:n.footer}),afterOpenChange:S})},A=({bodyStyle:t,bodyHeight:e,bodyMaxHeight:c,bodyMinHeight:n,notScrollable:i})=>{const u={...t,padding:"0 24px 0 24px",overflowY:i?"hidden":"auto"};return e&&(u.height=e),c&&(u.maxHeight=c),n&&(u.minHeight=n),u},F=(t,e,c,n,i)=>{e.getFormId=r(t),e.buttonsApi=n,e.getFormProps=P(c),e.setFormProps=p(c,i),e.open=o(e),e.close=ee(e),e.forceClose=m(e)},r=t=>s.useCallback(()=>t,[t]),P=t=>s.useCallback(()=>t,[t]),p=(t,e)=>s.useCallback(c=>{e({...t,...c})},[t,e]),o=t=>s.useCallback((e,c)=>{var h,S;if(!e){console.warn("The form mode is not set");return}const n=c??t.getFormProps().dataSet,i=n?L(n):void 0,u=t.getFormProps();((h=u.onOpen)==null?void 0:h.call(u,t,i))!==!1&&(t.setFormProps({isOpened:!0,formMode:e,dataSet:i}),(S=u.onOpened)==null||S.call(u,t,i))},[t]),m=t=>s.useCallback(()=>{var c,n;const e=t.getFormProps();if(((c=e.onClosing)==null?void 0:c.call(e,t))===!1)return!1;t.setFormProps({isOpened:!1}),(n=e.onClosed)==null||n.call(e,t)},[t]),ee=t=>s.useCallback(()=>{var c;const e=t.getFormProps();if(((c=e.onClosing)==null?void 0:c.call(e,t))!==!1){if(t.model.isFormDirty()&&e.confirmChanges){I.confirm({content:e.closeFormConfirmMessage??"Отменить сделанные изменения?",okText:"Да",cancelText:"Нет",onOk:()=>{t.forceClose()}});return}t.forceClose()}},[t]),te=({formId:t,buttons:e,buttonsApi:c,formApi:n,formProps:i,modalFormProps:u})=>{const[h]=s.useState(t??"dFormModal-"+R()),S=u.formMode??"create",g=ne(S,u.title);return b.jsx(d,{modalId:h,open:u.isOpened,onCancel:n.close,centered:!0,destroyOnClose:!0,footer:b.jsx(N,{buttons:e,colorType:u.colorType,buttonsApi:c,arrowsSelection:u.arrowsButtonsSelection,context:n}),footerStyle:u.footerStyle,maskClosable:!1,keyboard:!1,bodyHeight:u.bodyHeight,bodyMinHeight:u.bodyMinHeight,bodyMaxHeight:u.bodyMaxHeight,width:u.width,minWidth:u.minWidth,maxWidth:u.maxWidth,notScrollable:u.notScrollable,resizable:u.resizable!==!1,title:g,headerIcon:u.headerIcon,headerStyle:u.headerStyle,colorType:i.colorType,children:u.isOpened?b.jsx(V,{apiRef:n,...i,formStyle:{height:"100%",...i.formStyle},containerStyle:{height:"100%",...i.containerStyle}}):null})},ne=(t,e)=>e||(t==="view"?"Просмотр":t==="create"?"Создание":t==="clone"?"Клонирование":t==="update"?"Редактирование":"&nbsp;"),ce=(t,e)=>s.useMemo(()=>({onTabHiddenStateChanged:(c,n)=>{var i;return(i=e==null?void 0:e.onTabHiddenStateChanged)==null?void 0:i.call(e,c,n,t)},onTabReadOnlyStateChanged:(c,n)=>{var i;return(i=e==null?void 0:e.onTabReadOnlyStateChanged)==null?void 0:i.call(e,c,n,t)},onTabDisabledStateChanged:(c,n)=>{var i;return(i=e==null?void 0:e.onTabDisabledStateChanged)==null?void 0:i.call(e,c,n,t)},onFormDirtyStateChanged:c=>{var n;return(n=e==null?void 0:e.onFormDirtyStateChanged)==null?void 0:n.call(e,c,t)},onFormReadOnlyStateChanged:c=>{var n;return(n=e==null?void 0:e.onFormReadOnlyStateChanged)==null?void 0:n.call(e,c,t)},onFormInit:()=>{var c;return(c=e==null?void 0:e.onFormInit)==null?void 0:c.call(e,t)},onFormReadyStateChanged:c=>{var n;return(n=e==null?void 0:e.onFormReadyStateChanged)==null?void 0:n.call(e,c,t)},onFormValidated:(c,n,i)=>{var u;return(u=e==null?void 0:e.onFormValidated)==null?void 0:u.call(e,c,n,i,t)},onFormHasErrors:(c,n)=>{var i;return(i=e==null?void 0:e.onFormHasErrors)==null?void 0:i.call(e,c,n,t)},onFormHasNoErrors:c=>{var n;return(n=e==null?void 0:e.onFormHasNoErrors)==null?void 0:n.call(e,c,t)},onDataFetch:()=>{var c;return(c=e==null?void 0:e.onDataFetch)==null?void 0:c.call(e,t)},onDataFetchSuccess:c=>{var n;return(n=e==null?void 0:e.onDataFetchSuccess)==null?void 0:n.call(e,c,t)},onDataFetchError:c=>{var i;if(((i=e==null?void 0:e.onDataFetchError)==null?void 0:i.call(e,c,t))===!1)return!1;const n=I.confirm({content:b.jsxs(b.Fragment,{children:[b.jsx("p",{children:b.jsx("b",{children:c.message})}),c.stack&&Y()?b.jsx("p",{children:c.stack}):"",b.jsx("p",{children:"Попробовать снова?"})]}),colorType:"danger",buttons:{ok:{onClick:()=>{n.destroy(),t.model.fetchData()}},cancel:{onClick:()=>{var u;n.destroy(),(u=t.forceClose)==null||u.call(t)}}}});return!1},onDataFetchComplete:()=>{var c;return(c=e==null?void 0:e.onDataFetchComplete)==null?void 0:c.call(e,t)},onSubmitValidation:(c,n)=>{var i;return(i=e==null?void 0:e.onSubmitValidation)==null?void 0:i.call(e,c,n,t)},onSubmit:c=>{var n,i,u,h,S,g,a;return(i=(n=t.buttonsApi).disabled)==null||i.call(n,"ok",!0),(h=(u=t.buttonsApi).disabled)==null||h.call(u,"cancel",!0),e.confirmChanges||(g=(S=t.buttonsApi).loading)==null||g.call(S,"ok",!0),(a=e==null?void 0:e.onSubmit)==null?void 0:a.call(e,c,t)},onSubmitSuccess:(c,n)=>{var i;if(((i=e==null?void 0:e.onSubmitSuccess)==null?void 0:i.call(e,c,n,t))===!1)return!1;t.forceClose()},onSubmitError:(c,n)=>{var i;return(i=e==null?void 0:e.onSubmitError)==null?void 0:i.call(e,c,n,t)},onSubmitComplete:(c,n)=>{var i,u,h,S,g,a,x;if(((i=e==null?void 0:e.onSubmitComplete)==null?void 0:i.call(e,c,n,t))===!1)return!1;(h=(u=t.buttonsApi).disabled)==null||h.call(u,"ok",!1),(g=(S=t.buttonsApi).disabled)==null||g.call(S,"cancel",!1),(x=(a=t.buttonsApi).loading)==null||x.call(a,"ok",!1)},onDataSetChange:c=>{var n;return(n=e==null?void 0:e.onDataSetChange)==null?void 0:n.call(e,c,t)}}),[t,e]),ie=(t,e)=>s.useMemo(()=>{const c={ok:{position:"right",active:e.formMode!=="view",hidden:e.formMode==="view",title:"ОК",hotKeys:[{key:"enter",ctrl:!0},{key:"s",ctrl:!0},{key:"ы",ctrl:!0}],onClick:()=>{t.submitForm()}},cancel:{position:"right",title:"Отмена",hotKeys:[{key:"escape"}],active:e.formMode==="view",onClick:()=>{t.close()}}};return X(c,e.buttons)},[t,e.buttons,e.formMode]),ge=t=>{U();const[e]=s.useState(t.formId??"dFormModal-"+R()),[c,n]=$(t),[i,u]=s.useState(c.apiRef||{}),[h]=s.useState({}),S=ie(i,c);F(e,i,c,h,n);const g=ce(i,c),[,a]=ue(c,g);return s.useEffect(()=>()=>{u({})},[]),b.jsx(te,{formId:e,formApi:i,modalFormProps:c,formProps:a,buttons:S,buttonsApi:h})},ue=(t,e)=>s.useMemo(()=>{const[c,n]=K(t,{title:!0,width:!0,minWidth:!0,maxWidth:!0,bodyHeight:!0,bodyMinHeight:!0,bodyMaxHeight:!0,bodyStyle:!0,notScrollable:!0,resizable:!0,isOpened:!0,headerStyle:!0,headerIcon:!0,footerStyle:!0,closeFormConfirmMessage:!0});return n.buttons=null,[c,{...n,...e}]},[e,t]);export{ge as D,d as M};
