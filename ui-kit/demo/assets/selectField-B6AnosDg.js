import{r as e,C as t,J as o,V as l,ai as a,m as s,F as n,o as r,e as i,L as c,k as d,ab as u,bv as m,j as p}from"./index-DEKOHtjL.js";import{B as b}from"./baseField-C1lQOwhI.js";import{s as f}from"./dFormModal-CXclmgf1.js";import{a as h}from"./isArray-CilX2EC5.js";import{u as C,a as S,D as g,T as O,m as v,O as x,b as w}from"./useShowArrow-DbNT8REh.js";import{j as y}from"./buttonsRow-CRmAST--.js";import{c as I,d as j,e as N}from"./index-B4134D_s.js";import{u as M}from"./useIcons-D-Pv2D3R.js";const P="SECRET_COMBOBOX_MODE_DO_NOT_USE",E=(p,b)=>{var f;const{prefixCls:h,bordered:x,className:w,rootClassName:y,getPopupContainer:E,popupClassName:F,dropdownClassName:D,listHeight:R=256,placement:_,listItemHeight:k,size:W,disabled:$,notFoundContent:B,status:H,builtinPlacements:T,dropdownMatchSelectWidth:V,popupMatchSelectWidth:z,direction:A,style:L,allowClear:U,variant:X,dropdownStyle:G,transitionName:J,tagRender:Y,maxCount:q,prefix:K}=p,Q=function(e,t){var o={};for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&t.indexOf(l)<0&&(o[l]=e[l]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(l=Object.getOwnPropertySymbols(e);a<l.length;a++)t.indexOf(l[a])<0&&Object.prototype.propertyIsEnumerable.call(e,l[a])&&(o[l[a]]=e[l[a]])}return o}(p,["prefixCls","bordered","className","rootClassName","getPopupContainer","popupClassName","dropdownClassName","listHeight","placement","listItemHeight","size","disabled","notFoundContent","status","builtinPlacements","dropdownMatchSelectWidth","popupMatchSelectWidth","direction","style","allowClear","variant","dropdownStyle","transitionName","tagRender","maxCount","prefix"]),{getPopupContainer:Z,getPrefixCls:ee,renderEmpty:te,direction:oe,virtual:le,popupMatchSelectWidth:ae,popupOverflow:se}=e.useContext(t),ne=o("select"),[,re]=l(),ie=null!=k?k:null==re?void 0:re.controlHeight,ce=ee("select",h),de=ee(),ue=null!=A?A:oe,{compactSize:me,compactItemClassnames:pe}=a(ce,ue),[be,fe]=I("select",X,x),he=s(ce),[Ce,Se,ge]=C(ce,he),Oe=e.useMemo((()=>{const{mode:e}=p;if("combobox"!==e)return e===P?"combobox":e}),[p.mode]),ve="multiple"===Oe||"tags"===Oe,xe=S(p.suffixIcon,p.showArrow),we=null!==(f=null!=z?z:V)&&void 0!==f?f:ae,{status:ye,hasFeedback:Ie,isFormItemInput:je,feedbackIcon:Ne}=e.useContext(n),Me=N(ye,H);let Pe;Pe=void 0!==B?B:"combobox"===Oe?null:(null==te?void 0:te("Select"))||e.createElement(g,{componentName:"Select"});const{suffixIcon:Ee,itemIcon:Fe,removeIcon:De,clearIcon:Re}=M(Object.assign(Object.assign({},Q),{multiple:ve,hasFeedback:Ie,feedbackIcon:Ne,showSuffixIcon:xe,prefixCls:ce,componentName:"Select"})),_e=!0===U?{clearIcon:Re}:U,ke=r(Q,["suffixIcon","itemIcon"]),We=i(F||D,{[`${ce}-dropdown-${ue}`]:"rtl"===ue},y,ge,he,Se),$e=c((e=>{var t;return null!==(t=null!=W?W:me)&&void 0!==t?t:e})),Be=e.useContext(d),He=null!=$?$:Be,Te=i({[`${ce}-lg`]:"large"===$e,[`${ce}-sm`]:"small"===$e,[`${ce}-rtl`]:"rtl"===ue,[`${ce}-${be}`]:fe,[`${ce}-in-form-item`]:je},j(ce,Me,Ie),pe,ne.className,w,y,ge,he,Se),Ve=e.useMemo((()=>void 0!==_?_:"rtl"===ue?"bottomRight":"bottomLeft"),[_,ue]),[ze]=u("SelectLike",null==G?void 0:G.zIndex);return Ce(e.createElement(O,Object.assign({ref:b,virtual:le,showSearch:ne.showSearch},ke,{style:Object.assign(Object.assign({},ne.style),L),dropdownMatchSelectWidth:we,transitionName:m(de,"slide-up",J),builtinPlacements:v(T,se),listHeight:R,listItemHeight:ie,mode:Oe,prefixCls:ce,placement:Ve,direction:ue,prefix:K,suffixIcon:Ee,menuItemSelectedIcon:Fe,removeIcon:De,allowClear:_e,notFoundContent:Pe,className:Te,getPopupContainer:E||Z,dropdownClassName:We,disabled:He,dropdownStyle:Object.assign(Object.assign({},G),{zIndex:ze}),maxCount:ve?q:void 0,tagRender:ve?Y:void 0})))},F=e.forwardRef(E),D=y(F,"dropdownAlign");F.SECRET_COMBOBOX_MODE_DO_NOT_USE=P,F.Option=x,F.OptGroup=w,F._InternalPanelDoNotUseOrYouWillBeFired=D;const R=e=>{const t=W(e),o=_(e),l=k(e,e.value);return p.jsx(F,{...t,options:o,value:l,disabled:e.disabled||e.readOnly,optionFilterProp:e.optionFilterProp??"label",showSearch:!1!==e.showSearch,onSelect:(t,o)=>{var l;return null==(l=e.onSelect)?void 0:l.call(e,t,o)},onDeselect:(t,o)=>{var l;return null==(l=e.onDeselect)?void 0:l.call(e,t,o)},onChange:(t,o)=>{var l;return null==(l=e.onChange)?void 0:l.call(e,t,o)},children:e.children})},_=t=>e.useMemo((()=>{if(!t.dataSet)return;const e=t=>{const o=[];if(t&&h(t)){for(const l of t){const t={...l};l.id&&(t.value=l.id),l.label&&(t.label=l.label),l.children&&(t.children=e(l.children)),o.push(t)}return o}};return e(t.dataSet)}),[t.dataSet]),k=(t,o)=>e.useMemo((()=>{if(void 0===o)return;if(!h(o))return"object"==typeof o?{value:o.id??"0",label:o.label}:o;const e=[];for(const t of o)"object"==typeof t?e.push({value:t.id,label:t.label}):e.push(t);return e}),[o]),W=t=>e.useMemo((()=>f(t,{dataSet:!0,value:!0,readOnly:!0,onSelect:!0,onDeselect:!0,onChange:!0})[1]),[t]),$=({field:t})=>{e.useSyncExternalStore(t.subscribe.bind(t),t.getSnapshot.bind(t));const o=t.getProps(),l=t.getValue(),a=e.useCallback(((e,l)=>{t.isReady()&&(o.fullItemValue?t.setValue(l):t.setValue(e),t.setDirty(!0))}),[t,o.fullItemValue]),s=e.useCallback((()=>{t.setTouched(!0)}),[t]);e.useEffect((()=>{t.setReady(!0)}),[t]);const n={...{width:t.getWidth()??"100%"},...o.style};return p.jsx(R,{className:o.className,allowClear:!0,...o,disabled:t.isDisabled(),readOnly:t.isReadOnly(),value:l,style:n,onBlur:s,onChange:a})};class SelectField extends b{render(){return p.jsx($,{field:this})}}export{SelectField as S};
