var e=Object.defineProperty,t=(t,i,s)=>((t,i,s)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s)(t,"symbol"!=typeof i?i+"":i,s);import{r as i,j as s,bc as n,W as r,bd as o,be as l,f as a}from"./index-DkmdmL2B.js";import{F as d,C as h,a as u}from"./isArray-BIOd_gKK.js";import{o as p}from"./buttonsRow-CSdI3fHP.js";const c=({field:e,altLabel:t,children:n})=>{i.useSyncExternalStore(e.subscribe.bind(e),e.getSnapshot.bind(e));const r=e.getProps(),o=e.getFormProps(),l=e.getError(),a={height:"100%",...r.itemWrapperStyle};let h;"horizontal"===o.layout&&(h=" ");const u=void 0!==t?t:r.label??h;return s.jsx(d.Item,{label:u,className:r.itemWrapperClassName,help:l||void 0,validateStatus:l?"error":void 0,required:!!r.requiredMark,tooltip:r.tooltip,style:a,children:n})};function m(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,n(e,t)}function g(e,t){return e.replace(new RegExp("(^|\\s)"+t+"(?:\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/^\s*|\s*$/g,"")}const f=!1,E=r.createContext(null);var v=function(e){return e.scrollTop},x="unmounted",F="exited",b="entering",C="entered",y="exiting",R=function(e){function t(t,i){var s;s=e.call(this,t,i)||this;var n,r=i&&!i.isMounting?t.enter:t.appear;return s.appearStatus=null,t.in?r?(n=F,s.appearStatus=b):n=C:n=t.unmountOnExit||t.mountOnEnter?x:F,s.state={status:n},s.nextCallback=null,s}m(t,e),t.getDerivedStateFromProps=function(e,t){return e.in&&t.status===x?{status:F}:null};var i=t.prototype;return i.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},i.componentDidUpdate=function(e){var t=null;if(e!==this.props){var i=this.state.status;this.props.in?i!==b&&i!==C&&(t=b):i!==b&&i!==C||(t=y)}this.updateStatus(!1,t)},i.componentWillUnmount=function(){this.cancelNextCallback()},i.getTimeouts=function(){var e,t,i,s=this.props.timeout;return e=t=i=s,null!=s&&"number"!=typeof s&&(e=s.exit,t=s.enter,i=void 0!==s.appear?s.appear:t),{exit:e,enter:t,appear:i}},i.updateStatus=function(e,t){if(void 0===e&&(e=!1),null!==t)if(this.cancelNextCallback(),t===b){if(this.props.unmountOnExit||this.props.mountOnEnter){var i=this.props.nodeRef?this.props.nodeRef.current:o.findDOMNode(this);i&&v(i)}this.performEnter(e)}else this.performExit();else this.props.unmountOnExit&&this.state.status===F&&this.setState({status:x})},i.performEnter=function(e){var t=this,i=this.props.enter,s=this.context?this.context.isMounting:e,n=this.props.nodeRef?[s]:[o.findDOMNode(this),s],r=n[0],l=n[1],a=this.getTimeouts(),d=s?a.appear:a.enter;!e&&!i||f?this.safeSetState({status:C},(function(){t.props.onEntered(r)})):(this.props.onEnter(r,l),this.safeSetState({status:b},(function(){t.props.onEntering(r,l),t.onTransitionEnd(d,(function(){t.safeSetState({status:C},(function(){t.props.onEntered(r,l)}))}))})))},i.performExit=function(){var e=this,t=this.props.exit,i=this.getTimeouts(),s=this.props.nodeRef?void 0:o.findDOMNode(this);t&&!f?(this.props.onExit(s),this.safeSetState({status:y},(function(){e.props.onExiting(s),e.onTransitionEnd(i.exit,(function(){e.safeSetState({status:F},(function(){e.props.onExited(s)}))}))}))):this.safeSetState({status:F},(function(){e.props.onExited(s)}))},i.cancelNextCallback=function(){null!==this.nextCallback&&(this.nextCallback.cancel(),this.nextCallback=null)},i.safeSetState=function(e,t){t=this.setNextCallback(t),this.setState(e,t)},i.setNextCallback=function(e){var t=this,i=!0;return this.nextCallback=function(s){i&&(i=!1,t.nextCallback=null,e(s))},this.nextCallback.cancel=function(){i=!1},this.nextCallback},i.onTransitionEnd=function(e,t){this.setNextCallback(t);var i=this.props.nodeRef?this.props.nodeRef.current:o.findDOMNode(this),s=null==e&&!this.props.addEndListener;if(i&&!s){if(this.props.addEndListener){var n=this.props.nodeRef?[this.nextCallback]:[i,this.nextCallback],r=n[0],l=n[1];this.props.addEndListener(r,l)}null!=e&&setTimeout(this.nextCallback,e)}else setTimeout(this.nextCallback,0)},i.render=function(){var e=this.state.status;if(e===x)return null;var t=this.props,i=t.children;t.in,t.mountOnEnter,t.unmountOnExit,t.appear,t.enter,t.exit,t.timeout,t.addEndListener,t.onEnter,t.onEntering,t.onEntered,t.onExit,t.onExiting,t.onExited,t.nodeRef;var s=l(t,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]);return r.createElement(E.Provider,{value:null},"function"==typeof i?i(e,s):r.cloneElement(r.Children.only(i),s))},t}(r.Component);function S(){}R.contextType=E,R.propTypes={},R.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:S,onEntering:S,onEntered:S,onExit:S,onExiting:S,onExited:S},R.UNMOUNTED=x,R.EXITED=F,R.ENTERING=b,R.ENTERED=C,R.EXITING=y;var I=function(e,t){return e&&t&&t.split(" ").forEach((function(t){return s=t,void((i=e).classList?i.classList.remove(s):"string"==typeof i.className?i.className=g(i.className,s):i.setAttribute("class",g(i.className&&i.className.baseVal||"",s)));var i,s}))},P=function(e){function t(){for(var t,i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];return(t=e.call.apply(e,[this].concat(s))||this).appliedClasses={appear:{},enter:{},exit:{}},t.onEnter=function(e,i){var s=t.resolveArguments(e,i),n=s[0],r=s[1];t.removeClasses(n,"exit"),t.addClass(n,r?"appear":"enter","base"),t.props.onEnter&&t.props.onEnter(e,i)},t.onEntering=function(e,i){var s=t.resolveArguments(e,i),n=s[0],r=s[1]?"appear":"enter";t.addClass(n,r,"active"),t.props.onEntering&&t.props.onEntering(e,i)},t.onEntered=function(e,i){var s=t.resolveArguments(e,i),n=s[0],r=s[1]?"appear":"enter";t.removeClasses(n,r),t.addClass(n,r,"done"),t.props.onEntered&&t.props.onEntered(e,i)},t.onExit=function(e){var i=t.resolveArguments(e)[0];t.removeClasses(i,"appear"),t.removeClasses(i,"enter"),t.addClass(i,"exit","base"),t.props.onExit&&t.props.onExit(e)},t.onExiting=function(e){var i=t.resolveArguments(e)[0];t.addClass(i,"exit","active"),t.props.onExiting&&t.props.onExiting(e)},t.onExited=function(e){var i=t.resolveArguments(e)[0];t.removeClasses(i,"exit"),t.addClass(i,"exit","done"),t.props.onExited&&t.props.onExited(e)},t.resolveArguments=function(e,i){return t.props.nodeRef?[t.props.nodeRef.current,e]:[e,i]},t.getClassNames=function(e){var i=t.props.classNames,s="string"==typeof i,n=s?""+(s&&i?i+"-":"")+e:i[e];return{baseClassName:n,activeClassName:s?n+"-active":i[e+"Active"],doneClassName:s?n+"-done":i[e+"Done"]}},t}m(t,e);var i=t.prototype;return i.addClass=function(e,t,i){var s=this.getClassNames(t)[i+"ClassName"],n=this.getClassNames("enter").doneClassName;"appear"===t&&"done"===i&&n&&(s+=" "+n),"active"===i&&e&&v(e),s&&(this.appliedClasses[t][i]=s,function(e,t){e&&t&&t.split(" ").forEach((function(t){return s=t,void((i=e).classList?i.classList.add(s):function(e,t){return e.classList?!!t&&e.classList.contains(t):-1!==(" "+(e.className.baseVal||e.className)+" ").indexOf(" "+t+" ")}(i,s)||("string"==typeof i.className?i.className=i.className+" "+s:i.setAttribute("class",(i.className&&i.className.baseVal||"")+" "+s)));var i,s}))}(e,s))},i.removeClasses=function(e,t){var i=this.appliedClasses[t],s=i.base,n=i.active,r=i.done;this.appliedClasses[t]={},s&&I(e,s),n&&I(e,n),r&&I(e,r)},i.render=function(){var e=this.props;e.classNames;var t=l(e,["classNames"]);return r.createElement(R,a({},t,{onEnter:this.onEnter,onEntered:this.onEntered,onEntering:this.onEntering,onExit:this.onExit,onExiting:this.onExiting,onExited:this.onExited}))},t}(r.Component);P.defaultProps={classNames:""},P.propTypes={};const N=({field:e,style:t,children:n,noHighlightContainer:r})=>{i.useSyncExternalStore(e.subscribe.bind(e),e.getSnapshot.bind(e));const o=e.getProps(),l=e.isHidden(),a=o.autoHeightResize?" auto-height":"",d=o.containerClassName?" "+o.containerClassName:"",h=D(e),u=e.isHighlighted()&&!r?e.getHighlightedStyle():void 0,p={...o.containerStyle,...t,...u},c=i.useRef(null);return s.jsx(P,{nodeRef:c,in:!l,timeout:300,classNames:"zoom",unmountOnExit:!0,children:s.jsx("div",{ref:c,className:"dform-field-container"+d+a,style:p,onClick:h,children:n})})},D=e=>{const t=p((t=>{t.stopPropagation();const i=document.activeElement;e.setHighlighted(!0),setTimeout((()=>{null==i||i.focus()}),100)}));return"constructor"===e.getModel().getFormMode()?t:void 0};class BaseField{constructor(e,i,s,n){t(this,"fieldProps"),t(this,"fieldId"),t(this,"model"),t(this,"parent"),t(this,"listeners",[]),t(this,"renderSnapshot",{}),t(this,"fieldsMap",{}),t(this,"rootFields",{}),this.fieldId=e,this.fieldProps=i,this.model=s,this.parent=n}prepareChildrenFieldsCollection(){return[{},{}]}initFieldParameters(e,t){}getProps(){return this.fieldProps}setProps(e,t){this.fieldProps=e,t||this.emitRender()}noGrowWidth(){return!1}managesChildWidth(){return!1}getWidth(){var e;if(!(null==(e=this.parent)?void 0:e.managesChildWidth()))return this.fieldProps.width}updateProps(e,t){const i=this.getProps()??{};this.setProps({...i,...e},t)}getId(){return this.fieldId}getFormProps(){return this.model.getFormProps()}getModel(){return this.model}getParent(){return this.parent}getLabel(){return this.model.getLabels()[this.fieldId]}setLabel(e,t,i){var s,n;const r=this.getLabel();r!==e&&(this.model.getLabels()[this.fieldId]=e,t||null==(n=null==(s=this.getProps())?void 0:s.onLabelChanged)||n.call(s,e,r,this),i||this.emitRender())}getValue(){return this.model.getValues()[this.fieldId]}setValue(e,t,i){var s,n,r,o;const l=this.getValue();if(l===e)return;const a=this.model.getValues();a[this.fieldId]=e,t||(null==(n=null==(s=this.getProps())?void 0:s.onValueChanged)||n.call(s,e,l,this),null==(o=(r=this.model.getFormProps()).onFormValuesChanged)||o.call(r,this.fieldId,a,this.model.getFormApi(),new h),this.validate(t,i)),i||this.emitRender(),this.model.lockDependedFields(this,t,i)}isEmptyValue(){const e=this.getValue();return null===e||(!(!u(e)||0!==e.length)||("object"==typeof e&&0===Object.keys(e).length||0!==e&&!e))}isTouched(){return this.model.getTouchedFields()[this.fieldId]??!1}setTouched(e,t){var i,s;this.isTouched()!==e&&(this.model.getTouchedFields()[this.fieldId]=e,t||null==(s=null==(i=this.getProps())?void 0:i.onTouchedStateChanged)||s.call(i,e,this))}isDirty(){return this.model.getDirtyFields()[this.fieldId]??!1}setDirty(e,t){var i,s;if(this.isDirty()===e)return;this.model.getDirtyFields()[this.fieldId]=e,t||null==(s=null==(i=this.getProps())?void 0:i.onDirtyStateChanged)||s.call(i,e,this);let n=e;if(!e)for(const r in this.model.getDirtyFields()){if(this.model.getDirtyFields()[r]){n=!0;break}}this.model.setFormDirty(n,t)}isDisabled(){var e;return!!(this.model.isFormDisabled()||"disabled"===this.getProps().nonEditable&&"update"===this.model.getFormMode()||(null==(e=this.getParent())?void 0:e.isDisabled()))||(this.model.getDisabledFields()[this.fieldId]??!1)}setDisabled(e,t,i){var s,n;this.isDisabled()!==e&&(this.model.getDisabledFields()[this.fieldId]=e,t||null==(n=null==(s=this.getProps())?void 0:s.onDisabledStateChanged)||n.call(s,e,this),i||this.model.emitFormRender())}isReadOnly(){var e;return!(!this.model.isFormReadOnly()&&(!0!==this.getProps().nonEditable&&"readOnly"!==this.getProps().nonEditable||"update"!==this.model.getFormMode())&&!(null==(e=this.getParent())?void 0:e.isReadOnly()))||(this.model.getReadOnlyFields()[this.fieldId]??!1)}setReadOnly(e,t,i){var s,n;this.model.getReadOnlyFields()[this.fieldId]!==e&&(this.model.getReadOnlyFields()[this.fieldId]=e,t||null==(n=null==(s=this.getProps())?void 0:s.onReadOnlyStateChanged)||n.call(s,e,this),i||this.emitRender())}isHidden(){return this.model.getHiddenFields()[this.fieldId]??!1}setHidden(e,t,i){var s,n;this.isHidden()!==e&&(this.model.getHiddenFields()[this.fieldId]=e,this.model.lockDependedFields(this,t,i),e&&(this.setError("",t,i),this.setReady(!1,!0)),t||null==(n=null==(s=this.getProps())?void 0:s.onHiddenStateChanged)||n.call(s,e,this),i||this.model.emitFormRender())}isReady(){if(this.model.isFormFetching()||this.model.isFormFetchingFailed())return!1;return!this.model.getFetchingFields()[this.fieldId]&&(this.model.getReadyFields()[this.fieldId]??!1)}setReady(e,t){var i,s;this.isReady()!==e&&(this.model.getReadyFields()[this.fieldId]=e,t||null==(s=null==(i=this.getProps())?void 0:i.onReadyStateChanged)||s.call(i,e,this),this.model.checkFormReadyState())}getError(){return this.model.getErrors()[this.fieldId]??""}setError(e,t,i){var s,n,r;if(this.getError()===e)return;const o=this.model.getErrors();if(e?o[this.fieldId]=e:delete o[this.fieldId],!t){const t=this.getProps();null==(s=null==t?void 0:t.onErrorChanged)||s.call(t,e,this);const i=this.model.getFormProps(),l=this.model.getValues(),a=this.model.getFormDataSet();this.model.isFormHasError()?null==(n=i.onFormHasErrors)||n.call(i,l,a,o,this.model.getFormApi(),new h):null==(r=i.onFormHasNoErrors)||r.call(i,l,a,this.model.getFormApi(),new h)}i||this.emitRender()}validate(e,t){var i,s,n;const r=this.getProps().rules??[],o=(null==(i=this.getFormProps().validationRules)?void 0:i[this.fieldId])??[],l=this.isHidden()?"":this.model.getValidator().validateValue(this.getValue(),this.model,r.concat(o));return this.setError(l,e),e||this.isHidden()||null==(n=null==(s=this.getProps())?void 0:s.onValidated)||n.call(s,this.getValue(),l,this.model.isFormSubmitting(),this),t||this.emitRender(),l}onInitialFetch(){this.fetchData()}isFetching(){return 1===this.model.getFetchingFields()[this.fieldId]}isFetchingFailed(){return-1===this.model.getFetchingFields()[this.fieldId]}fetchData(){var e,t;const i=null==(t=(e=this.fieldProps).onFieldDataFetch)?void 0:t.call(e,this);if(!i)return;const s=this.model.getFetchingFields();s[this.fieldId]=1,this.model.checkFormReadyState(),this.emitRender(),i.then((e=>{var t,i;if(!this.model.isFormMounted())return;s[this.fieldId]=0,null==(i=(t=this.fieldProps).onFieldDataFetchSuccess)||i.call(t,e,this);const n=e.data;this.model.setValues(n),this.model.checkFormReadyState(),this.emitRender()}),(e=>{var t,i;this.model.isFormMounted()&&(s[this.fieldId]=-1,null==(i=(t=this.fieldProps).onFieldDataFetchError)||i.call(t,e,this),this.model.checkFormReadyState(),this.emitRender())}))}isHighlighted(){return this.model.getHighlightedId()===this.fieldId}setHighlighted(e,t,i){var s,n;const r=this.model.getHighlightedId(),o=e?this.getId():"";if(r===o)return;this.model.setHighlightedId(o);const l=r?this.model.getField(r):void 0;t||null==(n=null==(s=this.getFormProps())?void 0:s.onHighlightedFieldChanged)||n.call(s,e?this:void 0,l,void 0,this.model.getFormApi()),i||(this.emitRender(),l&&(null==l||l.emitRender()))}toggleHighlighted(e,t){this.setHighlighted(!this.isHighlighted(),e,t)}getFieldsMap(){return this.fieldsMap}getRootFields(){return this.rootFields}isContainer(){return Object.keys(this.rootFields).length>0}hasVisibleChildren(){for(const e in this.rootFields){const t=this.rootFields[e];if(!t.isContainer()&&!t.isHidden()||t.hasVisibleChildren())return!0}return!1}render(){throw new Error("Render method must be implemented in a derived class of the BaseField class")}renderField({altLabel:e,extraContainerStyle:t}={}){return this.renderFieldItem({children:this.render(),altLabel:e,extraContainerStyle:t})}renderFieldItem({children:e,altLabel:t,extraContainerStyle:i,noHighlightContainer:n}){return this.noContainer()?this.noItemWrapper()?s.jsx(s.Fragment,{children:e}):s.jsx(c,{field:this,altLabel:t,children:e}):this.noItemWrapper()?s.jsx(N,{field:this,style:i,noHighlightContainer:n,children:e},this.getId()):s.jsx(N,{field:this,style:i,noHighlightContainer:n,children:s.jsx(c,{field:this,altLabel:t,children:e})},this.getId())}noItemWrapper(){return this.getProps().noItemWrapper}noContainer(){return this.getProps().noContainer}getHighlightedStyle(){return{border:"dashed 1px blue"}}canHaveValue(){return!0}subscribe(e){return this.listeners=[...this.listeners,e],()=>{this.listeners=this.listeners.filter((t=>t!==e))}}getSnapshot(){return this.renderSnapshot}emitRender(){this.renderSnapshot={};for(const e of this.listeners)e()}}export{BaseField as B};
