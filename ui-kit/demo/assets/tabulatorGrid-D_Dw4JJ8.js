import{r as l,I as H,_ as G,R as P,o as le,z as ve,al as Se,a as ue,n as X,bP as ie,j as h,bQ as Fe}from"./index-CEW5Pw51.js";import{b as fe,I as K,G as de,m as Q,c as he,M as Pe,R as pe,O as Ke,e as be,h as Oe,t as Ie,L as je,v as Te,f as Ee}from"./index-XDwG7I6Z.js";import{M as Ne,D as ne}from"./dFormModal-CQxmvlme.js";import{R as ge}from"./EyeOutlined-CTrlI0WT.js";import{p as Me,R as Le}from"./docco-BDmKSriJ.js";import{u as Be,T as He,S as Ge,f as me,d as ze,a as _e,e as $e,h as Ve,C as We,j as Ue,R as qe}from"./DeleteOutlined-DC7B5UxI.js";var Xe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 444H820V330.4c0-17.7-14.3-32-32-32H473L355.7 186.2a8.15 8.15 0 00-5.5-2.2H96c-17.7 0-32 14.3-32 32v592c0 17.7 14.3 32 32 32h698c13 0 24.8-7.9 29.7-20l134-332c1.5-3.8 2.3-7.9 2.3-12 0-17.7-14.3-32-32-32zM136 256h188.5l119.6 114.4H748V444H238c-13 0-24.8 7.9-29.7 20L136 643.2V256zm635.3 512H159l103.3-256h612.4L771.3 768z"}}]},name:"folder-open",theme:"outlined"},Qe=function(t,n){return l.createElement(H,G({},t,{ref:n,icon:Xe}))},Je=l.forwardRef(Qe),Ye={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M300 276.5a56 56 0 1056-97 56 56 0 00-56 97zm0 284a56 56 0 1056-97 56 56 0 00-56 97zM640 228a56 56 0 10112 0 56 56 0 00-112 0zm0 284a56 56 0 10112 0 56 56 0 00-112 0zM300 844.5a56 56 0 1056-97 56 56 0 00-56 97zM640 796a56 56 0 10112 0 56 56 0 00-112 0z"}}]},name:"holder",theme:"outlined"},Ze=function(t,n){return l.createElement(H,G({},t,{ref:n,icon:Ye}))},Ae=l.forwardRef(Ze);const oe=4;function et(e){const{dropPosition:t,dropLevelOffset:n,prefixCls:o,indent:s,direction:r="ltr"}=e,c=r==="ltr"?"left":"right",a=r==="ltr"?"right":"left",u={[c]:-n*s+oe,[a]:0};switch(t){case-1:u.top=-3;break;case 1:u.bottom=-3;break;default:u.bottom=-3,u[c]=s+oe;break}return P.createElement("div",{style:u,className:`${o}-drop-indicator`})}const ye=P.forwardRef((e,t)=>{var n;const{getPrefixCls:o,direction:s,virtual:r,tree:c}=P.useContext(le),{prefixCls:a,className:u,showIcon:i=!1,showLine:f,switcherIcon:d,blockNode:b=!1,children:w,checkable:k=!1,selectable:R=!0,draggable:v,motion:I,style:O}=e,D=o("tree",a),j=o(),y=I??Object.assign(Object.assign({},ve(j)),{motionAppear:!1}),E=Object.assign(Object.assign({},e),{checkable:k,selectable:R,showIcon:i,motion:y,blockNode:b,showLine:!!f,dropIndicatorRender:et}),[_,F,C]=Be(D),[,x]=Se(),g=x.paddingXS/2+(((n=x.Tree)===null||n===void 0?void 0:n.titleHeight)||x.controlHeightSM),T=P.useMemo(()=>{if(!v)return!1;let m={};switch(typeof v){case"function":m.nodeDraggable=v;break;case"object":m=Object.assign({},v);break}return m.icon!==!1&&(m.icon=m.icon||P.createElement(Ae,null)),m},[v]),$=m=>P.createElement(Ge,{prefixCls:D,switcherIcon:d,treeNodeProps:m,showLine:f});return _(P.createElement(He,Object.assign({itemHeight:g,ref:t,virtual:r},E,{style:Object.assign(Object.assign({},c==null?void 0:c.style),O),prefixCls:D,className:ue({[`${D}-icon-hide`]:!i,[`${D}-block-node`]:b,[`${D}-unselectable`]:!R,[`${D}-rtl`]:s==="rtl"},c==null?void 0:c.className,u,F,C),direction:s,checkable:k&&P.createElement("span",{className:`${D}-checkbox-inner`}),selectable:R,switcherIcon:$,draggable:T}),w))}),se=0,V=1,re=2;function J(e,t,n){const{key:o,children:s}=n;function r(c){const a=c[o],u=c[s];t(a,c)!==!1&&J(u||[],t,n)}e.forEach(r)}function tt(e){let{treeData:t,expandedKeys:n,startKey:o,endKey:s,fieldNames:r}=e;const c=[];let a=se;if(o&&o===s)return[o];if(!o||!s)return[];function u(i){return i===o||i===s}return J(t,i=>{if(a===re)return!1;if(u(i)){if(c.push(i),a===se)a=V;else if(a===V)return a=re,!1}else a===V&&c.push(i);return n.includes(i)},me(r)),c}function W(e,t,n){const o=X(t),s=[];return J(e,(r,c)=>{const a=o.indexOf(r);return a!==-1&&(s.push(c),o.splice(a,1)),!!o.length},me(n)),s}var ce=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(n[o[s]]=e[o[s]]);return n};function nt(e){const{isLeaf:t,expanded:n}=e;return t?l.createElement(ze,null):n?l.createElement(Je,null):l.createElement(ie,null)}function ae(e){let{treeData:t,children:n}=e;return t||Ve(n)}const ot=(e,t)=>{var{defaultExpandAll:n,defaultExpandParent:o,defaultExpandedKeys:s}=e,r=ce(e,["defaultExpandAll","defaultExpandParent","defaultExpandedKeys"]);const c=l.useRef(),a=l.useRef(),u=()=>{const{keyEntities:F}=_e(ae(r));let C;return n?C=Object.keys(F):o?C=$e(r.expandedKeys||s||[],F):C=r.expandedKeys||s||[],C},[i,f]=l.useState(r.selectedKeys||r.defaultSelectedKeys||[]),[d,b]=l.useState(()=>u());l.useEffect(()=>{"selectedKeys"in r&&f(r.selectedKeys)},[r.selectedKeys]),l.useEffect(()=>{"expandedKeys"in r&&b(r.expandedKeys)},[r.expandedKeys]);const w=(F,C)=>{var x;return"expandedKeys"in r||b(F),(x=r.onExpand)===null||x===void 0?void 0:x.call(r,F,C)},k=(F,C)=>{var x;const{multiple:g,fieldNames:T}=r,{node:$,nativeEvent:m}=C,{key:M=""}=$,L=ae(r),B=Object.assign(Object.assign({},C),{selected:!0}),xe=(m==null?void 0:m.ctrlKey)||(m==null?void 0:m.metaKey),ke=m==null?void 0:m.shiftKey;let S;g&&xe?(S=F,c.current=M,a.current=S,B.selectedNodes=W(L,S,T)):g&&ke?(S=Array.from(new Set([].concat(X(a.current||[]),X(tt({treeData:L,expandedKeys:d,startKey:M,endKey:c.current,fieldNames:T}))))),B.selectedNodes=W(L,S,T)):(S=[M],c.current=M,a.current=S,B.selectedNodes=W(L,S,T)),(x=r.onSelect)===null||x===void 0||x.call(r,S,B),"selectedKeys"in r||f(S)},{getPrefixCls:R,direction:v}=l.useContext(le),{prefixCls:I,className:O,showIcon:D=!0,expandAction:j="click"}=r,y=ce(r,["prefixCls","className","showIcon","expandAction"]),E=R("tree",I),_=ue(`${E}-directory`,{[`${E}-directory-rtl`]:v==="rtl"},O);return l.createElement(ye,Object.assign({icon:nt,ref:t,blockNode:!0},y,{showIcon:D,expandAction:j,prefixCls:E,className:_,expandedKeys:d,selectedKeys:i,onSelect:k,onExpand:w}))},st=l.forwardRef(ot),Y=ye;Y.DirectoryTree=st;Y.TreeNode=We;var rt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880.1 154H143.9c-24.5 0-39.8 26.7-27.5 48L349 597.4V838c0 17.7 14.2 32 31.8 32h262.4c17.6 0 31.8-14.3 31.8-32V597.4L907.7 202c12.2-21.3-3.1-48-27.6-48zM603.4 798H420.6V642h182.9v156zm9.6-236.6l-9.5 16.6h-183l-9.5-16.6L212.7 226h598.6L613 561.4z"}}]},name:"filter",theme:"outlined"},ct=function(t,n){return l.createElement(H,G({},t,{ref:n,icon:rt}))},at=l.forwardRef(ct),lt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"}}]},name:"menu",theme:"outlined"},ut=function(t,n){return l.createElement(H,G({},t,{ref:n,icon:lt}))},it=l.forwardRef(ut);const we=(e,t,n)=>{if(!t)return;const o=e.gridProps;return e.setCurrentDataFetchHandler(t,n),(s,r,c)=>new Promise((a,u)=>{const i={...c,...n},f=t(i,e);if(typeof f>"u"&&a(U(o,{data:[]})),!fe(f)){K(f)?a(U(o,{data:f})):u(new Error);return}f.then(d=>{e.getIsMounted()&&a(U(o,d))},d=>{u(d)})})},U=(e,t)=>e.pagination||e.progressiveLoad?{data:t.data,last_page:t.last_page??1}:t.data;var ft=function(){var e=l.useRef(!1);return l.useEffect(function(){return e.current=!1,function(){e.current=!0}},[]),e};const dt=({gridApi:e,props:t,tableRef:n,editFormApi:o,selectionFormApi:s,buttonsApi:r,setColumnsDialog:c})=>{const a=l.useRef(void 0),u=l.useRef(),i=l.useRef(),[f,d]=l.useState(!1),b=ft();return ht(a,t.dataSet),e.gridProps=t,e.tableApi=n.current,e.editFormApi=o,e.selectionFormApi=s,e.buttonsApi=r,e.getIsMounted=mt(b),e.getId=bt(e),e.getDataSet=yt(a,e),e.setDataSet=wt(a,e),e.getIsLoading=Dt(f),e.setIsLoading=Rt(d),e.setActiveRowKey=Ct(e),e.getActiveRowKey=xt(e),e.getActiveNode=kt(e),e.getActiveRow=vt(e),e.getNextRowKey=St(e),e.getPrevRowKey=Ft(e),e.getSelectedRowKeys=Pt(e),e.getSelectedNodes=Ot(e),e.getSelectedRows=It(e),e.setSelectedRowKeys=pt(e),e.setSelectedRows=Kt(e),e.getNodeByKey=jt(e),e.getRowByKey=Tt(e),e.insertRows=Et(a,e),e.updateRows=Nt(a,e),e.removeRowsByKeys=Lt(a,e),e.removeRows=Bt(e),e.deleteRows=Ht(e),e.fetchData=Gt(e),e.retryFetchData=$t(e),e.setCurrentDataFetchHandler=zt(u,i),e.getCurrentDataFetchHandler=_t(u,i),e.getRowData=Vt(e),e.openColumnDialog=Wt(e,c),e},ht=(e,t)=>{const n=l.useRef(void 0);n.current!==t&&(n.current=t,e.current=t)},bt=e=>{const[t]=l.useState(e.gridProps.id??"grid-"+de());return l.useCallback(()=>t,[t])},mt=e=>l.useCallback(()=>!e.current,[e]),yt=(e,t)=>l.useCallback(()=>t.tableApi?t.tableApi.getData():e.current??void 0,[e,t.tableApi]),wt=(e,t)=>l.useCallback(n=>{var o,s,r,c,a,u;t.tableApi&&(e.current=n??void 0,(o=t.tableApi)==null||o.deselectRow(),(s=t.tableApi)==null||s.clearData(),(r=e.current)!=null&&r.length&&((c=t.tableApi)==null||c.setData(e.current)),(u=(a=t.gridProps).onDataChanged)==null||u.call(a,e.current,t))},[e,t]),Dt=e=>l.useCallback(()=>e,[e]),Rt=e=>l.useCallback(t=>{setTimeout(()=>{e(t)},0)},[e]),Ct=e=>l.useCallback((t,n,o)=>{e.tableApi&&e.tableApi.setActiveRowByKey(t,n,o)},[e]),xt=e=>l.useCallback(()=>{var t,n;return(n=(t=e.tableApi)==null?void 0:t.getActiveRowKey)==null?void 0:n.call(t)},[e]),kt=e=>l.useCallback(()=>{var t,n;return(n=(t=e.tableApi)==null?void 0:t.getActiveRow)==null?void 0:n.call(t)},[e]),vt=e=>l.useCallback(()=>{var t;return(t=e.getActiveNode())==null?void 0:t.getData()},[e]),St=e=>l.useCallback((t,n)=>{var s;if(!e.tableApi||!t)return;n||(n=1);let o=(s=e.tableApi)==null?void 0:s.getRow(t);if(o){for(let r=0;r<n;r++){const c=o==null?void 0:o.getNextRow();if(!c)return o.getData().id;o=c}return o.getData().id}},[e.tableApi]),Ft=e=>l.useCallback((t,n)=>{var s;if(!e.tableApi||!t)return;n||(n=1);let o=(s=e.tableApi)==null?void 0:s.getRow(t);if(o){for(let r=0;r<n;r++){const c=o==null?void 0:o.getPrevRow();if(!c)return o.getData().id;o=c}return o.getData().id}},[e.tableApi]),Pt=e=>{const t=l.useRef([]);return l.useCallback(()=>{if(!e.tableApi)return t.current;const n=e.tableApi.getSelectedData(),o=[];for(const s of n)o.push(s.id);return o},[e])},pt=e=>l.useCallback((t,n)=>{var s,r;if(!e.tableApi)return;(!t||n)&&((s=e.tableApi)==null||s.deselectRow());const o=K(t)?t:[t];(r=e.tableApi)==null||r.selectRow(o)},[e]),Kt=e=>l.useCallback((t,n)=>{if(!e.tableApi)return;if(!t)return e.setSelectedRowKeys(void 0,n);const o=[];for(const s of t)o.push(s.id);e.setSelectedRowKeys(o,n)},[e]),Ot=e=>l.useCallback(()=>{var t,n;return((n=(t=e.tableApi)==null?void 0:t.getSelectedRows)==null?void 0:n.call(t))??[]},[e]),It=e=>l.useCallback(()=>{var t,n;return((n=(t=e.tableApi)==null?void 0:t.getSelectedData)==null?void 0:n.call(t))??[]},[e]),jt=e=>l.useCallback(t=>{var n;if(!(!t||!e.tableApi))return(n=e.tableApi)==null?void 0:n.getRow(t)},[e]),Tt=e=>l.useCallback(t=>{var n;return(n=e.getNodeByKey(t))==null?void 0:n.getData()},[e]),Et=(e,t)=>l.useCallback((n,o,s,r)=>{var f,d;const c=t.tableApi;if(!c)return;const a=t.gridProps.dataTree,u=o==="above",i=K(n)?[...n]:[n];for(const b of i)a?gt(t,[b],o,s):c.addData([b],u,s).then();e.current=c.getData()||[],(d=(f=t.gridProps).onDataChanged)==null||d.call(f,e.current,t),r&&i[0]&&t.setActiveRowKey(i[0].id,!0,"center"),c.setTableBodyFocus()},[e,t]),Nt=(e,t)=>l.useCallback((n,o)=>{var c,a,u;if(!t.tableApi)return;const s=t.gridProps.dataTree,r=K(n)?[...n]:[n];for(const i of r)s?Mt(t,i):t.tableApi.updateData([i]).then();e.current=((c=t.tableApi)==null?void 0:c.getData())||[],(u=(a=t.gridProps).onDataChanged)==null||u.call(a,e.current,t),o&&r[0]&&t.setActiveRowKey(r[0].id,!0,"center"),t.tableApi.setTableBodyFocus()},[e,t]),De=(e,t)=>{if(!e.tableApi)return;const n=e.tableApi.options.dataTreeParentField,o=e.tableApi.options.index;if(!o||!n||!t[n])return;let s;if(typeof t[n]=="string"||typeof t[n]=="number"?s=t[n]:typeof t[n]=="object"&&(s=t[n][o]),!!s)return e.tableApi.getRow(s)||void 0},gt=(e,t,n,o)=>{var c;if(!e.tableApi)return;if(!e.gridProps.dataTree){console.warn("TreeData mode is disabled. Tree row updating not available");return}const s=n==="above",r=K(t)?[...t]:[t];for(const a of r){const u=De(e,a);u?(u.addTreeChild(a),Z(u),u.reformat()):(c=e.tableApi)==null||c.addData([a],s,o)}},Mt=(e,t)=>{if(!e.tableApi)return;if(!e.gridProps.dataTree){console.warn("TreeData mode is disabled. Tree row updating not available");return}const n=e.tableApi.options.index,o=e.tableApi.options.dataTreeChildField;if(!n||!o)return;const s=K(t)?[...t]:[t];for(const r of s){const c=r[n],a=e.tableApi.getRow(c);if(!a){e.tableApi.addData([r]).then();continue}const u=a.getTreeParent(),i=De(e,r);if(!u&&!i||u&&i&&u.getData()[n]===i.getData()[n]){e.tableApi.updateData([r]).then();continue}if(r[o]=a.getData()[o],e.tableApi.deselectRow(a),e.tableApi.deleteRow(c),u&&u.reformat(),!i){e.tableApi.addData([r]).then();continue}i.addTreeChild(r),Z(i),i.reformat()}},Z=e=>{if(!e)return;const t=e.getTreeParent();Z(t),e.isTreeExpanded()||e.treeExpand()},Lt=(e,t)=>l.useCallback(n=>{var u,i;const o=t.tableApi;if(!o)return;const s=o.options.index,r=K(n)?[...n]:[n];let c=!1,a=!1;for(const f of r){const d=o.getRow(f);if(!d)continue;c&&d===c&&(c=!1),a=d.getNextRow()||d.getPrevRow(),a&&(c=a);const b=o.options.dataTree?d.getTreeParent():!1;o.deselectRow(d),o.deleteRow(f),b&&b.reformat()}c&&s&&(c=o.getRow(c.getData()[s])),o.setActiveRow(c||null,!0,"bottom"),e.current=(o==null?void 0:o.getData())??[],(i=(u=t.gridProps).onDataChanged)==null||i.call(u,e.current,t),o.setTableBodyFocus()},[e,t]),Bt=e=>l.useCallback(t=>{const n=K(t)?[...t]:[t],o=[];for(const s of n)o.push(s.id);e.removeRowsByKeys(o)},[e]),Ht=e=>l.useCallback(t=>{if(!t)return;const n=Array.isArray(t)?t:[t],o=e.gridProps;let s;const r=()=>{var a;const c=(a=o==null?void 0:o.onDelete)==null?void 0:a.call(o,n,e);if(fe(c)){o.confirmDelete||e.setIsLoading(!0),c.then(()=>{e.getIsMounted()&&(e.removeRows(n),o.confirmDelete?s==null||s.destroy():e.setIsLoading(!1))}).catch(i=>{e.getIsMounted()&&(o.confirmDelete?s==null||s.destroy():e.setIsLoading(!1),Q.alert({content:h.jsxs(h.Fragment,{children:[h.jsx("p",{children:h.jsx("b",{children:i.message})}),i.stack&&he()?h.jsx("p",{children:i.stack}):""]}),colorType:"danger"}))});return}e.removeRows(n),s&&s.destroy()};o.confirmDelete?s=Q.confirmWaiter({content:o.rowDeleteMessage??"Удалить выбранные строки?",onOk:r}):r()},[e]),Gt=e=>l.useCallback((t,n)=>{const o=e.tableApi;o&&(o.modules.page.dataChanging=!0,o.modules.ajax.setUrl("-"),t&&(o.modules.ajax.loaderPromise=we(e,t,n)),o.setData(void 0,n).then())},[e]),zt=(e,t)=>l.useCallback((n,o)=>{e.current=n,t.current=o},[e,t]),_t=(e,t)=>l.useCallback(()=>[e.current,t.current],[e,t]),$t=e=>l.useCallback(()=>{const[t,n]=e.getCurrentDataFetchHandler();t&&e.fetchData(t,n)},[e]),Vt=e=>l.useCallback((t,n,o,s,r)=>{const c=e.tableApi;if(!c||!t)return{};const a=s?{}:{...t.getData()};if(!c.options.dataTree)return a;const u=c.options.dataTreeParentField,i=c.options.dataTreeChildField;if(!r&&i&&delete a[i],!u||typeof a[u]<"u")return a;const f=o?t:t.getTreeParent();if(!f)return a;const d=f.getData();return!r&&i&&delete d[i],a[u]=f.getData(),a},[e]),Wt=(e,t)=>l.useCallback(n=>{t(n)},[t]),Ut=e=>l.useMemo(()=>{var s;const t=(s=e.gridProps)==null?void 0:s.editFormProps;if(!t)return;const n={...t},o=t==null?void 0:t.onSubmitSuccess;return n.onSubmitSuccess=(r,c,a)=>{if(o&&o(r,c,a)===!1)return!1;const u={...a.model.getFormDataSet(),...c},i=a.model.getFormMode();if(i==="create"||i==="clone"){u.id||(u.id=de());const f=e.getActiveRowKey();e.insertRows(u,"below",f??void 0,!0)}else i==="update"&&e.updateRows(u,!0)},n},[e]),qt=e=>{const[,t]=l.useState({}),n=e.gridProps.buttons,o=e.gridProps.buttonsSize??"small",s=e.gridProps.buttonsPosition??"right",r=e.gridProps.buttonsIconsOnly,c=e.getActiveRow(),a=e.getSelectedRows();e.buttonsApi.refreshButtons=Xt(t);const u=Qt(e),i=Jt(e,c,a),f=Yt(e),d=Zt(e,c,a),b=At(e,c,a),w=tn(e,a),k=en(e),R=nn(e,e.tableApi),v=on(e);return l.useMemo(()=>{var D;const O=Pe({headerLabel:u,view:i,create:f,clone:d,update:b,select:k,delete:w,filterToggle:R,system:v},n);for(const j in O){const y=O[j];!y||j==="headerLabel"||(y.size=y.size??o,y.position=y.position??s,r&&(y.tooltip=y.tooltip??((D=y.title)==null?void 0:D.toString()),y.title=void 0),y.checkDisabled&&(y.disabled=!c||a.length!==1),y.checkHidden&&(y.hidden=!c||a.length!==1))}return O},[u,i,f,d,b,k,w,R,v,n,o,s,r,c,a.length])},Xt=e=>l.useCallback(()=>{e({})},[e]),Qt=e=>l.useMemo(()=>{const t=e.gridProps;if(t.headerLabel)return{weight:1,title:t.headerLabel,type:"element",position:"left"}},[e]),Jt=(e,t,n)=>l.useMemo(()=>{var r;const o=e.gridProps,s=e.editFormApi;if(!(!o.editFormProps||!o.readOnly||((r=o.buttons)==null?void 0:r.view)===null))return{weight:100,title:"Просмотреть",tooltip:"Просмотреть запись",icon:h.jsx(ge,{}),position:"right",disabled:!t||n.length!==1,hotKeys:[{key:"Enter"}],onClick:()=>{if(!e.getActiveRow())return;const c=z(e,!1);s.open("view",c)}}},[t,e,n.length]),Yt=e=>l.useMemo(()=>{var o;const t=e.gridProps,n=e.editFormApi;if(!(!t.editFormProps||t.readOnly||((o=t.buttons)==null?void 0:o.create)===null))return{weight:110,title:"Создать",tooltip:"Создать новую запись",icon:h.jsx(pe,{}),position:"right",hotKeys:[{key:"Insert"}],onClick:()=>{const s=z(e,!0,!0);n.open("create",s)}}},[e]),Zt=(e,t,n)=>l.useMemo(()=>{var r;const o=e.gridProps,s=e.editFormApi;if(!(!o.editFormProps||o.readOnly||((r=o.buttons)==null?void 0:r.clone)===null))return{weight:120,title:"Клонировать",tooltip:"Клонировать запись",icon:h.jsx(Me,{}),position:"right",disabled:!t||n.length!==1,hotKeys:[{key:"F9"}],onClick:()=>{if(!e.getActiveRow())return;const c=z(e,!1);s.open("clone",c)}}},[t,e,n.length]),At=(e,t,n)=>l.useMemo(()=>{var r;const o=e.gridProps,s=e.editFormApi;if(!(!o.editFormProps||o.readOnly||((r=o.buttons)==null?void 0:r.update)===null))return{weight:130,title:"Редактировать",tooltip:"Редактировать запись",icon:h.jsx(Le,{}),position:"right",disabled:!t||n.length!==1,hotKeys:[{key:"Enter"},{key:"F2"}],onClick:()=>{if(!e.getActiveRow())return;const c=z(e,!1);s.open("update",c)}}},[t,e,n.length]),en=e=>l.useMemo(()=>{var o;const t=e.gridProps,n=e.selectionFormApi;if(!(!t.selectionFormProps||t.readOnly||((o=t.buttons)==null?void 0:o.select)===null))return{weight:130,title:"Выбрать",tooltip:"Выбрать записи",icon:h.jsx(Ue,{}),position:"right",hotKeys:[{key:"Insert"}],onClick:()=>{const s=e.getDataSet();n.open("update",{select:s})}}},[e]),tn=(e,t)=>l.useMemo(()=>{var o;const n=e.gridProps;if(!(!n.editFormProps&&!n.selectionFormProps||n.readOnly||((o=n.buttons)==null?void 0:o.delete)===null))return{weight:140,title:"Удалить",tooltip:"Удалить запись",icon:h.jsx(qe,{}),position:"right",colorType:"danger",disabled:!t||t.length===0,hotKeys:[{key:"Delete",ctrl:!0}],onClick:()=>{const s=e.getSelectedRows();e.deleteRows(s)}}},[e,t]),nn=(e,t)=>l.useMemo(()=>{var o,s;if(((o=e.gridProps.buttons)==null?void 0:o.filterToggle)!==null&&t!=null&&t.isHeaderFilterAvailable())return{weight:1e3,icon:h.jsx(at,{}),position:"right",active:(s=e.tableApi)==null?void 0:s.isHeaderFilterVisible(),tooltip:"Фильтр",onClick:()=>{const r=t==null?void 0:t.toggleHeaderFilter();e.buttonsApi.updateButtons({filterToggle:{active:r}})}}},[e.buttonsApi,e.gridProps,e.tableApi,t]),z=(e,t,n)=>{const o=e.getActiveNode();return e.getRowData(o,!0,t,n)},on=e=>l.useMemo(()=>{var n;if(((n=e.gridProps.buttons)==null?void 0:n.filterToggle)!==null)return{weight:2e3,expandIcon:h.jsx(it,{}),position:"right",children:{toXlsx:{title:"Экспорт в Excel",onClick:()=>{Fe(()=>import("./xlsx-B8nI__6b.js"),[]).then(s=>{var r;window.XLSX=s,(r=e.tableApi)==null||r.download("xlsx","table.xlsx")})}},columns:{title:"Настройки столбцов",onClick:()=>{e.openColumnDialog(!0)}}}}},[e]),sn=({gridApi:e})=>{const t=e.gridProps,n=qt(e),[o,s]=l.useState(void 0);return l.useLayoutEffect(()=>{var c;const r=Ke(n)>0;(typeof o>"u"||o!==r)&&(s(r),(c=t==null?void 0:t.onMenuVisibilityChanged)==null||c.call(t,r,e))},[n,e,t,t==null?void 0:t.onMenuVisibilityChanged,o]),n?h.jsx("div",{style:{width:"100%",paddingBottom:8,paddingTop:8},children:h.jsx(be,{buttons:n,apiRef:e.buttonsApi,context:e})}):null},rn=(e,t)=>l.useMemo(()=>({tableBuilt:()=>{var n;(n=t==null?void 0:t.tableBuilt)==null||n.call(t),e.buttonsApi.refreshButtons()},dataLoading:n=>{var o,s,r;(o=t==null?void 0:t.dataLoading)==null||o.call(t,n),(r=(s=e.gridProps).onDataLoading)==null||r.call(s,n,e),e.gridProps.progressiveLoad||e.setIsLoading(!0)},dataLoaded:n=>{var o,s,r;(o=t==null?void 0:t.dataLoaded)==null||o.call(t,n),(r=(s=e.gridProps).onDataLoaded)==null||r.call(s,n,e),e.getIsMounted()&&(e.gridProps.progressiveLoad||e.setIsLoading(!1))},dataProcessed:n=>{var o,s,r;(o=t==null?void 0:t.dataProcessed)==null||o.call(t,n),(r=(s=e.gridProps).onDataProcessed)==null||r.call(s,n,e)},dataLoadError:n=>{var r,c,a;(r=t==null?void 0:t.dataLoadError)==null||r.call(t,n);const o=n;if((a=(c=e.gridProps).onDataLoadError)==null||a.call(c,o.message,o.code,e),!e.getIsMounted())return;e.setIsLoading(!1);const s=Q.confirm({content:h.jsxs("div",{children:[h.jsx("p",{children:h.jsx("b",{children:n.message})}),n.stack&&he()?h.jsx("p",{children:n.stack}):"",h.jsx("p",{children:"Попробовать снова?"})]}),colorType:"danger",buttons:{ok:{onClick:()=>{s.destroy(),e.retryFetchData()}}}})},rowDblClick:(n,o)=>{var s;(s=t==null?void 0:t.rowDblClick)==null||s.call(t,n,o),e.buttonsApi.triggerClick("update")},activeRowChanged:n=>{var o;(o=t==null?void 0:t.activeRowChanged)==null||o.call(t,n),e.buttonsApi.refreshButtons()},rowSelectionChanged:(n,o,s,r)=>{var c,a,u;(c=t==null?void 0:t.rowSelectionChanged)==null||c.call(t,n,o,s,r),(u=(a=e.gridProps).onSelectionChange)==null||u.call(a,n,o,s,r,e)}}),[t,e]),cn=({tableRef:e,gridApi:t,gridProps:n,tabulatorProps:o})=>{const s=rn(t,n.events),r=l.useRef(void 0),c=l.useCallback(f=>{e.current=f.current,t.tableApi=f.current,n.resizeHeightWithParent&&(r.current=an(e,n.resizeHeightWithParent))},[t,n.resizeHeightWithParent,e]);l.useEffect(()=>()=>{var f;(f=r.current)==null||f.disconnect()},[]),l.useEffect(()=>{Oe.pushToStack(t.getId())},[t]);const a=l.useMemo(()=>we(t,n==null?void 0:n.onDataFetch),[t,n.onDataFetch]),u=l.useCallback((f,d)=>{var b;return(b=n.onDataFetching)==null?void 0:b.call(n,f,d,t)},[t,n.onDataFetching]),i=l.useCallback((f,d,b)=>{var w;return(w=n.onDataFetchResponse)==null?void 0:w.call(n,b,d,t)},[t,n.onDataFetchResponse]);return h.jsx(Ie,{...o,id:t.getId(),layout:o.layout??"fitData",movableColumns:o.movableColumns!==!1,height:"100%",dataLoader:!1,onTableRef:c,dataTreeFilter:!0,data:n.dataSet,ajaxRequesting:n.onDataFetching?void 0:u,ajaxRequestFunc:n.onDataFetch?a:void 0,ajaxResponse:n.onDataFetchResponse?i:void 0,containerClassName:n.className,placeholder:n.placeholder??"Строки отсутствуют",events:s})},an=(e,t)=>{var u,i;const n=(i=(u=e.current)==null?void 0:u.element)==null?void 0:i.closest(".tabulator-grid-container"),o=n==null?void 0:n.closest(t);if(!n||!o||n.style.height.endsWith("%"))return;let s=parseInt(n.style.height),r=o.getBoundingClientRect().height;const c=()=>{if(!e.current)return;const f=o.getBoundingClientRect().height;s=s+(f-r),n.style.height=(s>0?s:0)+"px",r=o.getBoundingClientRect().height},a=new ResizeObserver(c);return a.observe(o),a},ln=e=>{const[t]=l.useState({});return h.jsx(Ne,{title:"Столбцы",destroyOnClose:!0,centered:!0,open:e.open,onCancel:()=>e.gridApi.openColumnDialog(!1),footer:h.jsx(fn,{formProps:e,dialogApi:t}),children:e.open&&h.jsx(un,{dialogProps:e,dialogApi:t})})},un=({dialogProps:e,dialogApi:t})=>{const n=e.gridApi.tableApi,[o,s]=l.useState([]),[r,c]=l.useState([]),[a,u]=l.useState([]);t.gridApi=e.gridApi,t.setNodes=u,t.setChecked=s,t.setExpanded=c,l.useEffect(()=>{const b=Ce(n.getColumns(!0));Re(t,b),dn(t)},[]);const i=Rn(t,s),f=Dn(t),d=wn(t);return h.jsx(Y,{draggable:!0,blockNode:!0,showIcon:!0,defaultExpandAll:!0,checkable:!0,expandedKeys:r,checkedKeys:o,treeData:a,selectable:!1,onCheck:i,allowDrop:d,onDrop:f,onExpand:b=>{c(b)}})},fn=({formProps:e,dialogApi:t})=>h.jsx(be,{arrowsSelection:!0,buttons:{ok:{title:"OK",position:"right",active:!0,onClick:()=>Cn(e,t)},cancel:{title:"Отмена",position:"right",onClick:()=>{e.gridApi.openColumnDialog(!1)}},default:{title:"По умолчанию",position:"left",onClick:()=>xn(e,t)}}}),Re=(e,t)=>{e.columnsDefsMap={};const n=(r,c)=>{var i;c||(c={val:0});let a=[];const u=[];for(const f of r){if(f.formatter==="rowSelection")continue;c.val++;const d=c.val.toString(),b={key:d,title:f.title};let w=f.visible!==!1;if((i=f.columns)!=null&&i.length){b.icon=h.jsx(ie,{});const[k,R]=n(f.columns,c);b.children=k,a=[...a,...R],R.length<f.columns.length&&(w=!1)}u.push(b),w&&a.push(d),e.columnsDefsMap[d]=f}return[u,a]},[o,s]=n(t);e.nodes=o,e.checked=s,e.setNodes(o),e.setChecked(s)},dn=e=>{const t=[];for(const n in e.columnsDefsMap)t.push(n);e.setExpanded(t)},hn=e=>{const t=o=>{var c;const s=[];let r=!1;for(const a of o){const u=e.columnsDefsMap[a.key.toString()];if(u.visible=e.checked.indexOf(a.key)>-1,(c=a.children)!=null&&c.length){const[i,f]=t(a.children);u.columns=i,f&&(u.visible=!0)}else delete u.columns;u.visible&&(r=!0),s.push(u)}return[s,r]},[n]=t(e.nodes);return n},Ce=e=>{const t=[];for(const n of e){const o={...n.getDefinition()};o.visible=n.isVisible(),o.width=n.getWidth();const s=n.getSubColumns();s!=null&&s.length&&(o.columns=Ce(s)),t.push(o)}return t},bn=e=>{const t=(n,o)=>{var r;const s=[];for(const c of n){const a={...o,...c};a.visible=a.visible!==!1,a.width||(a.width=0),(r=a.columns)!=null&&r.length&&(a.columns=t(a.columns,o)),s.push(a)}return s};return t(e.columns,e.columnDefaults??{})},mn=(e,t)=>{if(t.default&&e.gridApi.gridProps.persistence){const s=e.gridApi.gridProps.persistenceID??e.gridApi.getId();localStorage.removeItem(`tabulator-${s}-columns`)}const n=hn(t),o=t.gridApi.tableApi;o==null||o.setColumnLayout(n),o!=null&&o.isHeaderFilterVisible()||o==null||o.toggleHeaderFilter(!1)},N=(e,t)=>{var n;for(const o of e){if(o.key===t)return o;if(!((n=o.children)!=null&&n.length))continue;const s=N(o.children,t);if(s)return s}},A=(e,t)=>{var o;let n=0;for(const s of e){if(s.key===t)return e.splice(n,1),!0;(o=s.children)!=null&&o.length&&A(s.children,t),n++}},p=(e,t,n)=>{var o;for(const s of e){if(s.key===t.key)return n;if(!((o=s.children)!=null&&o.length))continue;const r=p(s.children,t,s);if(r)return r}},ee=(e,t,n)=>{const o=e,s=p(n.nodes,e);if((s==null?void 0:s.key)===(t==null?void 0:t.key))return o;if(s)return ee(s,t,n)},te=e=>{var n,o;if(!((n=e.children)!=null&&n.length))return e;const t=e.children[e.children.length-1];return(o=t.children)!=null&&o.length?te(t):t},yn=(e,t,n)=>{var s;if(!(t!=null&&t.children))return!1;const o=p(n.nodes,e);return t.key===(o==null?void 0:o.key)?(A(n.nodes,e.key),(s=t.children)==null||s.unshift(e),!0):(console.warn("Drop on the content: target is another group"),!1)},q=(e,t,n,o)=>{if(!t)return!1;const s=p(o.nodes,e),r=p(o.nodes,t);if(!s&&r||s&&!r||(s==null?void 0:s.key)!==(r==null?void 0:r.key))return console.warn("Node and target node have different parents"),!1;let c=[];if(!s&&!r)c=o.nodes;else if((s==null?void 0:s.key)===(r==null?void 0:r.key))c=r.children;else return!1;A(o.nodes,e.key);const a=c.indexOf(t);return a<0?!1:(c.splice(a+(n==="below"?1:0),0,e),!0)},wn=e=>{const t=n=>{const o=N(e.nodes,n.dragNode.key),s=N(e.nodes,n.dropNode.key);if(!o||!s)return!1;const r=p(e.nodes,o),c=p(e.nodes,s);if(n.dropPosition===-1)return r===c;if(n.dropPosition===0||n.dropPosition===1){if(!s.children&&r===c||s.children&&r===s)return!0;const a=ee(s,r,e);if(!a)return!1;if(s===te(a))return!0}return!1};return l.useCallback(t,[e])},Dn=e=>{const t=n=>{const o=N(e.nodes,n.dragNode.key),s=N(e.nodes,n.node.key);if(!s||!o)return;const r=p(e.nodes,o);if(n.node.dragOverGapTop)q(o,s,"above",e);else{const c=ee(s,r,e);c&&s===te(c)?q(o,c,"below",e):s.children?yn(o,s,e):q(o,s,"below",e)}e.setNodes([...e.nodes])};return l.useCallback(t,[e])},Rn=(e,t)=>l.useCallback(n=>{let o;Array.isArray(n)?o=n:o=[...n.checked,...n.halfChecked],e.checked=o,t(o)},[e,t]),Cn=(e,t)=>{mn(e,t),e.gridApi.openColumnDialog(!1)},xn=(e,t)=>{const n=bn(e.gridApi.gridProps);t.default=!0,Re(t,n)},kn=e=>l.useMemo(()=>{var s;const t=(s=e.gridProps)==null?void 0:s.selectionFormProps;if(!t)return;const n={...t},o=t==null?void 0:t.onSubmitSuccess;return n.onSubmitSuccess=(r,c,a)=>{if(o&&o(r,c,a)===!1)return!1;const u={...a.model.getFormDataSet(),...c},i=e.gridProps,f=u.select??[];if(!i.appendSelection)return e.setDataSet(f);const d=e.getDataSet()??[];for(const b of f)d.find(w=>w.id===b.id)||e.insertRows(b)},n},[e]),vn=({tableRef:e,gridApi:t,gridProps:n,tabulatorProps:o,columnsDialog:s})=>{const r=Ut(t),c=kn(t);return h.jsxs("div",{className:"tabulator-grid-container",style:{height:n.height||void 0,minHeight:n.minHeight,maxHeight:n.maxHeight},children:[h.jsx(je,{isLoading:t.getIsLoading(),notHideContent:!0,spinStyle:{height:"100%"},children:h.jsxs(Te,{style:{display:"flex",flexDirection:"column"},children:[h.jsx(sn,{gridApi:t}),h.jsx(cn,{tableRef:e,gridApi:t,gridProps:n,tabulatorProps:o})]})}),h.jsx(ln,{open:s,gridApi:t}),r?h.jsx(ne,{...r,apiRef:t.editFormApi}):null,c?h.jsx(ne,{...c,apiRef:t.selectionFormApi}):null]})},jn=e=>{var i,f;const t=Sn(e),n=l.useRef(),[o]=l.useState(((i=e.editFormProps)==null?void 0:i.apiRef)??{}),[s]=l.useState(((f=e.selectionFormProps)==null?void 0:f.apiRef)??{}),[r]=l.useState({}),[c]=l.useState(e.apiRef||{}),[a,u]=l.useState(!1);return dt({gridApi:c,props:e,tableRef:n,editFormApi:o,selectionFormApi:s,buttonsApi:r,setColumnsDialog:u}),h.jsx(vn,{tableRef:n,gridApi:c,gridProps:e,tabulatorProps:t,columnsDialog:a})},Sn=e=>l.useMemo(()=>Ee(e,{apiRef:!0,id:!0,gridMode:!0,dataSet:!0,className:!0,headerLabel:!0,buttons:!0,buttonsSize:!0,buttonsPosition:!0,buttonsIconsOnly:!0,readOnly:!0,editFormProps:!0,selectionFormProps:!0,appendSelection:!0,noHover:!0,rowDeleteMessage:!0,confirmDelete:!0,placeholder:!0,onMenuVisibilityChanged:!0,onDataLoading:!0,onDataLoadError:!0,onDataLoaded:!0,onDataChanged:!0,onDataProcessed:!0,onDataFetch:!0,onDataFetching:!0,onDataFetchResponse:!0,onSelectionChange:!0,onDelete:!0,resizeHeightWithParent:!0})[1],[e]);export{jn as T};
