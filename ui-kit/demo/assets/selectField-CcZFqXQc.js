import{r as a,C as Ee,J as Me,V as _e,ai as je,m as De,F as Fe,o as Re,e as z,L as Te,k as Ve,ab as Be,bv as ze,j as M}from"./index-CtAjfk3U.js";import{B as We}from"./baseField-CLOOMrMa.js";import{s as $e}from"./dFormModal-DBrO8yV5.js";import{a as W}from"./isArray-Dq3mFmoY.js";import{u as ke,a as He,D as Ae,T as Le,m as Ue,O as Ge,b as Xe}from"./useShowArrow-aGotVQ22.js";import{j as Je}from"./buttonsRow-DIWV9y5m.js";import{c as Ye,d as Ze,e as qe}from"./index-CQ36vsgA.js";import{u as Ke}from"./useIcons-BRnDxCLJ.js";var Qe=function(e,t){var s={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(s[o]=e[o]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(s[o[n]]=e[o[n]]);return s};const $="SECRET_COMBOBOX_MODE_DO_NOT_USE",et=(e,t)=>{var s;const{prefixCls:o,bordered:n,className:l,rootClassName:r,getPopupContainer:b,popupClassName:f,dropdownClassName:k,listHeight:H=256,placement:h,listItemHeight:p,size:g,disabled:O,notFoundContent:_,status:A,builtinPlacements:L,dropdownMatchSelectWidth:U,popupMatchSelectWidth:x,direction:v,style:G,allowClear:j,variant:X,dropdownStyle:m,transitionName:J,tagRender:Y,maxCount:Z,prefix:q}=e,D=Qe(e,["prefixCls","bordered","className","rootClassName","getPopupContainer","popupClassName","dropdownClassName","listHeight","placement","listItemHeight","size","disabled","notFoundContent","status","builtinPlacements","dropdownMatchSelectWidth","popupMatchSelectWidth","direction","style","allowClear","variant","dropdownStyle","transitionName","tagRender","maxCount","prefix"]),{getPopupContainer:K,getPrefixCls:F,renderEmpty:y,direction:Q,virtual:ee,popupMatchSelectWidth:te,popupOverflow:oe}=a.useContext(Ee),w=Me("select"),[,I]=_e(),ne=p??(I==null?void 0:I.controlHeight),c=F("select",o),se=F(),i=v??Q,{compactSize:ae,compactItemClassnames:le}=je(c,i),[re,ce]=Ye("select",X,n),P=De(c),[ie,R,T]=ke(c,P),S=a.useMemo(()=>{const{mode:d}=e;if(d!=="combobox")return d===$?"combobox":d},[e.mode]),N=S==="multiple"||S==="tags",ue=He(e.suffixIcon,e.showArrow),de=(s=x??U)!==null&&s!==void 0?s:te,{status:me,hasFeedback:V,isFormItemInput:Se,feedbackIcon:Ce}=a.useContext(Fe),be=qe(me,A);let C;_!==void 0?C=_:S==="combobox"?C=null:C=(y==null?void 0:y("Select"))||a.createElement(Ae,{componentName:"Select"});const{suffixIcon:fe,itemIcon:he,removeIcon:pe,clearIcon:ge}=Ke(Object.assign(Object.assign({},D),{multiple:N,hasFeedback:V,feedbackIcon:Ce,showSuffixIcon:ue,prefixCls:c,componentName:"Select"})),Oe=j===!0?{clearIcon:ge}:j,xe=Re(D,["suffixIcon","itemIcon"]),ve=z(f||k,{[`${c}-dropdown-${i}`]:i==="rtl"},r,T,P,R),B=Te(d=>{var E;return(E=g??ae)!==null&&E!==void 0?E:d}),ye=a.useContext(Ve),we=O??ye,Ie=z({[`${c}-lg`]:B==="large",[`${c}-sm`]:B==="small",[`${c}-rtl`]:i==="rtl",[`${c}-${re}`]:ce,[`${c}-in-form-item`]:Se},Ze(c,be,V),le,w.className,l,r,T,P,R),Pe=a.useMemo(()=>h!==void 0?h:i==="rtl"?"bottomRight":"bottomLeft",[h,i]),[Ne]=Be("SelectLike",m==null?void 0:m.zIndex);return ie(a.createElement(Le,Object.assign({ref:t,virtual:ee,showSearch:w.showSearch},xe,{style:Object.assign(Object.assign({},w.style),G),dropdownMatchSelectWidth:de,transitionName:ze(se,"slide-up",J),builtinPlacements:Ue(L,oe),listHeight:H,listItemHeight:ne,mode:S,prefixCls:c,placement:Pe,direction:i,prefix:q,suffixIcon:fe,menuItemSelectedIcon:he,removeIcon:pe,allowClear:Oe,notFoundContent:C,className:Ie,getPopupContainer:b||K,dropdownClassName:ve,disabled:we,dropdownStyle:Object.assign(Object.assign({},m),{zIndex:Ne}),maxCount:N?Z:void 0,tagRender:N?Y:void 0})))},u=a.forwardRef(et),tt=Je(u,"dropdownAlign");u.SECRET_COMBOBOX_MODE_DO_NOT_USE=$;u.Option=Ge;u.OptGroup=Xe;u._InternalPanelDoNotUseOrYouWillBeFired=tt;const ot=e=>{const t=at(e),s=nt(e),o=st(e,e.value);return M.jsx(u,{...t,options:s,value:o,disabled:e.disabled||e.readOnly,optionFilterProp:e.optionFilterProp??"label",showSearch:e.showSearch!==!1,onSelect:(n,l)=>{var r;return(r=e.onSelect)==null?void 0:r.call(e,n,l)},onDeselect:(n,l)=>{var r;return(r=e.onDeselect)==null?void 0:r.call(e,n,l)},onChange:(n,l)=>{var r;return(r=e.onChange)==null?void 0:r.call(e,n,l)},children:e.children})},nt=e=>a.useMemo(()=>{if(!e.dataSet)return;const t=s=>{const o=[];if(!(!s||!W(s))){for(const n of s){const l={...n};n.id&&(l.value=n.id),n.label&&(l.label=n.label),n.children&&(l.children=t(n.children)),o.push(l)}return o}};return t(e.dataSet)},[e.dataSet]),st=(e,t)=>a.useMemo(()=>{if(typeof t>"u")return;if(!W(t))return typeof t=="object"?{value:t.id??"0",label:t.label}:t;const s=[];for(const o of t)typeof o=="object"?s.push({value:o.id,label:o.label}):s.push(o);return s},[t]),at=e=>a.useMemo(()=>$e(e,{dataSet:!0,value:!0,readOnly:!0,onSelect:!0,onDeselect:!0,onChange:!0})[1],[e]),lt=({field:e})=>{a.useSyncExternalStore(e.subscribe.bind(e),e.getSnapshot.bind(e));const t=e.getProps(),s=e.getValue(),o=a.useCallback((b,f)=>{e.isReady()&&(t.fullItemValue?e.setValue(f):e.setValue(b),e.setDirty(!0))},[e,t.fullItemValue]),n=a.useCallback(()=>{e.setTouched(!0)},[e]);a.useEffect(()=>{e.setReady(!0)},[e]);const r={...{width:e.getWidth()??"100%"},...t.style};return M.jsx(ot,{className:t.className,allowClear:!0,...t,disabled:e.isDisabled(),readOnly:e.isReadOnly(),value:s,style:r,onBlur:n,onChange:o})};class bt extends We{render(){return M.jsx(lt,{field:this})}}export{bt as S};
