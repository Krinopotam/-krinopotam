var C=Object.defineProperty;var R=(e,t,r)=>t in e?C(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var D=(e,t,r)=>R(e,typeof t!="symbol"?t+"":t,r);import{r as c,j as i}from"./index-CNGiMTrA.js";import{B as d}from"./dForm-DmRsT3BS.js";import{T as S}from"./tabulatorGrid-C2BdhVJ6.js";import{s as b}from"./dFormModal-Clfa5FkM.js";const F=({field:e,gridApi:t})=>{c.useSyncExternalStore(e.subscribe.bind(e),e.getSnapshot.bind(e));const r=e.getProps(),[s]=c.useState(t),n=M(r),o=e.getValue(),a=c.useRef();typeof a.current>"u"&&(r.selectionMode?a.current=r.dataSet:a.current=o);const u=m(e,r),g=e.getWidth()??"100%",h=r.autoHeightResize?"100%":r.height,y=r.autoHeightResize?{position:"absolute",inset:0}:{};return i.jsx("div",{style:y,children:i.jsx(S,{...n,...u,apiRef:s,dataSet:a.current,readOnly:r.readOnly,placeholder:r.placeholder,width:g,height:h,resizeHeightWithParent:r.resizeHeightWithForm?"#"+e.getModel().getFormId():r.resizeHeightWithParent})})},M=e=>c.useMemo(()=>b(e,{value:!0,dataSet:!0,onMenuVisibilityChanged:!0,onDataLoading:!0,onDataLoaded:!0,onDataProcessed:!0,onDataLoadError:!0,onDataChanged:!0,onDataFetch:!0,onDataFetchResponse:!0,onDataFetching:!0,fetchInCreateMode:!0,onSelectionChange:!0,onDelete:!0,readOnly:!0,onValueChanged:!0,width:!0,autoHeightResize:!0,component:!0,rules:!0,onReadyStateChanged:!0,autoFocus:!0,dependsOn:!0,disabled:!0,helpClass:!0,hidden:!0,label:!0,nonEditable:!0,inlineGroup:!0,onDirtyStateChanged:!0,onDisabledStateChanged:!0,onErrorChanged:!0,onHiddenStateChanged:!0,onLabelChanged:!0,ajaxRequestFunc:!0,onReadOnlyStateChanged:!0,placeholder:!0,onTouchedStateChanged:!0,onValidated:!0,requiredMark:!0,rowStyle:!0,style:!0,tooltip:!0,resizeHeightWithForm:!0})[1],[e]),m=(e,t)=>{const s=e.getModel().getFormMode();return{onDataChanged:(n,o)=>{var a;return e.isReady()&&(t.selectionMode||(e.setValue(n??[],!1,!0,!0),e.setDirty(!0))),(a=t.onDataChanged)==null?void 0:a.call(t,n,o,e)},onSelectionChange:(n,o,a,u,g)=>{var h;return e.isReady()&&(t.selectionMode&&(e.setValue(n??[],!1,!0,!0),e.setDirty(!0)),e.setTouched(!0)),(h=t.onSelectionChange)==null?void 0:h.call(t,n,o,a,u,g,e)},onDataLoading:(n,o)=>{var a;return e.setReady(!1),(a=t.onDataLoading)==null?void 0:a.call(t,n,o,e)},onDataLoaded:(n,o)=>{var u;e.setReady(!0);const a=e.getProps();return a.selectionMode||e.setValue(n??[],!1,!0,!0),(u=a.onDataLoaded)==null?void 0:u.call(a,n,o,e)},onDataProcessed:(n,o)=>{var u;const a=e.getProps();return a.selectionMode&&o.setSelectedRows(e.getValue()),(u=a.onDataProcessed)==null?void 0:u.call(a,n,o,e)},onDataLoadError:(n,o,a)=>{var u;return e.setReady(!1),(u=t.onDataLoadError)==null?void 0:u.call(t,n,o,a,e)},onDataFetch:!t.onDataFetch||s==="create"&&!t.fetchInCreateMode?void 0:(n,o)=>t.onDataFetch(n,o,e),onDataFetching:t.onDataFetching?(n,o,a)=>t.onDataFetching(n,o,a,e):void 0,onDataFetchResponse:t.onDataFetchResponse?(n,o,a)=>{var u;return((u=t==null?void 0:t.onDataFetchResponse)==null?void 0:u.call(t,n,o,a,e))??n}:void 0,onMenuVisibilityChanged:t.onMenuVisibilityChanged?(n,o)=>{var a;return(a=t==null?void 0:t.onMenuVisibilityChanged)==null?void 0:a.call(t,n,o,e)}:void 0,onDelete:t.onDelete?(n,o)=>{var a;return(a=t==null?void 0:t.onDelete)==null?void 0:a.call(t,n,o,e)}:void 0}};class H extends d{constructor(){super(...arguments);D(this,"gridApi",{})}render(){const r=this.getProps();return r.apiRef&&(this.gridApi=r.apiRef),i.jsx(F,{field:this,gridApi:this.gridApi})}getGridApi(){return this.gridApi}setValue(r,s,n,o){const a=this.getProps();return!o&&!a.selectionMode&&this.gridApi.setDataSet(r),super.setValue(r,s,n)}setDataSet(r,s){this.getProps().selectionMode?this.gridApi.setDataSet(r):this.setValue(r,s)}getDataSet(){return this.gridApi.getDataSet()}}export{H as T};
