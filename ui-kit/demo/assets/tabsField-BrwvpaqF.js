var g=Object.defineProperty;var T=(s,n,e)=>n in s?g(s,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[n]=e;var c=(s,n,e)=>T(s,typeof n!="symbol"?n+"":n,e);import{r as p,j as h,t as R}from"./index-BZKbt60r.js";import{F,T as _,B as y}from"./dForm-Cc85MzR5.js";import{s as S}from"./index-H8CSuHfP.js";const{useToken:H}=R,x=({field:s})=>{p.useEffect(()=>{s.setReady(!0)},[s]);const n=s.getProps(),e=s.getTabsRootFields();p.useSyncExternalStore(s.subscribe.bind(s),s.getSnapshot.bind(s));let t=s.getActiveTab();const r=C(s);if(!s.hasVisibleChildren())return h.jsx(h.Fragment,{children:" "});const i={};n.panelsHeight&&(i.height=n.panelsHeight),n.panelsMinHeight&&(i.minHeight=n.panelsMinHeight),n.panelsMaxHeight&&(i.height=n.panelsMaxHeight);const d=[];for(const a in e){if(t||(t=a),!s.tabHasVisibleChildren(a))continue;const u=e[a],f={};n.autoHeightResize&&(f.height="100%"),d.push({key:a,tabKey:a,label:a,className:n.autoHeightResize?"auto-height":"",forceRender:!0,disabled:s.isDisabled(),style:{...f,...n.tabsStyle},children:h.jsx(F,{fields:u,formProps:s.getFormProps(),subscribe:s.tabSubscribe(a),getSnapshot:s.getTabSnapshot(a),containerStyle:i}),active:t===a})}const o=(a,u)=>M(a,u,s),l={width:s.getWidth()??"100%"};n.autoHeightResize&&(l.height="100%");const b={...l,...n.style};return h.jsx(_,{type:n.type??"card",tabBarStyle:n.tabBarStyle,size:n.size??"small",items:d,style:b,renderTabBar:o,onChange:r})},C=s=>p.useCallback(n=>{s.setActiveTab(n)},[s]),M=(s,n,e)=>{const{token:t}=H(),r=e.getFormProps(),i={...s.style};i.backgroundColor=t.colorBgElevated,i.height=(r==null?void 0:r.tabsHeight)??35;const o={height:r.contentIndent??0,backgroundColor:i.backgroundColor};return e.getParent()?h.jsxs(h.Fragment,{children:[h.jsx("div",{style:o}),h.jsx(n,{...s,style:i})]}):h.jsxs(S,{style:{zIndex:15},children:[h.jsx("div",{style:o}),h.jsx(n,{...s,style:i})]})};class P extends y{constructor(){super(...arguments);c(this,"_tabsFieldsMap",{});c(this,"_tabsRootFields",{});c(this,"_activeTab","");c(this,"_disabledTabs",{});c(this,"_hiddenTabs",{});c(this,"_readOnlyTabs",{});c(this,"_tabRenderListeners",{});c(this,"_tabRenderSnapshots",{})}initChildrenFields(){const e=this.getProps();if(!e.tabs)return[{},{}];this._tabsRootFields={};for(const t in e.tabs){const r=e.tabs[t],[i,d]=this.getModel().prepareFieldCollection(r,this);this._tabsRootFields[t]=d,this._tabsFieldsMap[t]=i,this._tabRenderSnapshots[t]={},this._tabRenderListeners[t]=[],this.fieldsMap={...this.fieldsMap,...i},this.rootFields={...this.rootFields,...d}}return[this.fieldsMap,this.rootFields]}getValue(){}setValue(){}canHaveValue(){return!1}render(){return h.jsx(x,{field:this})}renderField(){return this.parent?super.renderField():this.render()}getTabsFieldsMap(){return this._tabsFieldsMap}getTabsRootFields(){return this._tabsRootFields}isTabDisabled(e){return!!this._disabledTabs[e]}setTabDisabled(e,t,r,i){var l,b;if(this.isTabDisabled(e)===t)return;const o=this._tabsRootFields[e];if(o){this._disabledTabs[e]=t;for(const a in o)o[a].setDisabled(t,r,!0);r||(b=(l=this.getProps()).onTabDisabledStateChanged)==null||b.call(l,e,t,this),i||this.emitRender()}}isTabReadOnly(e){return!!this._readOnlyTabs[e]||this.model.getFormMode()==="view"}setTabReadOnly(e,t,r,i){var l,b;if(this.isTabReadOnly(e)===t)return;const o=this._tabsRootFields[e];if(o){this._readOnlyTabs[e]=t;for(const a in o)o[a].setReadOnly(t,r,i);r||(b=(l=this.getProps()).onTabReadOnlyStateChanged)==null||b.call(l,e,t,this),i||this.emitRender()}}isTabHidden(e){return!!this._hiddenTabs[e]}setTabHidden(e,t,r,i){var l,b;if(this.isTabHidden(e)===t)return;const o=this._tabsRootFields[e];if(o){this._hiddenTabs[e]=t;for(const a in o)o[a].setHidden(t,r,i);r||(b=(l=this.getProps()).onTabHiddenStateChanged)==null||b.call(l,e,t,this),i||this.emitRender()}}getActiveTab(){return this._activeTab}setActiveTab(e,t,r){var i,d;this._tabsFieldsMap[e]&&(this._activeTab=e,t||(d=(i=this.getProps()).onActiveTabChanged)==null||d.call(i,e,this),r||this.emitRender())}tabHasVisibleChildren(e){const t=this._tabsRootFields[e];for(const r in t){const i=this.rootFields[r];if(!i.isContainer()&&!i.isHidden()||i.hasVisibleChildren())return!0}return!1}setDisabled(e,t,r){if(this.isDisabled()!==e){for(const d in this._tabsFieldsMap)this.setTabDisabled(d,e,t,!0);super.setDisabled(e,t,r)}}setReadOnly(e,t,r){if(this.isReadOnly()!==e){for(const d in this._tabsFieldsMap)this.setTabReadOnly(d,e,t,!0);super.setReadOnly(e,t,r)}}tabSubscribe(e){return t=>(this._tabRenderListeners[e]=[...this._tabRenderListeners[e],t],()=>{this._tabRenderListeners[e]=this._tabRenderListeners[e].filter(r=>r!==t)})}getTabSnapshot(e){return()=>this._tabRenderSnapshots[e]}emitTabRender(e){this._tabRenderSnapshots[e]={};for(const t of this._tabRenderListeners[e])t()}}export{P as T};
