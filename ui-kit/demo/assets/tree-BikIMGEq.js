import{r as l,j as m}from"./index-Dv3qFdjW.js";import{F as P,n as B,u as D,a as M,b as I,c as O,d as L,e as T,f as j,h as V,i as H,j as U,k as z,l as Q,m as W,o as q,p as _,q as J,r as X,s as Y,t as Z,v as $,w as p,x as ee,y as te,z as oe,A as ne,B as de,C as re,D as se,E as ue}from"./useApiIsNodeSelected-CouYiEi1.js";import{u as le,t as ce,c as ae,d as ie,e as fe,b as ge,h as me,m as k,k as ye,f as Ne,P as be}from"./modal-Bp_ASPGm.js";import{D as v,s as Ge}from"./dFormModal-BUbiUSeF.js";import{u as Ae,a as K,b as Re,t as Se,E as Fe,L as Ke}from"./dForm-QxcKLYQQ.js";import{o as xe,d as we,b as De,r as ve,a as Ee,c as he,e as Ce,g as ke}from"./defaultButtonsProps-DchoBAIh.js";import{T as Pe}from"./index-CWJIcpxl.js";import{s as Be}from"./index-HhPNPXlg.js";const Me=e=>()=>e,Ie=e=>t=>{e(t)},Oe=e=>()=>e,Le=e=>()=>e,Te={view:"Просмотр",viewRecord:"Просмотр записи",create:"Создать",createRecord:"Создать запись",createGroup:"Создать группу",createRecordsGroup:"Создать группу записей",edit:"Редактировать",editGroup:"Редактировать группу",editRecord:"Редактировать запись",editRecordsGroup:"Редактировать группу записей",clone:"Клонировать",cloneGroup:"Клонировать группу",cloneRecord:"Клонировать запись",cloneRecordsGroup:"Клонировать группу записей",delete:"Удалить",deleteGroup:"Удалить группу",deleteRecord:"Удалить запись(и)",deleteRecordsGroup:"Удалить группу записей",select:"Выбрать",selectRecord:"Выбрать запись(и)",go:"Перейти",filter:"Фильтр",ok:"OK",cancel:"Отмена",tryAgainQt:"Попробовать еще раз?",deleteSelectedRecordQt:"Удалить выбранную запись?",error:"Ошибка",dataNotFound:"Данные не найдены"},je={view:"View",viewRecord:"View record",create:"Create",createRecord:"Create record",createGroup:"Create group",createRecordsGroup:"Create records group",edit:"Edit",editGroup:"Edit group",editRecord:"Edit record",editRecordsGroup:"Edit records group",clone:"Clone",cloneGroup:"Clone group",cloneRecord:"Clone record",cloneRecordsGroup:"Clone records group",delete:"Delete",deleteGroup:"Delete group",deleteRecord:"Delete record(s)",deleteRecordsGroup:"Delete records group(s)",select:"Select",selectRecord:"Select record(s)",go:"Go",filter:"Filter",ok:"OK",cancel:"Cancel",tryAgainQt:"Try again?",deleteSelectedRecordQt:"Delete selected record?",error:"Error",dataNotFound:"Data not found"},Ve={view:"查看",viewRecord:"查看记录",create:"创建",createRecord:"创建记录",createGroup:"创建组",createRecordsGroup:"创建记录组",edit:"编辑",editGroup:"编辑组",editRecord:"编辑记录",editRecordsGroup:"编辑记录组",clone:"克隆",cloneGroup:"克隆组",cloneRecord:"克隆记录",cloneRecordsGroup:"克隆记录组",delete:"删除",deleteGroup:"删除组",deleteRecord:"删除记录",deleteRecordsGroup:"删除记录组",select:"选择",selectRecord:"选择记录",go:"前往",filter:"过滤",ok:"确定",cancel:"取消",tryAgainQt:"再试一次",deleteSelectedRecordQt:"删除选定的记录",error:"错误",dataNotFound:"数据未找到"},He={ru:Te,en:je,cn:Ve},Ue=e=>Ae(e.language,He,e.translation),ze=({dataMutator:e})=>l.useCallback(t=>{if(!e)return t;let o={...t};return e&&(o=e(o)),o},[e]),Qe=e=>()=>e,We=e=>{const t=l.useRef(void 0),o=l.useRef(void 0);return n=>{const d=e.getSelectedKeys();if(t.current===d)return o.current;if(t.current=d,!d){o.current=void 0;return}const r=[];for(const s of d){const u=e.getNode(s,n);u&&r.push(u)}return o.current=r,r}},qe=(e,t)=>(o,n=!0,d=!1,r=void 0)=>{const s=e.getFieldNames(),u=typeof o=="object"?o[s.key]:o;if(!u)return;const c=r??e.getDataSet(),a=e.getSelectedKeys();if(d){const f=_e(u,n,a,c,s);e.setSelectedKeys(f);return}let i=[];if(n){if(a!=null&&a.includes(u))return;t?i=[...a??[],u]:i=[u]}else{if(!(a!=null&&a.includes(u)))return;t?i=a==null?void 0:a.filter(f=>f!==u):i=[]}e.setSelectedKeys(i)},_e=(e,t,o,n,d)=>{const r=P(e,n,d);if(!r||!n)return o;const s=[...o??[]],u=c=>{const a=c[d.key];if(!a)return;const i=s.indexOf(a);if(t){if(i>-1||c[d.disabled]||c[d.selectable]===!1)return;s.push(a)}else{if(i<0)return;s.splice(i,1)}if(K(c[d.children]))for(const f of c[d.children])u(f)};return u(r),s},Je=e=>{const[t,o]=l.useState(E(e));return B(()=>{o(E(e))},[e]),[t,o]},E=e=>{if(e)return K(e)?e:[e]},Xe=e=>t=>{if(!t){e(void 0);return}K(t)?e(t):e([t])},Ye=e=>()=>e,Ze=e=>t=>{setTimeout(()=>{e(t)},0)},$e=({props:e,setProps:t})=>{var g,w;const[o]=l.useState(e.apiRef??{}),[n]=l.useState(((g=e.editFormProps)==null?void 0:g.apiRef)??{}),[d]=l.useState(((w=e.editGroupFormProps)==null?void 0:w.apiRef)??{}),[r,s]=l.useState(!1),[u,c]=l.useState(!1),[a,i]=Je(e.selectedKeys),f=D(e)(),N=ze(e),[y,b,G,S]=M(e.dataSet,f,N),[x,R]=I(e.expandedKeys,e.defaultExpandedKeys,e.defaultExpandAll,S),F={getId:le(e.id??"tree-"+ce()),getProps:ae(e),setProps:ie(t),updateProps:fe(e,t),getIsMounted:ge(),getFieldNames:D(e),getDataSet:O(y),setDataSet:L(b,e==null?void 0:e.onDataSetChanged),isDataPlainList:T(G),getEditFormApi:Le(n),getEditGroupFormApi:Oe(d),getSelectedKeys:Qe(a),setSelectedKeys:Xe(i),getSelectedNodes:We(o),isNodeSelected:j(o),selectNode:qe(o,e.multiple),getActiveNodeKey:V(o),getActiveNode:H(o),getExpandedKeys:U(x),setExpandedKeys:z(R),getExpandedNodes:Q(o),isNodeExpanded:W(o),expandNode:q(o),collapseNode:_(o),toggleNode:J(o),expandParentNodes:X(o),getNode:Y(o),getNodes:Z(o),getNextNodeKey:$(o),getPrevNodeKey:p(o),getNextNode:ee(o),getPrevNode:te(o),getParentNode:oe(o),addNode:ne(o),updateNode:de(o),removeNode:re(o),moveNode:se(o),ensureNodeVisible:ue(o),t:Ue(e),treeRef:l.useRef(null),getButtonsApi:Re(),getIsReady:Me(r),setIsReady:Ie(s),getIsLoading:Ye(u),setIsLoading:Ze(c)};return Object.assign(o,F)},h=(e,t,o)=>l.useMemo(()=>{const n=o?t==null?void 0:t.editGroupFormProps:t==null?void 0:t.editFormProps;if(!n)return;const d={...n};t.language&&!d.language&&(d.language=t.language);const r=n==null?void 0:n.onSubmitSuccess;return d.onSubmitSuccess=(s,u,c,a,i)=>{var G;if(r==null||r(s,u,c,a,i),i.isPrevented())return;const f=a.model.getFormMode(),N=e.getFieldNames(),y={...u,...c};let b;y[N.parent]?b=(G=y[N.parent])==null?void 0:G[N.key]:y[N.parent]===null?b=void 0:b=e.getActiveNodeKey(),f==="create"||f==="clone"?(y[N.key]||(y[N.key]=xe()),e.addNode(y,b,"insideBottom",{ensureVisible:!0,select:!!t.selectNewNode})):f==="update"&&e.updateNode(y,b,{ensureVisible:!0})},d},[o,t==null?void 0:t.editFormProps,t==null?void 0:t.editGroupFormProps,t.language,t.selectNewNode,e]),pe=(e,t)=>{e.getButtonsApi().refreshButtons=et();const o=e.getFieldNames(),n=e.getActiveNode(!0),d=!(n!=null&&n.isLeaf)&&(!t.groupsMode||(n==null?void 0:n[o.isGroup])),r=t.buttons,s=t.buttonsSize??"small",u=t.buttonsPosition??"right",c=tt(t),a=ot(e,t,d),i=nt(e,t,d),f=dt(e,t,n,d),N=rt(e,t,n,d),y=st(e,t,n,d),b=ut(e,t,n,d),G=lt(e),S=ct(e);return l.useMemo(()=>{const R=me({headerLabel:c,view:f,create:a,createGroup:i,clone:N,update:y,delete:b,arrowUp:G,arrowDown:S},r);for(const F in R){const g=R[F];!g||F==="headerLabel"||g.type==="hotkey"||(g.size=g.size??s,g.position=g.position??u,g.checkDisabled&&(g.disabled=!n),g.checkHidden&&(g.hidden=!n))}return R},[c,f,a,i,N,y,b,G,S,r,s,u,n])},et=()=>{const[,e]=l.useState({});return l.useCallback(()=>{e({})},[e])},tt=e=>l.useMemo(()=>{if(e.headerLabel)return{...we,title:e.headerLabel}},[e.headerLabel]),ot=(e,t,o)=>{var n;return l.useMemo(()=>{var d;if(!(!t.editFormProps||t.disabled||t.readOnly||((d=t.buttons)==null?void 0:d.create)===null))return{...De,title:e.t("create"),tooltip:e.t("createRecord"),onClick:()=>{const r=e.getFieldNames(),s=e.getActiveNode(!1);let u;s&&(u=s&&o?s:e.getParentNode(s)),e.getEditFormApi().open("create",{defaultValues:{[r.parent]:u}})}}},[t.editFormProps,t.disabled,t.readOnly,(n=t.buttons)==null?void 0:n.create,e,o])},nt=(e,t,o)=>{var n;return l.useMemo(()=>{var d;if(!(!t.editGroupFormProps||!t.groupsMode||t.disabled||t.readOnly||((d=t.buttons)==null?void 0:d.createGroup)===null))return{...ve,title:e.t("createGroup"),tooltip:e.t("createRecordsGroup"),onClick:()=>{const r=e.getFieldNames(),s=e.getActiveNode(!1);let u;s&&(u=s&&o?s:e.getParentNode(s)),e.getEditGroupFormApi().open("create",{defaultValues:{[r.parent]:u}})}}},[t.editGroupFormProps,t.groupsMode,t.disabled,t.readOnly,(n=t.buttons)==null?void 0:n.createGroup,e,o])},dt=(e,t,o,n)=>{var d;return l.useMemo(()=>{var r;if(!(!n&&!t.editFormProps||n&&!t.editGroupFormProps||!t.readOnly||t.disabled||((r=t.buttons)==null?void 0:r.view)===null))return{...Ee,title:e.t("view"),tooltip:e.t("viewRecord"),disabled:!o,onClick:()=>{if(!o)return;const s=e.getFieldNames(),u=e.getParentNode(o);n?e.getEditGroupFormApi().open("view",{dataSet:{...A(o),[s.parent]:u}}):e.getEditFormApi().open("view",{dataSet:{...A(o),[s.parent]:u}})}}},[n,t.editFormProps,t.editGroupFormProps,t.readOnly,t.disabled,(d=t.buttons)==null?void 0:d.view,o,e])},rt=(e,t,o,n)=>{var d;return l.useMemo(()=>{var s;const r=t.editGroupFormProps;if(!(!n&&!t.editFormProps||n&&!t.editGroupFormProps||t.disabled||t.readOnly||((s=t.buttons)==null?void 0:s.clone)===null))return{...he,title:n&&r?e.t("cloneGroup"):e.t("clone"),tooltip:n&&r?e.t("cloneRecordsGroup"):e.t("cloneRecord"),disabled:!o,onClick:()=>{if(!o)return;const u=e.getFieldNames(),c=e.getParentNode(o);n?e.getEditGroupFormApi().open("clone",{dataSet:{...A(o),[u.parent]:c}}):e.getEditFormApi().open("clone",{dataSet:{...A(o),[u.parent]:c}})}}},[t.editGroupFormProps,t.editFormProps,t.disabled,t.readOnly,(d=t.buttons)==null?void 0:d.clone,n,o,e])},st=(e,t,o,n)=>{var d;return l.useMemo(()=>{var s;const r=t.editGroupFormProps;if(!(!n&&!t.editFormProps||n&&!t.editGroupFormProps||t.disabled||t.readOnly||((s=t.buttons)==null?void 0:s.update)===null))return{...Ce,title:n&&r?e.t("editGroup"):e.t("edit"),tooltip:n&&r?e.t("editRecordsGroup"):e.t("editRecord"),disabled:!o,onClick:()=>{if(!o)return;const u=e.getFieldNames(),c=e.getParentNode(o);n?e.getEditGroupFormApi().open("update",{dataSet:{...A(o),[u.parent]:c}}):e.getEditFormApi().open("update",{dataSet:{...A(o),[u.parent]:c}})}}},[t.editGroupFormProps,t.editFormProps,t.disabled,t.readOnly,(d=t.buttons)==null?void 0:d.update,n,o,e])},ut=(e,t,o,n)=>l.useMemo(()=>{var d;if(!(!t.editFormProps||t.disabled||t.readOnly||((d=t.buttons)==null?void 0:d.delete)===null))return{...ke,title:n?e.t("deleteGroup"):e.t("delete"),tooltip:n?e.t("deleteRecordsGroup"):e.t("deleteRecord"),disabled:!o,onClick:()=>{if(!o)return;if(!t.confirmDelete){C(o,t,e,e.t("error"));return}const r=k.confirmWaiter({language:t.language,content:t.nodeDeleteMessage??e.t("deleteSelectedRecordQt"),colorType:"danger",onOk:()=>{C(o,t,e,e.t("error"),r)},onCancel:()=>{r.destroy()}})}}},[t,n,e,o]),C=(e,t,o,n,d)=>{var u;const r=o.getButtonsApi(),s=(u=t==null?void 0:t.onDelete)==null?void 0:u.call(t,e,o);if(!Se(s)){o.removeNode(e,{select:t.selectNewNode?"next":void 0}),d&&d.destroy();return}t.confirmDelete||(r.loading("delete",!0),r.disableAll(!0)),s.then(()=>{d==null||d.destroy(),o.getIsMounted()&&(o.removeNode(e,{select:t.selectNewNode?"next":void 0}),t.confirmDelete||(r.loading("delete",!1),r.disableAll(!1)))}).catch(c=>{d==null||d.destroy(),o.getIsMounted()&&(t.confirmDelete||(r.loading("delete",!1),r.disableAll(!1)),k.alert({language:t.language,title:n,content:m.jsx(Fe,{error:c}),colorType:"danger"}))})},A=e=>({...e}),lt=e=>l.useMemo(()=>({type:"hotkey",hotKeys:[{key:"ArrowUp"}],onClick:()=>{var n;const t=(n=e.getSelectedKeys())==null?void 0:n[0],o=e.getPrevNodeKey(t);o&&e.setSelectedKeys([o])}}),[e]),ct=e=>l.useMemo(()=>({type:"hotkey",hotKeys:[{key:"ArrowDown"}],onClick:()=>{const t=e.getActiveNodeKey(),o=e.getNextNodeKey(t);o&&e.setSelectedKeys([o])}}),[e]),at=({api:e,treeProps:t})=>{const o=pe(e,t);return l.useMemo(()=>o?m.jsx("div",{style:{width:"100%",padding:"8px"},children:m.jsx(ye,{buttons:o,apiRef:e.getButtonsApi(),style:t.buttonsRowStyle,context:e,responsiveBreakpoint:t.responsiveBreakpoint,iconsOnly:t.buttonsIconsOnly})}):null,[o,e,t.buttonsIconsOnly,t.buttonsRowStyle,t.responsiveBreakpoint])},it=e=>{const t=e.treeApi,o=ft(t),n=gt(t),d=mt(t),r=yt(t);return m.jsx(Pe,{className:"draggable-tree",draggable:!0,onDrop:r,...e.antdTreeProps,ref:e.treeApi.treeRef,treeData:t.getDataSet(),selectedKeys:t.getSelectedKeys(),expandedKeys:t.getExpandedKeys(),fieldNames:{key:"id",title:"title",children:"children",...e.allProps.fieldNames},onSelect:o,onExpand:n,onDoubleClick:d})},ft=e=>l.useCallback((t,o)=>{var d;const n=e.getProps();(!n.noDeselect||o.selected)&&(e.setSelectedKeys(t),(d=n.onSelect)==null||d.call(n,t,o))},[e]),gt=e=>l.useCallback((t,o)=>{var d;const n=e.getProps();e.setExpandedKeys(t),(d=n.onExpand)==null||d.call(n,t,o)},[e]),mt=e=>l.useCallback((t,o)=>{var r,s;const n=e.getProps();n.onDoubleClick&&((r=n.onDoubleClick)==null||r.call(n,t,o));const d=e.getFieldNames();if(!n.disabled&&!n.readOnly&&(n.editFormProps||n.editGroupFormProps)){e.getButtonsApi().triggerClick("update");return}(s=o[d.children])!=null&&s.length&&e.toggleNode(o[d.key])},[e]),yt=e=>l.useCallback(t=>{let o="insideTop";t.dropToGap&&(o=t.dropPosition<0?"above":"below"),t.dragNode.id&&e.moveNode(t.dragNode.id,t.node.id,o,{ensureVisible:!0})},[e]),Nt=({api:e,allProps:t,antdTreeProps:o})=>{const n=h(e,t,!1),d=h(e,t,!0);return m.jsxs("div",{className:"extended-tree-container",children:[m.jsx(Ke,{isLoading:e.getIsLoading(),notHideContent:!0,spinStyle:{height:"100%"},children:m.jsxs(Ne,{style:{display:"flex",flexDirection:"column",...t.buttonsRowWrapperStyle},children:[m.jsx(Be,{style:{zIndex:15},children:m.jsx(at,{api:e,treeProps:t})}),m.jsx(it,{treeApi:e,allProps:t,antdTreeProps:o})]})}),!t.disabled&&n?m.jsx(v,{...n,apiRef:e.getEditFormApi()}):null,!t.disabled&&d?m.jsx(v,{...d,apiRef:e.getEditGroupFormApi()}):null]})},Dt=e=>{const[t,o]=be(e),[,n]=bt(t),d=$e({props:t,setProps:o});return m.jsx(Nt,{allProps:t,antdTreeProps:n,api:d})},bt=e=>l.useMemo(()=>{const[t,o]=Ge(e,{id:!0,buttons:!0,buttonsIconsOnly:!0,buttonsPosition:!0,buttonsSize:!0,confirmDelete:!0,editFormProps:!0,editGroupFormProps:!0,language:!0,readOnly:!0,deleteMessage:!0,translation:!0,apiRef:!0,headerLabel:!0,responsiveBreakpoint:!0,buttonsRowStyle:!0,buttonsRowWrapperStyle:!0,dataSet:!0,dataMutator:!0,noDeselect:!0,groupsMode:!0,onDataSetChanged:!0,nodeDeleteMessage:!0,onDelete:!0,selectNewNode:!0,fieldNames:!0,defaultCheckedKeys:!0,checkedKeys:!0,defaultExpandedKeys:!0,expandedKeys:!0,defaultSelectedKeys:!0,selectedKeys:!0});return[t,{...o,fieldNames:t.fieldNames}]},[e]);export{Dt as T};
