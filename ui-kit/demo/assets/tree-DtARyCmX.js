import{r as c,j as f}from"./index-CgBeyb-e.js";import{H as I,n as T,u as D,a as B,b as L,c as j,d as Q,e as H,f as V,h as U,i as z,j as W,k as q,l as _,m as J,o as X,p as Y,q as Z,r as p,s as $,t as ee,v as te,w as oe,x as ne,y as re,z as de,A as se,B as ue,C as le,D as ce,E as ae,F as ie,G as ge}from"./useApiGetGroupsOnly-BzYeVIfm.js";import{u as fe,t as me,c as ye,d as Ne,e as Ge,b as be,h as Re,m as v,k as Ae,f as Se,P as Fe}from"./modal-hi51mlNB.js";import{D as C,s as ve}from"./dFormModal-B-TtMmSz.js";import{u as Ke,a as K,b as he,t as k,E as O,L as we}from"./dForm-B-6Y2TlM.js";import{o as De,d as Ce,b as Ee,r as Pe,a as xe,c as Me,e as ke,g as Oe}from"./defaultButtonsProps-BjCvvsD6.js";import{T as Ie}from"./index-blBfG32B.js";import{s as Te}from"./index-bT1kimW8.js";const Be=e=>()=>e,Le=e=>t=>{e(t)},je=e=>()=>e,Qe=e=>()=>e,He={view:"Просмотр",viewRecord:"Просмотр записи",create:"Создать",createRecord:"Создать запись",createGroup:"Создать группу",createRecordsGroup:"Создать группу записей",edit:"Редактировать",editGroup:"Редактировать группу",editRecord:"Редактировать запись",editRecordsGroup:"Редактировать группу записей",clone:"Клонировать",cloneGroup:"Клонировать группу",cloneRecord:"Клонировать запись",cloneRecordsGroup:"Клонировать группу записей",delete:"Удалить",deleteGroup:"Удалить группу",deleteRecord:"Удалить запись(и)",deleteRecordsGroup:"Удалить группу записей",select:"Выбрать",selectRecord:"Выбрать запись(и)",go:"Перейти",filter:"Фильтр",ok:"OK",cancel:"Отмена",tryAgainQt:"Попробовать еще раз?",deleteSelectedRecordQt:"Удалить выбранную запись?",moveRecordQt:"Удалить данную запись?",error:"Ошибка",dataNotFound:"Данные не найдены"},Ve={view:"View",viewRecord:"View record",create:"Create",createRecord:"Create record",createGroup:"Create group",createRecordsGroup:"Create records group",edit:"Edit",editGroup:"Edit group",editRecord:"Edit record",editRecordsGroup:"Edit records group",clone:"Clone",cloneGroup:"Clone group",cloneRecord:"Clone record",cloneRecordsGroup:"Clone records group",delete:"Delete",deleteGroup:"Delete group",deleteRecord:"Delete record(s)",deleteRecordsGroup:"Delete records group(s)",select:"Select",selectRecord:"Select record(s)",go:"Go",filter:"Filter",ok:"OK",cancel:"Cancel",tryAgainQt:"Try again?",deleteSelectedRecordQt:"Delete selected record?",moveRecordQt:"Move the record?",error:"Error",dataNotFound:"Data not found"},Ue={view:"查看",viewRecord:"查看记录",create:"创建",createRecord:"创建记录",createGroup:"创建组",createRecordsGroup:"创建记录组",edit:"编辑",editGroup:"编辑组",editRecord:"编辑记录",editRecordsGroup:"编辑记录组",clone:"克隆",cloneGroup:"克隆组",cloneRecord:"克隆记录",cloneRecordsGroup:"克隆记录组",delete:"删除",deleteGroup:"删除组",deleteRecord:"删除记录",deleteRecordsGroup:"删除记录组",select:"选择",selectRecord:"选择记录",go:"前往",filter:"过滤",ok:"确定",cancel:"取消",tryAgainQt:"再试一次",deleteSelectedRecordQt:"删除选定的记录",moveRecordQt:"删除此记录",error:"错误",dataNotFound:"数据未找到"},ze={ru:He,en:Ve,cn:Ue},We=e=>Ke(e.language,ze,e.translation),qe=({dataMutator:e})=>c.useCallback(t=>{if(!e)return t;let o={...t};return e&&(o=e(o)),o},[e]),_e=e=>()=>e,Je=e=>{const t=c.useRef(void 0),o=c.useRef(void 0);return n=>{const r=e.getSelectedKeys();if(t.current===r)return o.current;if(t.current=r,!r){o.current=void 0;return}const s=[];for(const d of r){const u=e.getNode(d,n);u&&s.push(u)}return o.current=s,s}},Xe=(e,t)=>(o,n=!0,r=!1,s=void 0)=>{const d=e.getFieldNames(),u=typeof o=="object"?o[d.key]:o;if(!u)return;const a=s??e.getDataSet(),l=e.getSelectedKeys();if(r){const g=Ye(u,n,l,a,d);e.setSelectedKeys(g);return}let i=[];if(n){if(l!=null&&l.includes(u))return;t?i=[...l??[],u]:i=[u]}else{if(!(l!=null&&l.includes(u)))return;t?i=l==null?void 0:l.filter(g=>g!==u):i=[]}e.setSelectedKeys(i)},Ye=(e,t,o,n,r)=>{const s=I(e,n,r);if(!s||!n)return o;const d=[...o??[]],u=a=>{const l=a[r.key];if(!l)return;const i=d.indexOf(l);if(t){if(i>-1||a[r.disabled]||a[r.selectable]===!1)return;d.push(l)}else{if(i<0)return;d.splice(i,1)}if(K(a[r.children]))for(const g of a[r.children])u(g)};return u(s),d},Ze=e=>{const[t,o]=c.useState(E(e));return T(()=>{o(E(e))},[e]),[t,o]},E=e=>{if(e)return K(e)?e:[e]},pe=e=>t=>{if(!t){e(void 0);return}K(t)?e(t):e([t])},$e=e=>()=>e,et=e=>t=>{setTimeout(()=>{e(t)},0)},tt=({props:e,setProps:t})=>{var y,w;const[o]=c.useState(e.apiRef??{}),[n]=c.useState(((y=e.editFormProps)==null?void 0:y.apiRef)??{}),[r]=c.useState(((w=e.editGroupFormProps)==null?void 0:w.apiRef)??{}),[s,d]=c.useState(!1),[u,a]=c.useState(!1),[l,i]=Ze(e.selectedKeys),g=D(e)(),N=qe(e),[m,G,b,S]=B(e.dataSet,g,N),[h,A]=L(e.expandedKeys,e.defaultExpandedKeys,e.defaultExpandAll,S),F={getId:fe(e.id??"tree-"+me()),getProps:ye(e),setProps:Ne(t),updateProps:Ge(e,t),getIsMounted:be(),getFieldNames:D(e),getDataSet:j(m),setDataSet:Q(G,e==null?void 0:e.onDataSetChanged),getGroupsOnly:H(o),sortTree:V(m,e.sortComparator,o),isDataPlainList:U(b),getEditFormApi:Qe(n),getEditGroupFormApi:je(r),getSelectedKeys:_e(l),setSelectedKeys:pe(i),getSelectedNodes:Je(o),isNodeSelected:z(o),selectNode:Xe(o,e.multiple),getActiveNodeKey:W(o),getActiveNode:q(o),getExpandedKeys:_(h),setExpandedKeys:J(A),getExpandedNodes:X(o),isNodeExpanded:Y(o),expandNode:Z(o),collapseNode:p(o),toggleNode:$(o),expandParentNodes:ee(o),getNode:te(o),getNodes:oe(o),getNextNodeKey:ne(o),getPrevNodeKey:re(o),getNextNode:de(o),getPrevNode:se(o),getParentNode:ue(o),addNode:le(o),updateNode:ce(o),removeNode:ae(o),moveNode:ie(o),ensureNodeVisible:ge(o),t:We(e),treeRef:c.useRef(null),getButtonsApi:he(),getIsReady:Be(s),setIsReady:Le(d),getIsLoading:$e(u),setIsLoading:et(a)};return Object.assign(o,F)},P=(e,t,o)=>c.useMemo(()=>{const n=o?t==null?void 0:t.editGroupFormProps:t==null?void 0:t.editFormProps;if(!n)return;const r={...n};t.language&&!r.language&&(r.language=t.language);const s=n==null?void 0:n.onSubmitSuccess;return r.onSubmitSuccess=(d,u,a,l,i)=>{var b;if(s==null||s(d,u,a,l,i),i.isPrevented())return;const g=l.model.getFormMode(),N=e.getFieldNames(),m={...u,...a};let G;m[N.parent]?G=(b=m[N.parent])==null?void 0:b[N.key]:m[N.parent]===null?G=void 0:G=e.getActiveNodeKey(),g==="create"||g==="clone"?(m[N.key]||(m[N.key]=De()),e.addNode(m,G,"insideBottom",{ensureVisible:!0,select:!!t.selectNewNode,sortNodes:t.sortOnChange})):g==="update"&&e.updateNode(m,G,{ensureVisible:!0,sortNodes:t.sortOnChange})},r},[o,t==null?void 0:t.editFormProps,t==null?void 0:t.editGroupFormProps,t.language,t.selectNewNode,e]),ot=(e,t)=>{e.getButtonsApi().refreshButtons=nt();const o=e.getFieldNames(),n=e.getActiveNode(!0),r=!(n!=null&&n.isLeaf)&&(!t.groupsMode||(n==null?void 0:n[o.isGroup])),s=t.buttons,d=t.buttonsSize??"small",u=t.buttonsPosition??"right",a=rt(t),l=dt(e,t,r),i=st(e,t,r),g=ut(e,t,n,r),N=lt(e,t,n,r),m=ct(e,t,n,r),G=at(e,t,n,r),b=it(e),S=gt(e);return c.useMemo(()=>{const A=Re({headerLabel:a,view:g,create:l,createGroup:i,clone:N,update:m,delete:G,arrowUp:b,arrowDown:S},s);for(const F in A){const y=A[F];!y||F==="headerLabel"||y.type==="hotkey"||(y.size=y.size??d,y.position=y.position??u,y.checkDisabled&&(y.disabled=!n),y.checkHidden&&(y.hidden=!n))}return A},[a,g,l,i,N,m,G,b,S,s,d,u,n])},nt=()=>{const[,e]=c.useState({});return c.useCallback(()=>{e({})},[e])},rt=e=>c.useMemo(()=>{if(e.headerLabel)return{...Ce,title:e.headerLabel}},[e.headerLabel]),dt=(e,t,o)=>{var n;return c.useMemo(()=>{var r;if(!(!t.editFormProps||t.disabled||t.readOnly||((r=t.buttons)==null?void 0:r.create)===null))return{...Ee,title:e.t("create"),tooltip:e.t("createRecord"),onClick:()=>{const s=e.getFieldNames(),d=e.getActiveNode(!1);let u;d&&(u=d&&o?d:e.getParentNode(d)),e.getEditFormApi().open("create",{defaultValues:{[s.parent]:u}})}}},[t.editFormProps,t.disabled,t.readOnly,(n=t.buttons)==null?void 0:n.create,e,o])},st=(e,t,o)=>{var n;return c.useMemo(()=>{var r;if(!(!t.editGroupFormProps||!t.groupsMode||t.disabled||t.readOnly||((r=t.buttons)==null?void 0:r.createGroup)===null))return{...Pe,title:e.t("createGroup"),tooltip:e.t("createRecordsGroup"),onClick:()=>{const s=e.getFieldNames(),d=e.getActiveNode(!1);let u;d&&(u=d&&o?d:e.getParentNode(d)),e.getEditGroupFormApi().open("create",{defaultValues:{[s.parent]:u}})}}},[t.editGroupFormProps,t.groupsMode,t.disabled,t.readOnly,(n=t.buttons)==null?void 0:n.createGroup,e,o])},ut=(e,t,o,n)=>{var r;return c.useMemo(()=>{var s;if(!(!n&&!t.editFormProps||n&&!t.editGroupFormProps||!t.readOnly||t.disabled||((s=t.buttons)==null?void 0:s.view)===null))return{...xe,title:e.t("view"),tooltip:e.t("viewRecord"),disabled:!o,onClick:()=>{if(!o)return;const d=e.getFieldNames(),u=e.getParentNode(o);n?e.getEditGroupFormApi().open("view",{dataSet:{...R(o),[d.parent]:u}}):e.getEditFormApi().open("view",{dataSet:{...R(o),[d.parent]:u}})}}},[n,t.editFormProps,t.editGroupFormProps,t.readOnly,t.disabled,(r=t.buttons)==null?void 0:r.view,o,e])},lt=(e,t,o,n)=>{var r;return c.useMemo(()=>{var d;const s=t.editGroupFormProps;if(!(!n&&!t.editFormProps||n&&!t.editGroupFormProps||t.disabled||t.readOnly||((d=t.buttons)==null?void 0:d.clone)===null))return{...Me,title:n&&s?e.t("cloneGroup"):e.t("clone"),tooltip:n&&s?e.t("cloneRecordsGroup"):e.t("cloneRecord"),disabled:!o,onClick:()=>{if(!o)return;const u=e.getFieldNames(),a=e.getParentNode(o);n?e.getEditGroupFormApi().open("clone",{dataSet:{...R(o),[u.parent]:a}}):e.getEditFormApi().open("clone",{dataSet:{...R(o),[u.parent]:a}})}}},[t.editGroupFormProps,t.editFormProps,t.disabled,t.readOnly,(r=t.buttons)==null?void 0:r.clone,n,o,e])},ct=(e,t,o,n)=>{var r;return c.useMemo(()=>{var d;const s=t.editGroupFormProps;if(!(!n&&!t.editFormProps||n&&!t.editGroupFormProps||t.disabled||t.readOnly||((d=t.buttons)==null?void 0:d.update)===null))return{...ke,title:n&&s?e.t("editGroup"):e.t("edit"),tooltip:n&&s?e.t("editRecordsGroup"):e.t("editRecord"),disabled:!o,onClick:()=>{if(!o)return;const u=e.getFieldNames(),a=e.getParentNode(o);n?e.getEditGroupFormApi().open("update",{dataSet:{...R(o),[u.parent]:a}}):e.getEditFormApi().open("update",{dataSet:{...R(o),[u.parent]:a}})}}},[t.editGroupFormProps,t.editFormProps,t.disabled,t.readOnly,(r=t.buttons)==null?void 0:r.update,n,o,e])},at=(e,t,o,n)=>c.useMemo(()=>{var r;if(!(!t.editFormProps||t.disabled||t.readOnly||((r=t.buttons)==null?void 0:r.delete)===null))return{...Oe,title:n?e.t("deleteGroup"):e.t("delete"),tooltip:n?e.t("deleteRecordsGroup"):e.t("deleteRecord"),disabled:!o,onClick:()=>{if(!o)return;if(!t.confirmDelete){x(o,t,e);return}const s=v.confirmWaiter({language:t.language,content:t.nodeDeleteMessage??e.t("deleteSelectedRecordQt"),colorType:"danger",onOk:()=>{x(o,t,e,s)},onCancel:()=>{s.destroy()}})}}},[t,n,e,o]),x=(e,t,o,n)=>{var d;const r=o.getButtonsApi(),s=(d=t==null?void 0:t.onDelete)==null?void 0:d.call(t,e,o);if(!k(s)){o.removeNode(e,{select:t.selectNewNode?"next":void 0}),n&&n.destroy();return}t.confirmDelete||(r.loading("delete",!0),r.disableAll(!0)),s.then(()=>{n==null||n.destroy(),o.getIsMounted()&&(o.removeNode(e,{select:t.selectNewNode?"next":void 0}),t.confirmDelete||(r.loading("delete",!1),r.disableAll(!1)))}).catch(u=>{n==null||n.destroy(),o.getIsMounted()&&(t.confirmDelete||(r.loading("delete",!1),r.disableAll(!1)),v.alert({language:t.language,title:o.t("error"),content:f.jsx(O,{error:u}),colorType:"danger"}))})},R=e=>({...e}),it=e=>c.useMemo(()=>({type:"hotkey",hotKeys:[{key:"ArrowUp"}],onClick:()=>{var n;const t=(n=e.getSelectedKeys())==null?void 0:n[0],o=e.getPrevNodeKey(t);o&&e.setSelectedKeys([o])}}),[e]),gt=e=>c.useMemo(()=>({type:"hotkey",hotKeys:[{key:"ArrowDown"}],onClick:()=>{const t=e.getActiveNodeKey(),o=e.getNextNodeKey(t);o&&e.setSelectedKeys([o])}}),[e]),ft=({api:e,treeProps:t})=>{const o=ot(e,t);return c.useMemo(()=>o?f.jsx("div",{style:{width:"100%",padding:"8px"},children:f.jsx(Ae,{buttons:o,apiRef:e.getButtonsApi(),style:t.buttonsRowStyle,context:e,responsiveBreakpoint:t.responsiveBreakpoint,iconsOnly:t.buttonsIconsOnly})}):null,[o,e,t.buttonsIconsOnly,t.buttonsRowStyle,t.responsiveBreakpoint])},mt=({treeApi:e,allProps:t,antdTreeProps:o})=>{const n=yt(e),r=Nt(e),s=Gt(e),d=Rt(e),u=bt(e);return f.jsx(Ie,{className:"draggable-tree",onDrop:d,allowDrop:u,...o,draggable:!t.readOnly&&t.draggable!==!1,ref:e.treeRef,treeData:e.getDataSet(),selectedKeys:e.getSelectedKeys(),expandedKeys:e.getExpandedKeys(),fieldNames:{key:"id",title:"title",children:"children",...t.fieldNames},onSelect:n,onExpand:r,onDoubleClick:s})},yt=e=>(t,o)=>{var r;const n=e.getProps();(!n.noDeselect||o.selected)&&(e.setSelectedKeys(t),(r=n.onSelect)==null||r.call(n,t,o))},Nt=e=>(t,o)=>{var r;const n=e.getProps();e.setExpandedKeys(t),(r=n.onExpand)==null||r.call(n,t,o)},Gt=e=>(t,o)=>{var s,d;const n=e.getProps();n.onDoubleClick&&((s=n.onDoubleClick)==null||s.call(n,t,o));const r=e.getFieldNames();if(!n.disabled&&!n.readOnly&&(n.editFormProps||n.editGroupFormProps)){e.getButtonsApi().triggerClick("update");return}(d=o[r.children])!=null&&d.length&&e.toggleNode(o[r.key])},bt=e=>t=>{const o=e.getProps(),n=e.getFieldNames();return o.groupsMode?o.draggableOrder?t.dropPosition<=0&&t.dropNode[n.isGroup]||t.dropPosition>0:t.dropPosition<=0&&t.dropNode[n.isGroup]:o.draggableOrder?!0:t.dropPosition===0},Rt=e=>t=>{const o=e.getProps();let n="insideTop";if(t.dropToGap&&(n=t.dropPosition<0?"above":"below"),!t.dragNode)return;if(!o.confirmMove){M(t.dragNode,t.node,n,!0,e);return}const r=v.confirmWaiter({language:o.language,content:o.nodeMoveMessage??e.t("moveRecordQt"),onOk:()=>{M(t.dragNode,t.node,n,!0,e,r)},onCancel:()=>{r.destroy()}})},M=(e,t,o,n,r,s)=>{var a;const d=r.getProps(),u=(a=d==null?void 0:d.onNodeMove)==null?void 0:a.call(d,e,t,o,r);if(!k(u)){r.moveNode(e,t,o,{ensureVisible:n,sortNodes:d.sortOnChange}),s&&s.destroy();return}u.then(()=>{s==null||s.destroy(),r.getIsMounted()&&r.moveNode(e,t,o,{ensureVisible:n,sortNodes:d.sortOnChange})}).catch(l=>{s==null||s.destroy(),r.getIsMounted()&&v.alert({language:d.language,title:r.t("error"),content:f.jsx(O,{error:l}),colorType:"danger"})})},At=({api:e,allProps:t,antdTreeProps:o})=>{const n=P(e,t,!1),r=P(e,t,!0);return f.jsxs("div",{className:"extended-tree-container",children:[f.jsx(we,{isLoading:e.getIsLoading(),notHideContent:!0,spinStyle:{height:"100%"},children:f.jsxs(Se,{style:{display:"flex",flexDirection:"column",...t.buttonsRowWrapperStyle},children:[f.jsx(Te,{style:{zIndex:15},children:f.jsx(ft,{api:e,treeProps:t})}),f.jsx(mt,{treeApi:e,allProps:t,antdTreeProps:o})]})}),!t.disabled&&n?f.jsx(C,{...n,apiRef:e.getEditFormApi()}):null,!t.disabled&&r?f.jsx(C,{...r,apiRef:e.getEditGroupFormApi()}):null]})},Pt=e=>{const[t,o]=Fe(e),[,n]=St(t),r=tt({props:t,setProps:o});return f.jsx(At,{allProps:t,antdTreeProps:n,api:r})},St=e=>c.useMemo(()=>{const[t,o]=ve(e,{id:!0,buttons:!0,buttonsIconsOnly:!0,buttonsPosition:!0,buttonsSize:!0,confirmDelete:!0,editFormProps:!0,editGroupFormProps:!0,language:!0,readOnly:!0,deleteMessage:!0,translation:!0,apiRef:!0,headerLabel:!0,responsiveBreakpoint:!0,buttonsRowStyle:!0,buttonsRowWrapperStyle:!0,dataSet:!0,dataMutator:!0,noDeselect:!0,groupsMode:!0,selectNewNode:!0,confirmMove:!0,nodeMoveMessage:!0,draggableOrder:!0,sortComparator:!0,sortOnChange:!0,onDataSetChanged:!0,nodeDeleteMessage:!0,onDelete:!0,onNodeMove:!0,fieldNames:!0,defaultCheckedKeys:!0,checkedKeys:!0,defaultExpandedKeys:!0,expandedKeys:!0,defaultSelectedKeys:!0,selectedKeys:!0});return[t,{...o,fieldNames:t.fieldNames}]},[e]);export{Pt as T};
