import{r as h,j as b}from"./index-jRq8dFl9.js";import{h as I,m as k,G as a,c as E,M as O,f as D}from"./messageBox-A1wgNO27.js";import{D as f,I as j,a as w,u as R}from"./dForm-CmpnCynY.js";import{M as T}from"./modal-Bq0KGAYX.js";const V=(t,e,n,u,c)=>{e.getFormId=N(t),e.buttonsApi=u,e.getFormProps=v(n),e.setFormProps=H(n,c),e.open=B(e),e.close=G(e),e.forceClose=z(e)},N=t=>h.useCallback(()=>t,[t]),v=t=>h.useCallback(()=>t,[t]),H=(t,e)=>h.useCallback(n=>{e({...t,...n})},[t,e]),B=t=>h.useCallback((e,n)=>{var s,C;if(!e){console.warn("The form mode is not set");return}const u=n??t.getFormProps().dataSet,c=u?I(u):void 0,i=t.getFormProps();((s=i.onOpen)==null?void 0:s.call(i,t,c))!==!1&&(t.setFormProps({open:!0,formMode:e,dataSet:c}),(C=i.onOpened)==null||C.call(i,t,c))},[t]),z=t=>h.useCallback(()=>{var n,u;const e=t.getFormProps();if(((n=e.onClosing)==null?void 0:n.call(e,t))===!1)return!1;t.setFormProps({open:!1}),(u=e.onClosed)==null||u.call(e,t)},[t]),G=t=>h.useCallback(()=>{var n;const e=t.getFormProps();if(((n=e.onClosing)==null?void 0:n.call(e,t))!==!1){if(t.model.isFormDirty()&&e.confirmChanges){k.confirm({content:e.closeFormConfirmMessage??"Отменить сделанные изменения?",okText:"Да",cancelText:"Нет",onOk:()=>{t.forceClose()}});return}t.forceClose()}},[t]),K=({formId:t,buttons:e,buttonsApi:n,formApi:u,formProps:c,modalProps:i,modalFormProps:s})=>{const[C]=h.useState(t??"dFormModal-"+a()),S=s.formMode??"create",g=U(S,s.title);return b.jsx(T,{...i,modalId:C,style:s.modalStyle,styles:s.modalStyles,onCancel:u.close,centered:typeof i.centered>"u"?!0:i.centered,maskClosable:!1,keyboard:!1,destroyOnClose:!0,footer:b.jsx(E,{buttons:e,colorType:s.colorType,buttonsApi:n,arrowsSelection:s.arrowsButtonsSelection,context:u}),title:g,children:s.open?b.jsx(f,{apiRef:u,...c,formStyle:{height:"100%",width:"100%",...c.formStyle},containerStyle:{height:"100%",...c.containerStyle}}):null})},U=(t,e)=>e||(t==="view"?"Просмотр":t==="create"?"Создание":t==="clone"?"Клонирование":t==="update"?"Редактирование":"&nbsp;"),W=(t,e)=>h.useMemo(()=>({onFormDirtyStateChanged:n=>{var u;return(u=e==null?void 0:e.onFormDirtyStateChanged)==null?void 0:u.call(e,n,t)},onFormReadOnlyStateChanged:n=>{var u;return(u=e==null?void 0:e.onFormReadOnlyStateChanged)==null?void 0:u.call(e,n,t)},onFormInit:()=>{var n;return(n=e==null?void 0:e.onFormInit)==null?void 0:n.call(e,t)},onFormModelInitialized:()=>{var n;return(n=e==null?void 0:e.onFormModelInitialized)==null?void 0:n.call(e,t)},onFormReadyStateChanged:n=>{var u;return(u=e==null?void 0:e.onFormReadyStateChanged)==null?void 0:u.call(e,n,t)},onFormValuesChanged:(n,u)=>{var c;return(c=e==null?void 0:e.onFormValuesChanged)==null?void 0:c.call(e,n,u,t)},onFormValidated:(n,u,c)=>{var i;return(i=e==null?void 0:e.onFormValidated)==null?void 0:i.call(e,n,u,c,t)},onFormHasErrors:(n,u)=>{var c;return(c=e==null?void 0:e.onFormHasErrors)==null?void 0:c.call(e,n,u,t)},onFormHasNoErrors:n=>{var u;return(u=e==null?void 0:e.onFormHasNoErrors)==null?void 0:u.call(e,n,t)},onDataFetch:()=>{var n;return(n=e==null?void 0:e.onDataFetch)==null?void 0:n.call(e,t)},onDataFetchSuccess:n=>{var u;return(u=e==null?void 0:e.onDataFetchSuccess)==null?void 0:u.call(e,n,t)},onDataFetchError:n=>{var c;if(((c=e==null?void 0:e.onDataFetchError)==null?void 0:c.call(e,n,t))===!1)return!1;const u=k.confirm({content:b.jsxs(b.Fragment,{children:[b.jsx("p",{children:b.jsx("b",{children:n.message})}),n.stack&&j()?b.jsx("p",{children:n.stack}):"",b.jsx("p",{children:"Попробовать снова?"})]}),colorType:"danger",buttons:{ok:{onClick:()=>{u.destroy(),t.model.fetchData()}},cancel:{onClick:()=>{var i;u.destroy(),(i=t.forceClose)==null||i.call(t)}}}});return!1},onDataFetchComplete:()=>{var n;return(n=e==null?void 0:e.onDataFetchComplete)==null?void 0:n.call(e,t)},onSubmitValidation:(n,u)=>{var c;return(c=e==null?void 0:e.onSubmitValidation)==null?void 0:c.call(e,n,u,t)},onSubmit:n=>{var u,c,i,s,C,S,g;return(c=(u=t.buttonsApi).disabled)==null||c.call(u,"ok",!0),(s=(i=t.buttonsApi).disabled)==null||s.call(i,"cancel",!0),e.confirmChanges||(S=(C=t.buttonsApi).loading)==null||S.call(C,"ok",!0),(g=e==null?void 0:e.onSubmit)==null?void 0:g.call(e,n,t)},onSubmitSuccess:(n,u)=>{var c;if(((c=e==null?void 0:e.onSubmitSuccess)==null?void 0:c.call(e,n,u,t))===!1)return!1;t.forceClose()},onSubmitError:(n,u)=>{var c;return(c=e==null?void 0:e.onSubmitError)==null?void 0:c.call(e,n,u,t)},onSubmitComplete:(n,u)=>{var c,i,s,C,S,g,y;if(((c=e==null?void 0:e.onSubmitComplete)==null?void 0:c.call(e,n,u,t))===!1)return!1;(s=(i=t.buttonsApi).disabled)==null||s.call(i,"ok",!1),(S=(C=t.buttonsApi).disabled)==null||S.call(C,"cancel",!1),(y=(g=t.buttonsApi).loading)==null||y.call(g,"ok",!1)},onDataSetChange:n=>{var u;return(u=e==null?void 0:e.onDataSetChange)==null?void 0:u.call(e,n,t)}}),[t,e]),L=(t,e)=>h.useMemo(()=>{const n={ok:{position:"right",active:e.formMode!=="view",hidden:e.formMode==="view",title:"ОК",hotKeys:[{key:"enter",ctrl:!0},{key:"s",ctrl:!0},{key:"ы",ctrl:!0}],onClick:()=>{t.submitForm()}},cancel:{position:"right",title:"Отмена",hotKeys:[{key:"escape"}],active:e.formMode==="view",onClick:()=>{t.close()}}};return O(n,e.buttons)},[t,e.buttons,e.formMode]),_=t=>{w();const[e]=h.useState(t.formId??"dFormModal-"+a()),[n,u]=R(t),[c,i]=q(n),[s,C]=h.useState(n.apiRef||{}),[S]=h.useState({}),g=L(s,n);V(e,s,n,S,u);const y=W(s,n),[,x]=J(i,y);return h.useEffect(()=>()=>{C({})},[]),b.jsx(K,{formId:e,formApi:s,modalFormProps:n,modalProps:c,formProps:x,buttons:g,buttonsApi:S})},q=t=>h.useMemo(()=>{const[e,n]=D(t,{afterClose:!0,animation:!0,bodyProps:!0,centered:!0,children:!0,className:!0,classNames:!0,closable:!0,closeIcon:!0,colorType:!0,confirmLoading:!0,focusTriggerAfterClose:!0,forceRender:!0,getContainer:!0,headerIcon:!0,height:!0,isDraggable:!0,loading:!0,mask:!0,maskAnimation:!0,maskProps:!0,maskStyle:!0,maskTransitionName:!0,modalRender:!0,mousePosition:!0,notScrollable:!0,onAfterOpenChange:!0,open:!0,panelRef:!0,prefixCls:!0,resizable:!0,rootClassName:!0,title:!0,transitionName:!0,visible:!0,width:!0,wrapClassName:!0,wrapProps:!0,wrapStyle:!0,zIndex:!0,maxHeight:!0,minHeight:!0,minWidth:!0,maxWidth:!0});return[e,n]},[t]),J=(t,e)=>h.useMemo(()=>{const[n,u]=D(t,{closeFormConfirmMessage:!0,modalStyle:!0,modalStyles:!0,onClosed:!0,onClosing:!0,onDataFetch:!0,onDataFetchComplete:!0,onDataFetchError:!0,onDataFetchSuccess:!0,onDataSetChange:!0,onFormDirtyStateChanged:!0,onFormDisabledStateChanged:!0,onFormHasErrors:!0,onFormHasNoErrors:!0,onFormInit:!0,onFormModelInitialized:!0,onFormReadOnlyStateChanged:!0,onFormReadyStateChanged:!0,onFormValidated:!0,onFormValuesChanged:!0,onOpen:!0,onOpened:!0,onSubmit:!0,onSubmitComplete:!0,onSubmitError:!0,onSubmitSuccess:!0,onSubmitValidation:!0});return u.buttons=null,[n,{...u,...e}]},[e,t]);export{_ as D};
