import{j as b,b8 as B,r as s,a as z}from"./index-DpZR-xIT.js";import{h as T,G as H,i as W,j as V,H as G,k as L,m as O,l as N,D as Y,c as M,M as X,n as U,u as $,f as K}from"./dForm-BuCntjeb.js";const _=()=>{const t=navigator.userAgent||navigator.vendor||window.opera,e=["android","webos","iphone","ipad","ipod","blackberry","ieMobile","opera mini","avantgo","bada","blazer","elaine","fennec","hipTop","iris","kindle","lge","maemo","midp","mmp","symbian","pocket","webOs","nexus","compal"];return new RegExp(e.join("|"),"i").test(t)},{useToken:q}=B,J=({onMouseResize:t,resizable:e,children:n,style:i,colorType:c})=>{const{token:u}=q(),g=Z(u,c);return _()&&(e=!1),b.jsxs("div",{children:[b.jsx("div",{style:{borderTopWidth:1,borderTopStyle:"solid",borderTopColor:g,...i},children:n}),e?b.jsx(Q,{onMouseDown:t}):null]})},Q=t=>b.jsx("div",{className:"resize-handle",...t,children:b.jsx("div",{className:"resize-handle-inner"})}),Z=(t,e)=>{let n=t.colorFillSecondary;return e==="info"?n=t.colorInfoHover:e==="success"?n=t.colorSuccessHover:e==="warning"?n=t.colorWarningHover:e==="danger"&&(n=t.colorErrorHover),n};/**
 * @Modal
 * @version 0.0.0.3
 * @link omegatester@gmail.com
 * @author Maksim Zaytsev
 * @license MIT
 */const d=(t,e)=>{s.useEffect(()=>(e?T.pushToStack(t):T.removeFromStack(t),()=>{T.removeFromStack(t)}),[e,t])},A=(t,e,n,i,c,u,g)=>{const[h,a]=s.useState(!1),[y,D]=s.useState({initWidth:0,initBodyHeight:0,mouseDownX:0,mouseDownY:0}),R=s.useCallback(S=>{var C;if(S.preventDefault(),!e&&S.target instanceof HTMLElement){const f=(C=S.target.closest(".custom-antd-modal"))==null?void 0:C.querySelector(".ant-modal-body");f&&(e=f.clientHeight)}if(!t&&S.target instanceof HTMLElement){const f=S.target.closest(".custom-antd-modal");f&&(t=f.clientWidth)}D({initWidth:t,initBodyHeight:e,mouseDownX:S.clientX,mouseDownY:S.clientY}),a(!0)},[t,e,a,D]);return s.useEffect(()=>{const S=C=>{if(h){const{initWidth:f,mouseDownX:j,initBodyHeight:E,mouseDownY:l}=y,k=C.clientX-j,v=C.clientY-l;let w=f+k*2;c&&w>c&&(w=c),i&&w<i&&(w=i);let x=E+v*2;return g&&x>g&&(x=g),u&&x<u&&(x=u),n({width:w,bodyHeight:x})}};return window.addEventListener("mousemove",S,{passive:!0}),()=>window.removeEventListener("mousemove",S)},[y,h,n,i,c,u,g]),s.useEffect(()=>{const S=()=>{a(!1)};return window.addEventListener("mouseup",S),()=>window.removeEventListener("mouseup",S)},[a]),R},r=({resizable:t=!0,isDraggable:e=!0,headerStyle:n,footerStyle:i,...c})=>{const[u]=s.useState(c.modalId??"modal-"+H());d(u,!!c.open);const g=s.useRef({}),h=s.useRef();s.useEffect(()=>{c.open&&(h.current=document.activeElement)},[c.open]);const a=s.useCallback(k=>{var v,w,x,I;k?(w=(v=g.current)==null?void 0:v.onParentComponentRendered)==null||w.call(v):(x=h.current)==null||x.focus(),(I=c.onAfterOpenChange)==null||I.call(c,k)},[c]),[y,D]=s.useState({width:c.width??0,bodyHeight:c.bodyHeight??0}),R=A(y.width,y.bodyHeight,D,c.minWidth??200,c.maxWidth??5e3,c.bodyMinHeight??50,c.bodyMaxHeight??5e3),S=F({bodyStyle:c.bodyCss,bodyHeight:y.bodyHeight,bodyMaxHeight:c.bodyMaxHeight,bodyMinHeight:c.bodyMinHeight,notScrollable:c.notScrollable}),C=24,f=24,j={paddingLeft:C,paddingRight:f,paddingTop:5,paddingBottom:5,...n},E={paddingTop:20,paddingLeft:C,paddingRight:f,paddingBottom:20,...i},[l]=s.useState("draggable-"+H());return b.jsx(W,{...c,width:y.width||void 0,styles:{body:S,footer:{margin:0}},className:z("custom-antd-modal",c.className),modalRender:k=>V(k,l,g,e),title:b.jsx(G,{draggableId:l,icon:c.headerIcon,title:c.title,colorType:c.colorType,style:j}),footer:b.jsx(J,{onMouseResize:R,resizable:t,style:E,colorType:c.colorType,children:c.footer}),afterOpenChange:a})},F=({bodyStyle:t,bodyHeight:e,bodyMaxHeight:n,bodyMinHeight:i,notScrollable:c})=>{const u={...t,padding:"0 24px 0 24px",overflowY:c?"hidden":"auto"};return e&&(u.height=e),n&&(u.maxHeight=n),i&&(u.minHeight=i),u},P=(t,e,n,i,c)=>{e.getFormId=o(t),e.buttonsApi=i,e.getFormProps=p(n),e.setFormProps=m(n,c),e.open=ee(e),e.close=ne(e),e.forceClose=te(e)},o=t=>s.useCallback(()=>t,[t]),p=t=>s.useCallback(()=>t,[t]),m=(t,e)=>s.useCallback(n=>{e({...t,...n})},[t,e]),ee=t=>s.useCallback((e,n)=>{var g,h;if(!e){console.warn("The form mode is not set");return}const i=n??t.getFormProps().dataSet,c=i?L(i):void 0,u=t.getFormProps();((g=u.onOpen)==null?void 0:g.call(u,t,c))!==!1&&(t.setFormProps({isOpened:!0,formMode:e,dataSet:c}),(h=u.onOpened)==null||h.call(u,t,c))},[t]),te=t=>s.useCallback(()=>{var n,i;const e=t.getFormProps();if(((n=e.onClosing)==null?void 0:n.call(e,t))===!1)return!1;t.setFormProps({isOpened:!1}),(i=e.onClosed)==null||i.call(e,t)},[t]),ne=t=>s.useCallback(()=>{var n;const e=t.getFormProps();if(((n=e.onClosing)==null?void 0:n.call(e,t))!==!1){if(t.model.isFormDirty()&&e.confirmChanges){O.confirm({content:e.closeFormConfirmMessage??"Отменить сделанные изменения?",okText:"Да",cancelText:"Нет",onOk:()=>{t.forceClose()}});return}t.forceClose()}},[t]),ce=({formId:t,buttons:e,buttonsApi:n,formApi:i,formProps:c,modalFormProps:u})=>{const[g]=s.useState(t??"dFormModal-"+H()),h=u.formMode??"create",a=ie(h,u.title);return b.jsx(r,{modalId:g,open:u.isOpened,onCancel:i.close,centered:!0,destroyOnClose:!0,footer:b.jsx(N,{buttons:e,colorType:u.colorType,buttonsApi:n,arrowsSelection:u.arrowsButtonsSelection,context:i}),footerStyle:u.footerStyle,maskClosable:!1,keyboard:!1,width:u.width,minWidth:u.minWidth,maxWidth:u.maxWidth,notScrollable:u.notScrollable,resizable:u.resizable!==!1,title:a,headerIcon:u.headerIcon,headerStyle:u.headerStyle,colorType:c.colorType,bodyHeight:u.bodyHeight,bodyMinHeight:u.bodyMinHeight,bodyMaxHeight:u.bodyMaxHeight,bodyCss:u.bodyStyle,isDraggable:u.isDraggable,children:u.isOpened?b.jsx(Y,{apiRef:i,...c,formStyle:{height:"100%",...c.formStyle},containerStyle:{height:"100%",...c.containerStyle}}):null})},ie=(t,e)=>e||(t==="view"?"Просмотр":t==="create"?"Создание":t==="clone"?"Клонирование":t==="update"?"Редактирование":"&nbsp;"),ue=(t,e)=>s.useMemo(()=>({onFormDirtyStateChanged:n=>{var i;return(i=e==null?void 0:e.onFormDirtyStateChanged)==null?void 0:i.call(e,n,t)},onFormReadOnlyStateChanged:n=>{var i;return(i=e==null?void 0:e.onFormReadOnlyStateChanged)==null?void 0:i.call(e,n,t)},onFormInit:()=>{var n;return(n=e==null?void 0:e.onFormInit)==null?void 0:n.call(e,t)},onFormModelInitialized:()=>{var n;return(n=e==null?void 0:e.onFormModelInitialized)==null?void 0:n.call(e,t)},onFormReadyStateChanged:n=>{var i;return(i=e==null?void 0:e.onFormReadyStateChanged)==null?void 0:i.call(e,n,t)},onFormValuesChanged:(n,i)=>{var c;return(c=e==null?void 0:e.onFormValuesChanged)==null?void 0:c.call(e,n,i,t)},onFormValidated:(n,i,c)=>{var u;return(u=e==null?void 0:e.onFormValidated)==null?void 0:u.call(e,n,i,c,t)},onFormHasErrors:(n,i)=>{var c;return(c=e==null?void 0:e.onFormHasErrors)==null?void 0:c.call(e,n,i,t)},onFormHasNoErrors:n=>{var i;return(i=e==null?void 0:e.onFormHasNoErrors)==null?void 0:i.call(e,n,t)},onDataFetch:()=>{var n;return(n=e==null?void 0:e.onDataFetch)==null?void 0:n.call(e,t)},onDataFetchSuccess:n=>{var i;return(i=e==null?void 0:e.onDataFetchSuccess)==null?void 0:i.call(e,n,t)},onDataFetchError:n=>{var c;if(((c=e==null?void 0:e.onDataFetchError)==null?void 0:c.call(e,n,t))===!1)return!1;const i=O.confirm({content:b.jsxs(b.Fragment,{children:[b.jsx("p",{children:b.jsx("b",{children:n.message})}),n.stack&&M()?b.jsx("p",{children:n.stack}):"",b.jsx("p",{children:"Попробовать снова?"})]}),colorType:"danger",buttons:{ok:{onClick:()=>{i.destroy(),t.model.fetchData()}},cancel:{onClick:()=>{var u;i.destroy(),(u=t.forceClose)==null||u.call(t)}}}});return!1},onDataFetchComplete:()=>{var n;return(n=e==null?void 0:e.onDataFetchComplete)==null?void 0:n.call(e,t)},onSubmitValidation:(n,i)=>{var c;return(c=e==null?void 0:e.onSubmitValidation)==null?void 0:c.call(e,n,i,t)},onSubmit:n=>{var i,c,u,g,h,a,y;return(c=(i=t.buttonsApi).disabled)==null||c.call(i,"ok",!0),(g=(u=t.buttonsApi).disabled)==null||g.call(u,"cancel",!0),e.confirmChanges||(a=(h=t.buttonsApi).loading)==null||a.call(h,"ok",!0),(y=e==null?void 0:e.onSubmit)==null?void 0:y.call(e,n,t)},onSubmitSuccess:(n,i)=>{var c;if(((c=e==null?void 0:e.onSubmitSuccess)==null?void 0:c.call(e,n,i,t))===!1)return!1;t.forceClose()},onSubmitError:(n,i)=>{var c;return(c=e==null?void 0:e.onSubmitError)==null?void 0:c.call(e,n,i,t)},onSubmitComplete:(n,i)=>{var c,u,g,h,a,y,D;if(((c=e==null?void 0:e.onSubmitComplete)==null?void 0:c.call(e,n,i,t))===!1)return!1;(g=(u=t.buttonsApi).disabled)==null||g.call(u,"ok",!1),(a=(h=t.buttonsApi).disabled)==null||a.call(h,"cancel",!1),(D=(y=t.buttonsApi).loading)==null||D.call(y,"ok",!1)},onDataSetChange:n=>{var i;return(i=e==null?void 0:e.onDataSetChange)==null?void 0:i.call(e,n,t)}}),[t,e]),se=(t,e)=>s.useMemo(()=>{const n={ok:{position:"right",active:e.formMode!=="view",hidden:e.formMode==="view",title:"ОК",hotKeys:[{key:"enter",ctrl:!0},{key:"s",ctrl:!0},{key:"ы",ctrl:!0}],onClick:()=>{t.submitForm()}},cancel:{position:"right",title:"Отмена",hotKeys:[{key:"escape"}],active:e.formMode==="view",onClick:()=>{t.close()}}};return X(n,e.buttons)},[t,e.buttons,e.formMode]),ae=t=>{U();const[e]=s.useState(t.formId??"dFormModal-"+H()),[n,i]=$(t),[c,u]=s.useState(n.apiRef||{}),[g]=s.useState({}),h=se(c,n);P(e,c,n,g,i);const a=ue(c,n),[,y]=ge(n,a);return s.useEffect(()=>()=>{u({})},[]),b.jsx(ce,{formId:e,formApi:c,modalFormProps:n,formProps:y,buttons:h,buttonsApi:g})},ge=(t,e)=>s.useMemo(()=>{const[n,i]=K(t,{title:!0,width:!0,minWidth:!0,maxWidth:!0,bodyHeight:!0,bodyMinHeight:!0,bodyMaxHeight:!0,bodyStyle:!0,notScrollable:!0,isDraggable:!0,resizable:!0,isOpened:!0,headerStyle:!0,headerIcon:!0,footerStyle:!0,closeFormConfirmMessage:!0});return i.buttons=null,[n,{...i,...e}]},[e,t]);export{ae as D,r as M};
