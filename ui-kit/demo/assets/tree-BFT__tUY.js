import{r as l,j as N}from"./index-CtAjfk3U.js";import{O as M,n as I,h as x,i as O,j as B,k as T,l as L,m as j,o as P,p as H,q as Q,r as U,s as z,t as V,v as W,w as _,x as q,y as J,z as X,A as Y,B as Z,C as $,D as ee,E as te,F as oe,G as se,H as re,I as ne,J as de,K as ue,L as ce,M as ae,N as ie,u as le,a as ge,b as fe,c as ye,d as Ne,e as pe,f as Ge}from"./useApiGetGroupsOnly-Bxa2nsTp.js";import{D,s as me}from"./dFormModal-DBrO8yV5.js";import{f as Re,u as Se,t as ve,e as Ae,d as Ke,c as be,m as he,a as we,B as xe,P as De}from"./buttonsRow-DIWV9y5m.js";import{u as Ce,a as h,c as Ee,t as ke,E as Fe,L as Me}from"./isArray-Dq3mFmoY.js";import{o as Ie}from"./defaultButtonsProps-BFWSm065.js";import{m as F}from"./messageBox-BEJz6LZv.js";import{T as Oe}from"./index-C2aIs9ND.js";import{s as Be}from"./index-CMA59ydq.js";const Te=e=>()=>e,Le=e=>t=>{e(t)},je=e=>()=>e,Pe=e=>()=>e,He={view:"Просмотр",viewGroup:"Просмотр группы",viewRecord:"Просмотр записи",viewRecordsGroup:"Просмотр группы записей",create:"Создать",createRecord:"Создать запись",createGroup:"Создать группу",createRecordsGroup:"Создать группу записей",edit:"Редактировать",editGroup:"Редактировать группу",editRecord:"Редактировать запись",editRecordsGroup:"Редактировать группу записей",clone:"Клонировать",cloneGroup:"Клонировать группу",cloneRecord:"Клонировать запись",cloneRecordsGroup:"Клонировать группу записей",delete:"Удалить",deleteGroup:"Удалить группу",deleteRecord:"Удалить запись(и)",deleteRecordsGroup:"Удалить группу записей",select:"Выбрать",selectRecord:"Выбрать запись(и)",go:"Перейти",filter:"Фильтр",ok:"OK",cancel:"Отмена",tryAgainQt:"Попробовать еще раз?",deleteSelectedRecordQt:"Удалить выбранную запись?",moveRecordQt:"Удалить данную запись?",error:"Ошибка",dataNotFound:"Данные не найдены"},Qe={view:"View",viewGroup:"View group",viewRecord:"View record",viewRecordsGroup:"View records group",create:"Create",createRecord:"Create record",createGroup:"Create group",createRecordsGroup:"Create records group",edit:"Edit",editGroup:"Edit group",editRecord:"Edit record",editRecordsGroup:"Edit records group",clone:"Clone",cloneGroup:"Clone group",cloneRecord:"Clone record",cloneRecordsGroup:"Clone records group",delete:"Delete",deleteGroup:"Delete group",deleteRecord:"Delete record(s)",deleteRecordsGroup:"Delete records group(s)",select:"Select",selectRecord:"Select record(s)",go:"Go",filter:"Filter",ok:"OK",cancel:"Cancel",tryAgainQt:"Try again?",deleteSelectedRecordQt:"Delete selected record?",moveRecordQt:"Move the record?",error:"Error",dataNotFound:"Data not found"},Ue={view:"查看",viewGroup:"查看组",viewRecord:"查看记录",viewRecordsGroup:"查看记录组",create:"创建",createRecord:"创建记录",createGroup:"创建组",createRecordsGroup:"创建记录组",edit:"编辑",editGroup:"编辑组",editRecord:"编辑记录",editRecordsGroup:"编辑记录组",clone:"克隆",cloneGroup:"克隆组",cloneRecord:"克隆记录",cloneRecordsGroup:"克隆记录组",delete:"删除",deleteGroup:"删除组",deleteRecord:"删除记录",deleteRecordsGroup:"删除记录组",select:"选择",selectRecord:"选择记录",go:"前往",filter:"过滤",ok:"确定",cancel:"取消",tryAgainQt:"再试一次",deleteSelectedRecordQt:"删除选定的记录",moveRecordQt:"删除此记录",error:"错误",dataNotFound:"数据未找到"},ze={ru_RU:He,en_US:Qe,zh_CN:Ue},Ve=e=>Ce(e.language,ze,e.translation),We=({dataMutator:e})=>l.useCallback(t=>{if(!e)return t;let o={...t};return e&&(o=e(o)),o},[e]),_e=e=>()=>e,qe=e=>{const t=l.useRef(void 0),o=l.useRef(void 0);return s=>{const r=e.getSelectedKeys();if(t.current===r)return o.current;if(t.current=r,!r){o.current=void 0;return}const n=[];for(const d of r){const u=e.getNode(d,s);u&&n.push(u)}return o.current=n,n}},Je=(e,t)=>(o,s=!0,r=!1,n=void 0)=>{const d=e.getFieldNames(),u=typeof o=="object"?o[d.key]:o;if(!u)return;const i=n??e.getDataSet(),c=e.getSelectedKeys();if(r){const f=Xe(u,s,c,i,d);e.setSelectedKeys(f);return}let g=[];if(s){if(c!=null&&c.includes(u))return;t?g=[...c??[],u]:g=[u]}else{if(!(c!=null&&c.includes(u)))return;t?g=c==null?void 0:c.filter(f=>f!==u):g=[]}e.setSelectedKeys(g)},Xe=(e,t,o,s,r)=>{const n=M(e,s,r);if(!n||!s)return o;const d=[...o??[]],u=i=>{const c=i[r.key];if(!c)return;const g=d.indexOf(c);if(t){if(g>-1||i[r.disabled]||i[r.selectable]===!1)return;d.push(c)}else{if(g<0)return;d.splice(g,1)}if(h(i[r.children]))for(const f of i[r.children])u(f)};return u(n),d},Ye=e=>{const[t,o]=l.useState(C(e));return I(()=>{o(C(e))},[e]),[t,o]},C=e=>{if(e)return h(e)?e:[e]},Ze=e=>t=>{if(!t){e(void 0);return}h(t)?e(t):e([t])},$e=e=>()=>e,et=e=>t=>{setTimeout(()=>{e(t)},0)},tt=({props:e,setProps:t})=>{var v,R;const[o]=l.useState(e.apiRef??{}),[s]=l.useState(((v=e.editFormProps)==null?void 0:v.apiRef)??{}),[r]=l.useState(((R=e.editGroupFormProps)==null?void 0:R.apiRef)??{}),[n,d]=l.useState(!1),[u,i]=l.useState(!1),[c,g]=Ye(e.selectedKeys),f=x(e)(),p=We(e),[y,G,m,A]=O(e.dataSet,f,p),[w,S]=B(e.expandedKeys,e.defaultExpandedKeys,e.defaultExpandAll,A),K={getId:Se(e.id??"tree-"+ve()),getProps:be(e),setProps:Ke(t),updateProps:Ae(e,t),getIsMounted:Re(),getFieldNames:x(e),getDataSet:ie(y),setDataSet:j(G,e==null?void 0:e.onDataSetChanged),getGroupsOnly:ae(o),sortTree:L(y,e.sortComparator,o),isDataPlainList:ce(m),getEditFormApi:Pe(s),getEditGroupFormApi:je(r),getSelectedKeys:_e(c),setSelectedKeys:Ze(g),getSelectedNodes:qe(o),isNodeSelected:ue(o),selectNode:Je(o,e.multiple),getActiveNodeKey:de(o),getActiveNode:T(o),getExpandedKeys:ne(w),setExpandedKeys:re(S),getExpandedNodes:se(o),isNodeExpanded:oe(o),expandNode:te(o),collapseNode:ee(o),toggleNode:$(o),expandParentNodes:Z(o),getNode:Y(o),getNodes:X(o),getNextNodeKey:J(o),getPrevNodeKey:q(o),getNextNode:_(o),getPrevNode:W(o),getParentNode:V(o),addNode:z(o),updateNode:U(o),removeNode:Q(o),moveNode:H(o),ensureNodeVisible:P(o),t:Ve(e),treeRef:l.useRef(null),getButtonsApi:Ee(),getIsReady:Te(n),setIsReady:Le(d),getIsLoading:$e(u),setIsLoading:et(i)};return Object.assign(o,K)},E=(e,t,o)=>l.useMemo(()=>{const s=o?t==null?void 0:t.editGroupFormProps:t==null?void 0:t.editFormProps;if(!s)return;const r={...s};t.language&&!r.language&&(r.language=t.language);const n=s==null?void 0:s.onSubmitSuccess;return r.onSubmitSuccess=(d,u,i,c,g)=>{var m;if(n==null||n(d,u,i,c,g),g.isPrevented())return;const f=c.model.getFormMode(),p=e.getFieldNames(),y={...u,...i};let G;y[p.parent]?G=(m=y[p.parent])==null?void 0:m[p.key]:y[p.parent]===null?G=void 0:G=e.getActiveNodeKey(),f==="create"||f==="clone"?(y[p.key]||(y[p.key]=Ie()),e.addNode(y,G,"insideBottom",{ensureVisible:!0,select:!!t.selectNewNode,sortNodes:t.sortOnChange})):f==="update"&&e.updateNode(y,G,{ensureVisible:!0,sortNodes:t.sortOnChange})},r},[o,t==null?void 0:t.editFormProps,t==null?void 0:t.editGroupFormProps,t.language,t.selectNewNode,t.sortOnChange,e]),ot=(e,t)=>{e.getButtonsApi().refreshButtons=st();const o=e.getFieldNames(),s=e.getActiveNode(!0),r=!!(s!=null&&s.isLeaf)||!!(t.groupsMode&&!(s!=null&&s[o.isGroup])),n=t.buttons,d=t.buttonsSize??"small",u=t.buttonsPosition??"right",i=le(t),c=ge(e,t,r),g=fe(e,t,r),f=ye(e,t,s,b,r),p=Ne(e,t,s,b,r),y=pe(e,t,s,b,r),G=Ge(e,t,s,r),m=rt(e),A=nt(e);return l.useMemo(()=>{var K,v;const S=he({headerLabel:i,view:f,create:c,createGroup:g,clone:p,update:y,delete:G,arrowUp:m,arrowDown:A},n);for(const R in S){const a=S[R];!a||R==="headerLabel"||a.type==="hotkey"||(a.size=a.size??d,a.position=a.position??u,a.checkDisabled&&(a.disabled=!s),a.checkHidden&&(a.hidden=!s),a.onDisabledCheck&&(a.disabled=(K=a.onDisabledCheck)==null?void 0:K.call(a,R,a,s,e)),a.onHiddenCheck&&(a.hidden=(v=a.onHiddenCheck)==null?void 0:v.call(a,R,a,s,e)))}return S},[i,f,c,g,p,y,G,m,A,n,d,u,s])},st=()=>{const[,e]=l.useState({});return l.useCallback(()=>{e({})},[e])},b=e=>({...e}),rt=e=>l.useMemo(()=>({type:"hotkey",hotKeys:[{key:"ArrowUp"}],onClick:()=>{var s;const t=(s=e.getSelectedKeys())==null?void 0:s[0],o=e.getPrevNodeKey(t);o&&e.setSelectedKeys([o])}}),[e]),nt=e=>l.useMemo(()=>({type:"hotkey",hotKeys:[{key:"ArrowDown"}],onClick:()=>{const t=e.getActiveNodeKey(),o=e.getNextNodeKey(t);o&&e.setSelectedKeys([o])}}),[e]),dt=({api:e,treeProps:t})=>{const o=ot(e,t);return l.useMemo(()=>o?N.jsx(we,{buttons:o,apiRef:e.getButtonsApi(),style:{padding:"8px",...t.buttonsRowStyle},styles:t.buttonsRowStyles,context:e,responsiveBreakpoint:t.responsiveBreakpoint,iconsOnly:t.buttonsIconsOnly}):null,[o,e,t.buttonsRowStyle,t.buttonsRowStyles,t.responsiveBreakpoint,t.buttonsIconsOnly])},ut=({treeApi:e,allProps:t,antdTreeProps:o})=>{const s=ct(e),r=at(e),n=it(e),d=gt(e),u=lt(e);return N.jsx(Oe,{className:"draggable-tree",onDrop:d,allowDrop:u,...o,draggable:!t.readOnly&&t.draggable!==!1,ref:e.treeRef,treeData:e.getDataSet(),selectedKeys:e.getSelectedKeys(),expandedKeys:e.getExpandedKeys(),fieldNames:{key:"id",title:"title",children:"children",...t.fieldNames},onSelect:s,onExpand:r,onDoubleClick:n})},ct=e=>(t,o)=>{var r;const s=e.getProps();(!s.noDeselect||o.selected)&&(e.setSelectedKeys(t),(r=s.onSelect)==null||r.call(s,t,o))},at=e=>(t,o)=>{var r;const s=e.getProps();e.setExpandedKeys(t),(r=s.onExpand)==null||r.call(s,t,o)},it=e=>(t,o)=>{var n,d;const s=e.getProps();s.onDoubleClick&&((n=s.onDoubleClick)==null||n.call(s,t,o));const r=e.getFieldNames();if(!s.disabled&&!s.readOnly&&(s.editFormProps||s.editGroupFormProps)){e.getButtonsApi().triggerClick("update");return}(d=o[r.children])!=null&&d.length&&e.toggleNode(o[r.key])},lt=e=>t=>{const o=e.getProps(),s=e.getFieldNames();return o.groupsMode?o.draggableOrder?t.dropPosition<=0&&t.dropNode[s.isGroup]||t.dropPosition>0:t.dropPosition<=0&&t.dropNode[s.isGroup]:o.draggableOrder?!0:t.dropPosition===0},gt=e=>t=>{const o=e.getProps();let s="insideTop";if(t.dropToGap&&(s=t.dropPosition<0?"above":"below"),!t.dragNode)return;if(!o.confirmMove){k(t.dragNode,t.node,s,!0,e);return}const r=F.confirmWaiter({language:o.language,content:o.nodeMoveMessage??e.t("moveRecordQt"),onOk:()=>{k(t.dragNode,t.node,s,!0,e,r)},onCancel:()=>{r.destroy()}})},k=(e,t,o,s,r,n)=>{var i;const d=r.getProps(),u=(i=d==null?void 0:d.onNodeMove)==null?void 0:i.call(d,e,t,o,r);if(!ke(u)){r.moveNode(e,t,o,{ensureVisible:s,sortNodes:d.sortOnChange}),n&&n.destroy();return}u.then(()=>{n==null||n.destroy(),r.getIsMounted()&&r.moveNode(e,t,o,{ensureVisible:s,sortNodes:d.sortOnChange})}).catch(c=>{n==null||n.destroy(),r.getIsMounted()&&F.alert({language:d.language,title:r.t("error"),content:N.jsx(Fe,{error:c}),colorType:"danger"})})},ft=({api:e,allProps:t,antdTreeProps:o})=>{const s=E(e,t,!1),r=E(e,t,!0);return N.jsxs("div",{className:"extended-tree-container",children:[N.jsx(Me,{isLoading:e.getIsLoading(),notHideContent:!0,spinStyle:{height:"100%"},language:t.language,children:N.jsxs(xe,{style:{display:"flex",flexDirection:"column",...t.buttonsRowWrapperStyle},children:[N.jsx(Be,{style:{zIndex:15},children:N.jsx(dt,{api:e,treeProps:t})}),N.jsx(ut,{treeApi:e,allProps:t,antdTreeProps:o})]})}),!t.disabled&&s?N.jsx(D,{...s,apiRef:e.getEditFormApi()}):null,!t.disabled&&r?N.jsx(D,{...r,apiRef:e.getEditGroupFormApi()}):null]})},bt=e=>{const[t,o]=De(e),[,s]=yt(t),r=tt({props:t,setProps:o});return N.jsx(ft,{allProps:t,antdTreeProps:s,api:r})},yt=e=>l.useMemo(()=>{const[t,o]=me(e,{id:!0,buttons:!0,buttonsIconsOnly:!0,buttonsPosition:!0,buttonsSize:!0,confirmDelete:!0,editFormProps:!0,editGroupFormProps:!0,language:!0,readOnly:!0,deleteMessage:!0,translation:!0,apiRef:!0,headerLabel:!0,responsiveBreakpoint:!0,buttonsRowStyle:!0,buttonsRowStyles:!0,buttonsRowWrapperStyle:!0,dataSet:!0,dataMutator:!0,noDeselect:!0,groupsMode:!0,selectNewNode:!0,confirmMove:!0,nodeMoveMessage:!0,draggableOrder:!0,sortComparator:!0,sortOnChange:!0,onDataSetChanged:!0,nodeDeleteMessage:!0,onDelete:!0,onNodeMove:!0,fieldNames:!0,defaultCheckedKeys:!0,checkedKeys:!0,defaultExpandedKeys:!0,expandedKeys:!0,defaultSelectedKeys:!0,selectedKeys:!0});return[t,{...o,fieldNames:t.fieldNames}]},[e]);export{bt as T};
