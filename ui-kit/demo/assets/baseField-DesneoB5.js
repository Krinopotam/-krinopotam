var e=Object.defineProperty,t=(t,s,i)=>((t,s,i)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i)(t,"symbol"!=typeof s?s+"":s,i);import{bf as s,W as i,bg as n,bh as r,h as o,r as a,j as l}from"./index-7nZFAa1C.js";import{F as d,C as h,a as u}from"./isArray-Dr27fI6O.js";function p(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,s(e,t)}function c(e,t){return e.replace(new RegExp("(^|\\s)"+t+"(?:\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/^\s*|\s*$/g,"")}const m=!1,f=i.createContext(null);var g=function(e){return e.scrollTop},E="unmounted",v="exited",F="entering",x="entered",N="exiting",b=function(e){function t(t,s){var i;i=e.call(this,t,s)||this;var n,r=s&&!s.isMounting?t.enter:t.appear;return i.appearStatus=null,t.in?r?(n=v,i.appearStatus=F):n=x:n=t.unmountOnExit||t.mountOnEnter?E:v,i.state={status:n},i.nextCallback=null,i}p(t,e),t.getDerivedStateFromProps=function(e,t){return e.in&&t.status===E?{status:v}:null};var s=t.prototype;return s.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},s.componentDidUpdate=function(e){var t=null;if(e!==this.props){var s=this.state.status;this.props.in?s!==F&&s!==x&&(t=F):s!==F&&s!==x||(t=N)}this.updateStatus(!1,t)},s.componentWillUnmount=function(){this.cancelNextCallback()},s.getTimeouts=function(){var e,t,s,i=this.props.timeout;return e=t=s=i,null!=i&&"number"!=typeof i&&(e=i.exit,t=i.enter,s=void 0!==i.appear?i.appear:t),{exit:e,enter:t,appear:s}},s.updateStatus=function(e,t){if(void 0===e&&(e=!1),null!==t)if(this.cancelNextCallback(),t===F){if(this.props.unmountOnExit||this.props.mountOnEnter){var s=this.props.nodeRef?this.props.nodeRef.current:n.findDOMNode(this);s&&g(s)}this.performEnter(e)}else this.performExit();else this.props.unmountOnExit&&this.state.status===v&&this.setState({status:E})},s.performEnter=function(e){var t=this,s=this.props.enter,i=this.context?this.context.isMounting:e,r=this.props.nodeRef?[i]:[n.findDOMNode(this),i],o=r[0],a=r[1],l=this.getTimeouts(),d=i?l.appear:l.enter;!e&&!s||m?this.safeSetState({status:x},(function(){t.props.onEntered(o)})):(this.props.onEnter(o,a),this.safeSetState({status:F},(function(){t.props.onEntering(o,a),t.onTransitionEnd(d,(function(){t.safeSetState({status:x},(function(){t.props.onEntered(o,a)}))}))})))},s.performExit=function(){var e=this,t=this.props.exit,s=this.getTimeouts(),i=this.props.nodeRef?void 0:n.findDOMNode(this);t&&!m?(this.props.onExit(i),this.safeSetState({status:N},(function(){e.props.onExiting(i),e.onTransitionEnd(s.exit,(function(){e.safeSetState({status:v},(function(){e.props.onExited(i)}))}))}))):this.safeSetState({status:v},(function(){e.props.onExited(i)}))},s.cancelNextCallback=function(){null!==this.nextCallback&&(this.nextCallback.cancel(),this.nextCallback=null)},s.safeSetState=function(e,t){t=this.setNextCallback(t),this.setState(e,t)},s.setNextCallback=function(e){var t=this,s=!0;return this.nextCallback=function(i){s&&(s=!1,t.nextCallback=null,e(i))},this.nextCallback.cancel=function(){s=!1},this.nextCallback},s.onTransitionEnd=function(e,t){this.setNextCallback(t);var s=this.props.nodeRef?this.props.nodeRef.current:n.findDOMNode(this),i=null==e&&!this.props.addEndListener;if(s&&!i){if(this.props.addEndListener){var r=this.props.nodeRef?[this.nextCallback]:[s,this.nextCallback],o=r[0],a=r[1];this.props.addEndListener(o,a)}null!=e&&setTimeout(this.nextCallback,e)}else setTimeout(this.nextCallback,0)},s.render=function(){var e=this.state.status;if(e===E)return null;var t=this.props,s=t.children;t.in,t.mountOnEnter,t.unmountOnExit,t.appear,t.enter,t.exit,t.timeout,t.addEndListener,t.onEnter,t.onEntering,t.onEntered,t.onExit,t.onExiting,t.onExited,t.nodeRef;var n=r(t,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]);return i.createElement(f.Provider,{value:null},"function"==typeof s?s(e,n):i.cloneElement(i.Children.only(s),n))},t}(i.Component);function C(){}b.contextType=f,b.propTypes={},b.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:C,onEntering:C,onEntered:C,onExit:C,onExiting:C,onExited:C},b.UNMOUNTED=E,b.EXITED=v,b.ENTERING=F,b.ENTERED=x,b.EXITING=N;var y=function(e,t){return e&&t&&t.split(" ").forEach((function(t){return i=t,void((s=e).classList?s.classList.remove(i):"string"==typeof s.className?s.className=c(s.className,i):s.setAttribute("class",c(s.className&&s.className.baseVal||"",i)));var s,i}))},R=function(e){function t(){for(var t,s=arguments.length,i=new Array(s),n=0;n<s;n++)i[n]=arguments[n];return(t=e.call.apply(e,[this].concat(i))||this).appliedClasses={appear:{},enter:{},exit:{}},t.onEnter=function(e,s){var i=t.resolveArguments(e,s),n=i[0],r=i[1];t.removeClasses(n,"exit"),t.addClass(n,r?"appear":"enter","base"),t.props.onEnter&&t.props.onEnter(e,s)},t.onEntering=function(e,s){var i=t.resolveArguments(e,s),n=i[0],r=i[1]?"appear":"enter";t.addClass(n,r,"active"),t.props.onEntering&&t.props.onEntering(e,s)},t.onEntered=function(e,s){var i=t.resolveArguments(e,s),n=i[0],r=i[1]?"appear":"enter";t.removeClasses(n,r),t.addClass(n,r,"done"),t.props.onEntered&&t.props.onEntered(e,s)},t.onExit=function(e){var s=t.resolveArguments(e)[0];t.removeClasses(s,"appear"),t.removeClasses(s,"enter"),t.addClass(s,"exit","base"),t.props.onExit&&t.props.onExit(e)},t.onExiting=function(e){var s=t.resolveArguments(e)[0];t.addClass(s,"exit","active"),t.props.onExiting&&t.props.onExiting(e)},t.onExited=function(e){var s=t.resolveArguments(e)[0];t.removeClasses(s,"exit"),t.addClass(s,"exit","done"),t.props.onExited&&t.props.onExited(e)},t.resolveArguments=function(e,s){return t.props.nodeRef?[t.props.nodeRef.current,e]:[e,s]},t.getClassNames=function(e){var s=t.props.classNames,i="string"==typeof s,n=i?""+(i&&s?s+"-":"")+e:s[e];return{baseClassName:n,activeClassName:i?n+"-active":s[e+"Active"],doneClassName:i?n+"-done":s[e+"Done"]}},t}p(t,e);var s=t.prototype;return s.addClass=function(e,t,s){var i=this.getClassNames(t)[s+"ClassName"],n=this.getClassNames("enter").doneClassName;"appear"===t&&"done"===s&&n&&(i+=" "+n),"active"===s&&e&&g(e),i&&(this.appliedClasses[t][s]=i,function(e,t){e&&t&&t.split(" ").forEach((function(t){return i=t,void((s=e).classList?s.classList.add(i):function(e,t){return e.classList?!!t&&e.classList.contains(t):-1!==(" "+(e.className.baseVal||e.className)+" ").indexOf(" "+t+" ")}(s,i)||("string"==typeof s.className?s.className=s.className+" "+i:s.setAttribute("class",(s.className&&s.className.baseVal||"")+" "+i)));var s,i}))}(e,i))},s.removeClasses=function(e,t){var s=this.appliedClasses[t],i=s.base,n=s.active,r=s.done;this.appliedClasses[t]={},i&&y(e,i),n&&y(e,n),r&&y(e,r)},s.render=function(){var e=this.props;e.classNames;var t=r(e,["classNames"]);return i.createElement(b,o({},t,{onEnter:this.onEnter,onEntered:this.onEntered,onEntering:this.onEntering,onExit:this.onExit,onExiting:this.onExiting,onExited:this.onExited}))},t}(i.Component);R.defaultProps={classNames:""},R.propTypes={};const S=({field:e,altLabel:t,children:s,fieldContainerStyle:i})=>{const n=e.getProps(),r=e.getFormProps();a.useSyncExternalStore(e.subscribe.bind(e),e.getSnapshot.bind(e));const o=e.getError(),h=e.isHidden(),u={height:"100%",...n.rowStyle};let p;"horizontal"===r.layout&&(p=" ");const c=void 0!==t?t:n.label??p,m=a.useRef(null),f=n.autoHeightResize?" auto-height":"";return l.jsx(R,{nodeRef:m,in:!h,timeout:300,classNames:"zoom",unmountOnExit:!0,children:l.jsx("div",{ref:m,className:"dform-field-container"+f,style:i,children:l.jsx(d.Item,{label:c,className:n.itemClassName,help:o||void 0,validateStatus:o?"error":void 0,required:!!n.requiredMark,tooltip:n.tooltip,style:u,children:s})})})};class BaseField{constructor(e,s,i,n){t(this,"fieldProps"),t(this,"fieldName"),t(this,"model"),t(this,"parent"),t(this,"listeners",[]),t(this,"renderSnapshot",{}),t(this,"fieldsMap",{}),t(this,"rootFields",{}),this.fieldName=e,this.fieldProps=s,this.model=i,this.parent=n}initChildrenFields(){return[{},{}]}getProps(){return this.fieldProps}setProps(e,t){this.fieldProps=e,t||this.emitRender()}noGrowWidth(){return!1}managesChildWidth(){return!1}getWidth(){var e;if(!(null==(e=this.parent)?void 0:e.managesChildWidth()))return this.fieldProps.width}updateProps(e,t){const s=this.getProps()??{};this.setProps({...s,...e},t)}getName(){return this.fieldName}getFormProps(){return this.model.getFormProps()}getModel(){return this.model}getParent(){return this.parent}getLabel(){return this.model.getLabels()[this.fieldName]}setLabel(e,t,s){var i,n;const r=this.getLabel();r!==e&&(this.model.getLabels()[this.fieldName]=e,t||null==(n=null==(i=this.getProps())?void 0:i.onLabelChanged)||n.call(i,e,r,this),s||this.emitRender())}getValue(){return this.model.getValues()[this.fieldName]}setValue(e,t,s){var i,n,r,o;const a=this.getValue();if(a===e)return;const l=this.model.getValues();l[this.fieldName]=e,t||(null==(n=null==(i=this.getProps())?void 0:i.onValueChanged)||n.call(i,e,a,this),null==(o=(r=this.model.getFormProps()).onFormValuesChanged)||o.call(r,this.fieldName,l,this.model.getFormApi(),new h),this.validate(t,s)),s||this.emitRender(),this.model.lockDependedFields(this,t,s)}isEmptyValue(){const e=this.getValue();return null===e||(!(!u(e)||0!==e.length)||("object"==typeof e&&0===Object.keys(e).length||0!==e&&!e))}isTouched(){return this.model.getTouchedFields()[this.fieldName]??!1}setTouched(e,t){var s,i;this.isTouched()!==e&&(this.model.getTouchedFields()[this.fieldName]=e,t||null==(i=null==(s=this.getProps())?void 0:s.onTouchedStateChanged)||i.call(s,e,this))}isDirty(){return this.model.getDirtyFields()[this.fieldName]??!1}setDirty(e,t){var s,i;if(this.isDirty()===e)return;this.model.getDirtyFields()[this.fieldName]=e,t||null==(i=null==(s=this.getProps())?void 0:s.onDirtyStateChanged)||i.call(s,e,this);let n=e;if(!e)for(const r in this.model.getDirtyFields()){if(this.model.getDirtyFields()[r]){n=!0;break}}this.model.setFormDirty(n,t)}isDisabled(){return!!(this.model.isFormDisabled()||"disabled"===this.getProps().nonEditable&&"update"===this.model.getFormMode())||(this.model.getDisabledFields()[this.fieldName]??!1)}setDisabled(e,t,s){var i,n;this.isDisabled()!==e&&(this.model.getDisabledFields()[this.fieldName]=e,t||null==(n=null==(i=this.getProps())?void 0:i.onDisabledStateChanged)||n.call(i,e,this),s||this.model.emitFormRender())}isReadOnly(){return!(!this.model.isFormReadOnly()&&(!0!==this.getProps().nonEditable&&"readOnly"!==this.getProps().nonEditable||"update"!==this.model.getFormMode()))||(this.model.getReadOnlyFields()[this.fieldName]??!1)}setReadOnly(e,t,s){var i,n;this.model.getReadOnlyFields()[this.fieldName]!==e&&(this.model.getReadOnlyFields()[this.fieldName]=e,t||null==(n=null==(i=this.getProps())?void 0:i.onReadOnlyStateChanged)||n.call(i,e,this),s||this.emitRender())}isHidden(){return this.model.getHiddenFields()[this.fieldName]??!1}setHidden(e,t,s){var i,n;this.isHidden()!==e&&(this.model.getHiddenFields()[this.fieldName]=e,this.model.lockDependedFields(this,t,s),e&&(this.setError("",t,s),this.setReady(!1,!0)),t||null==(n=null==(i=this.getProps())?void 0:i.onHiddenStateChanged)||n.call(i,e,this),s||this.model.emitFormRender())}isReady(){if(this.model.isFormFetching()||this.model.isFormFetchingFailed())return!1;return!this.model.getFetchingFields()[this.fieldName]&&(this.model.getReadyFields()[this.fieldName]??!1)}setReady(e,t){var s,i;this.isReady()!==e&&(this.model.getReadyFields()[this.fieldName]=e,t||null==(i=null==(s=this.getProps())?void 0:s.onReadyStateChanged)||i.call(s,e,this),this.model.checkFormReadyState())}getError(){return this.model.getErrors()[this.fieldName]??""}setError(e,t,s){var i,n,r;if(this.getError()===e)return;const o=this.model.getErrors();if(e?o[this.fieldName]=e:delete o[this.fieldName],!t){const t=this.getProps();null==(i=null==t?void 0:t.onErrorChanged)||i.call(t,e,this);const s=this.model.getFormProps(),a=this.model.getValues(),l=this.model.getFormDataSet();this.model.isFormHasError()?null==(n=s.onFormHasErrors)||n.call(s,a,l,o,this.model.getFormApi(),new h):null==(r=s.onFormHasNoErrors)||r.call(s,a,l,this.model.getFormApi(),new h)}s||this.emitRender()}validate(e,t){var s,i,n;const r=this.getProps().rules??[],o=(null==(s=this.getFormProps().validationRules)?void 0:s[this.fieldName])??[],a=this.isHidden()?"":this.model.getValidator().validateValue(this.getValue(),this.model,r.concat(o));return this.setError(a,e),e||this.isHidden()||null==(n=null==(i=this.getProps())?void 0:i.onValidated)||n.call(i,this.getValue(),a,this.model.isFormSubmitting(),this),t||this.emitRender(),a}onInitialFetch(){this.fetchData()}isFetching(){return 1===this.model.getFetchingFields()[this.fieldName]}isFetchingFailed(){return-1===this.model.getFetchingFields()[this.fieldName]}fetchData(){var e,t;const s=null==(t=(e=this.fieldProps).onFieldDataFetch)?void 0:t.call(e,this);if(!s)return;const i=this.model.getFetchingFields();i[this.fieldName]=1,this.model.checkFormReadyState(),this.emitRender(),s.then((e=>{var t,s;if(!this.model.isFormMounted())return;i[this.fieldName]=0,null==(s=(t=this.fieldProps).onFieldDataFetchSuccess)||s.call(t,e,this);const n=e.data;this.model.setValues(n),this.model.checkFormReadyState(),this.emitRender()}),(e=>{var t,s;this.model.isFormMounted()&&(i[this.fieldName]=-1,null==(s=(t=this.fieldProps).onFieldDataFetchError)||s.call(t,e,this),this.model.checkFormReadyState(),this.emitRender())}))}getFieldsMap(){return this.fieldsMap}getRootFields(){return this.rootFields}isContainer(){return Object.keys(this.rootFields).length>0}hasVisibleChildren(){for(const e in this.rootFields){const t=this.rootFields[e];if(!t.isContainer()&&!t.isHidden()||t.hasVisibleChildren())return!0}return!1}render(){throw new Error("Render method must be implemented in a derived class of the BaseField class")}renderField({altLabel:e,fieldContainerStyle:t}={}){return this.renderFieldWrapper({field:this.render(),altLabel:e,fieldContainerStyle:t})}renderFieldWrapper({field:e,altLabel:t,fieldContainerStyle:s}){return l.jsx(S,{field:this,altLabel:t,fieldContainerStyle:s,children:e},this.getName())}canHaveValue(){return!0}subscribe(e){return this.listeners=[...this.listeners,e],()=>{this.listeners=this.listeners.filter((t=>t!==e))}}getSnapshot(){return this.renderSnapshot}emitRender(){this.renderSnapshot={};for(const e of this.listeners)e()}}export{BaseField as B,R as C};
