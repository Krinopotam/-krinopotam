var E=Object.defineProperty;var $=(t,s,e)=>s in t?E(t,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[s]=e;var v=(t,s,e)=>$(t,typeof s!="symbol"?s+"":s,e);import{j as b,r as H,b4 as z}from"./index-OT-fUFlw.js";import{F as A,T as I,B as q}from"./dForm-CXdkNth1.js";var K=t=>{let s=t;for(;s=s.parentElement;){const e=getComputedStyle(s,null).getPropertyValue("overflow-y");if(s===document.body)return window;if(e==="auto"||e==="scroll"||e==="overlay")return s}return window},D=t=>t.firstChild?t.firstChild.offsetParent===t:!0,W=(t,s)=>{let e=t,i=0;D(s)||(i+=t.offsetTop-s.offsetTop,s=t.offsetParent,i+=-t.offsetTop);do i+=e.offsetTop,e=e.offsetParent;while(e&&e!==s);return i},G=t=>{let s=t.parentElement;for(;s&&getComputedStyle(s,null).getPropertyValue("display")==="contents";)s=s.parentElement;return s||window},C=null;typeof CSS<"u"&&CSS.supports&&(CSS.supports("position","sticky")?C="sticky":CSS.supports("position","-webkit-sticky")&&(C="-webkit-sticky"));var L=!1;try{const t=Object.defineProperty({},"passive",{get(){L={passive:!0}}}),s=()=>{};window.addEventListener("testPassive",s,t),window.removeEventListener("testPassive",s,t)}catch{}var j=t=>{const{el:s,onChange:e,unsubs:i,measure:o}=t;if(s===window){const n=()=>({top:0,left:0,height:window.innerHeight,width:window.innerWidth}),r=o(n()),l=()=>{Object.assign(r,o(n())),e()};return window.addEventListener("resize",l,L),i.push(()=>window.removeEventListener("resize",l)),r}else{const n=o(s.getBoundingClientRect()),r=()=>{Object.assign(n,o(s.getBoundingClientRect())),e()},l=new ResizeObserver(r);return l.observe(s),i.push(()=>l.disconnect()),n}},J=t=>{const s=getComputedStyle(t,null),e=parseInt(s.getPropertyValue("padding-top"),10),i=parseInt(s.getPropertyValue("padding-bottom"),10);return{top:e,bottom:i}},Q=(t,s,e)=>{const{bottom:i,offsetBottom:o,offsetTop:n}=e,r=K(t);let l=!1;const f=()=>{l||requestAnimationFrame(()=>{const a=m();if(a!==T)w(a);else if(a===1&&!i){const{height:p}=R,{height:c}=S;t.style.top=`${p-c-o}px`}else if(a===2){const{height:p,offsetTop:c}=R,{height:g,naturalTop:u}=M,{height:x}=S,y=Math.max(0,c+d+p-(u+x+o));if(i){const P=Math.max(0,g-x-y);t.style.bottom=`${P}px`}else t.style.top=`${y}px`}l=!1}),l=!0};let d=r===window?window.scrollY:r.scrollTop;const h=a=>{const{offsetTop:p,height:c}=R,{naturalTop:g}=M,{height:u}=S;return a+p+c>=g+u+F+o},m=()=>{const{height:a}=R,{height:p}=S;return p+n+o<=a?3:h(d)?1:2},O=r!==window&&D(r),R=j({el:r,onChange:f,unsubs:s,measure:({height:a,top:p})=>({height:a,offsetTop:O?p:0})}),_=G(t),k=_===window?{top:0,bottom:0}:J(_),M=j({el:_,onChange:f,unsubs:s,measure:({height:a})=>({height:a-k.top-k.bottom,naturalTop:_===window?0:W(_,r)+k.top+R.offsetTop})}),S=j({el:t,onChange:f,unsubs:s,measure:({height:a})=>({height:a})});let F=0,T=m();const w=a=>{const p=T;if(T=a,p===2&&(F=-1),a===3){t.style.position=C,i?t.style.bottom=`${o}px`:t.style.top=`${n}px`;return}const{height:c,offsetTop:g}=R,{height:u,naturalTop:x}=M,{height:y}=S;if(a===2)if(t.style.position="relative",F=p===0?Math.max(0,g+d-x+n):Math.max(0,g+d+c-(x+y+o)),i){const P=Math.max(0,u-y-F);t.style.bottom=`${P}px`}else t.style.top=`${F}px`;else t.style.position=C,a===1?i?t.style.bottom=`${o}px`:t.style.top=`${c-y-o}px`:i?t.style.bottom=`${c-y-o}px`:t.style.top=`${n}px`};w(T);const B=a=>{if(a===d)return;const p=a-d;if(d=a,T===3)return;const{offsetTop:c,height:g}=R,{naturalTop:u,height:x}=M,{height:y}=S;if(p>0)if(T===0){if(a+c+n>u){const P=Math.max(0,c+d-u+n);a+c+g<=u+y+P+o?w(2):w(1)}}else T===2&&h(a)&&w(1);else if(T===1){if(c+a+g<u+x+o){const P=Math.max(0,c+d+g-(u+y+o));c+a+n>=u+P?w(2):w(0)}}else T===2&&c+a+n<u+F&&w(0)},V=r===window?()=>B(window.scrollY):()=>B(r.scrollTop);r.addEventListener("scroll",V,L),r.addEventListener("mousewheel",V,L),s.push(()=>r.removeEventListener("scroll",V),()=>r.removeEventListener("mousewheel",V))},U=({offsetTop:t=0,offsetBottom:s=0,bottom:e=!1}={})=>{const[i,o]=H.useState(null);return H.useEffect(()=>{if(!i||!C)return;const n=[];return Q(i,n,{offsetBottom:s,offsetTop:t,bottom:e}),()=>{n.forEach(r=>r())}},[i,s,t,e]),o},X=t=>{const{offsetTop:s,offsetBottom:e,bottom:i,children:o,className:n,style:r}=t,l=U({offsetTop:s,offsetBottom:e,bottom:i});return b.jsx("div",{className:n,style:r,ref:l,children:o})},Z=X;const{useToken:N}=z,Y=({field:t})=>{H.useEffect(()=>{t.setReady(!0)},[t]);const s=t.getProps(),e=t.getTabsRootFields();H.useSyncExternalStore(t.subscribe.bind(t),t.getSnapshot.bind(t));let i=t.getActiveTab();const o=ee(t);if(!t.hasVisibleChildren())return b.jsx(b.Fragment,{children:" "});const n={};s.panelsHeight&&(n.height=s.panelsHeight),s.panelsMinHeight&&(n.minHeight=s.panelsMinHeight),s.panelsMaxHeight&&(n.height=s.panelsMaxHeight);const r=[];for(const h in e){if(i||(i=h),!t.tabHasVisibleChildren(h))continue;const m=e[h],O={};s.autoHeightResize&&(O.height="100%"),r.push({key:h,tabKey:h,label:h,className:s.autoHeightResize?"auto-height":"",forceRender:!0,disabled:t.isDisabled(),style:{...O,...s.tabsStyle},children:b.jsx(A,{fields:m,formProps:t.getFormProps(),subscribe:t.tabSubscribe(h),getSnapshot:t.getTabSnapshot(h),containerStyle:n}),active:i===h})}const l=(h,m)=>te(h,m,t),f={};s.width&&(f.width=s.width),s.autoHeightResize&&(f.height="100%");const d={...f,...s.style};return b.jsx(I,{type:s.type??"card",tabBarStyle:s.tabBarStyle,size:s.size??"small",items:r,style:d,renderTabBar:l,onChange:o})},ee=t=>H.useCallback(s=>{t.setActiveTab(s)},[t]),te=(t,s,e)=>{const{token:i}=N(),o=e.getFormProps(),n={...t.style};n.backgroundColor=i.colorBgElevated,n.height=(o==null?void 0:o.tabsHeight)??35;const l={height:o.contentIndent??0,backgroundColor:n.backgroundColor};return e.getParent()?b.jsxs(b.Fragment,{children:[b.jsx("div",{style:l}),b.jsx(s,{...t,style:n})]}):b.jsxs(Z,{style:{zIndex:15},children:[b.jsx("div",{style:l}),b.jsx(s,{...t,style:n})]})};class oe extends q{constructor(){super(...arguments);v(this,"_tabsFieldsMap",{});v(this,"_tabsRootFields",{});v(this,"_activeTab","");v(this,"_disabledTabs",{});v(this,"_hiddenTabs",{});v(this,"_readOnlyTabs",{});v(this,"_tabRenderListeners",{});v(this,"_tabRenderSnapshots",{})}initChildrenFields(){const e=this.getProps();if(!e.tabs)return[{},{}];this._tabsRootFields={};for(const i in e.tabs){const o=e.tabs[i],[n,r]=this.getModel().prepareFieldCollection(o,this);this._tabsRootFields[i]=r,this._tabsFieldsMap[i]=n,this._tabRenderSnapshots[i]={},this._tabRenderListeners[i]=[],this.fieldsMap={...this.fieldsMap,...n},this.rootFields={...this.rootFields,...r}}return[this.fieldsMap,this.rootFields]}getValue(){}setValue(){}canHaveValue(){return!1}render(){return b.jsx(Y,{field:this})}renderField(){return this.parent?super.renderField():this.render()}getTabsFieldsMap(){return this._tabsFieldsMap}getTabsRootFields(){return this._tabsRootFields}isTabDisabled(e){return!!this._disabledTabs[e]}setTabDisabled(e,i,o,n){var f,d;if(this.isTabDisabled(e)===i)return;const l=this._tabsRootFields[e];if(l){this._disabledTabs[e]=i;for(const h in l)l[h].setDisabled(i,o,!0);o||(d=(f=this.getProps()).onTabDisabledStateChanged)==null||d.call(f,e,i,this),n||this.emitRender()}}isTabReadOnly(e){return!!this._readOnlyTabs[e]||this.model.getFormMode()==="view"}setTabReadOnly(e,i,o,n){var f,d;if(this.isTabReadOnly(e)===i)return;const l=this._tabsRootFields[e];if(l){this._readOnlyTabs[e]=i;for(const h in l)l[h].setReadOnly(i,o,n);o||(d=(f=this.getProps()).onTabReadOnlyStateChanged)==null||d.call(f,e,i,this),n||this.emitRender()}}isTabHidden(e){return!!this._hiddenTabs[e]}setTabHidden(e,i,o,n){var f,d;if(this.isTabHidden(e)===i)return;const l=this._tabsRootFields[e];if(l){this._hiddenTabs[e]=i;for(const h in l)l[h].setHidden(i,o,n);o||(d=(f=this.getProps()).onTabHiddenStateChanged)==null||d.call(f,e,i,this),n||this.emitRender()}}getActiveTab(){return this._activeTab}setActiveTab(e,i,o){var n,r;this._tabsFieldsMap[e]&&(this._activeTab=e,i||(r=(n=this.getProps()).onActiveTabChanged)==null||r.call(n,e,this),o||this.emitRender())}tabHasVisibleChildren(e){const i=this._tabsRootFields[e];for(const o in i){const n=this.rootFields[o];if(!n.isContainer()&&!n.isHidden()||n.hasVisibleChildren())return!0}return!1}setDisabled(e,i,o){if(this.isDisabled()!==e){for(const r in this._tabsFieldsMap)this.setTabDisabled(r,e,i,!0);super.setDisabled(e,i,o)}}setReadOnly(e,i,o){if(this.isReadOnly()!==e){for(const r in this._tabsFieldsMap)this.setTabReadOnly(r,e,i,!0);super.setReadOnly(e,i,o)}}tabSubscribe(e){return i=>(this._tabRenderListeners[e]=[...this._tabRenderListeners[e],i],()=>{this._tabRenderListeners[e]=this._tabRenderListeners[e].filter(o=>o!==i)})}getTabSnapshot(e){return()=>this._tabRenderSnapshots[e]}emitTabRender(e){this._tabRenderSnapshots[e]={};for(const i of this._tabRenderListeners[e])i()}}export{oe as T};
