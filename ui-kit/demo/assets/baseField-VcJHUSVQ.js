var e=Object.defineProperty,t=(t,i,s)=>((t,i,s)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s)(t,"symbol"!=typeof i?i+"":i,s);import{bc as i,W as s,bd as n,be as r,f as o,r as l,j as a}from"./index-CAK7O9l6.js";import{F as d,C as h,a as u}from"./isArray-Bxga0gLP.js";import{o as p}from"./buttonsRow-B4oNgxRU.js";function c(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,i(e,t)}function m(e,t){return e.replace(new RegExp("(^|\\s)"+t+"(?:\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/^\s*|\s*$/g,"")}const g=!1,f=s.createContext(null);var E=function(e){return e.scrollTop},v="unmounted",F="exited",x="entering",b="entered",C="exiting",y=function(e){function t(t,i){var s;s=e.call(this,t,i)||this;var n,r=i&&!i.isMounting?t.enter:t.appear;return s.appearStatus=null,t.in?r?(n=F,s.appearStatus=x):n=b:n=t.unmountOnExit||t.mountOnEnter?v:F,s.state={status:n},s.nextCallback=null,s}c(t,e),t.getDerivedStateFromProps=function(e,t){return e.in&&t.status===v?{status:F}:null};var i=t.prototype;return i.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},i.componentDidUpdate=function(e){var t=null;if(e!==this.props){var i=this.state.status;this.props.in?i!==x&&i!==b&&(t=x):i!==x&&i!==b||(t=C)}this.updateStatus(!1,t)},i.componentWillUnmount=function(){this.cancelNextCallback()},i.getTimeouts=function(){var e,t,i,s=this.props.timeout;return e=t=i=s,null!=s&&"number"!=typeof s&&(e=s.exit,t=s.enter,i=void 0!==s.appear?s.appear:t),{exit:e,enter:t,appear:i}},i.updateStatus=function(e,t){if(void 0===e&&(e=!1),null!==t)if(this.cancelNextCallback(),t===x){if(this.props.unmountOnExit||this.props.mountOnEnter){var i=this.props.nodeRef?this.props.nodeRef.current:n.findDOMNode(this);i&&E(i)}this.performEnter(e)}else this.performExit();else this.props.unmountOnExit&&this.state.status===F&&this.setState({status:v})},i.performEnter=function(e){var t=this,i=this.props.enter,s=this.context?this.context.isMounting:e,r=this.props.nodeRef?[s]:[n.findDOMNode(this),s],o=r[0],l=r[1],a=this.getTimeouts(),d=s?a.appear:a.enter;!e&&!i||g?this.safeSetState({status:b},(function(){t.props.onEntered(o)})):(this.props.onEnter(o,l),this.safeSetState({status:x},(function(){t.props.onEntering(o,l),t.onTransitionEnd(d,(function(){t.safeSetState({status:b},(function(){t.props.onEntered(o,l)}))}))})))},i.performExit=function(){var e=this,t=this.props.exit,i=this.getTimeouts(),s=this.props.nodeRef?void 0:n.findDOMNode(this);t&&!g?(this.props.onExit(s),this.safeSetState({status:C},(function(){e.props.onExiting(s),e.onTransitionEnd(i.exit,(function(){e.safeSetState({status:F},(function(){e.props.onExited(s)}))}))}))):this.safeSetState({status:F},(function(){e.props.onExited(s)}))},i.cancelNextCallback=function(){null!==this.nextCallback&&(this.nextCallback.cancel(),this.nextCallback=null)},i.safeSetState=function(e,t){t=this.setNextCallback(t),this.setState(e,t)},i.setNextCallback=function(e){var t=this,i=!0;return this.nextCallback=function(s){i&&(i=!1,t.nextCallback=null,e(s))},this.nextCallback.cancel=function(){i=!1},this.nextCallback},i.onTransitionEnd=function(e,t){this.setNextCallback(t);var i=this.props.nodeRef?this.props.nodeRef.current:n.findDOMNode(this),s=null==e&&!this.props.addEndListener;if(i&&!s){if(this.props.addEndListener){var r=this.props.nodeRef?[this.nextCallback]:[i,this.nextCallback],o=r[0],l=r[1];this.props.addEndListener(o,l)}null!=e&&setTimeout(this.nextCallback,e)}else setTimeout(this.nextCallback,0)},i.render=function(){var e=this.state.status;if(e===v)return null;var t=this.props,i=t.children;t.in,t.mountOnEnter,t.unmountOnExit,t.appear,t.enter,t.exit,t.timeout,t.addEndListener,t.onEnter,t.onEntering,t.onEntered,t.onExit,t.onExiting,t.onExited,t.nodeRef;var n=r(t,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]);return s.createElement(f.Provider,{value:null},"function"==typeof i?i(e,n):s.cloneElement(s.Children.only(i),n))},t}(s.Component);function R(){}y.contextType=f,y.propTypes={},y.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:R,onEntering:R,onEntered:R,onExit:R,onExiting:R,onExited:R},y.UNMOUNTED=v,y.EXITED=F,y.ENTERING=x,y.ENTERED=b,y.EXITING=C;var S=function(e,t){return e&&t&&t.split(" ").forEach((function(t){return s=t,void((i=e).classList?i.classList.remove(s):"string"==typeof i.className?i.className=m(i.className,s):i.setAttribute("class",m(i.className&&i.className.baseVal||"",s)));var i,s}))},I=function(e){function t(){for(var t,i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];return(t=e.call.apply(e,[this].concat(s))||this).appliedClasses={appear:{},enter:{},exit:{}},t.onEnter=function(e,i){var s=t.resolveArguments(e,i),n=s[0],r=s[1];t.removeClasses(n,"exit"),t.addClass(n,r?"appear":"enter","base"),t.props.onEnter&&t.props.onEnter(e,i)},t.onEntering=function(e,i){var s=t.resolveArguments(e,i),n=s[0],r=s[1]?"appear":"enter";t.addClass(n,r,"active"),t.props.onEntering&&t.props.onEntering(e,i)},t.onEntered=function(e,i){var s=t.resolveArguments(e,i),n=s[0],r=s[1]?"appear":"enter";t.removeClasses(n,r),t.addClass(n,r,"done"),t.props.onEntered&&t.props.onEntered(e,i)},t.onExit=function(e){var i=t.resolveArguments(e)[0];t.removeClasses(i,"appear"),t.removeClasses(i,"enter"),t.addClass(i,"exit","base"),t.props.onExit&&t.props.onExit(e)},t.onExiting=function(e){var i=t.resolveArguments(e)[0];t.addClass(i,"exit","active"),t.props.onExiting&&t.props.onExiting(e)},t.onExited=function(e){var i=t.resolveArguments(e)[0];t.removeClasses(i,"exit"),t.addClass(i,"exit","done"),t.props.onExited&&t.props.onExited(e)},t.resolveArguments=function(e,i){return t.props.nodeRef?[t.props.nodeRef.current,e]:[e,i]},t.getClassNames=function(e){var i=t.props.classNames,s="string"==typeof i,n=s?""+(s&&i?i+"-":"")+e:i[e];return{baseClassName:n,activeClassName:s?n+"-active":i[e+"Active"],doneClassName:s?n+"-done":i[e+"Done"]}},t}c(t,e);var i=t.prototype;return i.addClass=function(e,t,i){var s=this.getClassNames(t)[i+"ClassName"],n=this.getClassNames("enter").doneClassName;"appear"===t&&"done"===i&&n&&(s+=" "+n),"active"===i&&e&&E(e),s&&(this.appliedClasses[t][i]=s,function(e,t){e&&t&&t.split(" ").forEach((function(t){return s=t,void((i=e).classList?i.classList.add(s):function(e,t){return e.classList?!!t&&e.classList.contains(t):-1!==(" "+(e.className.baseVal||e.className)+" ").indexOf(" "+t+" ")}(i,s)||("string"==typeof i.className?i.className=i.className+" "+s:i.setAttribute("class",(i.className&&i.className.baseVal||"")+" "+s)));var i,s}))}(e,s))},i.removeClasses=function(e,t){var i=this.appliedClasses[t],s=i.base,n=i.active,r=i.done;this.appliedClasses[t]={},s&&S(e,s),n&&S(e,n),r&&S(e,r)},i.render=function(){var e=this.props;e.classNames;var t=r(e,["classNames"]);return s.createElement(y,o({},t,{onEnter:this.onEnter,onEntered:this.onEntered,onEntering:this.onEntering,onExit:this.onExit,onExiting:this.onExiting,onExited:this.onExited}))},t}(s.Component);I.defaultProps={classNames:""},I.propTypes={};const N=({field:e,altLabel:t,children:i,fieldContainerStyle:s})=>{const n=e.getProps(),r=e.getFormProps();l.useSyncExternalStore(e.subscribe.bind(e),e.getSnapshot.bind(e));const o=e.getError(),h=e.isHidden(),u={height:"100%",...n.rowStyle};let p;"horizontal"===r.layout&&(p=" ");const c=void 0!==t?t:n.label??p,m=l.useRef(null),g=n.autoHeightResize?" auto-height":"",f=e.getModel(),E=P(e),v={...s,...e.getId()===f.getHighlightedId()?e.getHighlightedStyle():void 0};return a.jsx(I,{nodeRef:m,in:!h,timeout:300,classNames:"zoom",unmountOnExit:!0,children:a.jsx("div",{ref:m,className:"dform-field-container"+g,style:v,onClick:E,children:a.jsx(d.Item,{label:c,className:n.itemClassName,help:o||void 0,validateStatus:o?"error":void 0,required:!!n.requiredMark,tooltip:n.tooltip,style:u,children:i})})})},P=e=>{const t=p((t=>{t.stopPropagation();const i=document.activeElement;e.setHighlighted(!0),setTimeout((()=>{null==i||i.focus()}),100)}));return"constructor"===e.getModel().getFormMode()?t:void 0};class BaseField{constructor(e,i,s,n){t(this,"fieldProps"),t(this,"fieldId"),t(this,"model"),t(this,"parent"),t(this,"listeners",[]),t(this,"renderSnapshot",{}),t(this,"fieldsMap",{}),t(this,"rootFields",{}),this.fieldId=e,this.fieldProps=i,this.model=s,this.parent=n}prepareChildrenFieldsCollection(){return[{},{}]}initFieldParameters(e,t){}getProps(){return this.fieldProps}setProps(e,t){this.fieldProps=e,t||this.emitRender()}noGrowWidth(){return!1}managesChildWidth(){return!1}getWidth(){var e;if(!(null==(e=this.parent)?void 0:e.managesChildWidth()))return this.fieldProps.width}updateProps(e,t){const i=this.getProps()??{};this.setProps({...i,...e},t)}getId(){return this.fieldId}getFormProps(){return this.model.getFormProps()}getModel(){return this.model}getParent(){return this.parent}getLabel(){return this.model.getLabels()[this.fieldId]}setLabel(e,t,i){var s,n;const r=this.getLabel();r!==e&&(this.model.getLabels()[this.fieldId]=e,t||null==(n=null==(s=this.getProps())?void 0:s.onLabelChanged)||n.call(s,e,r,this),i||this.emitRender())}getValue(){return this.model.getValues()[this.fieldId]}setValue(e,t,i){var s,n,r,o;const l=this.getValue();if(l===e)return;const a=this.model.getValues();a[this.fieldId]=e,t||(null==(n=null==(s=this.getProps())?void 0:s.onValueChanged)||n.call(s,e,l,this),null==(o=(r=this.model.getFormProps()).onFormValuesChanged)||o.call(r,this.fieldId,a,this.model.getFormApi(),new h),this.validate(t,i)),i||this.emitRender(),this.model.lockDependedFields(this,t,i)}isEmptyValue(){const e=this.getValue();return null===e||(!(!u(e)||0!==e.length)||("object"==typeof e&&0===Object.keys(e).length||0!==e&&!e))}isTouched(){return this.model.getTouchedFields()[this.fieldId]??!1}setTouched(e,t){var i,s;this.isTouched()!==e&&(this.model.getTouchedFields()[this.fieldId]=e,t||null==(s=null==(i=this.getProps())?void 0:i.onTouchedStateChanged)||s.call(i,e,this))}isDirty(){return this.model.getDirtyFields()[this.fieldId]??!1}setDirty(e,t){var i,s;if(this.isDirty()===e)return;this.model.getDirtyFields()[this.fieldId]=e,t||null==(s=null==(i=this.getProps())?void 0:i.onDirtyStateChanged)||s.call(i,e,this);let n=e;if(!e)for(const r in this.model.getDirtyFields()){if(this.model.getDirtyFields()[r]){n=!0;break}}this.model.setFormDirty(n,t)}isDisabled(){return!!(this.model.isFormDisabled()||"disabled"===this.getProps().nonEditable&&"update"===this.model.getFormMode())||(this.model.getDisabledFields()[this.fieldId]??!1)}setDisabled(e,t,i){var s,n;this.isDisabled()!==e&&(this.model.getDisabledFields()[this.fieldId]=e,t||null==(n=null==(s=this.getProps())?void 0:s.onDisabledStateChanged)||n.call(s,e,this),i||this.model.emitFormRender())}isReadOnly(){return!(!this.model.isFormReadOnly()&&(!0!==this.getProps().nonEditable&&"readOnly"!==this.getProps().nonEditable||"update"!==this.model.getFormMode()))||(this.model.getReadOnlyFields()[this.fieldId]??!1)}setReadOnly(e,t,i){var s,n;this.model.getReadOnlyFields()[this.fieldId]!==e&&(this.model.getReadOnlyFields()[this.fieldId]=e,t||null==(n=null==(s=this.getProps())?void 0:s.onReadOnlyStateChanged)||n.call(s,e,this),i||this.emitRender())}isHidden(){return this.model.getHiddenFields()[this.fieldId]??!1}setHidden(e,t,i){var s,n;this.isHidden()!==e&&(this.model.getHiddenFields()[this.fieldId]=e,this.model.lockDependedFields(this,t,i),e&&(this.setError("",t,i),this.setReady(!1,!0)),t||null==(n=null==(s=this.getProps())?void 0:s.onHiddenStateChanged)||n.call(s,e,this),i||this.model.emitFormRender())}isReady(){if(this.model.isFormFetching()||this.model.isFormFetchingFailed())return!1;return!this.model.getFetchingFields()[this.fieldId]&&(this.model.getReadyFields()[this.fieldId]??!1)}setReady(e,t){var i,s;this.isReady()!==e&&(this.model.getReadyFields()[this.fieldId]=e,t||null==(s=null==(i=this.getProps())?void 0:i.onReadyStateChanged)||s.call(i,e,this),this.model.checkFormReadyState())}getError(){return this.model.getErrors()[this.fieldId]??""}setError(e,t,i){var s,n,r;if(this.getError()===e)return;const o=this.model.getErrors();if(e?o[this.fieldId]=e:delete o[this.fieldId],!t){const t=this.getProps();null==(s=null==t?void 0:t.onErrorChanged)||s.call(t,e,this);const i=this.model.getFormProps(),l=this.model.getValues(),a=this.model.getFormDataSet();this.model.isFormHasError()?null==(n=i.onFormHasErrors)||n.call(i,l,a,o,this.model.getFormApi(),new h):null==(r=i.onFormHasNoErrors)||r.call(i,l,a,this.model.getFormApi(),new h)}i||this.emitRender()}validate(e,t){var i,s,n;const r=this.getProps().rules??[],o=(null==(i=this.getFormProps().validationRules)?void 0:i[this.fieldId])??[],l=this.isHidden()?"":this.model.getValidator().validateValue(this.getValue(),this.model,r.concat(o));return this.setError(l,e),e||this.isHidden()||null==(n=null==(s=this.getProps())?void 0:s.onValidated)||n.call(s,this.getValue(),l,this.model.isFormSubmitting(),this),t||this.emitRender(),l}onInitialFetch(){this.fetchData()}isFetching(){return 1===this.model.getFetchingFields()[this.fieldId]}isFetchingFailed(){return-1===this.model.getFetchingFields()[this.fieldId]}fetchData(){var e,t;const i=null==(t=(e=this.fieldProps).onFieldDataFetch)?void 0:t.call(e,this);if(!i)return;const s=this.model.getFetchingFields();s[this.fieldId]=1,this.model.checkFormReadyState(),this.emitRender(),i.then((e=>{var t,i;if(!this.model.isFormMounted())return;s[this.fieldId]=0,null==(i=(t=this.fieldProps).onFieldDataFetchSuccess)||i.call(t,e,this);const n=e.data;this.model.setValues(n),this.model.checkFormReadyState(),this.emitRender()}),(e=>{var t,i;this.model.isFormMounted()&&(s[this.fieldId]=-1,null==(i=(t=this.fieldProps).onFieldDataFetchError)||i.call(t,e,this),this.model.checkFormReadyState(),this.emitRender())}))}isHighlighted(){return this.model.getHighlightedId()===this.fieldId}setHighlighted(e,t,i){var s,n;const r=this.model.getHighlightedId(),o=e?this.getId():"";if(r===o)return;this.model.setHighlightedId(o);const l=r?this.model.getField(r):void 0;t||null==(n=null==(s=this.getFormProps())?void 0:s.onHighlightedFieldChanged)||n.call(s,e?this:void 0,l,void 0,this.model.getFormApi()),i||(this.emitRender(),l&&(null==l||l.emitRender()))}toggleHighlighted(e,t){this.setHighlighted(!this.isHighlighted(),e,t)}getFieldsMap(){return this.fieldsMap}getRootFields(){return this.rootFields}isContainer(){return Object.keys(this.rootFields).length>0}hasVisibleChildren(){for(const e in this.rootFields){const t=this.rootFields[e];if(!t.isContainer()&&!t.isHidden()||t.hasVisibleChildren())return!0}return!1}render(){throw new Error("Render method must be implemented in a derived class of the BaseField class")}renderField({altLabel:e,fieldContainerStyle:t}={}){return this.renderFieldWrapper({field:this.render(),altLabel:e,fieldContainerStyle:t})}renderFieldWrapper({field:e,altLabel:t,fieldContainerStyle:i}){return a.jsx(N,{field:this,altLabel:t,fieldContainerStyle:i,children:e},this.getId())}getHighlightedStyle(){return{border:"dashed 1px blue"}}canHaveValue(){return!0}subscribe(e){return this.listeners=[...this.listeners,e],()=>{this.listeners=this.listeners.filter((t=>t!==e))}}getSnapshot(){return this.renderSnapshot}emitRender(){this.renderSnapshot={};for(const e of this.listeners)e()}}export{BaseField as B,I as C,P as u};
