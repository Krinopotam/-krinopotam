import{r as l,A as G,_ as z,R as O,o as re,v as ve,a as ae,n as q,bO as ce,Q as ke,j as h,bP as Se}from"./index-3024f328.js";import{b as le,I as E,G as ue,m as X,c as ie,M as Fe,P as Pe,O as pe,d as de,f as Oe,q as Ke,L as Ee,t as je,e as Te}from"./index-901967cb.js";import{M as Ne,D as te}from"./dFormModal-09fd0649.js";import{E as ge}from"./EyeOutlined-ff2ae648.js";import{m as Me,E as Ie}from"./docco-8e796366.js";import{u as Le,T as Be,S as He,f as fe,F as Ge,a as ze,d as _e,e as Ve,C as $e,P as Ue,D as We}from"./DeleteOutlined-73630e69.js";var qe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 444H820V330.4c0-17.7-14.3-32-32-32H473L355.7 186.2a8.15 8.15 0 00-5.5-2.2H96c-17.7 0-32 14.3-32 32v592c0 17.7 14.3 32 32 32h698c13 0 24.8-7.9 29.7-20l134-332c1.5-3.8 2.3-7.9 2.3-12 0-17.7-14.3-32-32-32zM136 256h188.5l119.6 114.4H748V444H238c-13 0-24.8 7.9-29.7 20L136 643.2V256zm635.3 512H159l103.3-256h612.4L771.3 768z"}}]},name:"folder-open",theme:"outlined"};const Xe=qe;var Qe=function(t,n){return l.createElement(G,z({},t,{ref:n,icon:Xe}))};const Je=l.forwardRef(Qe);var Ye={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M300 276.5a56 56 0 1056-97 56 56 0 00-56 97zm0 284a56 56 0 1056-97 56 56 0 00-56 97zM640 228a56 56 0 10112 0 56 56 0 00-112 0zm0 284a56 56 0 10112 0 56 56 0 00-112 0zM300 844.5a56 56 0 1056-97 56 56 0 00-56 97zM640 796a56 56 0 10112 0 56 56 0 00-112 0z"}}]},name:"holder",theme:"outlined"};const Ze=Ye;var Ae=function(t,n){return l.createElement(G,z({},t,{ref:n,icon:Ze}))};const et=l.forwardRef(Ae),ne=4;function tt(e){const{dropPosition:t,dropLevelOffset:n,prefixCls:o,indent:s,direction:r="ltr"}=e,a=r==="ltr"?"left":"right",c=r==="ltr"?"right":"left",u={[a]:-n*s+ne,[c]:0};switch(t){case-1:u.top=-3;break;case 1:u.bottom=-3;break;default:u.bottom=-3,u[a]=s+ne;break}return O.createElement("div",{style:u,className:`${o}-drop-indicator`})}const nt=O.forwardRef((e,t)=>{const{getPrefixCls:n,direction:o,virtual:s,tree:r}=O.useContext(re),{prefixCls:a,className:c,showIcon:u=!1,showLine:i,switcherIcon:d,blockNode:f=!1,children:b,checkable:y=!1,selectable:R=!0,draggable:D,motion:p,style:M}=e,w=n("tree",a),j=n(),T=p??Object.assign(Object.assign({},ve(j)),{motionAppear:!1}),m=Object.assign(Object.assign({},e),{checkable:y,selectable:R,showIcon:u,motion:T,blockNode:f,showLine:!!i,dropIndicatorRender:tt}),[N,V,k]=Le(w),C=O.useMemo(()=>{if(!D)return!1;let x={};switch(typeof D){case"function":x.nodeDraggable=D;break;case"object":x=Object.assign({},D);break}return x.icon!==!1&&(x.icon=x.icon||O.createElement(et,null)),x},[D]),S=x=>O.createElement(He,{prefixCls:w,switcherIcon:d,treeNodeProps:x,showLine:i});return N(O.createElement(Be,Object.assign({itemHeight:20,ref:t,virtual:s},m,{style:Object.assign(Object.assign({},r==null?void 0:r.style),M),prefixCls:w,className:ae({[`${w}-icon-hide`]:!u,[`${w}-block-node`]:f,[`${w}-unselectable`]:!R,[`${w}-rtl`]:o==="rtl"},r==null?void 0:r.className,c,V,k),direction:o,checkable:y&&O.createElement("span",{className:`${w}-checkbox-inner`}),selectable:R,switcherIcon:S,draggable:C}),b))}),he=nt;var P;(function(e){e[e.None=0]="None",e[e.Start=1]="Start",e[e.End=2]="End"})(P||(P={}));function Q(e,t,n){const{key:o,children:s}=n;function r(a){const c=a[o],u=a[s];t(c,a)!==!1&&Q(u||[],t,n)}e.forEach(r)}function ot(e){let{treeData:t,expandedKeys:n,startKey:o,endKey:s,fieldNames:r}=e;const a=[];let c=P.None;if(o&&o===s)return[o];if(!o||!s)return[];function u(i){return i===o||i===s}return Q(t,i=>{if(c===P.End)return!1;if(u(i)){if(a.push(i),c===P.None)c=P.Start;else if(c===P.Start)return c=P.End,!1}else c===P.Start&&a.push(i);return n.includes(i)},fe(r)),a}function $(e,t,n){const o=q(t),s=[];return Q(e,(r,a)=>{const c=o.indexOf(r);return c!==-1&&(s.push(a),o.splice(c,1)),!!o.length},fe(n)),s}var oe=globalThis&&globalThis.__rest||function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(n[o[s]]=e[o[s]]);return n};function st(e){const{isLeaf:t,expanded:n}=e;return t?l.createElement(Ge,null):n?l.createElement(Je,null):l.createElement(ce,null)}function se(e){let{treeData:t,children:n}=e;return t||Ve(n)}const rt=(e,t)=>{var{defaultExpandAll:n,defaultExpandParent:o,defaultExpandedKeys:s}=e,r=oe(e,["defaultExpandAll","defaultExpandParent","defaultExpandedKeys"]);const a=l.useRef(),c=l.useRef(),u=()=>{const{keyEntities:k}=ze(se(r));let C;return n?C=Object.keys(k):o?C=_e(r.expandedKeys||s||[],k):C=r.expandedKeys||s,C},[i,d]=l.useState(r.selectedKeys||r.defaultSelectedKeys||[]),[f,b]=l.useState(()=>u());l.useEffect(()=>{"selectedKeys"in r&&d(r.selectedKeys)},[r.selectedKeys]),l.useEffect(()=>{"expandedKeys"in r&&b(r.expandedKeys)},[r.expandedKeys]);const y=(k,C)=>{var S;return"expandedKeys"in r||b(k),(S=r.onExpand)===null||S===void 0?void 0:S.call(r,k,C)},R=(k,C)=>{var S;const{multiple:x,fieldNames:I}=r,{node:Ce,nativeEvent:F}=C,{key:L=""}=Ce,B=se(r),H=Object.assign(Object.assign({},C),{selected:!0}),xe=(F==null?void 0:F.ctrlKey)||(F==null?void 0:F.metaKey),Re=F==null?void 0:F.shiftKey;let v;x&&xe?(v=k,a.current=L,c.current=v,H.selectedNodes=$(B,v,I)):x&&Re?(v=Array.from(new Set([].concat(q(c.current||[]),q(ot({treeData:B,expandedKeys:f,startKey:L,endKey:a.current,fieldNames:I}))))),H.selectedNodes=$(B,v,I)):(v=[L],a.current=L,c.current=v,H.selectedNodes=$(B,v,I)),(S=r.onSelect)===null||S===void 0||S.call(r,v,H),"selectedKeys"in r||d(v)},{getPrefixCls:D,direction:p}=l.useContext(re),{prefixCls:M,className:w,showIcon:j=!0,expandAction:T="click"}=r,m=oe(r,["prefixCls","className","showIcon","expandAction"]),N=D("tree",M),V=ae(`${N}-directory`,{[`${N}-directory-rtl`]:p==="rtl"},w);return l.createElement(he,Object.assign({icon:st,ref:t,blockNode:!0},m,{showIcon:j,expandAction:T,prefixCls:N,className:V,expandedKeys:f,selectedKeys:i,onSelect:R,onExpand:y}))},at=l.forwardRef(rt),ct=at,J=he;J.DirectoryTree=ct;J.TreeNode=$e;const lt=J;var ut={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880.1 154H143.9c-24.5 0-39.8 26.7-27.5 48L349 597.4V838c0 17.7 14.2 32 31.8 32h262.4c17.6 0 31.8-14.3 31.8-32V597.4L907.7 202c12.2-21.3-3.1-48-27.6-48zM603.4 798H420.6V642h182.9v156zm9.6-236.6l-9.5 16.6h-183l-9.5-16.6L212.7 226h598.6L613 561.4z"}}]},name:"filter",theme:"outlined"};const it=ut;var dt=function(t,n){return l.createElement(G,z({},t,{ref:n,icon:it}))};const ft=l.forwardRef(dt);var ht={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"}}]},name:"menu",theme:"outlined"};const bt=ht;var mt=function(t,n){return l.createElement(G,z({},t,{ref:n,icon:bt}))};const yt=l.forwardRef(mt);var be={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=l,n=function(){var r=(0,t.useRef)(!1);return(0,t.useEffect)(function(){return r.current=!1,function(){r.current=!0}},[]),r},o=n;e.default=o})(be);const wt=ke(be),me=(e,t,n)=>{if(!t)return;const o=e.gridProps;return e.setCurrentDataFetchHandler(t,n),(s,r,a)=>new Promise((c,u)=>{const i={...a,...n},d=t(i,e);if(typeof d>"u"&&c(U(o,{data:[]})),!le(d)){E(d)?c(U(o,{data:d})):u(new Error);return}d.then(f=>{e.getIsMounted()&&c(U(o,f))},f=>{u(f)})})},U=(e,t)=>e.pagination||e.progressiveLoad?{data:t.data,last_page:t.last_page??1}:t.data,Dt=({gridApi:e,props:t,tableRef:n,editFormApi:o,selectionFormApi:s,buttonsApi:r,setColumnsDialog:a})=>{const c=l.useRef(void 0),u=l.useRef(),i=l.useRef(),[d,f]=l.useState(!1),b=wt();return Ct(c,t.dataSet),e.gridProps=t,e.tableApi=n.current,e.editFormApi=o,e.selectionFormApi=s,e.buttonsApi=r,e.getIsMounted=Rt(b),e.getId=xt(e),e.getDataSet=vt(c,e),e.setDataSet=kt(c,e),e.getIsLoading=St(d),e.setIsLoading=Ft(f),e.setActiveRowKey=Pt(e),e.getActiveRowKey=pt(e),e.getActiveNode=Ot(e),e.getActiveRow=Kt(e),e.getNextRowKey=Et(e),e.getPrevRowKey=jt(e),e.getSelectedRowKeys=Tt(e),e.getSelectedNodes=Mt(e),e.getSelectedRows=It(e),e.setSelectedRowKeys=Nt(e),e.setSelectedRows=gt(e),e.getNodeByKey=Lt(e),e.getRowByKey=Bt(e),e.insertRows=Ht(c,e),e.updateRows=Gt(c,e),e.removeRowsByKeys=Vt(c,e),e.removeRows=$t(e),e.deleteRows=Ut(e),e.fetchData=Wt(e),e.retryFetchData=Qt(e),e.setCurrentDataFetchHandler=qt(u,i),e.getCurrentDataFetchHandler=Xt(u,i),e.getRowData=Jt(e),e.openColumnDialog=Yt(e,a),e},Ct=(e,t)=>{const n=l.useRef(void 0);n.current!==t&&(n.current=t,e.current=t)},xt=e=>{const[t]=l.useState(e.gridProps.id??"grid-"+ue());return l.useCallback(()=>t,[t])},Rt=e=>l.useCallback(()=>!e.current,[e]),vt=(e,t)=>l.useCallback(()=>t.tableApi?t.tableApi.getData():e.current??void 0,[e,t.tableApi]),kt=(e,t)=>l.useCallback(n=>{var o,s,r,a,c,u;t.tableApi&&(e.current=n??void 0,(o=t.tableApi)==null||o.deselectRow(),(s=t.tableApi)==null||s.clearData(),(r=e.current)!=null&&r.length&&((a=t.tableApi)==null||a.setData(e.current)),(u=(c=t.gridProps).onDataChanged)==null||u.call(c,e.current,t))},[e,t]),St=e=>l.useCallback(()=>e,[e]),Ft=e=>l.useCallback(t=>{setTimeout(()=>{e(t)},0)},[e]),Pt=e=>l.useCallback((t,n,o)=>{e.tableApi&&e.tableApi.setActiveRowByKey(t,n,o)},[e]),pt=e=>l.useCallback(()=>{var t,n;return(n=(t=e.tableApi)==null?void 0:t.getActiveRowKey)==null?void 0:n.call(t)},[e]),Ot=e=>l.useCallback(()=>{var t,n;return(n=(t=e.tableApi)==null?void 0:t.getActiveRow)==null?void 0:n.call(t)},[e]),Kt=e=>l.useCallback(()=>{var t;return(t=e.getActiveNode())==null?void 0:t.getData()},[e]),Et=e=>l.useCallback((t,n)=>{var s;if(!e.tableApi||!t)return;n||(n=1);let o=(s=e.tableApi)==null?void 0:s.getRow(t);if(o){for(let r=0;r<n;r++){const a=o==null?void 0:o.getNextRow();if(!a)return o.getData().id;o=a}return o.getData().id}},[e.tableApi]),jt=e=>l.useCallback((t,n)=>{var s;if(!e.tableApi||!t)return;n||(n=1);let o=(s=e.tableApi)==null?void 0:s.getRow(t);if(o){for(let r=0;r<n;r++){const a=o==null?void 0:o.getPrevRow();if(!a)return o.getData().id;o=a}return o.getData().id}},[e.tableApi]),Tt=e=>{const t=l.useRef([]);return l.useCallback(()=>{if(!e.tableApi)return t.current;const n=e.tableApi.getSelectedData(),o=[];for(const s of n)o.push(s.id);return o},[e])},Nt=e=>l.useCallback((t,n)=>{var s,r;if(!e.tableApi)return;(!t||n)&&((s=e.tableApi)==null||s.deselectRow());const o=E(t)?t:[t];(r=e.tableApi)==null||r.selectRow(o)},[e]),gt=e=>l.useCallback((t,n)=>{if(!e.tableApi)return;if(!t)return e.setSelectedRowKeys(void 0,n);const o=[];for(const s of t)o.push(s.id);e.setSelectedRowKeys(o,n)},[e]),Mt=e=>l.useCallback(()=>{var t,n;return((n=(t=e.tableApi)==null?void 0:t.getSelectedRows)==null?void 0:n.call(t))??[]},[e]),It=e=>l.useCallback(()=>{var t,n;return((n=(t=e.tableApi)==null?void 0:t.getSelectedData)==null?void 0:n.call(t))??[]},[e]),Lt=e=>l.useCallback(t=>{var n;if(!(!t||!e.tableApi))return(n=e.tableApi)==null?void 0:n.getRow(t)},[e]),Bt=e=>l.useCallback(t=>{var n;return(n=e.getNodeByKey(t))==null?void 0:n.getData()},[e]),Ht=(e,t)=>l.useCallback((n,o,s,r)=>{var d,f;const a=t.tableApi;if(!a)return;const c=t.gridProps.dataTree,u=o==="above",i=E(n)?[...n]:[n];for(const b of i)c?zt(t,[b],o,s):a.addData([b],u,s).then();e.current=a.getData()||[],(f=(d=t.gridProps).onDataChanged)==null||f.call(d,e.current,t),r&&i[0]&&t.setActiveRowKey(i[0].id,!0,"center"),a.setTableBodyFocus()},[e,t]),Gt=(e,t)=>l.useCallback((n,o)=>{var a,c,u;if(!t.tableApi)return;const s=t.gridProps.dataTree,r=E(n)?[...n]:[n];for(const i of r)s?_t(t,i):t.tableApi.updateData([i]).then();e.current=((a=t.tableApi)==null?void 0:a.getData())||[],(u=(c=t.gridProps).onDataChanged)==null||u.call(c,e.current,t),o&&r[0]&&t.setActiveRowKey(r[0].id,!0,"center"),t.tableApi.setTableBodyFocus()},[e,t]),ye=(e,t)=>{if(!e.tableApi)return;const n=e.tableApi.options.dataTreeParentField,o=e.tableApi.options.index;if(!o||!n||!t[n])return;let s;if(typeof t[n]=="string"||typeof t[n]=="number"?s=t[n]:typeof t[n]=="object"&&(s=t[n][o]),!!s)return e.tableApi.getRow(s)||void 0},zt=(e,t,n,o)=>{var a;if(!e.tableApi)return;if(!e.gridProps.dataTree){console.warn("TreeData mode is disabled. Tree row updating not available");return}const s=n==="above",r=E(t)?[...t]:[t];for(const c of r){const u=ye(e,c);u?(u.addTreeChild(c),Y(u),u.reformat()):(a=e.tableApi)==null||a.addData([c],s,o)}},_t=(e,t)=>{if(!e.tableApi)return;if(!e.gridProps.dataTree){console.warn("TreeData mode is disabled. Tree row updating not available");return}const n=e.tableApi.options.index,o=e.tableApi.options.dataTreeChildField;if(!n||!o)return;const s=E(t)?[...t]:[t];for(const r of s){const a=r[n],c=e.tableApi.getRow(a);if(!c){e.tableApi.addData([r]).then();continue}const u=c.getTreeParent(),i=ye(e,r);if(!u&&!i||u&&i&&u.getData()[n]===i.getData()[n]){e.tableApi.updateData([r]).then();continue}if(r[o]=c.getData()[o],e.tableApi.deselectRow(c),e.tableApi.deleteRow(a),u&&u.reformat(),!i){e.tableApi.addData([r]).then();continue}i.addTreeChild(r),Y(i),i.reformat()}},Y=e=>{if(!e)return;const t=e.getTreeParent();Y(t),e.isTreeExpanded()||e.treeExpand()},Vt=(e,t)=>l.useCallback(n=>{var u,i;const o=t.tableApi;if(!o)return;const s=o.options.index,r=E(n)?[...n]:[n];let a=!1,c=!1;for(const d of r){const f=o.getRow(d);if(!f)continue;a&&f===a&&(a=!1),c=f.getNextRow()||f.getPrevRow(),c&&(a=c);const b=o.options.dataTree?f.getTreeParent():!1;o.deselectRow(f),o.deleteRow(d),b&&b.reformat()}a&&s&&(a=o.getRow(a.getData()[s])),o.setActiveRow(a||null,!0,"bottom"),e.current=(o==null?void 0:o.getData())??[],(i=(u=t.gridProps).onDataChanged)==null||i.call(u,e.current,t),o.setTableBodyFocus()},[e,t]),$t=e=>l.useCallback(t=>{const n=E(t)?[...t]:[t],o=[];for(const s of n)o.push(s.id);e.removeRowsByKeys(o)},[e]),Ut=e=>l.useCallback(t=>{if(!t)return;const n=Array.isArray(t)?t:[t],o=e.gridProps;let s;const r=()=>{var c;const a=(c=o==null?void 0:o.onDelete)==null?void 0:c.call(o,n,e);if(le(a)){o.confirmDelete||e.setIsLoading(!0),a.then(()=>{e.getIsMounted()&&(e.removeRows(n),o.confirmDelete?s==null||s.destroy():e.setIsLoading(!1))}).catch(i=>{e.getIsMounted()&&(o.confirmDelete?s==null||s.destroy():e.setIsLoading(!1),X.alert({content:h.jsxs(h.Fragment,{children:[h.jsx("p",{children:h.jsx("b",{children:i.message})}),i.stack&&ie()?h.jsx("p",{children:i.stack}):""]}),colorType:"danger"}))});return}e.removeRows(n),s&&s.destroy()};o.confirmDelete?s=X.confirmWaiter({content:o.rowDeleteMessage??"Удалить выбранные строки?",onOk:r}):r()},[e]),Wt=e=>l.useCallback((t,n)=>{const o=e.tableApi;o&&(o.modules.page.dataChanging=!0,o.modules.ajax.setUrl("-"),t&&(o.modules.ajax.loaderPromise=me(e,t,n)),o.setData(void 0,n).then())},[e]),qt=(e,t)=>l.useCallback((n,o)=>{e.current=n,t.current=o},[e,t]),Xt=(e,t)=>l.useCallback(()=>[e.current,t.current],[e,t]),Qt=e=>l.useCallback(()=>{const[t,n]=e.getCurrentDataFetchHandler();t&&e.fetchData(t,n)},[e]),Jt=e=>l.useCallback((t,n,o,s,r)=>{const a=e.tableApi;if(!a||!t)return{};const c=s?{}:{...t.getData()};if(!a.options.dataTree)return c;const u=a.options.dataTreeParentField,i=a.options.dataTreeChildField;if(!r&&i&&delete c[i],!u||typeof c[u]<"u")return c;const d=o?t:t.getTreeParent();if(!d)return c;const f=d.getData();return!r&&i&&delete f[i],c[u]=d.getData(),c},[e]),Yt=(e,t)=>l.useCallback(n=>{t(n)},[t]),Zt=e=>l.useMemo(()=>{var s;const t=(s=e.gridProps)==null?void 0:s.editFormProps;if(!t)return;const n={...t},o=t==null?void 0:t.onSubmitSuccess;return n.onSubmitSuccess=(r,a,c)=>{if(o&&o(r,a,c)===!1)return!1;const u={...c.model.getFormDataSet(),...a},i=c.model.getFormMode();if(i==="create"||i==="clone"){u.id||(u.id=ue());const d=e.getActiveRowKey();e.insertRows(u,"below",d??void 0,!0)}else i==="update"&&e.updateRows(u,!0)},n},[e]),At=e=>{const[,t]=l.useState({}),n=e.gridProps.buttons,o=e.gridProps.buttonsSize??"small",s=e.gridProps.buttonsPosition??"right",r=e.gridProps.buttonsIconsOnly,a=e.getActiveRow(),c=e.getSelectedRows();e.buttonsApi.refreshButtons=en(t);const u=tn(e),i=nn(e,a,c),d=on(e),f=sn(e,a,c),b=rn(e,a,c),y=cn(e,c),R=an(e),D=ln(e,e.tableApi),p=un(e);return l.useMemo(()=>{var j;const w=Fe({headerLabel:u,view:i,create:d,clone:f,update:b,select:R,delete:y,filterToggle:D,system:p},n);for(const T in w){const m=w[T];!m||T==="headerLabel"||(m.size=m.size??o,m.position=m.position??s,r&&(m.tooltip=m.tooltip??((j=m.title)==null?void 0:j.toString()),m.title=void 0),m.checkDisabled&&(m.disabled=!a||c.length!==1),m.checkHidden&&(m.hidden=!a||c.length!==1))}return w},[u,i,d,f,b,R,y,D,p,n,o,s,r,a,c.length])},en=e=>l.useCallback(()=>{e({})},[e]),tn=e=>l.useMemo(()=>{const t=e.gridProps;if(t.headerLabel)return{weight:1,title:t.headerLabel,type:"element",position:"left"}},[e]),nn=(e,t,n)=>l.useMemo(()=>{var r;const o=e.gridProps,s=e.editFormApi;if(!(!o.editFormProps||!o.readOnly||((r=o.buttons)==null?void 0:r.view)===null))return{weight:100,title:"Просмотреть",tooltip:"Просмотреть запись",icon:h.jsx(ge,{}),position:"right",disabled:!t||n.length!==1,hotKeys:[{key:"Enter"}],onClick:()=>{if(!e.getActiveRow())return;const a=_(e,!1);s.open("view",a)}}},[t,e,n.length]),on=e=>l.useMemo(()=>{var o;const t=e.gridProps,n=e.editFormApi;if(!(!t.editFormProps||t.readOnly||((o=t.buttons)==null?void 0:o.create)===null))return{weight:110,title:"Создать",tooltip:"Создать новую запись",icon:h.jsx(Pe,{}),position:"right",hotKeys:[{key:"Insert"}],onClick:()=>{const s=_(e,!0,!0);n.open("create",s)}}},[e]),sn=(e,t,n)=>l.useMemo(()=>{var r;const o=e.gridProps,s=e.editFormApi;if(!(!o.editFormProps||o.readOnly||((r=o.buttons)==null?void 0:r.clone)===null))return{weight:120,title:"Клонировать",tooltip:"Клонировать запись",icon:h.jsx(Me,{}),position:"right",disabled:!t||n.length!==1,hotKeys:[{key:"F9"}],onClick:()=>{if(!e.getActiveRow())return;const a=_(e,!1);s.open("clone",a)}}},[t,e,n.length]),rn=(e,t,n)=>l.useMemo(()=>{var r;const o=e.gridProps,s=e.editFormApi;if(!(!o.editFormProps||o.readOnly||((r=o.buttons)==null?void 0:r.update)===null))return{weight:130,title:"Редактировать",tooltip:"Редактировать запись",icon:h.jsx(Ie,{}),position:"right",disabled:!t||n.length!==1,hotKeys:[{key:"Enter"},{key:"F2"}],onClick:()=>{if(!e.getActiveRow())return;const a=_(e,!1);s.open("update",a)}}},[t,e,n.length]),an=e=>l.useMemo(()=>{var o;const t=e.gridProps,n=e.selectionFormApi;if(!(!t.selectionFormProps||t.readOnly||((o=t.buttons)==null?void 0:o.select)===null))return{weight:130,title:"Выбрать",tooltip:"Выбрать записи",icon:h.jsx(Ue,{}),position:"right",hotKeys:[{key:"Insert"}],onClick:()=>{const s=e.getDataSet();n.open("update",{select:s})}}},[e]),cn=(e,t)=>l.useMemo(()=>{var o;const n=e.gridProps;if(!(!n.editFormProps&&!n.selectionFormProps||n.readOnly||((o=n.buttons)==null?void 0:o.delete)===null))return{weight:140,title:"Удалить",tooltip:"Удалить запись",icon:h.jsx(We,{}),position:"right",colorType:"danger",disabled:!t||t.length===0,hotKeys:[{key:"Delete",ctrl:!0}],onClick:()=>{const s=e.getSelectedRows();e.deleteRows(s)}}},[e,t]),ln=(e,t)=>l.useMemo(()=>{var o,s;if(((o=e.gridProps.buttons)==null?void 0:o.filterToggle)!==null&&t!=null&&t.isHeaderFilterAvailable())return{weight:1e3,icon:h.jsx(ft,{}),position:"right",active:(s=e.tableApi)==null?void 0:s.isHeaderFilterVisible(),tooltip:"Фильтр",onClick:()=>{const r=t==null?void 0:t.toggleHeaderFilter();e.buttonsApi.updateButtons({filterToggle:{active:r}})}}},[e.buttonsApi,e.gridProps,e.tableApi,t]),_=(e,t,n)=>{const o=e.getActiveNode();return e.getRowData(o,!0,t,n)},un=e=>l.useMemo(()=>{var n;if(((n=e.gridProps.buttons)==null?void 0:n.filterToggle)!==null)return{weight:2e3,expandIcon:h.jsx(yt,{}),position:"right",children:{toXlsx:{title:"Экспорт в Excel",onClick:()=>{Se(()=>import("./xlsx-5c181179.js"),[]).then(s=>{var r;window.XLSX=s,(r=e.tableApi)==null||r.download("xlsx","table.xlsx")})}},columns:{title:"Настройки столбцов",onClick:()=>{e.openColumnDialog(!0)}}}}},[e]),dn=({gridApi:e})=>{const t=e.gridProps,n=At(e),[o,s]=l.useState(void 0);return l.useLayoutEffect(()=>{var a;const r=pe(n)>0;(typeof o>"u"||o!==r)&&(s(r),(a=t==null?void 0:t.onMenuVisibilityChanged)==null||a.call(t,r,e))},[n,e,t,t==null?void 0:t.onMenuVisibilityChanged,o]),n?h.jsx("div",{style:{width:"100%",paddingBottom:8,paddingTop:8},children:h.jsx(de,{buttons:n,apiRef:e.buttonsApi,context:e})}):null},fn=(e,t)=>l.useMemo(()=>({tableBuilt:()=>{var n;(n=t==null?void 0:t.tableBuilt)==null||n.call(t),e.buttonsApi.refreshButtons()},dataLoading:n=>{var o,s,r;(o=t==null?void 0:t.dataLoading)==null||o.call(t,n),(r=(s=e.gridProps).onDataLoading)==null||r.call(s,n,e),e.gridProps.progressiveLoad||e.setIsLoading(!0)},dataLoaded:n=>{var o,s,r;(o=t==null?void 0:t.dataLoaded)==null||o.call(t,n),(r=(s=e.gridProps).onDataLoaded)==null||r.call(s,n,e),e.getIsMounted()&&(e.gridProps.progressiveLoad||e.setIsLoading(!1))},dataProcessed:n=>{var o,s,r;(o=t==null?void 0:t.dataProcessed)==null||o.call(t,n),(r=(s=e.gridProps).onDataProcessed)==null||r.call(s,n,e)},dataLoadError:n=>{var r,a,c;(r=t==null?void 0:t.dataLoadError)==null||r.call(t,n);const o=n;if((c=(a=e.gridProps).onDataLoadError)==null||c.call(a,o.message,o.code,e),!e.getIsMounted())return;e.setIsLoading(!1);const s=X.confirm({content:h.jsxs("div",{children:[h.jsx("p",{children:h.jsx("b",{children:n.message})}),n.stack&&ie()?h.jsx("p",{children:n.stack}):"",h.jsx("p",{children:"Попробовать снова?"})]}),colorType:"danger",buttons:{ok:{onClick:()=>{s.destroy(),e.retryFetchData()}}}})},rowDblClick:(n,o)=>{var s;(s=t==null?void 0:t.rowDblClick)==null||s.call(t,n,o),e.buttonsApi.triggerClick("update")},activeRowChanged:n=>{var o;(o=t==null?void 0:t.activeRowChanged)==null||o.call(t,n),e.buttonsApi.refreshButtons()},rowSelectionChanged:(n,o,s,r)=>{var a,c,u;(a=t==null?void 0:t.rowSelectionChanged)==null||a.call(t,n,o,s,r),(u=(c=e.gridProps).onSelectionChange)==null||u.call(c,n,o,s,r,e)}}),[t,e]),hn=({tableRef:e,gridApi:t,gridProps:n,tabulatorProps:o})=>{const s=fn(t,n.events),r=l.useRef(void 0),a=l.useCallback(d=>{e.current=d.current,t.tableApi=d.current,n.resizeHeightWithParent&&(r.current=bn(e,n.resizeHeightWithParent))},[t,n.resizeHeightWithParent,e]);l.useEffect(()=>()=>{var d;(d=r.current)==null||d.disconnect()},[]),l.useEffect(()=>{Oe.pushToStack(t.getId())},[t]);const c=l.useMemo(()=>me(t,n==null?void 0:n.onDataFetch),[t,n.onDataFetch]),u=l.useCallback((d,f)=>{var b;return(b=n.onDataFetching)==null?void 0:b.call(n,d,f,t)},[t,n.onDataFetching]),i=l.useCallback((d,f,b)=>{var y;return(y=n.onDataFetchResponse)==null?void 0:y.call(n,b,f,t)},[t,n.onDataFetchResponse]);return h.jsx(Ke,{...o,id:t.getId(),layout:o.layout??"fitData",movableColumns:o.movableColumns!==!1,height:"100%",dataLoader:!1,onTableRef:a,dataTreeFilter:!0,data:n.dataSet,ajaxRequesting:n.onDataFetching?void 0:u,ajaxRequestFunc:n.onDataFetch?c:void 0,ajaxResponse:n.onDataFetchResponse?i:void 0,containerClassName:n.className,placeholder:n.placeholder??"Строки отсутствуют",events:s})},bn=(e,t)=>{var u,i;const n=(i=(u=e.current)==null?void 0:u.element)==null?void 0:i.closest(".tabulator-grid-container"),o=n==null?void 0:n.closest(t);if(!n||!o||n.style.height.endsWith("%"))return;let s=parseInt(n.style.height),r=o.getBoundingClientRect().height;const a=()=>{if(!e.current)return;const d=o.getBoundingClientRect().height;s=s+(d-r),n.style.height=(s>0?s:0)+"px",r=o.getBoundingClientRect().height},c=new ResizeObserver(a);return c.observe(o),c},mn=e=>{const[t]=l.useState({});return h.jsx(Ne,{title:"Столбцы",destroyOnClose:!0,centered:!0,open:e.open,onCancel:()=>e.gridApi.openColumnDialog(!1),footer:h.jsx(wn,{formProps:e,dialogApi:t}),children:e.open&&h.jsx(yn,{dialogProps:e,dialogApi:t})})},yn=({dialogProps:e,dialogApi:t})=>{const n=e.gridApi.tableApi,[o,s]=l.useState([]),[r,a]=l.useState([]),[c,u]=l.useState([]);t.gridApi=e.gridApi,t.setNodes=u,t.setChecked=s,t.setExpanded=a,l.useEffect(()=>{const b=De(n.getColumns(!0));we(t,b),Dn(t)},[]);const i=Fn(t,s),d=Sn(t),f=kn(t);return h.jsx(lt,{draggable:!0,blockNode:!0,showIcon:!0,defaultExpandAll:!0,checkable:!0,expandedKeys:r,checkedKeys:o,treeData:c,selectable:!1,onCheck:i,allowDrop:f,onDrop:d,onExpand:b=>{a(b)}})},wn=({formProps:e,dialogApi:t})=>h.jsx(de,{arrowsSelection:!0,buttons:{ok:{title:"OK",position:"right",active:!0,onClick:()=>Pn(e,t)},cancel:{title:"Отмена",position:"right",onClick:()=>{e.gridApi.openColumnDialog(!1)}},default:{title:"По умолчанию",position:"left",onClick:()=>pn(e,t)}}}),we=(e,t)=>{e.columnsDefsMap={};const n=(r,a)=>{var i;a||(a={val:0});let c=[];const u=[];for(const d of r){if(d.formatter==="rowSelection")continue;a.val++;const f=a.val.toString(),b={key:f,title:d.title};let y=d.visible!==!1;if((i=d.columns)!=null&&i.length){b.icon=h.jsx(ce,{});const[R,D]=n(d.columns,a);b.children=R,c=[...c,...D],D.length<d.columns.length&&(y=!1)}u.push(b),y&&c.push(f),e.columnsDefsMap[f]=d}return[u,c]},[o,s]=n(t);e.nodes=o,e.checked=s,e.setNodes(o),e.setChecked(s)},Dn=e=>{const t=[];for(const n in e.columnsDefsMap)t.push(n);e.setExpanded(t)},Cn=e=>{const t=o=>{var a;const s=[];let r=!1;for(const c of o){const u=e.columnsDefsMap[c.key.toString()];if(u.visible=e.checked.indexOf(c.key)>-1,(a=c.children)!=null&&a.length){const[i,d]=t(c.children);u.columns=i,d&&(u.visible=!0)}else delete u.columns;u.visible&&(r=!0),s.push(u)}return[s,r]},[n]=t(e.nodes);return n},De=e=>{const t=[];for(const n of e){const o={...n.getDefinition()};o.visible=n.isVisible(),o.width=n.getWidth();const s=n.getSubColumns();s!=null&&s.length&&(o.columns=De(s)),t.push(o)}return t},xn=e=>{const t=(n,o)=>{var r;const s=[];for(const a of n){const c={...o,...a};c.visible=c.visible!==!1,c.width||(c.width=0),(r=c.columns)!=null&&r.length&&(c.columns=t(c.columns,o)),s.push(c)}return s};return t(e.columns,e.columnDefaults??{})},Rn=(e,t)=>{if(t.default&&e.gridApi.gridProps.persistence){const s=e.gridApi.gridProps.persistenceID??e.gridApi.getId();localStorage.removeItem(`tabulator-${s}-columns`)}const n=Cn(t),o=t.gridApi.tableApi;o==null||o.setColumnLayout(n),o!=null&&o.isHeaderFilterVisible()||o==null||o.toggleHeaderFilter(!1)},g=(e,t)=>{var n;for(const o of e){if(o.key===t)return o;if(!((n=o.children)!=null&&n.length))continue;const s=g(o.children,t);if(s)return s}},Z=(e,t)=>{var o;let n=0;for(const s of e){if(s.key===t)return e.splice(n,1),!0;(o=s.children)!=null&&o.length&&Z(s.children,t),n++}},K=(e,t,n)=>{var o;for(const s of e){if(s.key===t.key)return n;if(!((o=s.children)!=null&&o.length))continue;const r=K(s.children,t,s);if(r)return r}},A=(e,t,n)=>{const o=e,s=K(n.nodes,e);if((s==null?void 0:s.key)===(t==null?void 0:t.key))return o;if(s)return A(s,t,n)},ee=e=>{var n,o;if(!((n=e.children)!=null&&n.length))return e;const t=e.children[e.children.length-1];return(o=t.children)!=null&&o.length?ee(t):t},vn=(e,t,n)=>{var s;if(!(t!=null&&t.children))return!1;const o=K(n.nodes,e);return t.key===(o==null?void 0:o.key)?(Z(n.nodes,e.key),(s=t.children)==null||s.unshift(e),!0):(console.warn("Drop on the content: target is another group"),!1)},W=(e,t,n,o)=>{if(!t)return!1;const s=K(o.nodes,e),r=K(o.nodes,t);if(!s&&r||s&&!r||(s==null?void 0:s.key)!==(r==null?void 0:r.key))return console.warn("Node and target node have different parents"),!1;let a=[];if(!s&&!r)a=o.nodes;else if((s==null?void 0:s.key)===(r==null?void 0:r.key))a=r.children;else return!1;Z(o.nodes,e.key);const c=a.indexOf(t);return c<0?!1:(a.splice(c+(n==="below"?1:0),0,e),!0)},kn=e=>{const t=n=>{const o=g(e.nodes,n.dragNode.key),s=g(e.nodes,n.dropNode.key);if(!o||!s)return!1;const r=K(e.nodes,o),a=K(e.nodes,s);if(n.dropPosition===-1)return r===a;if(n.dropPosition===0||n.dropPosition===1){if(!s.children&&r===a||s.children&&r===s)return!0;const c=A(s,r,e);if(!c)return!1;if(s===ee(c))return!0}return!1};return l.useCallback(t,[e])},Sn=e=>{const t=n=>{const o=g(e.nodes,n.dragNode.key),s=g(e.nodes,n.node.key);if(!s||!o)return;const r=K(e.nodes,o);if(n.node.dragOverGapTop)W(o,s,"above",e);else{const a=A(s,r,e);a&&s===ee(a)?W(o,a,"below",e):s.children?vn(o,s,e):W(o,s,"below",e)}e.setNodes([...e.nodes])};return l.useCallback(t,[e])},Fn=(e,t)=>l.useCallback(n=>{let o;Array.isArray(n)?o=n:o=[...n.checked,...n.halfChecked],e.checked=o,t(o)},[e,t]),Pn=(e,t)=>{Rn(e,t),e.gridApi.openColumnDialog(!1)},pn=(e,t)=>{const n=xn(e.gridApi.gridProps);t.default=!0,we(t,n)},On=e=>l.useMemo(()=>{var s;const t=(s=e.gridProps)==null?void 0:s.selectionFormProps;if(!t)return;const n={...t},o=t==null?void 0:t.onSubmitSuccess;return n.onSubmitSuccess=(r,a,c)=>{if(o&&o(r,a,c)===!1)return!1;const u={...c.model.getFormDataSet(),...a},i=e.gridProps,d=u.select??[];if(!i.appendSelection)return e.setDataSet(d);const f=e.getDataSet()??[];for(const b of d)f.find(y=>y.id===b.id)||e.insertRows(b)},n},[e]),Kn=({tableRef:e,gridApi:t,gridProps:n,tabulatorProps:o,columnsDialog:s})=>{const r=Zt(t),a=On(t);return h.jsxs("div",{className:"tabulator-grid-container",style:{height:n.height||void 0,minHeight:n.minHeight,maxHeight:n.maxHeight},children:[h.jsx(Ee,{isLoading:t.getIsLoading(),notHideContent:!0,spinStyle:{height:"100%"},children:h.jsxs(je,{style:{display:"flex",flexDirection:"column"},children:[h.jsx(dn,{gridApi:t}),h.jsx(hn,{tableRef:e,gridApi:t,gridProps:n,tabulatorProps:o})]})}),h.jsx(mn,{open:s,gridApi:t}),r?h.jsx(te,{...r,apiRef:t.editFormApi}):null,a?h.jsx(te,{...a,apiRef:t.selectionFormApi}):null]})},Ln=e=>{var i,d;const t=En(e),n=l.useRef(),[o]=l.useState(((i=e.editFormProps)==null?void 0:i.apiRef)??{}),[s]=l.useState(((d=e.selectionFormProps)==null?void 0:d.apiRef)??{}),[r]=l.useState({}),[a]=l.useState(e.apiRef||{}),[c,u]=l.useState(!1);return Dt({gridApi:a,props:e,tableRef:n,editFormApi:o,selectionFormApi:s,buttonsApi:r,setColumnsDialog:u}),h.jsx(Kn,{tableRef:n,gridApi:a,gridProps:e,tabulatorProps:t,columnsDialog:c})},En=e=>l.useMemo(()=>Te(e,{apiRef:!0,id:!0,gridMode:!0,dataSet:!0,className:!0,headerLabel:!0,buttons:!0,buttonsSize:!0,buttonsPosition:!0,buttonsIconsOnly:!0,readOnly:!0,editFormProps:!0,selectionFormProps:!0,appendSelection:!0,noHover:!0,rowDeleteMessage:!0,confirmDelete:!0,placeholder:!0,onMenuVisibilityChanged:!0,onDataLoading:!0,onDataLoadError:!0,onDataLoaded:!0,onDataChanged:!0,onDataProcessed:!0,onDataFetch:!0,onDataFetching:!0,onDataFetchResponse:!0,onSelectionChange:!0,onDelete:!0,resizeHeightWithParent:!0})[1],[e]);export{Ln as T};
