import{r as e,j as o}from"./index-CQvKQJ1H.js";import{O as t,n as r,h as s,i as d,j as n,k as a,l,m as i,o as c,p as u,q as p,r as g,s as y,t as v,v as m,w as f,x as N,y as R,z as b,A as S,B as h,C as G,D as P,E as x,F as w,G as K,H as k,I as C,J as D,K as M,L as F,M as j,N as A,u as O,a as E,b as B,c as I,d as T,e as L,f as Q}from"./useApiGetGroupsOnly-Crc4Nrko.js";import{D as V,s as z}from"./dFormModal-B_Bp8jqf.js";import{f as H,u as U,t as W,e as _,d as q,c as J,m as X,a as Y,B as Z,P as $}from"./buttonsRow-Tlbvi7M1.js";import{u as ee,a as oe,c as te,t as re,E as se,L as de}from"./isArray-1gBtd_za.js";import{o as ne}from"./defaultButtonsProps-q6NScukI.js";import{m as ae}from"./messageBox-DWQe614-.js";import{T as le}from"./index-B1Vh7D-O.js";import{s as ie}from"./index-DHFS5DRO.js";const ce=e=>()=>e,ue=e=>o=>{e(o)},pe=e=>()=>e,ge=e=>()=>e,ye={ru_RU:{view:"Просмотр",viewGroup:"Просмотр группы",viewRecord:"Просмотр записи",viewRecordsGroup:"Просмотр группы записей",create:"Создать",createRecord:"Создать запись",createGroup:"Создать группу",createRecordsGroup:"Создать группу записей",edit:"Редактировать",editGroup:"Редактировать группу",editRecord:"Редактировать запись",editRecordsGroup:"Редактировать группу записей",clone:"Клонировать",cloneGroup:"Клонировать группу",cloneRecord:"Клонировать запись",cloneRecordsGroup:"Клонировать группу записей",delete:"Удалить",deleteGroup:"Удалить группу",deleteRecord:"Удалить запись(и)",deleteRecordsGroup:"Удалить группу записей",select:"Выбрать",selectRecord:"Выбрать запись(и)",go:"Перейти",filter:"Фильтр",ok:"OK",cancel:"Отмена",tryAgainQt:"Попробовать еще раз?",deleteSelectedRecordQt:"Удалить выбранную запись?",moveRecordQt:"Удалить данную запись?",error:"Ошибка",dataNotFound:"Данные не найдены"},en_US:{view:"View",viewGroup:"View group",viewRecord:"View record",viewRecordsGroup:"View records group",create:"Create",createRecord:"Create record",createGroup:"Create group",createRecordsGroup:"Create records group",edit:"Edit",editGroup:"Edit group",editRecord:"Edit record",editRecordsGroup:"Edit records group",clone:"Clone",cloneGroup:"Clone group",cloneRecord:"Clone record",cloneRecordsGroup:"Clone records group",delete:"Delete",deleteGroup:"Delete group",deleteRecord:"Delete record(s)",deleteRecordsGroup:"Delete records group(s)",select:"Select",selectRecord:"Select record(s)",go:"Go",filter:"Filter",ok:"OK",cancel:"Cancel",tryAgainQt:"Try again?",deleteSelectedRecordQt:"Delete selected record?",moveRecordQt:"Move the record?",error:"Error",dataNotFound:"Data not found"},zh_CN:{view:"查看",viewGroup:"查看组",viewRecord:"查看记录",viewRecordsGroup:"查看记录组",create:"创建",createRecord:"创建记录",createGroup:"创建组",createRecordsGroup:"创建记录组",edit:"编辑",editGroup:"编辑组",editRecord:"编辑记录",editRecordsGroup:"编辑记录组",clone:"克隆",cloneGroup:"克隆组",cloneRecord:"克隆记录",cloneRecordsGroup:"克隆记录组",delete:"删除",deleteGroup:"删除组",deleteRecord:"删除记录",deleteRecordsGroup:"删除记录组",select:"选择",selectRecord:"选择记录",go:"前往",filter:"过滤",ok:"确定",cancel:"取消",tryAgainQt:"再试一次",deleteSelectedRecordQt:"删除选定的记录",moveRecordQt:"删除此记录",error:"错误",dataNotFound:"数据未找到"}},ve=e=>ee(e.language,ye,e.translation),me=e=>()=>e,fe=e=>o=>{const t=e.getSelectedKeys();if(!t)return;const r=[];for(const s of t){const t=e.getNode(s,o);t&&r.push(t)}return r},Ne=(e,o)=>(t,r=!0,s=!1,d=void 0)=>{const n=e.getFieldNames(),a="object"==typeof t?t[n.key]:t;if(!a)return void e.setSelectedKeys(void 0);const l=d??e.getDataSet(),i=e.getSelectedKeys();if(s){const o=Re(a,r,i,l,n);return void e.setSelectedKeys(o)}let c=[];if(r){if(null==i?void 0:i.includes(a))return;c=o?[...i??[],a]:[a]}else{if(!(null==i?void 0:i.includes(a)))return;c=o?null==i?void 0:i.filter((e=>e!==a)):[]}e.setSelectedKeys(c)},Re=(e,o,r,s,d)=>{const n=t(e,s,d);if(!n||!s)return r;const a=[...r??[]],l=e=>{const t=e[d.key];if(!t)return;const r=a.indexOf(t);if(o){if(r>-1||e[d.disabled]||!1===e[d.selectable])return;a.push(t)}else{if(r<0)return;a.splice(r,1)}if(oe(e[d.children]))for(const o of e[d.children])l(o)};return l(n),a},be=e=>{if(e)return oe(e)?e:[e]},Se=(e,o)=>t=>{var r,s;if(!t)return e(void 0),void(null==(r=null==o?void 0:o.onSelect)||r.call(o,[]));const d=oe(t)?t:[t];e(d),null==(s=null==o?void 0:o.onSelect)||s.call(o,d)},he=e=>()=>e,Ge=e=>o=>{setTimeout((()=>{e(o)}),0)},Pe=({props:o,setProps:t})=>{var O,E;const[B]=e.useState(o.apiRef??{}),[I]=e.useState((null==(O=o.editFormProps)?void 0:O.apiRef)??{}),[T]=e.useState((null==(E=o.editGroupFormProps)?void 0:E.apiRef)??{}),[L,Q]=e.useState(!1),[V,z]=e.useState(!1),[X,Y]=(o=>{const[t,s]=e.useState(be(o));return r((()=>{s(be(o))}),[o]),[t,s]})(o.selectedKeys),Z=s(o)(),$=(({dataMutator:o})=>e.useCallback((e=>{if(!o)return e;let t={...e};return o&&(t=o(t)),t}),[o]))(o),[ee,oe,re,se]=d(o.dataSet,Z,$),[de,ne]=n(o.expandedKeys,o.defaultExpandedKeys,o.defaultExpandAll,se),ae={getId:U(o.id??"tree-"+W()),getProps:J(o),setProps:q(t),updateProps:_(o,t),getIsMounted:H(),getFieldNames:s(o),getDataSet:A(ee),setDataSet:i(oe,null==o?void 0:o.onDataSetChanged),getGroupsOnly:j(B),sortTree:l(ee,o.sortComparator,B),isDataPlainList:F(re),getEditFormApi:ge(I),getEditGroupFormApi:pe(T),getSelectedKeys:me(X),setSelectedKeys:Se(Y,o),getSelectedNodes:fe(B),isNodeSelected:M(B),selectNode:Ne(B,o.multiple),getActiveNodeKey:D(B),getActiveNode:a(B),getExpandedKeys:C(de),setExpandedKeys:k(ne),getExpandedNodes:K(B),isNodeExpanded:w(B),expandNode:x(B),collapseNode:P(B),toggleNode:G(B),expandParentNodes:h(B),getNode:S(B),getNodes:b(B),getNextNodeKey:R(B),getPrevNodeKey:N(B),getNextNode:f(B),getPrevNode:m(B),getParentNode:v(B),addNode:y(B),updateNode:g(B),removeNode:p(B),moveNode:u(B),ensureNodeVisible:c(B),t:ve(o),treeRef:e.useRef(null),getButtonsApi:te(),getIsReady:ce(L),setIsReady:ue(Q),getIsLoading:he(V),setIsLoading:Ge(z)};return Object.assign(B,ae)},xe=(o,t,r)=>e.useMemo((()=>{const e=r?null==t?void 0:t.editGroupFormProps:null==t?void 0:t.editFormProps;if(!e)return;const s={...e};t.language&&!s.language&&(s.language=t.language);const d=null==e?void 0:e.onSubmitSuccess;return s.onSubmitSuccess=(e,r,s,n,a)=>{var l;if(null==d||d(e,r,s,n,a),a.isPrevented())return;const i=n.model.getFormMode(),c=o.getFieldNames(),u={...r,...s};let p;p=u[c.parent]?null==(l=u[c.parent])?void 0:l[c.key]:null===u[c.parent]?void 0:o.getActiveNodeKey(),"create"===i||"clone"===i?(u[c.key]||(u[c.key]=ne()),o.addNode(u,p,"insideBottom",{ensureVisible:!0,select:!!t.selectNewNode,sortNodes:t.sortOnChange})):"update"===i&&o.updateNode(u,p,{ensureVisible:!0,sortNodes:t.sortOnChange})},s}),[r,null==t?void 0:t.editFormProps,null==t?void 0:t.editGroupFormProps,t.language,t.selectNewNode,t.sortOnChange,o]),we=()=>{const[,o]=e.useState({});return e.useCallback((()=>{o({})}),[o])},Ke=e=>({...e}),ke=o=>e.useMemo((()=>({type:"hotkey",hotKeys:[{key:"ArrowUp"}],onClick:()=>{var e;const t=null==(e=o.getSelectedKeys())?void 0:e[0],r=o.getPrevNodeKey(t);r&&o.setSelectedKeys([r])}})),[o]),Ce=o=>e.useMemo((()=>({type:"hotkey",hotKeys:[{key:"ArrowDown"}],onClick:()=>{const e=o.getActiveNodeKey(),t=o.getNextNodeKey(e);t&&o.setSelectedKeys([t])}})),[o]),De=({api:t,treeProps:r})=>{const s=((o,t)=>{o.getButtonsApi().refreshButtons=we();const r=o.getFieldNames(),s=o.getActiveNode(!0),d=!!(null==s?void 0:s.isLeaf)||!(!t.groupsMode||(null==s?void 0:s[r.isGroup])),n=t.buttons,a=t.buttonsSize??"small",l=t.buttonsPosition??"right",i=O(t),c=E(o,t,d),u=B(o,t,d),p=I(o,t,s,Ke,d),g=T(o,t,s,Ke,d),y=L(o,t,s,Ke,d),v=Q(o,t,s,d),m=ke(o),f=Ce(o);return e.useMemo((()=>{var e,t;const r=X({headerLabel:i,view:p,create:c,createGroup:u,clone:g,update:y,delete:v,arrowUp:m,arrowDown:f},n);for(const d in r){const n=r[d];n&&"headerLabel"!==d&&"hotkey"!==n.type&&(n.size=n.size??a,n.position=n.position??l,n.checkDisabled&&(n.disabled=!s),n.checkHidden&&(n.hidden=!s),n.onDisabledCheck&&(n.disabled=null==(e=n.onDisabledCheck)?void 0:e.call(n,d,n,s,o)),n.onHiddenCheck&&(n.hidden=null==(t=n.onHiddenCheck)?void 0:t.call(n,d,n,s,o)))}return r}),[i,p,c,u,g,y,v,m,f,n,a,l,s])})(t,r);return e.useMemo((()=>s?o.jsx(Y,{buttons:s,apiRef:t.getButtonsApi(),style:{padding:"8px",...r.buttonsRowStyle},styles:r.buttonsRowStyles,context:t,responsiveBreakpoint:r.responsiveBreakpoint,iconsOnly:r.buttonsIconsOnly}):null),[s,t,r.buttonsRowStyle,r.buttonsRowStyles,r.responsiveBreakpoint,r.buttonsIconsOnly])},Me=({treeApi:e,allProps:t,antdTreeProps:r})=>{const s=Fe(e),d=je(e),n=Ae(e),a=Ee(e),l=Oe(e);return o.jsx(le,{className:"draggable-tree",onDrop:a,allowDrop:l,...r,draggable:!t.readOnly&&!1!==t.draggable,ref:e.treeRef,treeData:e.getDataSet(),selectedKeys:e.getSelectedKeys(),expandedKeys:e.getExpandedKeys(),fieldNames:{key:"id",title:"title",children:"children",...t.fieldNames},onSelect:s,onExpand:d,onDoubleClick:n})},Fe=e=>(o,t)=>{var r;const s=e.getProps();s.noDeselect&&!t.selected||(e.setSelectedKeys(o),null==(r=s.onSelect)||r.call(s,o,t))},je=e=>(o,t)=>{var r;const s=e.getProps();e.setExpandedKeys(o),null==(r=s.onExpand)||r.call(s,o,t)},Ae=e=>(o,t)=>{var r,s;const d=e.getProps();d.onDoubleClick&&(null==(r=d.onDoubleClick)||r.call(d,o,t));const n=e.getFieldNames();d.disabled||d.readOnly||!d.editFormProps&&!d.editGroupFormProps?(null==(s=t[n.children])?void 0:s.length)&&e.toggleNode(t[n.key]):e.getButtonsApi().triggerClick("update")},Oe=e=>o=>{const t=e.getProps(),r=e.getFieldNames();return t.groupsMode?t.draggableOrder?o.dropPosition<=0&&o.dropNode[r.isGroup]||o.dropPosition>0:o.dropPosition<=0&&o.dropNode[r.isGroup]:!!t.draggableOrder||0===o.dropPosition},Ee=e=>o=>{const t=e.getProps();let r="insideTop";if(o.dropToGap&&(r=o.dropPosition<0?"above":"below"),!o.dragNode)return;if(!t.confirmMove)return void Be(o.dragNode,o.node,r,!0,e);const s=ae.confirmWaiter({language:t.language,content:t.nodeMoveMessage??e.t("moveRecordQt"),onOk:()=>{Be(o.dragNode,o.node,r,!0,e,s)},onCancel:()=>{s.destroy()}})},Be=(e,t,r,s,d,n)=>{var a;const l=d.getProps(),i=null==(a=null==l?void 0:l.onNodeMove)?void 0:a.call(l,e,t,r,d);if(!re(i))return d.moveNode(e,t,r,{ensureVisible:s,sortNodes:l.sortOnChange}),void(n&&n.destroy());i.then((()=>{null==n||n.destroy(),d.getIsMounted()&&d.moveNode(e,t,r,{ensureVisible:s,sortNodes:l.sortOnChange})})).catch((e=>{null==n||n.destroy(),d.getIsMounted()&&ae.alert({language:l.language,title:d.t("error"),content:o.jsx(se,{error:e}),colorType:"danger"})}))},Ie=({api:e,allProps:t,antdTreeProps:r})=>{const s=xe(e,t,!1),d=xe(e,t,!0);return o.jsxs("div",{className:"extended-tree-container",children:[o.jsx(de,{isLoading:e.getIsLoading(),notHideContent:!0,spinStyle:{height:"100%"},language:t.language,children:o.jsxs(Z,{style:{display:"flex",flexDirection:"column",...t.buttonsRowWrapperStyle},children:[o.jsx(ie,{style:{zIndex:15},children:o.jsx(De,{api:e,treeProps:t})}),o.jsx(Me,{treeApi:e,allProps:t,antdTreeProps:r})]})}),!t.disabled&&s?o.jsx(V,{...s,apiRef:e.getEditFormApi()}):null,!t.disabled&&d?o.jsx(V,{...d,apiRef:e.getEditGroupFormApi()}):null]})},Te=e=>{const[t,r]=$(e),[,s]=Le(t),d=Pe({props:t,setProps:r});return o.jsx(Ie,{allProps:t,antdTreeProps:s,api:d})},Le=o=>e.useMemo((()=>{const[e,t]=z(o,{id:!0,buttons:!0,buttonsIconsOnly:!0,buttonsPosition:!0,buttonsSize:!0,confirmDelete:!0,editFormProps:!0,editGroupFormProps:!0,language:!0,readOnly:!0,deleteMessage:!0,translation:!0,apiRef:!0,headerLabel:!0,responsiveBreakpoint:!0,buttonsRowStyle:!0,buttonsRowStyles:!0,buttonsRowWrapperStyle:!0,dataSet:!0,dataMutator:!0,noDeselect:!0,groupsMode:!0,selectNewNode:!0,confirmMove:!0,nodeMoveMessage:!0,draggableOrder:!0,sortComparator:!0,sortOnChange:!0,onDataSetChanged:!0,nodeDeleteMessage:!0,onDelete:!0,onNodeMove:!0,fieldNames:!0,defaultCheckedKeys:!0,checkedKeys:!0,defaultExpandedKeys:!0,expandedKeys:!0,defaultSelectedKeys:!0,selectedKeys:!0});return[e,{...t,fieldNames:e.fieldNames}]}),[o]);export{Te as T};
