import{r as a,C as Ne,aG as Ee,aV as Me,m as _e,F as je,o as De,f as z,G as Re,l as Fe,aR as Te,Y as Be,j as E}from"./index-CgBeyb-e.js";import{a as V,B as ze}from"./dForm-B-6Y2TlM.js";import{s as Ve}from"./dFormModal-B-TtMmSz.js";import{O as We,a as $e,u as ke,b as He,D as Ge,T as Ae,m as Ue}from"./useShowArrow-DhNUwsya.js";import{j as Le}from"./modal-hi51mlNB.js";import{j as Xe,k as Ye,g as Ze}from"./index-Birbnh4n.js";import{u as qe}from"./useIcons-tPNZCeWw.js";var Je=function(e,n){var s={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.indexOf(t)<0&&(s[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,t=Object.getOwnPropertySymbols(e);o<t.length;o++)n.indexOf(t[o])<0&&Object.prototype.propertyIsEnumerable.call(e,t[o])&&(s[t[o]]=e[t[o]]);return s};const W="SECRET_COMBOBOX_MODE_DO_NOT_USE",Ke=(e,n)=>{var s;const{prefixCls:t,bordered:o,className:l,rootClassName:r,getPopupContainer:h,popupClassName:$,dropdownClassName:k,listHeight:H=256,placement:f,listItemHeight:g,size:p,disabled:O,notFoundContent:M,status:G,builtinPlacements:A,dropdownMatchSelectWidth:U,popupMatchSelectWidth:v,direction:x,style:L,allowClear:_,variant:X,dropdownStyle:S,transitionName:Y,tagRender:Z,maxCount:q}=e,j=Je(e,["prefixCls","bordered","className","rootClassName","getPopupContainer","popupClassName","dropdownClassName","listHeight","placement","listItemHeight","size","disabled","notFoundContent","status","builtinPlacements","dropdownMatchSelectWidth","popupMatchSelectWidth","direction","style","allowClear","variant","dropdownStyle","transitionName","tagRender","maxCount"]),{getPopupContainer:J,getPrefixCls:D,renderEmpty:y,direction:K,virtual:Q,popupMatchSelectWidth:ee,popupOverflow:te,select:c}=a.useContext(Ne),[,w]=Ee(),oe=g??(w==null?void 0:w.controlHeight),i=D("select",t),ne=D(),u=x??K,{compactSize:se,compactItemClassnames:ae}=Me(i,u),[le,re]=Xe("select",X,o),P=_e(i),[ie,R,F]=ke(i,P),C=a.useMemo(()=>{const{mode:m}=e;if(m!=="combobox")return m===W?"combobox":m},[e.mode]),I=C==="multiple"||C==="tags",ce=He(e.suffixIcon,e.showArrow),ue=(s=v??U)!==null&&s!==void 0?s:ee,{status:de,hasFeedback:T,isFormItemInput:me,feedbackIcon:Se}=a.useContext(je),Ce=Ze(de,G);let b;M!==void 0?b=M:C==="combobox"?b=null:b=(y==null?void 0:y("Select"))||a.createElement(Ge,{componentName:"Select"});const{suffixIcon:be,itemIcon:he,removeIcon:fe,clearIcon:ge}=qe(Object.assign(Object.assign({},j),{multiple:I,hasFeedback:T,feedbackIcon:Se,showSuffixIcon:ce,prefixCls:i,componentName:"Select"})),pe=_===!0?{clearIcon:ge}:_,Oe=De(j,["suffixIcon","itemIcon"]),ve=z($||k,{[`${i}-dropdown-${u}`]:u==="rtl"},r,F,P,R),B=Re(m=>{var N;return(N=p??se)!==null&&N!==void 0?N:m}),xe=a.useContext(Fe),ye=O??xe,we=z({[`${i}-lg`]:B==="large",[`${i}-sm`]:B==="small",[`${i}-rtl`]:u==="rtl",[`${i}-${le}`]:re,[`${i}-in-form-item`]:me},Ye(i,Ce,T),ae,c==null?void 0:c.className,l,r,F,P,R),Pe=a.useMemo(()=>f!==void 0?f:u==="rtl"?"bottomRight":"bottomLeft",[f,u]),[Ie]=Te("SelectLike",S==null?void 0:S.zIndex);return ie(a.createElement(Ae,Object.assign({ref:n,virtual:Q,showSearch:c==null?void 0:c.showSearch},Oe,{style:Object.assign(Object.assign({},c==null?void 0:c.style),L),dropdownMatchSelectWidth:ue,transitionName:Be(ne,"slide-up",Y),builtinPlacements:Ue(A,te),listHeight:H,listItemHeight:oe,mode:C,prefixCls:i,placement:Pe,direction:u,suffixIcon:be,menuItemSelectedIcon:he,removeIcon:fe,allowClear:pe,notFoundContent:b,className:we,getPopupContainer:h||J,dropdownClassName:ve,disabled:ye,dropdownStyle:Object.assign(Object.assign({},S),{zIndex:Ie}),maxCount:I?q:void 0,tagRender:I?Z:void 0})))},d=a.forwardRef(Ke),Qe=Le(d);d.SECRET_COMBOBOX_MODE_DO_NOT_USE=W;d.Option=We;d.OptGroup=$e;d._InternalPanelDoNotUseOrYouWillBeFired=Qe;const et=e=>{const n=nt(e),s=tt(e),t=ot(e,e.value);return E.jsx(d,{...n,options:s,value:t,disabled:e.disabled||e.readOnly,optionFilterProp:e.optionFilterProp??"label",showSearch:e.showSearch!==!1,onSelect:(o,l)=>{var r;return(r=e.onSelect)==null?void 0:r.call(e,o,l)},onDeselect:(o,l)=>{var r;return(r=e.onDeselect)==null?void 0:r.call(e,o,l)},onChange:(o,l)=>{var r;return(r=e.onChange)==null?void 0:r.call(e,o,l)},children:e.children})},tt=e=>a.useMemo(()=>{if(!e.dataSet)return;const n=s=>{const t=[];if(!(!s||!V(s))){for(const o of s){const l={...o};o.id&&(l.value=o.id),o.label&&(l.label=o.label),o.children&&(l.children=n(o.children)),t.push(l)}return t}};return n(e.dataSet)},[e.dataSet]),ot=(e,n)=>a.useMemo(()=>{if(typeof n>"u")return;if(!V(n))return typeof n=="object"?{value:n.id,label:n.label}:n;const s=[];for(const t of n)typeof t=="object"?s.push({value:t.id,label:t.label}):s.push(t);return s},[n]),nt=e=>a.useMemo(()=>Ve(e,{dataSet:!0,value:!0,readOnly:!0,onSelect:!0,onDeselect:!0,onChange:!0})[1],[e]),st=({field:e})=>{a.useSyncExternalStore(e.subscribe.bind(e),e.getSnapshot.bind(e));const n=e.getProps(),s=e.getValue(),t=a.useCallback(h=>{e.isReady()&&(e.setValue(h),e.setDirty(!0))},[e]),o=a.useCallback(()=>{e.setTouched(!0)},[e]);a.useEffect(()=>{e.setReady(!0)},[e]);const r={...{width:e.getWidth()??"100%"},...n.style};return E.jsx(et,{allowClear:!0,...n,disabled:e.isDisabled(),readOnly:e.isReadOnly(),value:s,style:r,onBlur:o,onChange:t})};class mt extends ze{render(){return E.jsx(st,{field:this})}}export{mt as S};
