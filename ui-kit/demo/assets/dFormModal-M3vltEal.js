import{r as a,j as h}from"./index-B_ePoftH.js";import{h as O,m as x,G as w,c as j,M as E,f as I}from"./messageBox-BvRGMm6l.js";import{r as T,e as R,c as V,D as N,I as v,a as H,u as B}from"./dForm-CcoZZ7WD.js";import{M as z}from"./modal-CKEVbAO9.js";const G={...T,cancelChangesQn:"Отменить сделанные изменения?",viewing:"Просмотр",creating:"Создание",editing:"Редактирование",cloning:"Клонирование"},Q={...R,cancelChangesQn:"Cancel the changes made?",viewing:"Viewing",creating:"Creating",editing:"Editing",cloning:"Cloning"},L={...V,cancelChangesQn:"取消已做的更改？",viewing:"查看",creating:"创建",editing:"编辑",cloning:"克隆"},k={ru:G,en:Q,cn:L},D=t=>a.useCallback(e=>{const i=t.language??"en",u={...k[i]??k.en,...t.translation};return Object.prototype.hasOwnProperty.call(u,e)?u[e]:Object.prototype.hasOwnProperty.call(k.en,e)?k.en[e]:e},[t.language,t.translation]),$=(t,e,i,n,u)=>{e.getFormId=K(t),e.buttonsApi=n,e.getFormProps=U(i),e.setFormProps=W(i,u),e.open=q(e),e.close=X(e,i),e.forceClose=J(e)},K=t=>a.useCallback(()=>t,[t]),U=t=>a.useCallback(()=>t,[t]),W=(t,e)=>a.useCallback(i=>{e({...t,...i})},[t,e]),q=t=>a.useCallback((e,i)=>{var g,s;if(!e){console.warn("The form mode is not set");return}const n=i??t.getFormProps().dataSet,u=n?O(n):void 0,c=t.getFormProps();((g=c.onOpen)==null?void 0:g.call(c,t,u))!==!1&&(t.setFormProps({open:!0,formMode:e,dataSet:u}),(s=c.onOpened)==null||s.call(c,t,u))},[t]),J=t=>a.useCallback(()=>{var i,n;const e=t.getFormProps();if(((i=e.onClosing)==null?void 0:i.call(e,t))===!1)return!1;t.setFormProps({open:!1}),(n=e.onClosed)==null||n.call(e,t)},[t]),X=(t,e)=>{const i=D(e);return a.useCallback(()=>{var n,u;if(((n=e.onClosing)==null?void 0:n.call(e,t))!==!1){if(t.model.isFormDirty()&&e.confirmChanges){x.confirm({language:e.language,content:e.closeFormConfirmMessage??i("cancelChangesQn"),okText:i("yes"),cancelText:i("no"),onOk:()=>{var c;(c=e.onCancel)==null||c.call(e,t),t.forceClose()}});return}(u=e.onCancel)==null||u.call(e,t),t.forceClose()}},[t,e,i])},Y=({formId:t,buttons:e,buttonsApi:i,formApi:n,formProps:u,modalProps:c,modalFormProps:g})=>{const[s]=a.useState(t??"dFormModal-"+w()),C=Z(g);return h.jsx(z,{...c,modalId:s,style:g.modalStyle,styles:g.modalStyles,onCancel:n.close,centered:typeof c.centered>"u"?!0:c.centered,maskClosable:!1,keyboard:!1,destroyOnClose:!0,footer:h.jsx(j,{buttons:e,colorType:g.colorType,buttonsApi:i,arrowsSelection:g.arrowsButtonsSelection,context:n}),title:C,children:g.open?h.jsx(N,{apiRef:n,...u,formStyle:{height:"100%",width:"100%",...u.formStyle},containerStyle:{height:"100%",...u.containerStyle}}):null})},Z=t=>{const e=t.formMode??"create",i=t.title,n=D(t);return i||(e==="view"?n("viewing"):e==="create"?n("creating"):e==="clone"?n("cloning"):e==="update"?n("editing"):"&nbsp;")},_=(t,e)=>{const i=D(e);return a.useMemo(()=>({onFormDirtyStateChanged:n=>{var u;return(u=e==null?void 0:e.onFormDirtyStateChanged)==null?void 0:u.call(e,n,t)},onFormReadOnlyStateChanged:n=>{var u;return(u=e==null?void 0:e.onFormReadOnlyStateChanged)==null?void 0:u.call(e,n,t)},onFormInit:()=>{var n;return(n=e==null?void 0:e.onFormInit)==null?void 0:n.call(e,t)},onFormModelInitialized:()=>{var n;return(n=e==null?void 0:e.onFormModelInitialized)==null?void 0:n.call(e,t)},onFormReadyStateChanged:n=>{var u;return(u=e==null?void 0:e.onFormReadyStateChanged)==null?void 0:u.call(e,n,t)},onFormValuesChanged:(n,u)=>{var c;return(c=e==null?void 0:e.onFormValuesChanged)==null?void 0:c.call(e,n,u,t)},onFormValidated:(n,u,c)=>{var g;return(g=e==null?void 0:e.onFormValidated)==null?void 0:g.call(e,n,u,c,t)},onFormHasErrors:(n,u)=>{var c;return(c=e==null?void 0:e.onFormHasErrors)==null?void 0:c.call(e,n,u,t)},onFormHasNoErrors:n=>{var u;return(u=e==null?void 0:e.onFormHasNoErrors)==null?void 0:u.call(e,n,t)},onDataFetch:()=>{var n;return(n=e==null?void 0:e.onDataFetch)==null?void 0:n.call(e,t)},onDataFetchSuccess:n=>{var u;return(u=e==null?void 0:e.onDataFetchSuccess)==null?void 0:u.call(e,n,t)},onDataFetchError:n=>{var c;if(((c=e==null?void 0:e.onDataFetchError)==null?void 0:c.call(e,n,t))===!1)return!1;const u=x.confirm({language:e.language,content:h.jsxs(h.Fragment,{children:[h.jsx("p",{children:h.jsx("b",{children:n.message})}),n.stack&&v()?h.jsx("p",{children:n.stack}):"",h.jsx("p",{children:i("tryAgainQt")})]}),colorType:"danger",buttons:{ok:{onClick:()=>{u.destroy(),t.model.fetchData()}},cancel:{onClick:()=>{var g;u.destroy(),(g=t.forceClose)==null||g.call(t)}}}});return!1},onDataFetchComplete:()=>{var n;return(n=e==null?void 0:e.onDataFetchComplete)==null?void 0:n.call(e,t)},onSubmitValidation:(n,u)=>{var c;return(c=e==null?void 0:e.onSubmitValidation)==null?void 0:c.call(e,n,u,t)},onSubmit:n=>{var u,c,g,s,C,b,S;return(c=(u=t.buttonsApi).disabled)==null||c.call(u,"ok",!0),(s=(g=t.buttonsApi).disabled)==null||s.call(g,"cancel",!0),e.confirmChanges||(b=(C=t.buttonsApi).loading)==null||b.call(C,"ok",!0),(S=e==null?void 0:e.onSubmit)==null?void 0:S.call(e,n,t)},onSubmitSuccess:(n,u)=>{var c;if(((c=e==null?void 0:e.onSubmitSuccess)==null?void 0:c.call(e,n,u,t))===!1)return!1;t.forceClose()},onSubmitError:(n,u)=>{var c;return(c=e==null?void 0:e.onSubmitError)==null?void 0:c.call(e,n,u,t)},onSubmitComplete:(n,u)=>{var c,g,s,C,b,S,y;if(((c=e==null?void 0:e.onSubmitComplete)==null?void 0:c.call(e,n,u,t))===!1)return!1;(s=(g=t.buttonsApi).disabled)==null||s.call(g,"ok",!1),(b=(C=t.buttonsApi).disabled)==null||b.call(C,"cancel",!1),(y=(S=t.buttonsApi).loading)==null||y.call(S,"ok",!1)},onDataSetChange:n=>{var u;return(u=e==null?void 0:e.onDataSetChange)==null?void 0:u.call(e,n,t)}}),[t,e])},f=(t,e)=>{const i=D(e);return a.useMemo(()=>{const n={ok:{position:"right",active:e.formMode!=="view",hidden:e.formMode==="view",title:i("ok"),hotKeys:[{key:"enter",ctrl:!0},{key:"s",ctrl:!0},{key:"ы",ctrl:!0}],onClick:()=>{t.submitForm()}},cancel:{position:"right",title:i("cancel"),hotKeys:[{key:"escape"}],active:e.formMode==="view",onClick:()=>{t.close()}}};return E(n,e.buttons)},[t,e.buttons,e.formMode,i])},P=t=>{H();const[e]=a.useState(t.formId??"dFormModal-"+w()),[i,n]=B(t),[u,c]=M(i),[g,s]=a.useState(i.apiRef||{}),[C]=a.useState({}),b=f(g,i);$(e,g,i,C,n);const S=_(g,i),[,y]=l(c,S);return a.useEffect(()=>()=>{s({})},[]),h.jsx(Y,{formId:e,formApi:g,modalFormProps:i,modalProps:u,formProps:y,buttons:b,buttonsApi:C})},M=t=>a.useMemo(()=>{const[e,i]=I(t,{afterClose:!0,animation:!0,bodyProps:!0,centered:!0,children:!0,className:!0,classNames:!0,closable:!0,closeIcon:!0,colorType:!0,confirmLoading:!0,focusTriggerAfterClose:!0,forceRender:!0,getContainer:!0,headerIcon:!0,height:!0,isDraggable:!0,loading:!0,mask:!0,maskAnimation:!0,maskProps:!0,maskStyle:!0,maskTransitionName:!0,modalRender:!0,mousePosition:!0,notScrollable:!0,onAfterOpenChange:!0,open:!0,panelRef:!0,prefixCls:!0,resizable:!0,rootClassName:!0,title:!0,transitionName:!0,visible:!0,width:!0,wrapClassName:!0,wrapProps:!0,wrapStyle:!0,zIndex:!0,maxHeight:!0,minHeight:!0,minWidth:!0,maxWidth:!0});return[e,i]},[t]),l=(t,e)=>a.useMemo(()=>{const[i,n]=I(t,{closeFormConfirmMessage:!0,modalStyle:!0,modalStyles:!0,onClosed:!0,onClosing:!0,onDataFetch:!0,onDataFetchComplete:!0,onDataFetchError:!0,onDataFetchSuccess:!0,onDataSetChange:!0,onFormDirtyStateChanged:!0,onFormDisabledStateChanged:!0,onFormHasErrors:!0,onFormHasNoErrors:!0,onFormInit:!0,onFormModelInitialized:!0,onFormReadOnlyStateChanged:!0,onFormReadyStateChanged:!0,onFormValidated:!0,onFormValuesChanged:!0,onOpen:!0,onOpened:!0,onSubmit:!0,onSubmitComplete:!0,onSubmitError:!0,onSubmitSuccess:!0,onSubmitValidation:!0,onCancel:!0,language:!0,translation:!0});return n.buttons=null,[i,{...n,...e,language:t.language,translation:t.translation}]},[e,t]);export{P as D};
