import{r as i,j as N}from"./index-B5poLpDm.js";import{O as k,n as M,h as x,i as I,j as O,k as B,l as T,m as L,o as j,p as P,q as Q,r as U,s as z,t as H,v as V,w as W,x as _,y as q,z as J,A as X,B as Y,C as Z,D as $,E as ee,F as te,G as oe,H as se,I as ne,J as re,K as de,L as ue,M as ce,N as ae,u as ie,a as le,b as ge,c as fe,d as ye,e as Ne,f as pe}from"./useApiGetGroupsOnly-5VEr3Syr.js";import{D as h,s as Ge}from"./dFormModal-C_QqbNS_.js";import{f as me,u as Re,t as Se,e as Ae,d as be,c as Ke,m as ve,a as we,B as xe,P as he}from"./buttonsRow-aX3TQ5bu.js";import{u as De,a as K,b as Ce,t as Ee,E as Fe,L as ke}from"./dForm-vrGhQ6Lh.js";import{o as Me}from"./defaultButtonsProps-DtqWhfDr.js";import{m as F}from"./messageBox-1o2XjDyt.js";import{T as Ie}from"./index--2ky6TFp.js";import{s as Oe}from"./index-CDQLj6wX.js";const Be=e=>()=>e,Te=e=>t=>{e(t)},Le=e=>()=>e,je=e=>()=>e,Pe={view:"Просмотр",viewGroup:"Просмотр группы",viewRecord:"Просмотр записи",viewRecordsGroup:"Просмотр группы записей",create:"Создать",createRecord:"Создать запись",createGroup:"Создать группу",createRecordsGroup:"Создать группу записей",edit:"Редактировать",editGroup:"Редактировать группу",editRecord:"Редактировать запись",editRecordsGroup:"Редактировать группу записей",clone:"Клонировать",cloneGroup:"Клонировать группу",cloneRecord:"Клонировать запись",cloneRecordsGroup:"Клонировать группу записей",delete:"Удалить",deleteGroup:"Удалить группу",deleteRecord:"Удалить запись(и)",deleteRecordsGroup:"Удалить группу записей",select:"Выбрать",selectRecord:"Выбрать запись(и)",go:"Перейти",filter:"Фильтр",ok:"OK",cancel:"Отмена",tryAgainQt:"Попробовать еще раз?",deleteSelectedRecordQt:"Удалить выбранную запись?",moveRecordQt:"Удалить данную запись?",error:"Ошибка",dataNotFound:"Данные не найдены"},Qe={view:"View",viewGroup:"View group",viewRecord:"View record",viewRecordsGroup:"View records group",create:"Create",createRecord:"Create record",createGroup:"Create group",createRecordsGroup:"Create records group",edit:"Edit",editGroup:"Edit group",editRecord:"Edit record",editRecordsGroup:"Edit records group",clone:"Clone",cloneGroup:"Clone group",cloneRecord:"Clone record",cloneRecordsGroup:"Clone records group",delete:"Delete",deleteGroup:"Delete group",deleteRecord:"Delete record(s)",deleteRecordsGroup:"Delete records group(s)",select:"Select",selectRecord:"Select record(s)",go:"Go",filter:"Filter",ok:"OK",cancel:"Cancel",tryAgainQt:"Try again?",deleteSelectedRecordQt:"Delete selected record?",moveRecordQt:"Move the record?",error:"Error",dataNotFound:"Data not found"},Ue={view:"查看",viewGroup:"查看组",viewRecord:"查看记录",viewRecordsGroup:"查看记录组",create:"创建",createRecord:"创建记录",createGroup:"创建组",createRecordsGroup:"创建记录组",edit:"编辑",editGroup:"编辑组",editRecord:"编辑记录",editRecordsGroup:"编辑记录组",clone:"克隆",cloneGroup:"克隆组",cloneRecord:"克隆记录",cloneRecordsGroup:"克隆记录组",delete:"删除",deleteGroup:"删除组",deleteRecord:"删除记录",deleteRecordsGroup:"删除记录组",select:"选择",selectRecord:"选择记录",go:"前往",filter:"过滤",ok:"确定",cancel:"取消",tryAgainQt:"再试一次",deleteSelectedRecordQt:"删除选定的记录",moveRecordQt:"删除此记录",error:"错误",dataNotFound:"数据未找到"},ze={ru_RU:Pe,en_US:Qe,zh_CN:Ue},He=e=>De(e.language,ze,e.translation),Ve=({dataMutator:e})=>i.useCallback(t=>{if(!e)return t;let o={...t};return e&&(o=e(o)),o},[e]),We=e=>()=>e,_e=e=>{const t=i.useRef(void 0),o=i.useRef(void 0);return s=>{const n=e.getSelectedKeys();if(t.current===n)return o.current;if(t.current=n,!n){o.current=void 0;return}const r=[];for(const d of n){const u=e.getNode(d,s);u&&r.push(u)}return o.current=r,r}},qe=(e,t)=>(o,s=!0,n=!1,r=void 0)=>{const d=e.getFieldNames(),u=typeof o=="object"?o[d.key]:o;if(!u)return;const a=r??e.getDataSet(),c=e.getSelectedKeys();if(n){const g=Je(u,s,c,a,d);e.setSelectedKeys(g);return}let l=[];if(s){if(c!=null&&c.includes(u))return;t?l=[...c??[],u]:l=[u]}else{if(!(c!=null&&c.includes(u)))return;t?l=c==null?void 0:c.filter(g=>g!==u):l=[]}e.setSelectedKeys(l)},Je=(e,t,o,s,n)=>{const r=k(e,s,n);if(!r||!s)return o;const d=[...o??[]],u=a=>{const c=a[n.key];if(!c)return;const l=d.indexOf(c);if(t){if(l>-1||a[n.disabled]||a[n.selectable]===!1)return;d.push(c)}else{if(l<0)return;d.splice(l,1)}if(K(a[n.children]))for(const g of a[n.children])u(g)};return u(r),d},Xe=e=>{const[t,o]=i.useState(D(e));return M(()=>{o(D(e))},[e]),[t,o]},D=e=>{if(e)return K(e)?e:[e]},Ye=e=>t=>{if(!t){e(void 0);return}K(t)?e(t):e([t])},Ze=e=>()=>e,$e=e=>t=>{setTimeout(()=>{e(t)},0)},et=({props:e,setProps:t})=>{var y,w;const[o]=i.useState(e.apiRef??{}),[s]=i.useState(((y=e.editFormProps)==null?void 0:y.apiRef)??{}),[n]=i.useState(((w=e.editGroupFormProps)==null?void 0:w.apiRef)??{}),[r,d]=i.useState(!1),[u,a]=i.useState(!1),[c,l]=Xe(e.selectedKeys),g=x(e)(),p=Ve(e),[f,G,m,S]=I(e.dataSet,g,p),[v,R]=O(e.expandedKeys,e.defaultExpandedKeys,e.defaultExpandAll,S),A={getId:Re(e.id??"tree-"+Se()),getProps:Ke(e),setProps:be(t),updateProps:Ae(e,t),getIsMounted:me(),getFieldNames:x(e),getDataSet:ae(f),setDataSet:L(G,e==null?void 0:e.onDataSetChanged),getGroupsOnly:ce(o),sortTree:T(f,e.sortComparator,o),isDataPlainList:ue(m),getEditFormApi:je(s),getEditGroupFormApi:Le(n),getSelectedKeys:We(c),setSelectedKeys:Ye(l),getSelectedNodes:_e(o),isNodeSelected:de(o),selectNode:qe(o,e.multiple),getActiveNodeKey:re(o),getActiveNode:B(o),getExpandedKeys:ne(v),setExpandedKeys:se(R),getExpandedNodes:oe(o),isNodeExpanded:te(o),expandNode:ee(o),collapseNode:$(o),toggleNode:Z(o),expandParentNodes:Y(o),getNode:X(o),getNodes:J(o),getNextNodeKey:q(o),getPrevNodeKey:_(o),getNextNode:W(o),getPrevNode:V(o),getParentNode:H(o),addNode:z(o),updateNode:U(o),removeNode:Q(o),moveNode:P(o),ensureNodeVisible:j(o),t:He(e),treeRef:i.useRef(null),getButtonsApi:Ce(),getIsReady:Be(r),setIsReady:Te(d),getIsLoading:Ze(u),setIsLoading:$e(a)};return Object.assign(o,A)},C=(e,t,o)=>i.useMemo(()=>{const s=o?t==null?void 0:t.editGroupFormProps:t==null?void 0:t.editFormProps;if(!s)return;const n={...s};t.language&&!n.language&&(n.language=t.language);const r=s==null?void 0:s.onSubmitSuccess;return n.onSubmitSuccess=(d,u,a,c,l)=>{var m;if(r==null||r(d,u,a,c,l),l.isPrevented())return;const g=c.model.getFormMode(),p=e.getFieldNames(),f={...u,...a};let G;f[p.parent]?G=(m=f[p.parent])==null?void 0:m[p.key]:f[p.parent]===null?G=void 0:G=e.getActiveNodeKey(),g==="create"||g==="clone"?(f[p.key]||(f[p.key]=Me()),e.addNode(f,G,"insideBottom",{ensureVisible:!0,select:!!t.selectNewNode,sortNodes:t.sortOnChange})):g==="update"&&e.updateNode(f,G,{ensureVisible:!0,sortNodes:t.sortOnChange})},n},[o,t==null?void 0:t.editFormProps,t==null?void 0:t.editGroupFormProps,t.language,t.selectNewNode,t.sortOnChange,e]),tt=(e,t)=>{e.getButtonsApi().refreshButtons=ot();const o=e.getFieldNames(),s=e.getActiveNode(!0),n=!!(s!=null&&s.isLeaf)||!!(t.groupsMode&&!(s!=null&&s[o.isGroup])),r=t.buttons,d=t.buttonsSize??"small",u=t.buttonsPosition??"right",a=ie(t),c=le(e,t,n),l=ge(e,t,n),g=fe(e,t,s,b,n),p=ye(e,t,s,b,n),f=Ne(e,t,s,b,n),G=pe(e,t,s,n),m=st(e),S=nt(e);return i.useMemo(()=>{const R=ve({headerLabel:a,view:g,create:c,createGroup:l,clone:p,update:f,delete:G,arrowUp:m,arrowDown:S},r);for(const A in R){const y=R[A];!y||A==="headerLabel"||y.type==="hotkey"||(y.size=y.size??d,y.position=y.position??u,y.checkDisabled&&(y.disabled=!s),y.checkHidden&&(y.hidden=!s))}return R},[a,g,c,l,p,f,G,m,S,r,d,u,s])},ot=()=>{const[,e]=i.useState({});return i.useCallback(()=>{e({})},[e])},b=e=>({...e}),st=e=>i.useMemo(()=>({type:"hotkey",hotKeys:[{key:"ArrowUp"}],onClick:()=>{var s;const t=(s=e.getSelectedKeys())==null?void 0:s[0],o=e.getPrevNodeKey(t);o&&e.setSelectedKeys([o])}}),[e]),nt=e=>i.useMemo(()=>({type:"hotkey",hotKeys:[{key:"ArrowDown"}],onClick:()=>{const t=e.getActiveNodeKey(),o=e.getNextNodeKey(t);o&&e.setSelectedKeys([o])}}),[e]),rt=({api:e,treeProps:t})=>{const o=tt(e,t);return i.useMemo(()=>o?N.jsx(we,{buttons:o,apiRef:e.getButtonsApi(),style:{padding:"8px",...t.buttonsRowStyle},styles:t.buttonsRowStyles,context:e,responsiveBreakpoint:t.responsiveBreakpoint,iconsOnly:t.buttonsIconsOnly}):null,[o,e,t.buttonsRowStyle,t.buttonsRowStyles,t.responsiveBreakpoint,t.buttonsIconsOnly])},dt=({treeApi:e,allProps:t,antdTreeProps:o})=>{const s=ut(e),n=ct(e),r=at(e),d=lt(e),u=it(e);return N.jsx(Ie,{className:"draggable-tree",onDrop:d,allowDrop:u,...o,draggable:!t.readOnly&&t.draggable!==!1,ref:e.treeRef,treeData:e.getDataSet(),selectedKeys:e.getSelectedKeys(),expandedKeys:e.getExpandedKeys(),fieldNames:{key:"id",title:"title",children:"children",...t.fieldNames},onSelect:s,onExpand:n,onDoubleClick:r})},ut=e=>(t,o)=>{var n;const s=e.getProps();(!s.noDeselect||o.selected)&&(e.setSelectedKeys(t),(n=s.onSelect)==null||n.call(s,t,o))},ct=e=>(t,o)=>{var n;const s=e.getProps();e.setExpandedKeys(t),(n=s.onExpand)==null||n.call(s,t,o)},at=e=>(t,o)=>{var r,d;const s=e.getProps();s.onDoubleClick&&((r=s.onDoubleClick)==null||r.call(s,t,o));const n=e.getFieldNames();if(!s.disabled&&!s.readOnly&&(s.editFormProps||s.editGroupFormProps)){e.getButtonsApi().triggerClick("update");return}(d=o[n.children])!=null&&d.length&&e.toggleNode(o[n.key])},it=e=>t=>{const o=e.getProps(),s=e.getFieldNames();return o.groupsMode?o.draggableOrder?t.dropPosition<=0&&t.dropNode[s.isGroup]||t.dropPosition>0:t.dropPosition<=0&&t.dropNode[s.isGroup]:o.draggableOrder?!0:t.dropPosition===0},lt=e=>t=>{const o=e.getProps();let s="insideTop";if(t.dropToGap&&(s=t.dropPosition<0?"above":"below"),!t.dragNode)return;if(!o.confirmMove){E(t.dragNode,t.node,s,!0,e);return}const n=F.confirmWaiter({language:o.language,content:o.nodeMoveMessage??e.t("moveRecordQt"),onOk:()=>{E(t.dragNode,t.node,s,!0,e,n)},onCancel:()=>{n.destroy()}})},E=(e,t,o,s,n,r)=>{var a;const d=n.getProps(),u=(a=d==null?void 0:d.onNodeMove)==null?void 0:a.call(d,e,t,o,n);if(!Ee(u)){n.moveNode(e,t,o,{ensureVisible:s,sortNodes:d.sortOnChange}),r&&r.destroy();return}u.then(()=>{r==null||r.destroy(),n.getIsMounted()&&n.moveNode(e,t,o,{ensureVisible:s,sortNodes:d.sortOnChange})}).catch(c=>{r==null||r.destroy(),n.getIsMounted()&&F.alert({language:d.language,title:n.t("error"),content:N.jsx(Fe,{error:c}),colorType:"danger"})})},gt=({api:e,allProps:t,antdTreeProps:o})=>{const s=C(e,t,!1),n=C(e,t,!0);return N.jsxs("div",{className:"extended-tree-container",children:[N.jsx(ke,{isLoading:e.getIsLoading(),notHideContent:!0,spinStyle:{height:"100%"},language:t.language,children:N.jsxs(xe,{style:{display:"flex",flexDirection:"column",...t.buttonsRowWrapperStyle},children:[N.jsx(Oe,{style:{zIndex:15},children:N.jsx(rt,{api:e,treeProps:t})}),N.jsx(dt,{treeApi:e,allProps:t,antdTreeProps:o})]})}),!t.disabled&&s?N.jsx(h,{...s,apiRef:e.getEditFormApi()}):null,!t.disabled&&n?N.jsx(h,{...n,apiRef:e.getEditGroupFormApi()}):null]})},Kt=e=>{const[t,o]=he(e),[,s]=ft(t),n=et({props:t,setProps:o});return N.jsx(gt,{allProps:t,antdTreeProps:s,api:n})},ft=e=>i.useMemo(()=>{const[t,o]=Ge(e,{id:!0,buttons:!0,buttonsIconsOnly:!0,buttonsPosition:!0,buttonsSize:!0,confirmDelete:!0,editFormProps:!0,editGroupFormProps:!0,language:!0,readOnly:!0,deleteMessage:!0,translation:!0,apiRef:!0,headerLabel:!0,responsiveBreakpoint:!0,buttonsRowStyle:!0,buttonsRowStyles:!0,buttonsRowWrapperStyle:!0,dataSet:!0,dataMutator:!0,noDeselect:!0,groupsMode:!0,selectNewNode:!0,confirmMove:!0,nodeMoveMessage:!0,draggableOrder:!0,sortComparator:!0,sortOnChange:!0,onDataSetChanged:!0,nodeDeleteMessage:!0,onDelete:!0,onNodeMove:!0,fieldNames:!0,defaultCheckedKeys:!0,checkedKeys:!0,defaultExpandedKeys:!0,expandedKeys:!0,defaultSelectedKeys:!0,selectedKeys:!0});return[t,{...o,fieldNames:t.fieldNames}]},[e]);export{Kt as T};
