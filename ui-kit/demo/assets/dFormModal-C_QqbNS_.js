import{r as d,j as w}from"./index-B5poLpDm.js";import{u as S,t as b,c as k,d as A,e as M,f as T,a as v,m as B,P as O}from"./buttonsRow-aX3TQ5bu.js";import{e as D,r as I,z as j,u as x,a as C,f as g,b as R,D as E,E as U,g as _}from"./dForm-vrGhQ6Lh.js";import{m as y}from"./messageBox-1o2XjDyt.js";import{M as G}from"./modal-tHBgt86o.js";const H=(e,n)=>{const t={},s={};for(const u in e)n[u]?t[u]=e[u]:s[u]=e[u];return[t,s]},W={...D,cancelChangesQn:"Cancel the changes made?",viewing:"Viewing",creating:"Creating",editing:"Editing",cloning:"Cloning"},z={...I,cancelChangesQn:"Отменить сделанные изменения?",viewing:"Просмотр",creating:"Создание",editing:"Редактирование",cloning:"Клонирование"},Q={...j,cancelChangesQn:"取消已做的更改？",viewing:"查看",creating:"创建",editing:"编辑",cloning:"克隆"},F={en_US:W,ru_RU:z,zh_CN:Q},$=e=>x(e.language,F,e.translation),K=(e,n)=>{const t=N(e,n),[s,u]=d.useState(t);return d.useEffect(()=>{u(t)},[t]),[s,u]},N=(e,n)=>d.useMemo(()=>{const t=e.formMode??"create",s=e.title;return s||(t==="view"?n.t("viewing"):t==="create"?n.t("creating"):t==="clone"?n.t("cloning"):t==="update"?n.t("editing"):"&nbsp;")},[n,e.formMode,e.title]),P=e=>()=>e,V=e=>n=>{e(n)},q=(e,n)=>e?Object.prototype.hasOwnProperty.call(e,n):!1,J=(e,n)=>{const t=new Map,s=(o,c)=>{if(!o)return o;if(t.has(o))return t.get(o);const l={};t.set(o,l);for(const a in o){if(!q(o,a))continue;const i=o[a];!i||typeof i!="object"||n?l[a]=i:l[a]=C(i)?u(i):s(i)}return l},u=(o,c)=>{const l=[];for(let a=0;a<o.length;a++){const i=o[a];!i||typeof i!="object"||n?l[a]=i:l[a]=C(i)?u(i):s(i)}return l};return typeof e!="object"||e===null?e:C(e)?u(e):s(e)},L=e=>(n,t)=>{var l,a;if(!n){console.warn("The form mode is not set");return}const s=(t==null?void 0:t.dataSet)??e.getProps().dataSet,u=s?J(s):void 0,o=e.getProps(),c={open:!0,formMode:n,dataSet:u,buttons:{ok:{disabled:!0}},...t};((l=o.onOpen)==null?void 0:l.call(o,e,u,c,new g))!==!1&&((a=t==null?void 0:t.onOpen)==null?void 0:a.call(t,e,u,c,new g))!==!1&&(e.updateProps(c),setTimeout(()=>{var r;const i=e.getProps();(r=i.onOpened)==null||r.call(i,e,i.dataSet,new g)},0))},X=e=>()=>{var t,s;const n=e.getProps();if(((t=n.onClosing)==null?void 0:t.call(n,e,new g))===!1)return!1;e.updateProps({open:!1}),(s=n.onClosed)==null||s.call(n,e,new g)},Y=(e,n)=>()=>{var t,s;if(((t=n.onClosing)==null?void 0:t.call(n,e,new g))!==!1){if(e.model.isFormDirty()&&n.confirmChanges){y.confirm({language:n.language,content:n.closeFormConfirmMessage??e.t("cancelChangesQn"),okText:e.t("yes"),cancelText:e.t("no"),onOk:()=>{var u;(u=n.onCancel)==null||u.call(n,e,new g),e.forceClose()}});return}(s=n.onCancel)==null||s.call(n,e,new g),e.forceClose()}},Z=({props:e,setProps:n})=>{const[t]=d.useState(e.apiRef||{});t.getId=S(e.formId??"dFormModal-"+b()),t.getButtonsApi=R(),t.getProps=k(e),t.setProps=A(n),t.updateProps=M(e,n),t.getIsMounted=T(),t.t=$(e),t.open=L(t),t.close=Y(t,e),t.forceClose=X(t);const[s,u]=K(e,t);return t.getTitle=P(s),t.setTitle=V(u),t},p=({buttons:e,formApi:n,formProps:t,modalFormProps:s})=>{const u=s.modalProps;return w.jsx(G,{open:s.open,maskProps:{style:{zIndex:1060}},wrapProps:{style:{zIndex:1060}},modalId:n.getId(),centered:!0,maskClosable:!1,keyboard:!1,destroyOnClose:!0,title:n.getTitle(),onCancel:n.close,footer:w.jsx(v,{buttons:e,apiRef:n.getButtonsApi(),color:t.colorType,arrowsSelection:t.arrowsButtonsSelection,style:t.buttonsRowStyle,styles:t.buttonsRowStyles,context:n}),height:s.height,maxHeight:s.maxHeight,minHeight:s.minHeight,width:s.width,maxWidth:s.maxWidth,minWidth:s.minWidth,...u,children:s.open?w.jsx(E,{apiRef:n,...t,formStyle:{height:"100%",width:"100%",...t.formStyle},containerStyle:{height:"100%",...t.containerStyle},_overriddenApi:{getId:!0,t:!0,getButtonsApi:!0,getProps:!0,setProps:!0,updateProps:!0,getIsMounted:!0}}):null})},ee=e=>d.useMemo(()=>({...e,...{onDataFetchError:(t,s,u)=>{var c;if((c=e==null?void 0:e.onDataFetchError)==null||c.call(e,t,s,u),u.isPrevented())return;u.preventOriginal();const o=y.confirm({language:e.language,title:s.t("error"),content:w.jsx(U,{error:t,extraMessage:s.t("tryAgainQt")}),colorType:"danger",buttons:{ok:{onClick:()=>{o.destroy(),s.model.fetchData()}},cancel:{onClick:()=>{var l;o.destroy(),(l=s.forceClose)==null||l.call(s)}}}})},onSubmit:(t,s,u,o)=>{var l,a,i,r,f,h,m;const c=(l=e==null?void 0:e.onSubmit)==null?void 0:l.call(e,t,s,u,o);return o.isPrevented()||(o.preventOriginal(),(i=(a=u.getButtonsApi()).disabled)==null||i.call(a,"ok",!0),(f=(r=u.getButtonsApi()).disabled)==null||f.call(r,"cancel",!0),e.confirmChanges||(m=(h=u.getButtonsApi()).loading)==null||m.call(h,"ok",!0)),c},onSubmitSuccess:(t,s,u,o,c)=>{var l;(l=e==null?void 0:e.onSubmitSuccess)==null||l.call(e,t,s,u,o,c),!c.isPrevented()&&o.forceClose()},onSubmitComplete:(t,s,u,o,c)=>{var l,a,i,r,f,h,m;(l=e==null?void 0:e.onSubmitComplete)==null||l.call(e,t,s,u,o,c),!c.isPrevented()&&(c.preventOriginal(),(i=(a=o.getButtonsApi()).disabled)==null||i.call(a,"ok",!1),(f=(r=o.getButtonsApi()).disabled)==null||f.call(r,"cancel",!1),(m=(h=o.getButtonsApi()).loading)==null||m.call(h,"ok",!1))}}}),[e]),te=(e,n)=>d.useMemo(()=>{const t={ok:{position:"right",active:n.formMode!=="view",hidden:n.formMode==="view",title:e.t("ok"),disabled:!0,hotKeys:[{key:"enter",ctrl:!0},{key:"s",ctrl:!0},{key:"ы",ctrl:!0}],onClick:()=>{e.submitForm()}},cancel:{position:"right",title:e.t("cancel"),hotKeys:[{key:"escape"}],active:n.formMode==="view",onClick:()=>{e.close()}}};return B(t,n.buttons)},[e,n.buttons,n.formMode]),ce=e=>{_();const[n,t]=O(e),s=ee(n),[,u]=ne(s),o=Z({props:s,setProps:t}),c=te(o,s);return w.jsx(p,{formApi:o,modalFormProps:s,formProps:u,buttons:c})},ne=e=>d.useMemo(()=>{const[n,t]=H(e,{closeFormConfirmMessage:!0,modalProps:!0,title:!0,open:!0,width:!0,maxWidth:!0,minWidth:!0,height:!0,minHeight:!0,maxHeight:!0,onCancel:!0,onOpen:!0,onClosed:!0,onClosing:!0,onOpened:!0,language:!0,translation:!0});return t.buttons=null,[n,{...t,language:e.language,translation:e.translation}]},[e]);export{ce as D,J as m,H as s};
