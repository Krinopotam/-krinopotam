import{r as l,A as G,_ as z,R as O,o as re,v as Re,a as ce,n as U,bO as ae,j as h,bP as ve}from"./index-353109d5.js";import{b as le,I as E,G as ue,m as X,c as ie,M as ke,P as Se,O as Fe,d as de,f as Pe,q as pe,L as Oe,t as Ke,e as Ee}from"./index-1664f5a0.js";import{M as Te,D as te}from"./dFormModal-cd36bfcf.js";import{E as je}from"./EyeOutlined-da2ead67.js";import{m as Ne,E as ge}from"./docco-60b84056.js";import{u as Ie,T as Me,S as Le,f as fe,F as Be,a as He,d as Ge,e as ze,C as _e,P as Ve,D as $e}from"./DeleteOutlined-c8bbeae5.js";var We={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 444H820V330.4c0-17.7-14.3-32-32-32H473L355.7 186.2a8.15 8.15 0 00-5.5-2.2H96c-17.7 0-32 14.3-32 32v592c0 17.7 14.3 32 32 32h698c13 0 24.8-7.9 29.7-20l134-332c1.5-3.8 2.3-7.9 2.3-12 0-17.7-14.3-32-32-32zM136 256h188.5l119.6 114.4H748V444H238c-13 0-24.8 7.9-29.7 20L136 643.2V256zm635.3 512H159l103.3-256h612.4L771.3 768z"}}]},name:"folder-open",theme:"outlined"};const qe=We;var Ue=function(t,n){return l.createElement(G,z({},t,{ref:n,icon:qe}))};const Xe=l.forwardRef(Ue);var Je={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M300 276.5a56 56 0 1056-97 56 56 0 00-56 97zm0 284a56 56 0 1056-97 56 56 0 00-56 97zM640 228a56 56 0 10112 0 56 56 0 00-112 0zm0 284a56 56 0 10112 0 56 56 0 00-112 0zM300 844.5a56 56 0 1056-97 56 56 0 00-56 97zM640 796a56 56 0 10112 0 56 56 0 00-112 0z"}}]},name:"holder",theme:"outlined"};const Qe=Je;var Ye=function(t,n){return l.createElement(G,z({},t,{ref:n,icon:Qe}))};const Ze=l.forwardRef(Ye),ne=4;function Ae(e){const{dropPosition:t,dropLevelOffset:n,prefixCls:o,indent:s,direction:r="ltr"}=e,c=r==="ltr"?"left":"right",a=r==="ltr"?"right":"left",u={[c]:-n*s+ne,[a]:0};switch(t){case-1:u.top=-3;break;case 1:u.bottom=-3;break;default:u.bottom=-3,u[c]=s+ne;break}return O.createElement("div",{style:u,className:`${o}-drop-indicator`})}const et=O.forwardRef((e,t)=>{const{getPrefixCls:n,direction:o,virtual:s,tree:r}=O.useContext(re),{prefixCls:c,className:a,showIcon:u=!1,showLine:i,switcherIcon:d,blockNode:f=!1,children:b,checkable:y=!1,selectable:R=!0,draggable:D,motion:p,style:I}=e,w=n("tree",c),T=n(),j=p??Object.assign(Object.assign({},Re(T)),{motionAppear:!1}),m=Object.assign(Object.assign({},e),{checkable:y,selectable:R,showIcon:u,motion:j,blockNode:f,showLine:!!i,dropIndicatorRender:Ae}),[N,V,k]=Ie(w),C=O.useMemo(()=>{if(!D)return!1;let x={};switch(typeof D){case"function":x.nodeDraggable=D;break;case"object":x=Object.assign({},D);break}return x.icon!==!1&&(x.icon=x.icon||O.createElement(Ze,null)),x},[D]),S=x=>O.createElement(Le,{prefixCls:w,switcherIcon:d,treeNodeProps:x,showLine:i});return N(O.createElement(Me,Object.assign({itemHeight:20,ref:t,virtual:s},m,{style:Object.assign(Object.assign({},r==null?void 0:r.style),I),prefixCls:w,className:ce({[`${w}-icon-hide`]:!u,[`${w}-block-node`]:f,[`${w}-unselectable`]:!R,[`${w}-rtl`]:o==="rtl"},r==null?void 0:r.className,a,V,k),direction:o,checkable:y&&O.createElement("span",{className:`${w}-checkbox-inner`}),selectable:R,switcherIcon:S,draggable:C}),b))}),he=et;var P;(function(e){e[e.None=0]="None",e[e.Start=1]="Start",e[e.End=2]="End"})(P||(P={}));function J(e,t,n){const{key:o,children:s}=n;function r(c){const a=c[o],u=c[s];t(a,c)!==!1&&J(u||[],t,n)}e.forEach(r)}function tt(e){let{treeData:t,expandedKeys:n,startKey:o,endKey:s,fieldNames:r}=e;const c=[];let a=P.None;if(o&&o===s)return[o];if(!o||!s)return[];function u(i){return i===o||i===s}return J(t,i=>{if(a===P.End)return!1;if(u(i)){if(c.push(i),a===P.None)a=P.Start;else if(a===P.Start)return a=P.End,!1}else a===P.Start&&c.push(i);return n.includes(i)},fe(r)),c}function $(e,t,n){const o=U(t),s=[];return J(e,(r,c)=>{const a=o.indexOf(r);return a!==-1&&(s.push(c),o.splice(a,1)),!!o.length},fe(n)),s}var oe=globalThis&&globalThis.__rest||function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(n[o[s]]=e[o[s]]);return n};function nt(e){const{isLeaf:t,expanded:n}=e;return t?l.createElement(Be,null):n?l.createElement(Xe,null):l.createElement(ae,null)}function se(e){let{treeData:t,children:n}=e;return t||ze(n)}const ot=(e,t)=>{var{defaultExpandAll:n,defaultExpandParent:o,defaultExpandedKeys:s}=e,r=oe(e,["defaultExpandAll","defaultExpandParent","defaultExpandedKeys"]);const c=l.useRef(),a=l.useRef(),u=()=>{const{keyEntities:k}=He(se(r));let C;return n?C=Object.keys(k):o?C=Ge(r.expandedKeys||s||[],k):C=r.expandedKeys||s,C},[i,d]=l.useState(r.selectedKeys||r.defaultSelectedKeys||[]),[f,b]=l.useState(()=>u());l.useEffect(()=>{"selectedKeys"in r&&d(r.selectedKeys)},[r.selectedKeys]),l.useEffect(()=>{"expandedKeys"in r&&b(r.expandedKeys)},[r.expandedKeys]);const y=(k,C)=>{var S;return"expandedKeys"in r||b(k),(S=r.onExpand)===null||S===void 0?void 0:S.call(r,k,C)},R=(k,C)=>{var S;const{multiple:x,fieldNames:M}=r,{node:De,nativeEvent:F}=C,{key:L=""}=De,B=se(r),H=Object.assign(Object.assign({},C),{selected:!0}),Ce=(F==null?void 0:F.ctrlKey)||(F==null?void 0:F.metaKey),xe=F==null?void 0:F.shiftKey;let v;x&&Ce?(v=k,c.current=L,a.current=v,H.selectedNodes=$(B,v,M)):x&&xe?(v=Array.from(new Set([].concat(U(a.current||[]),U(tt({treeData:B,expandedKeys:f,startKey:L,endKey:c.current,fieldNames:M}))))),H.selectedNodes=$(B,v,M)):(v=[L],c.current=L,a.current=v,H.selectedNodes=$(B,v,M)),(S=r.onSelect)===null||S===void 0||S.call(r,v,H),"selectedKeys"in r||d(v)},{getPrefixCls:D,direction:p}=l.useContext(re),{prefixCls:I,className:w,showIcon:T=!0,expandAction:j="click"}=r,m=oe(r,["prefixCls","className","showIcon","expandAction"]),N=D("tree",I),V=ce(`${N}-directory`,{[`${N}-directory-rtl`]:p==="rtl"},w);return l.createElement(he,Object.assign({icon:nt,ref:t,blockNode:!0},m,{showIcon:T,expandAction:j,prefixCls:N,className:V,expandedKeys:f,selectedKeys:i,onSelect:R,onExpand:y}))},st=l.forwardRef(ot),rt=st,Q=he;Q.DirectoryTree=rt;Q.TreeNode=_e;const ct=Q;var at={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880.1 154H143.9c-24.5 0-39.8 26.7-27.5 48L349 597.4V838c0 17.7 14.2 32 31.8 32h262.4c17.6 0 31.8-14.3 31.8-32V597.4L907.7 202c12.2-21.3-3.1-48-27.6-48zM603.4 798H420.6V642h182.9v156zm9.6-236.6l-9.5 16.6h-183l-9.5-16.6L212.7 226h598.6L613 561.4z"}}]},name:"filter",theme:"outlined"};const lt=at;var ut=function(t,n){return l.createElement(G,z({},t,{ref:n,icon:lt}))};const it=l.forwardRef(ut);var dt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"}}]},name:"menu",theme:"outlined"};const ft=dt;var ht=function(t,n){return l.createElement(G,z({},t,{ref:n,icon:ft}))};const bt=l.forwardRef(ht),be=(e,t,n)=>{if(!t)return;const o=e.gridProps;return e.setCurrentDataFetchHandler(t,n),(s,r,c)=>new Promise((a,u)=>{const i={...c,...n},d=t(i,e);if(typeof d>"u"&&a(W(o,{data:[]})),!le(d)){E(d)?a(W(o,{data:d})):u(new Error);return}d.then(f=>{e.getIsMounted()&&a(W(o,f))},f=>{u(f)})})},W=(e,t)=>e.pagination||e.progressiveLoad?{data:t.data,last_page:t.last_page??1}:t.data;var mt=function(){var e=l.useRef(!1);return l.useEffect(function(){return e.current=!1,function(){e.current=!0}},[]),e};const yt=mt,wt=({gridApi:e,props:t,tableRef:n,editFormApi:o,selectionFormApi:s,buttonsApi:r,setColumnsDialog:c})=>{const a=l.useRef(void 0),u=l.useRef(),i=l.useRef(),[d,f]=l.useState(!1),b=yt();return Dt(a,t.dataSet),e.gridProps=t,e.tableApi=n.current,e.editFormApi=o,e.selectionFormApi=s,e.buttonsApi=r,e.getIsMounted=xt(b),e.getId=Ct(e),e.getDataSet=Rt(a,e),e.setDataSet=vt(a,e),e.getIsLoading=kt(d),e.setIsLoading=St(f),e.setActiveRowKey=Ft(e),e.getActiveRowKey=Pt(e),e.getActiveNode=pt(e),e.getActiveRow=Ot(e),e.getNextRowKey=Kt(e),e.getPrevRowKey=Et(e),e.getSelectedRowKeys=Tt(e),e.getSelectedNodes=gt(e),e.getSelectedRows=It(e),e.setSelectedRowKeys=jt(e),e.setSelectedRows=Nt(e),e.getNodeByKey=Mt(e),e.getRowByKey=Lt(e),e.insertRows=Bt(a,e),e.updateRows=Ht(a,e),e.removeRowsByKeys=_t(a,e),e.removeRows=Vt(e),e.deleteRows=$t(e),e.fetchData=Wt(e),e.retryFetchData=Xt(e),e.setCurrentDataFetchHandler=qt(u,i),e.getCurrentDataFetchHandler=Ut(u,i),e.getRowData=Jt(e),e.openColumnDialog=Qt(e,c),e},Dt=(e,t)=>{const n=l.useRef(void 0);n.current!==t&&(n.current=t,e.current=t)},Ct=e=>{const[t]=l.useState(e.gridProps.id??"grid-"+ue());return l.useCallback(()=>t,[t])},xt=e=>l.useCallback(()=>!e.current,[e]),Rt=(e,t)=>l.useCallback(()=>t.tableApi?t.tableApi.getData():e.current??void 0,[e,t.tableApi]),vt=(e,t)=>l.useCallback(n=>{var o,s,r,c,a,u;t.tableApi&&(e.current=n??void 0,(o=t.tableApi)==null||o.deselectRow(),(s=t.tableApi)==null||s.clearData(),(r=e.current)!=null&&r.length&&((c=t.tableApi)==null||c.setData(e.current)),(u=(a=t.gridProps).onDataChanged)==null||u.call(a,e.current,t))},[e,t]),kt=e=>l.useCallback(()=>e,[e]),St=e=>l.useCallback(t=>{setTimeout(()=>{e(t)},0)},[e]),Ft=e=>l.useCallback((t,n,o)=>{e.tableApi&&e.tableApi.setActiveRowByKey(t,n,o)},[e]),Pt=e=>l.useCallback(()=>{var t,n;return(n=(t=e.tableApi)==null?void 0:t.getActiveRowKey)==null?void 0:n.call(t)},[e]),pt=e=>l.useCallback(()=>{var t,n;return(n=(t=e.tableApi)==null?void 0:t.getActiveRow)==null?void 0:n.call(t)},[e]),Ot=e=>l.useCallback(()=>{var t;return(t=e.getActiveNode())==null?void 0:t.getData()},[e]),Kt=e=>l.useCallback((t,n)=>{var s;if(!e.tableApi||!t)return;n||(n=1);let o=(s=e.tableApi)==null?void 0:s.getRow(t);if(o){for(let r=0;r<n;r++){const c=o==null?void 0:o.getNextRow();if(!c)return o.getData().id;o=c}return o.getData().id}},[e.tableApi]),Et=e=>l.useCallback((t,n)=>{var s;if(!e.tableApi||!t)return;n||(n=1);let o=(s=e.tableApi)==null?void 0:s.getRow(t);if(o){for(let r=0;r<n;r++){const c=o==null?void 0:o.getPrevRow();if(!c)return o.getData().id;o=c}return o.getData().id}},[e.tableApi]),Tt=e=>{const t=l.useRef([]);return l.useCallback(()=>{if(!e.tableApi)return t.current;const n=e.tableApi.getSelectedData(),o=[];for(const s of n)o.push(s.id);return o},[e])},jt=e=>l.useCallback((t,n)=>{var s,r;if(!e.tableApi)return;(!t||n)&&((s=e.tableApi)==null||s.deselectRow());const o=E(t)?t:[t];(r=e.tableApi)==null||r.selectRow(o)},[e]),Nt=e=>l.useCallback((t,n)=>{if(!e.tableApi)return;if(!t)return e.setSelectedRowKeys(void 0,n);const o=[];for(const s of t)o.push(s.id);e.setSelectedRowKeys(o,n)},[e]),gt=e=>l.useCallback(()=>{var t,n;return((n=(t=e.tableApi)==null?void 0:t.getSelectedRows)==null?void 0:n.call(t))??[]},[e]),It=e=>l.useCallback(()=>{var t,n;return((n=(t=e.tableApi)==null?void 0:t.getSelectedData)==null?void 0:n.call(t))??[]},[e]),Mt=e=>l.useCallback(t=>{var n;if(!(!t||!e.tableApi))return(n=e.tableApi)==null?void 0:n.getRow(t)},[e]),Lt=e=>l.useCallback(t=>{var n;return(n=e.getNodeByKey(t))==null?void 0:n.getData()},[e]),Bt=(e,t)=>l.useCallback((n,o,s,r)=>{var d,f;const c=t.tableApi;if(!c)return;const a=t.gridProps.dataTree,u=o==="above",i=E(n)?[...n]:[n];for(const b of i)a?Gt(t,[b],o,s):c.addData([b],u,s).then();e.current=c.getData()||[],(f=(d=t.gridProps).onDataChanged)==null||f.call(d,e.current,t),r&&i[0]&&t.setActiveRowKey(i[0].id,!0,"center"),c.setTableBodyFocus()},[e,t]),Ht=(e,t)=>l.useCallback((n,o)=>{var c,a,u;if(!t.tableApi)return;const s=t.gridProps.dataTree,r=E(n)?[...n]:[n];for(const i of r)s?zt(t,i):t.tableApi.updateData([i]).then();e.current=((c=t.tableApi)==null?void 0:c.getData())||[],(u=(a=t.gridProps).onDataChanged)==null||u.call(a,e.current,t),o&&r[0]&&t.setActiveRowKey(r[0].id,!0,"center"),t.tableApi.setTableBodyFocus()},[e,t]),me=(e,t)=>{if(!e.tableApi)return;const n=e.tableApi.options.dataTreeParentField,o=e.tableApi.options.index;if(!o||!n||!t[n])return;let s;if(typeof t[n]=="string"||typeof t[n]=="number"?s=t[n]:typeof t[n]=="object"&&(s=t[n][o]),!!s)return e.tableApi.getRow(s)||void 0},Gt=(e,t,n,o)=>{var c;if(!e.tableApi)return;if(!e.gridProps.dataTree){console.warn("TreeData mode is disabled. Tree row updating not available");return}const s=n==="above",r=E(t)?[...t]:[t];for(const a of r){const u=me(e,a);u?(u.addTreeChild(a),Y(u),u.reformat()):(c=e.tableApi)==null||c.addData([a],s,o)}},zt=(e,t)=>{if(!e.tableApi)return;if(!e.gridProps.dataTree){console.warn("TreeData mode is disabled. Tree row updating not available");return}const n=e.tableApi.options.index,o=e.tableApi.options.dataTreeChildField;if(!n||!o)return;const s=E(t)?[...t]:[t];for(const r of s){const c=r[n],a=e.tableApi.getRow(c);if(!a){e.tableApi.addData([r]).then();continue}const u=a.getTreeParent(),i=me(e,r);if(!u&&!i||u&&i&&u.getData()[n]===i.getData()[n]){e.tableApi.updateData([r]).then();continue}if(r[o]=a.getData()[o],e.tableApi.deselectRow(a),e.tableApi.deleteRow(c),u&&u.reformat(),!i){e.tableApi.addData([r]).then();continue}i.addTreeChild(r),Y(i),i.reformat()}},Y=e=>{if(!e)return;const t=e.getTreeParent();Y(t),e.isTreeExpanded()||e.treeExpand()},_t=(e,t)=>l.useCallback(n=>{var u,i;const o=t.tableApi;if(!o)return;const s=o.options.index,r=E(n)?[...n]:[n];let c=!1,a=!1;for(const d of r){const f=o.getRow(d);if(!f)continue;c&&f===c&&(c=!1),a=f.getNextRow()||f.getPrevRow(),a&&(c=a);const b=o.options.dataTree?f.getTreeParent():!1;o.deselectRow(f),o.deleteRow(d),b&&b.reformat()}c&&s&&(c=o.getRow(c.getData()[s])),o.setActiveRow(c||null,!0,"bottom"),e.current=(o==null?void 0:o.getData())??[],(i=(u=t.gridProps).onDataChanged)==null||i.call(u,e.current,t),o.setTableBodyFocus()},[e,t]),Vt=e=>l.useCallback(t=>{const n=E(t)?[...t]:[t],o=[];for(const s of n)o.push(s.id);e.removeRowsByKeys(o)},[e]),$t=e=>l.useCallback(t=>{if(!t)return;const n=Array.isArray(t)?t:[t],o=e.gridProps;let s;const r=()=>{var a;const c=(a=o==null?void 0:o.onDelete)==null?void 0:a.call(o,n,e);if(le(c)){o.confirmDelete||e.setIsLoading(!0),c.then(()=>{e.getIsMounted()&&(e.removeRows(n),o.confirmDelete?s==null||s.destroy():e.setIsLoading(!1))}).catch(i=>{e.getIsMounted()&&(o.confirmDelete?s==null||s.destroy():e.setIsLoading(!1),X.alert({content:h.jsxs(h.Fragment,{children:[h.jsx("p",{children:h.jsx("b",{children:i.message})}),i.stack&&ie()?h.jsx("p",{children:i.stack}):""]}),colorType:"danger"}))});return}e.removeRows(n),s&&s.destroy()};o.confirmDelete?s=X.confirmWaiter({content:o.rowDeleteMessage??"Удалить выбранные строки?",onOk:r}):r()},[e]),Wt=e=>l.useCallback((t,n)=>{const o=e.tableApi;o&&(o.modules.page.dataChanging=!0,o.modules.ajax.setUrl("-"),t&&(o.modules.ajax.loaderPromise=be(e,t,n)),o.setData(void 0,n).then())},[e]),qt=(e,t)=>l.useCallback((n,o)=>{e.current=n,t.current=o},[e,t]),Ut=(e,t)=>l.useCallback(()=>[e.current,t.current],[e,t]),Xt=e=>l.useCallback(()=>{const[t,n]=e.getCurrentDataFetchHandler();t&&e.fetchData(t,n)},[e]),Jt=e=>l.useCallback((t,n,o,s,r)=>{const c=e.tableApi;if(!c||!t)return{};const a=s?{}:{...t.getData()};if(!c.options.dataTree)return a;const u=c.options.dataTreeParentField,i=c.options.dataTreeChildField;if(!r&&i&&delete a[i],!u||typeof a[u]<"u")return a;const d=o?t:t.getTreeParent();if(!d)return a;const f=d.getData();return!r&&i&&delete f[i],a[u]=d.getData(),a},[e]),Qt=(e,t)=>l.useCallback(n=>{t(n)},[t]),Yt=e=>l.useMemo(()=>{var s;const t=(s=e.gridProps)==null?void 0:s.editFormProps;if(!t)return;const n={...t},o=t==null?void 0:t.onSubmitSuccess;return n.onSubmitSuccess=(r,c,a)=>{if(o&&o(r,c,a)===!1)return!1;const u={...a.model.getFormDataSet(),...c},i=a.model.getFormMode();if(i==="create"||i==="clone"){u.id||(u.id=ue());const d=e.getActiveRowKey();e.insertRows(u,"below",d??void 0,!0)}else i==="update"&&e.updateRows(u,!0)},n},[e]),Zt=e=>{const[,t]=l.useState({}),n=e.gridProps.buttons,o=e.gridProps.buttonsSize??"small",s=e.gridProps.buttonsPosition??"right",r=e.gridProps.buttonsIconsOnly,c=e.getActiveRow(),a=e.getSelectedRows();e.buttonsApi.refreshButtons=At(t);const u=en(e),i=tn(e,c,a),d=nn(e),f=on(e,c,a),b=sn(e,c,a),y=cn(e,a),R=rn(e),D=an(e,e.tableApi),p=ln(e);return l.useMemo(()=>{var T;const w=ke({headerLabel:u,view:i,create:d,clone:f,update:b,select:R,delete:y,filterToggle:D,system:p},n);for(const j in w){const m=w[j];!m||j==="headerLabel"||(m.size=m.size??o,m.position=m.position??s,r&&(m.tooltip=m.tooltip??((T=m.title)==null?void 0:T.toString()),m.title=void 0),m.checkDisabled&&(m.disabled=!c||a.length!==1),m.checkHidden&&(m.hidden=!c||a.length!==1))}return w},[u,i,d,f,b,R,y,D,p,n,o,s,r,c,a.length])},At=e=>l.useCallback(()=>{e({})},[e]),en=e=>l.useMemo(()=>{const t=e.gridProps;if(t.headerLabel)return{weight:1,title:t.headerLabel,type:"element",position:"left"}},[e]),tn=(e,t,n)=>l.useMemo(()=>{var r;const o=e.gridProps,s=e.editFormApi;if(!(!o.editFormProps||!o.readOnly||((r=o.buttons)==null?void 0:r.view)===null))return{weight:100,title:"Просмотреть",tooltip:"Просмотреть запись",icon:h.jsx(je,{}),position:"right",disabled:!t||n.length!==1,hotKeys:[{key:"Enter"}],onClick:()=>{if(!e.getActiveRow())return;const c=_(e,!1);s.open("view",c)}}},[t,e,n.length]),nn=e=>l.useMemo(()=>{var o;const t=e.gridProps,n=e.editFormApi;if(!(!t.editFormProps||t.readOnly||((o=t.buttons)==null?void 0:o.create)===null))return{weight:110,title:"Создать",tooltip:"Создать новую запись",icon:h.jsx(Se,{}),position:"right",hotKeys:[{key:"Insert"}],onClick:()=>{const s=_(e,!0,!0);n.open("create",s)}}},[e]),on=(e,t,n)=>l.useMemo(()=>{var r;const o=e.gridProps,s=e.editFormApi;if(!(!o.editFormProps||o.readOnly||((r=o.buttons)==null?void 0:r.clone)===null))return{weight:120,title:"Клонировать",tooltip:"Клонировать запись",icon:h.jsx(Ne,{}),position:"right",disabled:!t||n.length!==1,hotKeys:[{key:"F9"}],onClick:()=>{if(!e.getActiveRow())return;const c=_(e,!1);s.open("clone",c)}}},[t,e,n.length]),sn=(e,t,n)=>l.useMemo(()=>{var r;const o=e.gridProps,s=e.editFormApi;if(!(!o.editFormProps||o.readOnly||((r=o.buttons)==null?void 0:r.update)===null))return{weight:130,title:"Редактировать",tooltip:"Редактировать запись",icon:h.jsx(ge,{}),position:"right",disabled:!t||n.length!==1,hotKeys:[{key:"Enter"},{key:"F2"}],onClick:()=>{if(!e.getActiveRow())return;const c=_(e,!1);s.open("update",c)}}},[t,e,n.length]),rn=e=>l.useMemo(()=>{var o;const t=e.gridProps,n=e.selectionFormApi;if(!(!t.selectionFormProps||t.readOnly||((o=t.buttons)==null?void 0:o.select)===null))return{weight:130,title:"Выбрать",tooltip:"Выбрать записи",icon:h.jsx(Ve,{}),position:"right",hotKeys:[{key:"Insert"}],onClick:()=>{const s=e.getDataSet();n.open("update",{select:s})}}},[e]),cn=(e,t)=>l.useMemo(()=>{var o;const n=e.gridProps;if(!(!n.editFormProps&&!n.selectionFormProps||n.readOnly||((o=n.buttons)==null?void 0:o.delete)===null))return{weight:140,title:"Удалить",tooltip:"Удалить запись",icon:h.jsx($e,{}),position:"right",colorType:"danger",disabled:!t||t.length===0,hotKeys:[{key:"Delete",ctrl:!0}],onClick:()=>{const s=e.getSelectedRows();e.deleteRows(s)}}},[e,t]),an=(e,t)=>l.useMemo(()=>{var o,s;if(((o=e.gridProps.buttons)==null?void 0:o.filterToggle)!==null&&t!=null&&t.isHeaderFilterAvailable())return{weight:1e3,icon:h.jsx(it,{}),position:"right",active:(s=e.tableApi)==null?void 0:s.isHeaderFilterVisible(),tooltip:"Фильтр",onClick:()=>{const r=t==null?void 0:t.toggleHeaderFilter();e.buttonsApi.updateButtons({filterToggle:{active:r}})}}},[e.buttonsApi,e.gridProps,e.tableApi,t]),_=(e,t,n)=>{const o=e.getActiveNode();return e.getRowData(o,!0,t,n)},ln=e=>l.useMemo(()=>{var n;if(((n=e.gridProps.buttons)==null?void 0:n.filterToggle)!==null)return{weight:2e3,expandIcon:h.jsx(bt,{}),position:"right",children:{toXlsx:{title:"Экспорт в Excel",onClick:()=>{ve(()=>import("./xlsx-5c181179.js"),[]).then(s=>{var r;window.XLSX=s,(r=e.tableApi)==null||r.download("xlsx","table.xlsx")})}},columns:{title:"Настройки столбцов",onClick:()=>{e.openColumnDialog(!0)}}}}},[e]),un=({gridApi:e})=>{const t=e.gridProps,n=Zt(e),[o,s]=l.useState(void 0);return l.useLayoutEffect(()=>{var c;const r=Fe(n)>0;(typeof o>"u"||o!==r)&&(s(r),(c=t==null?void 0:t.onMenuVisibilityChanged)==null||c.call(t,r,e))},[n,e,t,t==null?void 0:t.onMenuVisibilityChanged,o]),n?h.jsx("div",{style:{width:"100%",paddingBottom:8,paddingTop:8},children:h.jsx(de,{buttons:n,apiRef:e.buttonsApi,context:e})}):null},dn=(e,t)=>l.useMemo(()=>({tableBuilt:()=>{var n;(n=t==null?void 0:t.tableBuilt)==null||n.call(t),e.buttonsApi.refreshButtons()},dataLoading:n=>{var o,s,r;(o=t==null?void 0:t.dataLoading)==null||o.call(t,n),(r=(s=e.gridProps).onDataLoading)==null||r.call(s,n,e),e.gridProps.progressiveLoad||e.setIsLoading(!0)},dataLoaded:n=>{var o,s,r;(o=t==null?void 0:t.dataLoaded)==null||o.call(t,n),(r=(s=e.gridProps).onDataLoaded)==null||r.call(s,n,e),e.getIsMounted()&&(e.gridProps.progressiveLoad||e.setIsLoading(!1))},dataProcessed:n=>{var o,s,r;(o=t==null?void 0:t.dataProcessed)==null||o.call(t,n),(r=(s=e.gridProps).onDataProcessed)==null||r.call(s,n,e)},dataLoadError:n=>{var r,c,a;(r=t==null?void 0:t.dataLoadError)==null||r.call(t,n);const o=n;if((a=(c=e.gridProps).onDataLoadError)==null||a.call(c,o.message,o.code,e),!e.getIsMounted())return;e.setIsLoading(!1);const s=X.confirm({content:h.jsxs("div",{children:[h.jsx("p",{children:h.jsx("b",{children:n.message})}),n.stack&&ie()?h.jsx("p",{children:n.stack}):"",h.jsx("p",{children:"Попробовать снова?"})]}),colorType:"danger",buttons:{ok:{onClick:()=>{s.destroy(),e.retryFetchData()}}}})},rowDblClick:(n,o)=>{var s;(s=t==null?void 0:t.rowDblClick)==null||s.call(t,n,o),e.buttonsApi.triggerClick("update")},activeRowChanged:n=>{var o;(o=t==null?void 0:t.activeRowChanged)==null||o.call(t,n),e.buttonsApi.refreshButtons()},rowSelectionChanged:(n,o,s,r)=>{var c,a,u;(c=t==null?void 0:t.rowSelectionChanged)==null||c.call(t,n,o,s,r),(u=(a=e.gridProps).onSelectionChange)==null||u.call(a,n,o,s,r,e)}}),[t,e]),fn=({tableRef:e,gridApi:t,gridProps:n,tabulatorProps:o})=>{const s=dn(t,n.events),r=l.useRef(void 0),c=l.useCallback(d=>{e.current=d.current,t.tableApi=d.current,n.resizeHeightWithParent&&(r.current=hn(e,n.resizeHeightWithParent))},[t,n.resizeHeightWithParent,e]);l.useEffect(()=>()=>{var d;(d=r.current)==null||d.disconnect()},[]),l.useEffect(()=>{Pe.pushToStack(t.getId())},[t]);const a=l.useMemo(()=>be(t,n==null?void 0:n.onDataFetch),[t,n.onDataFetch]),u=l.useCallback((d,f)=>{var b;return(b=n.onDataFetching)==null?void 0:b.call(n,d,f,t)},[t,n.onDataFetching]),i=l.useCallback((d,f,b)=>{var y;return(y=n.onDataFetchResponse)==null?void 0:y.call(n,b,f,t)},[t,n.onDataFetchResponse]);return h.jsx(pe,{...o,id:t.getId(),layout:o.layout??"fitData",movableColumns:o.movableColumns!==!1,height:"100%",dataLoader:!1,onTableRef:c,dataTreeFilter:!0,data:n.dataSet,ajaxRequesting:n.onDataFetching?void 0:u,ajaxRequestFunc:n.onDataFetch?a:void 0,ajaxResponse:n.onDataFetchResponse?i:void 0,containerClassName:n.className,placeholder:n.placeholder??"Строки отсутствуют",events:s})},hn=(e,t)=>{var u,i;const n=(i=(u=e.current)==null?void 0:u.element)==null?void 0:i.closest(".tabulator-grid-container"),o=n==null?void 0:n.closest(t);if(!n||!o||n.style.height.endsWith("%"))return;let s=parseInt(n.style.height),r=o.getBoundingClientRect().height;const c=()=>{if(!e.current)return;const d=o.getBoundingClientRect().height;s=s+(d-r),n.style.height=(s>0?s:0)+"px",r=o.getBoundingClientRect().height},a=new ResizeObserver(c);return a.observe(o),a},bn=e=>{const[t]=l.useState({});return h.jsx(Te,{title:"Столбцы",destroyOnClose:!0,centered:!0,open:e.open,onCancel:()=>e.gridApi.openColumnDialog(!1),footer:h.jsx(yn,{formProps:e,dialogApi:t}),children:e.open&&h.jsx(mn,{dialogProps:e,dialogApi:t})})},mn=({dialogProps:e,dialogApi:t})=>{const n=e.gridApi.tableApi,[o,s]=l.useState([]),[r,c]=l.useState([]),[a,u]=l.useState([]);t.gridApi=e.gridApi,t.setNodes=u,t.setChecked=s,t.setExpanded=c,l.useEffect(()=>{const b=we(n.getColumns(!0));ye(t,b),wn(t)},[]);const i=Sn(t,s),d=kn(t),f=vn(t);return h.jsx(ct,{draggable:!0,blockNode:!0,showIcon:!0,defaultExpandAll:!0,checkable:!0,expandedKeys:r,checkedKeys:o,treeData:a,selectable:!1,onCheck:i,allowDrop:f,onDrop:d,onExpand:b=>{c(b)}})},yn=({formProps:e,dialogApi:t})=>h.jsx(de,{arrowsSelection:!0,buttons:{ok:{title:"OK",position:"right",active:!0,onClick:()=>Fn(e,t)},cancel:{title:"Отмена",position:"right",onClick:()=>{e.gridApi.openColumnDialog(!1)}},default:{title:"По умолчанию",position:"left",onClick:()=>Pn(e,t)}}}),ye=(e,t)=>{e.columnsDefsMap={};const n=(r,c)=>{var i;c||(c={val:0});let a=[];const u=[];for(const d of r){if(d.formatter==="rowSelection")continue;c.val++;const f=c.val.toString(),b={key:f,title:d.title};let y=d.visible!==!1;if((i=d.columns)!=null&&i.length){b.icon=h.jsx(ae,{});const[R,D]=n(d.columns,c);b.children=R,a=[...a,...D],D.length<d.columns.length&&(y=!1)}u.push(b),y&&a.push(f),e.columnsDefsMap[f]=d}return[u,a]},[o,s]=n(t);e.nodes=o,e.checked=s,e.setNodes(o),e.setChecked(s)},wn=e=>{const t=[];for(const n in e.columnsDefsMap)t.push(n);e.setExpanded(t)},Dn=e=>{const t=o=>{var c;const s=[];let r=!1;for(const a of o){const u=e.columnsDefsMap[a.key.toString()];if(u.visible=e.checked.indexOf(a.key)>-1,(c=a.children)!=null&&c.length){const[i,d]=t(a.children);u.columns=i,d&&(u.visible=!0)}else delete u.columns;u.visible&&(r=!0),s.push(u)}return[s,r]},[n]=t(e.nodes);return n},we=e=>{const t=[];for(const n of e){const o={...n.getDefinition()};o.visible=n.isVisible(),o.width=n.getWidth();const s=n.getSubColumns();s!=null&&s.length&&(o.columns=we(s)),t.push(o)}return t},Cn=e=>{const t=(n,o)=>{var r;const s=[];for(const c of n){const a={...o,...c};a.visible=a.visible!==!1,a.width||(a.width=0),(r=a.columns)!=null&&r.length&&(a.columns=t(a.columns,o)),s.push(a)}return s};return t(e.columns,e.columnDefaults??{})},xn=(e,t)=>{if(t.default&&e.gridApi.gridProps.persistence){const s=e.gridApi.gridProps.persistenceID??e.gridApi.getId();localStorage.removeItem(`tabulator-${s}-columns`)}const n=Dn(t),o=t.gridApi.tableApi;o==null||o.setColumnLayout(n),o!=null&&o.isHeaderFilterVisible()||o==null||o.toggleHeaderFilter(!1)},g=(e,t)=>{var n;for(const o of e){if(o.key===t)return o;if(!((n=o.children)!=null&&n.length))continue;const s=g(o.children,t);if(s)return s}},Z=(e,t)=>{var o;let n=0;for(const s of e){if(s.key===t)return e.splice(n,1),!0;(o=s.children)!=null&&o.length&&Z(s.children,t),n++}},K=(e,t,n)=>{var o;for(const s of e){if(s.key===t.key)return n;if(!((o=s.children)!=null&&o.length))continue;const r=K(s.children,t,s);if(r)return r}},A=(e,t,n)=>{const o=e,s=K(n.nodes,e);if((s==null?void 0:s.key)===(t==null?void 0:t.key))return o;if(s)return A(s,t,n)},ee=e=>{var n,o;if(!((n=e.children)!=null&&n.length))return e;const t=e.children[e.children.length-1];return(o=t.children)!=null&&o.length?ee(t):t},Rn=(e,t,n)=>{var s;if(!(t!=null&&t.children))return!1;const o=K(n.nodes,e);return t.key===(o==null?void 0:o.key)?(Z(n.nodes,e.key),(s=t.children)==null||s.unshift(e),!0):(console.warn("Drop on the content: target is another group"),!1)},q=(e,t,n,o)=>{if(!t)return!1;const s=K(o.nodes,e),r=K(o.nodes,t);if(!s&&r||s&&!r||(s==null?void 0:s.key)!==(r==null?void 0:r.key))return console.warn("Node and target node have different parents"),!1;let c=[];if(!s&&!r)c=o.nodes;else if((s==null?void 0:s.key)===(r==null?void 0:r.key))c=r.children;else return!1;Z(o.nodes,e.key);const a=c.indexOf(t);return a<0?!1:(c.splice(a+(n==="below"?1:0),0,e),!0)},vn=e=>{const t=n=>{const o=g(e.nodes,n.dragNode.key),s=g(e.nodes,n.dropNode.key);if(!o||!s)return!1;const r=K(e.nodes,o),c=K(e.nodes,s);if(n.dropPosition===-1)return r===c;if(n.dropPosition===0||n.dropPosition===1){if(!s.children&&r===c||s.children&&r===s)return!0;const a=A(s,r,e);if(!a)return!1;if(s===ee(a))return!0}return!1};return l.useCallback(t,[e])},kn=e=>{const t=n=>{const o=g(e.nodes,n.dragNode.key),s=g(e.nodes,n.node.key);if(!s||!o)return;const r=K(e.nodes,o);if(n.node.dragOverGapTop)q(o,s,"above",e);else{const c=A(s,r,e);c&&s===ee(c)?q(o,c,"below",e):s.children?Rn(o,s,e):q(o,s,"below",e)}e.setNodes([...e.nodes])};return l.useCallback(t,[e])},Sn=(e,t)=>l.useCallback(n=>{let o;Array.isArray(n)?o=n:o=[...n.checked,...n.halfChecked],e.checked=o,t(o)},[e,t]),Fn=(e,t)=>{xn(e,t),e.gridApi.openColumnDialog(!1)},Pn=(e,t)=>{const n=Cn(e.gridApi.gridProps);t.default=!0,ye(t,n)},pn=e=>l.useMemo(()=>{var s;const t=(s=e.gridProps)==null?void 0:s.selectionFormProps;if(!t)return;const n={...t},o=t==null?void 0:t.onSubmitSuccess;return n.onSubmitSuccess=(r,c,a)=>{if(o&&o(r,c,a)===!1)return!1;const u={...a.model.getFormDataSet(),...c},i=e.gridProps,d=u.select??[];if(!i.appendSelection)return e.setDataSet(d);const f=e.getDataSet()??[];for(const b of d)f.find(y=>y.id===b.id)||e.insertRows(b)},n},[e]),On=({tableRef:e,gridApi:t,gridProps:n,tabulatorProps:o,columnsDialog:s})=>{const r=Yt(t),c=pn(t);return h.jsxs("div",{className:"tabulator-grid-container",style:{height:n.height||void 0,minHeight:n.minHeight,maxHeight:n.maxHeight},children:[h.jsx(Oe,{isLoading:t.getIsLoading(),notHideContent:!0,spinStyle:{height:"100%"},children:h.jsxs(Ke,{style:{display:"flex",flexDirection:"column"},children:[h.jsx(un,{gridApi:t}),h.jsx(fn,{tableRef:e,gridApi:t,gridProps:n,tabulatorProps:o})]})}),h.jsx(bn,{open:s,gridApi:t}),r?h.jsx(te,{...r,apiRef:t.editFormApi}):null,c?h.jsx(te,{...c,apiRef:t.selectionFormApi}):null]})},Mn=e=>{var i,d;const t=Kn(e),n=l.useRef(),[o]=l.useState(((i=e.editFormProps)==null?void 0:i.apiRef)??{}),[s]=l.useState(((d=e.selectionFormProps)==null?void 0:d.apiRef)??{}),[r]=l.useState({}),[c]=l.useState(e.apiRef||{}),[a,u]=l.useState(!1);return wt({gridApi:c,props:e,tableRef:n,editFormApi:o,selectionFormApi:s,buttonsApi:r,setColumnsDialog:u}),h.jsx(On,{tableRef:n,gridApi:c,gridProps:e,tabulatorProps:t,columnsDialog:a})},Kn=e=>l.useMemo(()=>Ee(e,{apiRef:!0,id:!0,gridMode:!0,dataSet:!0,className:!0,headerLabel:!0,buttons:!0,buttonsSize:!0,buttonsPosition:!0,buttonsIconsOnly:!0,readOnly:!0,editFormProps:!0,selectionFormProps:!0,appendSelection:!0,noHover:!0,rowDeleteMessage:!0,confirmDelete:!0,placeholder:!0,onMenuVisibilityChanged:!0,onDataLoading:!0,onDataLoadError:!0,onDataLoaded:!0,onDataChanged:!0,onDataProcessed:!0,onDataFetch:!0,onDataFetching:!0,onDataFetchResponse:!0,onSelectionChange:!0,onDelete:!0,resizeHeightWithParent:!0})[1],[e]);export{Mn as T};
