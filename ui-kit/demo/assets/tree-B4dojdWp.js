import{r as i,j as N}from"./index-D4bHa_3o.js";import{O as k,n as M,h as x,i as I,j as O,k as B,l as T,m as j,o as L,p as P,q as Q,r as H,s as V,t as z,v as U,w as W,x as q,y as J,z as _,A as X,B as Y,C as Z,D as $,E as ee,F as te,G as oe,H as se,I as re,J as ne,K as de,L as ue,M as ce,N as ae,u as ie,a as le,b as ge,c as fe,d as pe,e as Ne,f as ye}from"./useApiGetGroupsOnly-T5Kwr76U.js";import{u as Ge,t as me,c as Re,d as Se,e as ve,b as Ae,h as Ke,k as be,m as F,f as we,P as xe}from"./modal-Cje67qL2.js";import{D as h,s as he}from"./dFormModal-BCjjhs8Y.js";import{u as De,a as K,b as Ce,t as Ee,E as Fe,L as ke}from"./dForm-3m-O6pho.js";import{o as Me}from"./defaultButtonsProps-D413j251.js";import{T as Ie}from"./index-BVoWYqDG.js";import{s as Oe}from"./index-ohDy-Hm0.js";const Be=e=>()=>e,Te=e=>t=>{e(t)},je=e=>()=>e,Le=e=>()=>e,Pe={view:"Просмотр",viewGroup:"Просмотр группы",viewRecord:"Просмотр записи",viewRecordsGroup:"Просмотр группы записей",create:"Создать",createRecord:"Создать запись",createGroup:"Создать группу",createRecordsGroup:"Создать группу записей",edit:"Редактировать",editGroup:"Редактировать группу",editRecord:"Редактировать запись",editRecordsGroup:"Редактировать группу записей",clone:"Клонировать",cloneGroup:"Клонировать группу",cloneRecord:"Клонировать запись",cloneRecordsGroup:"Клонировать группу записей",delete:"Удалить",deleteGroup:"Удалить группу",deleteRecord:"Удалить запись(и)",deleteRecordsGroup:"Удалить группу записей",select:"Выбрать",selectRecord:"Выбрать запись(и)",go:"Перейти",filter:"Фильтр",ok:"OK",cancel:"Отмена",tryAgainQt:"Попробовать еще раз?",deleteSelectedRecordQt:"Удалить выбранную запись?",moveRecordQt:"Удалить данную запись?",error:"Ошибка",dataNotFound:"Данные не найдены"},Qe={view:"View",viewGroup:"View group",viewRecord:"View record",viewRecordsGroup:"View records group",create:"Create",createRecord:"Create record",createGroup:"Create group",createRecordsGroup:"Create records group",edit:"Edit",editGroup:"Edit group",editRecord:"Edit record",editRecordsGroup:"Edit records group",clone:"Clone",cloneGroup:"Clone group",cloneRecord:"Clone record",cloneRecordsGroup:"Clone records group",delete:"Delete",deleteGroup:"Delete group",deleteRecord:"Delete record(s)",deleteRecordsGroup:"Delete records group(s)",select:"Select",selectRecord:"Select record(s)",go:"Go",filter:"Filter",ok:"OK",cancel:"Cancel",tryAgainQt:"Try again?",deleteSelectedRecordQt:"Delete selected record?",moveRecordQt:"Move the record?",error:"Error",dataNotFound:"Data not found"},He={view:"查看",viewGroup:"查看组",viewRecord:"查看记录",viewRecordsGroup:"查看记录组",create:"创建",createRecord:"创建记录",createGroup:"创建组",createRecordsGroup:"创建记录组",edit:"编辑",editGroup:"编辑组",editRecord:"编辑记录",editRecordsGroup:"编辑记录组",clone:"克隆",cloneGroup:"克隆组",cloneRecord:"克隆记录",cloneRecordsGroup:"克隆记录组",delete:"删除",deleteGroup:"删除组",deleteRecord:"删除记录",deleteRecordsGroup:"删除记录组",select:"选择",selectRecord:"选择记录",go:"前往",filter:"过滤",ok:"确定",cancel:"取消",tryAgainQt:"再试一次",deleteSelectedRecordQt:"删除选定的记录",moveRecordQt:"删除此记录",error:"错误",dataNotFound:"数据未找到"},Ve={ru:Pe,en:Qe,cn:He},ze=e=>De(e.language,Ve,e.translation),Ue=({dataMutator:e})=>i.useCallback(t=>{if(!e)return t;let o={...t};return e&&(o=e(o)),o},[e]),We=e=>()=>e,qe=e=>{const t=i.useRef(void 0),o=i.useRef(void 0);return s=>{const r=e.getSelectedKeys();if(t.current===r)return o.current;if(t.current=r,!r){o.current=void 0;return}const n=[];for(const d of r){const u=e.getNode(d,s);u&&n.push(u)}return o.current=n,n}},Je=(e,t)=>(o,s=!0,r=!1,n=void 0)=>{const d=e.getFieldNames(),u=typeof o=="object"?o[d.key]:o;if(!u)return;const a=n??e.getDataSet(),c=e.getSelectedKeys();if(r){const g=_e(u,s,c,a,d);e.setSelectedKeys(g);return}let l=[];if(s){if(c!=null&&c.includes(u))return;t?l=[...c??[],u]:l=[u]}else{if(!(c!=null&&c.includes(u)))return;t?l=c==null?void 0:c.filter(g=>g!==u):l=[]}e.setSelectedKeys(l)},_e=(e,t,o,s,r)=>{const n=k(e,s,r);if(!n||!s)return o;const d=[...o??[]],u=a=>{const c=a[r.key];if(!c)return;const l=d.indexOf(c);if(t){if(l>-1||a[r.disabled]||a[r.selectable]===!1)return;d.push(c)}else{if(l<0)return;d.splice(l,1)}if(K(a[r.children]))for(const g of a[r.children])u(g)};return u(n),d},Xe=e=>{const[t,o]=i.useState(D(e));return M(()=>{o(D(e))},[e]),[t,o]},D=e=>{if(e)return K(e)?e:[e]},Ye=e=>t=>{if(!t){e(void 0);return}K(t)?e(t):e([t])},Ze=e=>()=>e,$e=e=>t=>{setTimeout(()=>{e(t)},0)},et=({props:e,setProps:t})=>{var p,w;const[o]=i.useState(e.apiRef??{}),[s]=i.useState(((p=e.editFormProps)==null?void 0:p.apiRef)??{}),[r]=i.useState(((w=e.editGroupFormProps)==null?void 0:w.apiRef)??{}),[n,d]=i.useState(!1),[u,a]=i.useState(!1),[c,l]=Xe(e.selectedKeys),g=x(e)(),y=Ue(e),[f,G,m,S]=I(e.dataSet,g,y),[b,R]=O(e.expandedKeys,e.defaultExpandedKeys,e.defaultExpandAll,S),v={getId:Ge(e.id??"tree-"+me()),getProps:Re(e),setProps:Se(t),updateProps:ve(e,t),getIsMounted:Ae(),getFieldNames:x(e),getDataSet:B(f),setDataSet:T(G,e==null?void 0:e.onDataSetChanged),getGroupsOnly:j(o),sortTree:L(f,e.sortComparator,o),isDataPlainList:P(m),getEditFormApi:Le(s),getEditGroupFormApi:je(r),getSelectedKeys:We(c),setSelectedKeys:Ye(l),getSelectedNodes:qe(o),isNodeSelected:Q(o),selectNode:Je(o,e.multiple),getActiveNodeKey:H(o),getActiveNode:V(o),getExpandedKeys:z(b),setExpandedKeys:U(R),getExpandedNodes:W(o),isNodeExpanded:q(o),expandNode:J(o),collapseNode:_(o),toggleNode:X(o),expandParentNodes:Y(o),getNode:Z(o),getNodes:$(o),getNextNodeKey:ee(o),getPrevNodeKey:te(o),getNextNode:oe(o),getPrevNode:se(o),getParentNode:re(o),addNode:ne(o),updateNode:de(o),removeNode:ue(o),moveNode:ce(o),ensureNodeVisible:ae(o),t:ze(e),treeRef:i.useRef(null),getButtonsApi:Ce(),getIsReady:Be(n),setIsReady:Te(d),getIsLoading:Ze(u),setIsLoading:$e(a)};return Object.assign(o,v)},C=(e,t,o)=>i.useMemo(()=>{const s=o?t==null?void 0:t.editGroupFormProps:t==null?void 0:t.editFormProps;if(!s)return;const r={...s};t.language&&!r.language&&(r.language=t.language);const n=s==null?void 0:s.onSubmitSuccess;return r.onSubmitSuccess=(d,u,a,c,l)=>{var m;if(n==null||n(d,u,a,c,l),l.isPrevented())return;const g=c.model.getFormMode(),y=e.getFieldNames(),f={...u,...a};let G;f[y.parent]?G=(m=f[y.parent])==null?void 0:m[y.key]:f[y.parent]===null?G=void 0:G=e.getActiveNodeKey(),g==="create"||g==="clone"?(f[y.key]||(f[y.key]=Me()),e.addNode(f,G,"insideBottom",{ensureVisible:!0,select:!!t.selectNewNode,sortNodes:t.sortOnChange})):g==="update"&&e.updateNode(f,G,{ensureVisible:!0,sortNodes:t.sortOnChange})},r},[o,t==null?void 0:t.editFormProps,t==null?void 0:t.editGroupFormProps,t.language,t.selectNewNode,e]),tt=(e,t)=>{e.getButtonsApi().refreshButtons=ot();const o=e.getFieldNames(),s=e.getActiveNode(!0),r=!!(s!=null&&s.isLeaf)||!!(t.groupsMode&&!(s!=null&&s[o.isGroup])),n=t.buttons,d=t.buttonsSize??"small",u=t.buttonsPosition??"right",a=ie(t),c=le(e,t,r),l=ge(e,t,r),g=fe(e,t,s,A,r),y=pe(e,t,s,A,r),f=Ne(e,t,s,A,r),G=ye(e,t,s,r),m=st(e),S=rt(e);return i.useMemo(()=>{const R=Ke({headerLabel:a,view:g,create:c,createGroup:l,clone:y,update:f,delete:G,arrowUp:m,arrowDown:S},n);for(const v in R){const p=R[v];!p||v==="headerLabel"||p.type==="hotkey"||(p.size=p.size??d,p.position=p.position??u,p.checkDisabled&&(p.disabled=!s),p.checkHidden&&(p.hidden=!s))}return R},[a,g,c,l,y,f,G,m,S,n,d,u,s])},ot=()=>{const[,e]=i.useState({});return i.useCallback(()=>{e({})},[e])},A=e=>({...e}),st=e=>i.useMemo(()=>({type:"hotkey",hotKeys:[{key:"ArrowUp"}],onClick:()=>{var s;const t=(s=e.getSelectedKeys())==null?void 0:s[0],o=e.getPrevNodeKey(t);o&&e.setSelectedKeys([o])}}),[e]),rt=e=>i.useMemo(()=>({type:"hotkey",hotKeys:[{key:"ArrowDown"}],onClick:()=>{const t=e.getActiveNodeKey(),o=e.getNextNodeKey(t);o&&e.setSelectedKeys([o])}}),[e]),nt=({api:e,treeProps:t})=>{const o=tt(e,t);return i.useMemo(()=>o?N.jsx("div",{style:{width:"100%",padding:"8px"},children:N.jsx(be,{buttons:o,apiRef:e.getButtonsApi(),style:t.buttonsRowStyle,context:e,responsiveBreakpoint:t.responsiveBreakpoint,iconsOnly:t.buttonsIconsOnly})}):null,[o,e,t.buttonsIconsOnly,t.buttonsRowStyle,t.responsiveBreakpoint])},dt=({treeApi:e,allProps:t,antdTreeProps:o})=>{const s=ut(e),r=ct(e),n=at(e),d=lt(e),u=it(e);return N.jsx(Ie,{className:"draggable-tree",onDrop:d,allowDrop:u,...o,draggable:!t.readOnly&&t.draggable!==!1,ref:e.treeRef,treeData:e.getDataSet(),selectedKeys:e.getSelectedKeys(),expandedKeys:e.getExpandedKeys(),fieldNames:{key:"id",title:"title",children:"children",...t.fieldNames},onSelect:s,onExpand:r,onDoubleClick:n})},ut=e=>(t,o)=>{var r;const s=e.getProps();(!s.noDeselect||o.selected)&&(e.setSelectedKeys(t),(r=s.onSelect)==null||r.call(s,t,o))},ct=e=>(t,o)=>{var r;const s=e.getProps();e.setExpandedKeys(t),(r=s.onExpand)==null||r.call(s,t,o)},at=e=>(t,o)=>{var n,d;const s=e.getProps();s.onDoubleClick&&((n=s.onDoubleClick)==null||n.call(s,t,o));const r=e.getFieldNames();if(!s.disabled&&!s.readOnly&&(s.editFormProps||s.editGroupFormProps)){e.getButtonsApi().triggerClick("update");return}(d=o[r.children])!=null&&d.length&&e.toggleNode(o[r.key])},it=e=>t=>{const o=e.getProps(),s=e.getFieldNames();return o.groupsMode?o.draggableOrder?t.dropPosition<=0&&t.dropNode[s.isGroup]||t.dropPosition>0:t.dropPosition<=0&&t.dropNode[s.isGroup]:o.draggableOrder?!0:t.dropPosition===0},lt=e=>t=>{const o=e.getProps();let s="insideTop";if(t.dropToGap&&(s=t.dropPosition<0?"above":"below"),!t.dragNode)return;if(!o.confirmMove){E(t.dragNode,t.node,s,!0,e);return}const r=F.confirmWaiter({language:o.language,content:o.nodeMoveMessage??e.t("moveRecordQt"),onOk:()=>{E(t.dragNode,t.node,s,!0,e,r)},onCancel:()=>{r.destroy()}})},E=(e,t,o,s,r,n)=>{var a;const d=r.getProps(),u=(a=d==null?void 0:d.onNodeMove)==null?void 0:a.call(d,e,t,o,r);if(!Ee(u)){r.moveNode(e,t,o,{ensureVisible:s,sortNodes:d.sortOnChange}),n&&n.destroy();return}u.then(()=>{n==null||n.destroy(),r.getIsMounted()&&r.moveNode(e,t,o,{ensureVisible:s,sortNodes:d.sortOnChange})}).catch(c=>{n==null||n.destroy(),r.getIsMounted()&&F.alert({language:d.language,title:r.t("error"),content:N.jsx(Fe,{error:c}),colorType:"danger"})})},gt=({api:e,allProps:t,antdTreeProps:o})=>{const s=C(e,t,!1),r=C(e,t,!0);return N.jsxs("div",{className:"extended-tree-container",children:[N.jsx(ke,{isLoading:e.getIsLoading(),notHideContent:!0,spinStyle:{height:"100%"},children:N.jsxs(we,{style:{display:"flex",flexDirection:"column",...t.buttonsRowWrapperStyle},children:[N.jsx(Oe,{style:{zIndex:15},children:N.jsx(nt,{api:e,treeProps:t})}),N.jsx(dt,{treeApi:e,allProps:t,antdTreeProps:o})]})}),!t.disabled&&s?N.jsx(h,{...s,apiRef:e.getEditFormApi()}):null,!t.disabled&&r?N.jsx(h,{...r,apiRef:e.getEditGroupFormApi()}):null]})},At=e=>{const[t,o]=xe(e),[,s]=ft(t),r=et({props:t,setProps:o});return N.jsx(gt,{allProps:t,antdTreeProps:s,api:r})},ft=e=>i.useMemo(()=>{const[t,o]=he(e,{id:!0,buttons:!0,buttonsIconsOnly:!0,buttonsPosition:!0,buttonsSize:!0,confirmDelete:!0,editFormProps:!0,editGroupFormProps:!0,language:!0,readOnly:!0,deleteMessage:!0,translation:!0,apiRef:!0,headerLabel:!0,responsiveBreakpoint:!0,buttonsRowStyle:!0,buttonsRowWrapperStyle:!0,dataSet:!0,dataMutator:!0,noDeselect:!0,groupsMode:!0,selectNewNode:!0,confirmMove:!0,nodeMoveMessage:!0,draggableOrder:!0,sortComparator:!0,sortOnChange:!0,onDataSetChanged:!0,nodeDeleteMessage:!0,onDelete:!0,onNodeMove:!0,fieldNames:!0,defaultCheckedKeys:!0,checkedKeys:!0,defaultExpandedKeys:!0,expandedKeys:!0,defaultSelectedKeys:!0,selectedKeys:!0});return[t,{...o,fieldNames:t.fieldNames}]},[e]);export{At as T};
