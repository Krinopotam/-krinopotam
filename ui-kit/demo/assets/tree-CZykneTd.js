import{r as l,j as g}from"./index-CObHp3AH.js";import{F as P,n as B,u as D,a as M,b as I,c as O,d as L,e as T,f as j,h as V,i as H,j as U,k as z,l as Q,m as W,o as q,p as _,q as J,r as X,s as Y,t as Z,v as $,w as p,x as ee,y as te,z as oe,A as ne,B as re,C as de,D as se,E as ue}from"./useApiIsNodeSelected-DsZSnUgD.js";import{u as le,t as ce,e as ae,f as ie,g as fe,h as ge,m as me,a as k,b as ye,c as Ne,P as be}from"./modal-BBQwvlDP.js";import{r as Ge,D as v,s as Ae}from"./dFormModal-BBSecmha.js";import{u as Re,n as F,a as Se,t as Fe,E as Ke,L as xe}from"./dForm-DjwSwKfj.js";import{o as we,d as De,a as ve,b as Ee,c as he,e as Ce,f as ke,g as Pe}from"./defaultButtonsProps-DSb7WT6w.js";import{T as Be}from"./index-CVqHkW2e.js";import{s as Me}from"./index-ByCva3dC.js";const Ie=e=>()=>e,Oe=e=>t=>{e(t)},Le=e=>()=>e,Te=e=>()=>e,je={view:"Просмотр",viewRecord:"Просмотр записи",create:"Создать",createRecord:"Создать запись",createGroup:"Создать группу",createRecordsGroup:"Создать группу записей",edit:"Редактировать",editGroup:"Редактировать группу",editRecord:"Редактировать запись",editRecordsGroup:"Редактировать группу записей",clone:"Клонировать",cloneGroup:"Клонировать группу",cloneRecord:"Клонировать запись",cloneRecordsGroup:"Клонировать группу записей",delete:"Удалить",deleteGroup:"Удалить группу",deleteRecord:"Удалить запись(и)",deleteRecordsGroup:"Удалить группу записей",select:"Выбрать",selectRecord:"Выбрать запись(и)",go:"Перейти",filter:"Фильтр",ok:"OK",cancel:"Отмена",tryAgainQt:"Попробовать еще раз?",deleteSelectedRecordQt:"Удалить выбранную запись?",error:"Ошибка",dataNotFound:"Данные не найдены"},Ve={view:"View",viewRecord:"View record",create:"Create",createRecord:"Create record",createGroup:"Create group",createRecordsGroup:"Create records group",edit:"Edit",editGroup:"Edit group",editRecord:"Edit record",editRecordsGroup:"Edit records group",clone:"Clone",cloneGroup:"Clone group",cloneRecord:"Clone record",cloneRecordsGroup:"Clone records group",delete:"Delete",deleteGroup:"Delete group",deleteRecord:"Delete record(s)",deleteRecordsGroup:"Delete records group(s)",select:"Select",selectRecord:"Select record(s)",go:"Go",filter:"Filter",ok:"OK",cancel:"Cancel",tryAgainQt:"Try again?",deleteSelectedRecordQt:"Delete selected record?",error:"Error",dataNotFound:"Data not found"},He={view:"查看",viewRecord:"查看记录",create:"创建",createRecord:"创建记录",createGroup:"创建组",createRecordsGroup:"创建记录组",edit:"编辑",editGroup:"编辑组",editRecord:"编辑记录",editRecordsGroup:"编辑记录组",clone:"克隆",cloneGroup:"克隆组",cloneRecord:"克隆记录",cloneRecordsGroup:"克隆记录组",delete:"删除",deleteGroup:"删除组",deleteRecord:"删除记录",deleteRecordsGroup:"删除记录组",select:"选择",selectRecord:"选择记录",go:"前往",filter:"过滤",ok:"确定",cancel:"取消",tryAgainQt:"再试一次",deleteSelectedRecordQt:"删除选定的记录",error:"错误",dataNotFound:"数据未找到"},Ue={ru:je,en:Ve,cn:He},ze=e=>Re(e.language,Ue,e.translation),Qe=({dataMutator:e})=>l.useCallback(t=>{if(!e)return t;let o={...t};return e&&(o=e(o)),o},[e]),We=e=>()=>e,qe=e=>{const t=l.useRef(void 0),o=l.useRef(void 0);return n=>{const r=e.getSelectedKeys();if(t.current===r)return o.current;if(t.current=r,!r){o.current=void 0;return}const d=[];for(const s of r){const u=e.getNode(s,n);u&&d.push(u)}return o.current=d,d}},_e=(e,t)=>(o,n=!0,r=!1,d=void 0)=>{const s=e.getFieldNames(),u=typeof o=="object"?o[s.key]:o;if(!u)return;const c=d??e.getDataSet(),a=e.getSelectedKeys();if(r){const f=Je(u,n,a,c,s);e.setSelectedKeys(f);return}let i=[];if(n){if(a!=null&&a.includes(u))return;t?i=[...a??[],u]:i=[u]}else{if(!(a!=null&&a.includes(u)))return;t?i=a==null?void 0:a.filter(f=>f!==u):i=[]}e.setSelectedKeys(i)},Je=(e,t,o,n,r)=>{const d=P(e,n,r);if(!d||!n)return o;const s=[...o??[]],u=c=>{const a=c[r.key];if(!a)return;const i=s.indexOf(a);if(t){if(i>-1||c[r.disabled]||c[r.selectable]===!1)return;s.push(a)}else{if(i<0)return;s.splice(i,1)}if(F(c[r.children]))for(const f of c[r.children])u(f)};return u(d),s},Xe=e=>{const[t,o]=l.useState(E(e));return B(()=>{o(E(e))},[e]),[t,o]},E=e=>{if(e)return F(e)?e:[e]},Ye=e=>t=>{if(!t){e(void 0);return}F(t)?e(t):e([t])},Ze=e=>()=>e,$e=e=>t=>{setTimeout(()=>{e(t)},0)},pe=({props:e,setProps:t})=>{var x,w;const[o]=l.useState(e.apiRef??{}),[n]=l.useState(((x=e.editFormProps)==null?void 0:x.apiRef)??{}),[r]=l.useState(((w=e.editGroupFormProps)==null?void 0:w.apiRef)??{}),[d,s]=l.useState(!1),[u,c]=l.useState(!1),[a,i]=Xe(e.selectedKeys),f=D(e)(),N=Qe(e),[y,b,G,K]=M(e.dataSet,f,N),[R,S]=I(e.expandedKeys,e.defaultExpandedKeys,e.defaultExpandAll,K),m={getId:le(e.id??"tree-"+ce()),getProps:ae(e),setProps:ie(t),updateProps:fe(e,t),getIsMounted:ge(),getFieldNames:D(e),getDataSet:O(y),setDataSet:L(b,e==null?void 0:e.onDataSetChanged),isDataPlainList:T(G),getEditFormApi:Te(n),getEditGroupFormApi:Le(r),getSelectedKeys:We(a),setSelectedKeys:Ye(i),getSelectedNodes:qe(o),isNodeSelected:j(o),selectNode:_e(o,e.multiple),getActiveNodeKey:V(o),getActiveNode:H(o),getExpandedKeys:U(R),setExpandedKeys:z(S),getExpandedNodes:Q(o),isNodeExpanded:W(o),expandNode:q(o),collapseNode:_(o),toggleNode:J(o),expandParentNodes:X(o),getNode:Y(o),getNodes:Z(o),getNextNodeKey:$(o),getPrevNodeKey:p(o),getNextNode:ee(o),getPrevNode:te(o),getParentNode:oe(o),addNode:ne(o),updateNode:re(o),removeNode:de(o),moveNode:se(o),ensureNodeVisible:ue(o),t:ze(e),treeRef:l.useRef(null),getButtonsApi:Se(),getIsReady:Ie(d),setIsReady:Oe(s),getIsLoading:Ze(u),setIsLoading:$e(c)};return Object.assign(o,m)},h=(e,t,o)=>l.useMemo(()=>{const n=o?t==null?void 0:t.editGroupFormProps:t==null?void 0:t.editFormProps;if(!n)return;const r={...n};t.language&&!r.language&&(r.language=t.language);const d=n==null?void 0:n.onSubmitSuccess;return r.onSubmitSuccess=(s,u,c,a,i)=>{var G;if(d==null||d(s,u,c,a,i),i.isPrevented())return;const f=a.model.getFormMode(),N=e.getFieldNames(),y={...c};let b;Ge(y,N.parent)?b=(G=y[N.parent])==null?void 0:G[N.key]:b=e.getActiveNodeKey(),f==="create"||f==="clone"?(y[N.key]||(y[N.key]=we()),e.addNode(y,b,"insideBottom",{ensureVisible:!0,select:!!t.selectNewNode})):f==="update"&&e.updateNode(y,b,{ensureVisible:!0})},r},[o,t==null?void 0:t.editFormProps,t==null?void 0:t.editGroupFormProps,t.language,t.selectNewNode,e]),et=(e,t)=>{e.getButtonsApi().refreshButtons=tt();const o=e.getActiveNode(!0),n=t.groupsMode&&(!(o!=null&&o.isLeaf)||(o==null?void 0:o.isGroup)),r=t.buttons,d=t.buttonsSize??"small",s=t.buttonsPosition??"right",u=ot(t),c=nt(e,t),a=rt(e,t),i=dt(e,t,o,n),f=st(e,t,o,n),N=ut(e,t,o,n),y=lt(e,t,o,n),b=ct(e),G=at(e);return l.useMemo(()=>{const R=me({headerLabel:u,view:i,create:c,createGroup:a,clone:f,update:N,delete:y,arrowUp:b,arrowDown:G},r);for(const S in R){const m=R[S];!m||S==="headerLabel"||m.type==="hotkey"||(m.size=m.size??d,m.position=m.position??s,m.checkDisabled&&(m.disabled=!o),m.checkHidden&&(m.hidden=!o))}return R},[u,i,c,a,f,N,y,b,G,r,d,s,o])},tt=()=>{const[,e]=l.useState({});return l.useCallback(()=>{e({})},[e])},ot=e=>l.useMemo(()=>{if(e.headerLabel)return{...De,title:e.headerLabel}},[e.headerLabel]),nt=(e,t)=>{var o;return l.useMemo(()=>{var n;if(!(!t.editFormProps||t.disabled||t.readOnly||((n=t.buttons)==null?void 0:n.create)===null))return{...ve,title:e.t("create"),tooltip:e.t("createRecord"),onClick:()=>{const r=e.getFieldNames(),d=e.getActiveNode(!1);let s;d&&(d.isLeaf?s=e.getParentNode(d):s=d),e.getEditFormApi().open("create",{defaultValues:{[r.parent]:s}})}}},[e,t.disabled,(o=t.buttons)==null?void 0:o.create,t.editFormProps,t.readOnly])},rt=(e,t)=>{var o;return l.useMemo(()=>{var n;if(!(!t.editGroupFormProps||!t.groupsMode||t.disabled||t.readOnly||((n=t.buttons)==null?void 0:n.createGroup)===null))return{...Ee,title:e.t("createGroup"),tooltip:e.t("createRecordsGroup"),onClick:()=>{const r=e.getFieldNames(),d=e.getActiveNode(!1);let s;d&&(d.isLeaf?s=e.getParentNode(d):s=d),e.getEditGroupFormApi().open("create",{defaultValues:{[r.parent]:s}})}}},[t.editGroupFormProps,t.groupsMode,t.disabled,t.readOnly,(o=t.buttons)==null?void 0:o.createGroup,e])},dt=(e,t,o,n)=>{var r;return l.useMemo(()=>{var d;if(!(!n&&!t.editFormProps||n&&!t.editGroupFormProps||!t.readOnly||t.disabled||((d=t.buttons)==null?void 0:d.view)===null))return{...he,title:e.t("view"),tooltip:e.t("viewRecord"),disabled:!o,onClick:()=>{if(!o)return;const s=e.getFieldNames(),u=e.getParentNode(o);n?e.getEditGroupFormApi().open("view",{dataSet:{...A(o),[s.parent]:u}}):e.getEditFormApi().open("view",{dataSet:{...A(o),[s.parent]:u}})}}},[n,t.editFormProps,t.editGroupFormProps,t.readOnly,t.disabled,(r=t.buttons)==null?void 0:r.view,o,e])},st=(e,t,o,n)=>{var r;return l.useMemo(()=>{var s;const d=t.editGroupFormProps;if(!(!n&&!t.editFormProps||n&&!t.editGroupFormProps||t.disabled||t.readOnly||((s=t.buttons)==null?void 0:s.clone)===null))return{...Ce,title:n&&d?e.t("cloneGroup"):e.t("clone"),tooltip:n&&d?e.t("cloneRecordsGroup"):e.t("cloneRecord"),disabled:!o,onClick:()=>{if(!o)return;const u=e.getFieldNames(),c=e.getParentNode(o);n?e.getEditGroupFormApi().open("clone",{dataSet:{...A(o),[u.parent]:c}}):e.getEditFormApi().open("clone",{dataSet:{...A(o),[u.parent]:c}})}}},[t.editGroupFormProps,t.editFormProps,t.disabled,t.readOnly,(r=t.buttons)==null?void 0:r.clone,n,o,e])},ut=(e,t,o,n)=>{var r;return l.useMemo(()=>{var s;const d=t.editGroupFormProps;if(!(!n&&!t.editFormProps||n&&!t.editGroupFormProps||t.disabled||t.readOnly||((s=t.buttons)==null?void 0:s.update)===null))return{...ke,title:n&&d?e.t("editGroup"):e.t("edit"),tooltip:n&&d?e.t("editRecordsGroup"):e.t("editRecord"),disabled:!o,onClick:()=>{if(!o)return;const u=e.getFieldNames(),c=e.getParentNode(o);n?e.getEditGroupFormApi().open("update",{dataSet:{...A(o),[u.parent]:c}}):e.getEditFormApi().open("update",{dataSet:{...A(o),[u.parent]:c}})}}},[t.editGroupFormProps,t.editFormProps,t.disabled,t.readOnly,(r=t.buttons)==null?void 0:r.update,n,o,e])},lt=(e,t,o,n)=>l.useMemo(()=>{var r;if(!(!t.editFormProps||t.disabled||t.readOnly||((r=t.buttons)==null?void 0:r.delete)===null))return{...Pe,title:n?e.t("deleteGroup"):e.t("delete"),tooltip:n?e.t("deleteRecordsGroup"):e.t("deleteRecord"),disabled:!o,onClick:()=>{if(!o)return;if(!t.confirmDelete){C(o,t,e,e.t("error"));return}const d=k.confirmWaiter({language:t.language,content:t.nodeDeleteMessage??e.t("deleteSelectedRecordQt"),onOk:()=>{C(o,t,e,e.t("error"),d)},onCancel:()=>{d.destroy()}})}}},[t,n,e,o]),C=(e,t,o,n,r)=>{var u;const d=o.getButtonsApi(),s=(u=t==null?void 0:t.onDelete)==null?void 0:u.call(t,e,o);if(!Fe(s)){o.removeNode(e,{select:t.selectNewNode?"next":void 0}),r&&r.destroy();return}t.confirmDelete||(d.loading("delete",!0),d.disableAll(!0)),s.then(()=>{r==null||r.destroy(),o.getIsMounted()&&(o.removeNode(e,{select:t.selectNewNode?"next":void 0}),t.confirmDelete||(d.loading("delete",!1),d.disableAll(!1)))}).catch(c=>{r==null||r.destroy(),o.getIsMounted()&&(t.confirmDelete||(d.loading("delete",!1),d.disableAll(!1)),k.alert({language:t.language,title:n,content:g.jsx(Ke,{error:c}),colorType:"danger"}))})},A=e=>({...e}),ct=e=>l.useMemo(()=>({type:"hotkey",hotKeys:[{key:"ArrowUp"}],onClick:()=>{var n;const t=(n=e.getSelectedKeys())==null?void 0:n[0],o=e.getPrevNodeKey(t);o&&e.setSelectedKeys([o])}}),[e]),at=e=>l.useMemo(()=>({type:"hotkey",hotKeys:[{key:"ArrowDown"}],onClick:()=>{const t=e.getActiveNodeKey(),o=e.getNextNodeKey(t);o&&e.setSelectedKeys([o])}}),[e]),it=({api:e,treeProps:t})=>{const o=et(e,t);return l.useMemo(()=>o?g.jsx("div",{style:{width:"100%",padding:"8px"},children:g.jsx(ye,{buttons:o,apiRef:e.getButtonsApi(),style:t.buttonsRowStyle,context:e,responsiveBreakpoint:t.responsiveBreakpoint,iconsOnly:t.buttonsIconsOnly})}):null,[o,e,t.buttonsIconsOnly,t.buttonsRowStyle,t.responsiveBreakpoint])},ft=e=>{const t=e.treeApi,o=gt(t),n=mt(t),r=yt(t),d=Nt(t);return g.jsx(Be,{className:"draggable-tree",draggable:!0,onDrop:d,...e.antdTreeProps,ref:e.treeApi.treeRef,treeData:t.getDataSet(),selectedKeys:t.getSelectedKeys(),expandedKeys:t.getExpandedKeys(),fieldNames:{key:"id",title:"title",children:"children",...e.allProps.fieldNames},onSelect:o,onExpand:n,onDoubleClick:r})},gt=e=>l.useCallback((t,o)=>{var r;const n=e.getProps();(!n.noDeselect||o.selected)&&(e.setSelectedKeys(t),(r=n.onSelect)==null||r.call(n,t,o))},[e]),mt=e=>l.useCallback((t,o)=>{var r;const n=e.getProps();e.setExpandedKeys(t),(r=n.onExpand)==null||r.call(n,t,o)},[e]),yt=e=>l.useCallback((t,o)=>{var d,s;const n=e.getProps();n.onDoubleClick&&((d=n.onDoubleClick)==null||d.call(n,t,o));const r=e.getFieldNames();if(!n.disabled&&!n.readOnly&&(n.editFormProps||n.editGroupFormProps)){e.getButtonsApi().triggerClick("update");return}(s=o[r.children])!=null&&s.length&&e.toggleNode(o[r.key])},[e]),Nt=e=>l.useCallback(t=>{let o="insideTop";t.dropToGap&&(o=t.dropPosition<0?"above":"below"),t.dragNode.id&&e.moveNode(t.dragNode.id,t.node.id,o,{ensureVisible:!0})},[e]),bt=({api:e,allProps:t,antdTreeProps:o})=>{const n=h(e,t,!1),r=h(e,t,!0);return g.jsxs("div",{className:"extended-tree-container",children:[g.jsx(xe,{isLoading:e.getIsLoading(),notHideContent:!0,spinStyle:{height:"100%"},children:g.jsxs(Ne,{style:{display:"flex",flexDirection:"column",...t.buttonsRowWrapperStyle},children:[g.jsx(Me,{style:{zIndex:15},children:g.jsx(it,{api:e,treeProps:t})}),g.jsx(ft,{treeApi:e,allProps:t,antdTreeProps:o})]})}),!t.disabled&&n?g.jsx(v,{...n,apiRef:e.getEditFormApi()}):null,!t.disabled&&r?g.jsx(v,{...r,apiRef:e.getEditGroupFormApi()}):null]})},vt=e=>{const[t,o]=be(e),[,n]=Gt(t),r=pe({props:t,setProps:o});return g.jsx(bt,{allProps:t,antdTreeProps:n,api:r})},Gt=e=>l.useMemo(()=>{const[t,o]=Ae(e,{id:!0,buttons:!0,buttonsIconsOnly:!0,buttonsPosition:!0,buttonsSize:!0,confirmDelete:!0,editFormProps:!0,editGroupFormProps:!0,language:!0,readOnly:!0,deleteMessage:!0,translation:!0,apiRef:!0,headerLabel:!0,responsiveBreakpoint:!0,buttonsRowStyle:!0,buttonsRowWrapperStyle:!0,dataSet:!0,dataMutator:!0,noDeselect:!0,groupsMode:!0,onDataSetChanged:!0,nodeDeleteMessage:!0,onDelete:!0,selectNewNode:!0,fieldNames:!0,defaultCheckedKeys:!0,checkedKeys:!0,defaultExpandedKeys:!0,expandedKeys:!0,defaultSelectedKeys:!0,selectedKeys:!0});return[t,{...o,fieldNames:t.fieldNames}]},[e]);export{vt as T};
