import{r as d,j as C}from"./index-DQhjKTAX.js";import{m as y,u as S,t as b,c as k,d as A,e as M,b as T,g as v,h as B,P as O}from"./modal-CoK2ultv.js";import{r as D,c as I,f as j,u as x,a as w,C as g,b as E,D as G,E as H,g as W}from"./dForm-CrwAE8Nv.js";import{M as Q}from"./modal-DUXxSXRd.js";const R={...D,cancelChangesQn:"Отменить сделанные изменения?",viewing:"Просмотр",creating:"Создание",editing:"Редактирование",cloning:"Клонирование"},$={...I,cancelChangesQn:"Cancel the changes made?",viewing:"Viewing",creating:"Creating",editing:"Editing",cloning:"Cloning"},P={...j,cancelChangesQn:"取消已做的更改？",viewing:"查看",creating:"创建",editing:"编辑",cloning:"克隆"},U={ru:R,en:$,cn:P},z=e=>x(e.language,U,e.translation),F=(e,n)=>{const t=K(e,n),[s,u]=d.useState(t);return d.useEffect(()=>{u(t)},[t]),[s,u]},K=(e,n)=>d.useMemo(()=>{const t=e.formMode??"create",s=e.title;return s||(t==="view"?n.t("viewing"):t==="create"?n.t("creating"):t==="clone"?n.t("cloning"):t==="update"?n.t("editing"):"&nbsp;")},[n,e.formMode,e.title]),V=e=>()=>e,_=e=>n=>{e(n)},q=(e,n)=>e?Object.prototype.hasOwnProperty.call(e,n):!1,J=(e,n)=>{const t=new Map,s=(i,l)=>{if(!i)return i;if(t.has(i))return t.get(i);const c={};t.set(i,c);for(const r in i){if(!q(i,r))continue;const o=i[r];!o||typeof o!="object"||n?c[r]=o:c[r]=w(o)?u(o):s(o)}return c},u=(i,l)=>{const c=[];for(let r=0;r<i.length;r++){const o=i[r];!o||typeof o!="object"||n?c[r]=o:c[r]=w(o)?u(o):s(o)}return c};return typeof e!="object"||e===null?e:w(e)?u(e):s(e)},L=e=>(n,t)=>{var c,r;if(!n)return;const s=(t==null?void 0:t.dataSet)??e.getProps().dataSet,u=s?J(s):void 0,i=e.getProps(),l={open:!0,formMode:n,dataSet:u,...t};((c=i.onOpen)==null?void 0:c.call(i,e,u,l,new g))!==!1&&((r=t==null?void 0:t.onOpen)==null?void 0:r.call(t,e,u,l,new g))!==!1&&(e.updateProps(l),setTimeout(()=>{var a;const o=e.getProps();(a=o.onOpened)==null||a.call(o,e,o.dataSet,new g)},0))},N=e=>()=>{var t,s;const n=e.getProps();if(((t=n.onClosing)==null?void 0:t.call(n,e,new g))===!1)return!1;e.updateProps({open:!1}),(s=n.onClosed)==null||s.call(n,e,new g)},X=(e,n)=>()=>{var t,s;if(((t=n.onClosing)==null?void 0:t.call(n,e,new g))!==!1){if(e.model.isFormDirty()&&n.confirmChanges){y.confirm({language:n.language,content:n.closeFormConfirmMessage??e.t("cancelChangesQn"),okText:e.t("yes"),cancelText:e.t("no"),onOk:()=>{var u;(u=n.onCancel)==null||u.call(n,e,new g),e.forceClose()}});return}(s=n.onCancel)==null||s.call(n,e,new g),e.forceClose()}},Y=({props:e,setProps:n})=>{const[t]=d.useState(e.apiRef||{});t.getId=S(e.formId??"dFormModal-"+b()),t.getButtonsApi=E(),t.getProps=k(e),t.setProps=A(n),t.updateProps=M(e,n),t.getIsMounted=T(),t.t=z(e),t.open=L(t),t.close=X(t,e),t.forceClose=N(t);const[s,u]=F(e,t);return t.getTitle=V(s),t.setTitle=_(u),t},Z=({buttons:e,formApi:n,formProps:t,modalFormProps:s})=>{const u=s.modalProps;return C.jsx(Q,{open:s.open,maskProps:{style:{zIndex:1060}},wrapProps:{style:{zIndex:1060}},modalId:n.getId(),centered:!0,maskClosable:!1,keyboard:!1,destroyOnClose:!0,title:n.getTitle(),onCancel:n.close,footer:C.jsx(v,{buttons:e,colorType:s.colorType,buttonsApi:n.getButtonsApi(),arrowsSelection:s.arrowsButtonsSelection,context:n}),height:s.height,maxHeight:s.maxHeight,minHeight:s.minHeight,width:s.width,maxWidth:s.maxWidth,minWidth:s.minWidth,...u,children:s.open?C.jsx(G,{apiRef:n,...t,formStyle:{height:"100%",width:"100%",...t.formStyle},containerStyle:{height:"100%",...t.containerStyle},_overriddenApi:{getId:!0,t:!0,getButtonsApi:!0,getProps:!0,setProps:!0,updateProps:!0,getIsMounted:!0}}):null})},p=(e,n)=>{const t={},s={};for(const u in e)n[u]?t[u]=e[u]:s[u]=e[u];return[t,s]},ee=e=>d.useMemo(()=>({...e,...{onDataFetchError:(t,s,u)=>{var l;if((l=e==null?void 0:e.onDataFetchError)==null||l.call(e,t,s,u),u.isPrevented())return;u.preventOriginal();const i=y.confirm({language:e.language,title:s.t("error"),content:C.jsx(H,{error:t,extraMessage:s.t("tryAgainQt")}),colorType:"danger",buttons:{ok:{onClick:()=>{i.destroy(),s.model.fetchData()}},cancel:{onClick:()=>{var c;i.destroy(),(c=s.forceClose)==null||c.call(s)}}}})},onSubmit:(t,s,u,i)=>{var c,r,o,a,f,h,m;const l=(c=e==null?void 0:e.onSubmit)==null?void 0:c.call(e,t,s,u,i);return i.isPrevented()||(i.preventOriginal(),(o=(r=u.getButtonsApi()).disabled)==null||o.call(r,"ok",!0),(f=(a=u.getButtonsApi()).disabled)==null||f.call(a,"cancel",!0),e.confirmChanges||(m=(h=u.getButtonsApi()).loading)==null||m.call(h,"ok",!0)),l},onSubmitSuccess:(t,s,u,i,l)=>{var c;(c=e==null?void 0:e.onSubmitSuccess)==null||c.call(e,t,s,u,i,l),!l.isPrevented()&&i.forceClose()},onSubmitComplete:(t,s,u,i,l)=>{var c,r,o,a,f,h,m;(c=e==null?void 0:e.onSubmitComplete)==null||c.call(e,t,s,u,i,l),!l.isPrevented()&&(l.preventOriginal(),(o=(r=i.getButtonsApi()).disabled)==null||o.call(r,"ok",!1),(f=(a=i.getButtonsApi()).disabled)==null||f.call(a,"cancel",!1),(m=(h=i.getButtonsApi()).loading)==null||m.call(h,"ok",!1))}}}),[e]),te=(e,n)=>d.useMemo(()=>{const t={ok:{position:"right",active:n.formMode!=="view",hidden:n.formMode==="view",title:e.t("ok"),hotKeys:[{key:"enter",ctrl:!0},{key:"s",ctrl:!0},{key:"ы",ctrl:!0}],onClick:()=>{e.submitForm()}},cancel:{position:"right",title:e.t("cancel"),hotKeys:[{key:"escape"}],active:n.formMode==="view",onClick:()=>{e.close()}}};return B(t,n.buttons)},[e,n.buttons,n.formMode]),ce=e=>{W();const[n,t]=O(e),s=ee(n),[,u]=ne(s),i=Y({props:s,setProps:t}),l=te(i,s);return C.jsx(Z,{formApi:i,modalFormProps:s,formProps:u,buttons:l})},ne=e=>d.useMemo(()=>{const[n,t]=p(e,{closeFormConfirmMessage:!0,modalProps:!0,title:!0,open:!0,width:!0,maxWidth:!0,minWidth:!0,height:!0,minHeight:!0,maxHeight:!0,onCancel:!0,onOpen:!0,onClosed:!0,onClosing:!0,onOpened:!0,language:!0,translation:!0});return t.buttons=null,[n,{...t,language:e.language,translation:e.translation}]},[e]);export{ce as D,J as m,p as s};
