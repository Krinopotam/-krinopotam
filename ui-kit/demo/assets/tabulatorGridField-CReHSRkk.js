var F=Object.defineProperty;var C=(e,t,u)=>t in e?F(e,t,{enumerable:!0,configurable:!0,writable:!0,value:u}):e[t]=u;var D=(e,t,u)=>C(e,typeof t!="symbol"?t+"":t,u);import{r as h,j as i}from"./index-B5poLpDm.js";import{B as R}from"./dForm-vrGhQ6Lh.js";import{s as m}from"./dFormModal-C_QqbNS_.js";import{T as y}from"./tabulatorGrid-igE2XdiX.js";const S=({field:e,gridApi:t})=>{h.useSyncExternalStore(e.subscribe.bind(e),e.getSnapshot.bind(e));const u=e.getProps(),[s]=h.useState(t),n=b(u),r=e.getValue(),a=h.useRef(void 0);typeof a.current>"u"&&(u.selectionMode?a.current=u.dataSet:a.current=r);const o=M(e,u),g=e.getWidth()??"100%",c=u.autoHeightResize?"100%":u.height,d=u.autoHeightResize?{position:"absolute",inset:0}:{};return i.jsx("div",{style:d,children:i.jsx(y,{...n,...o,className:u.className,apiRef:s,dataSet:a.current,readOnly:u.readOnly,placeholder:u.placeholder,width:g,height:c,resizeHeightWithParent:u.resizeHeightWithForm?"#"+e.getModel().getFormId():u.resizeHeightWithParent})})},b=e=>h.useMemo(()=>m(e,{defaultValue:!0,dataSet:!0,onMenuVisibilityChanged:!0,onDataLoading:!0,onDataLoaded:!0,onDataProcessed:!0,onDataLoadError:!0,onDataChanged:!0,onDataFetch:!0,onDataFetchResponse:!0,onDataFetching:!0,fetchInCreateMode:!0,onSelectionChange:!0,onActiveRowChanged:!0,onDelete:!0,readOnly:!0,onValueChanged:!0,width:!0,autoHeightResize:!0,component:!0,rules:!0,onReadyStateChanged:!0,autoFocus:!0,dependsOn:!0,disabled:!0,helpClass:!0,hidden:!0,label:!0,nonEditable:!0,inlineGroup:!0,onDirtyStateChanged:!0,onDisabledStateChanged:!0,onErrorChanged:!0,onHiddenStateChanged:!0,onLabelChanged:!0,ajaxRequestFunc:!0,onReadOnlyStateChanged:!0,placeholder:!0,onTouchedStateChanged:!0,onValidated:!0,requiredMark:!0,rowStyle:!0,style:!0,tooltip:!0,resizeHeightWithForm:!0,onFieldDataFetch:!0,onFieldDataFetchError:!0,onFieldDataFetchSuccess:!0,className:!0,itemClassName:!0})[1],[e]),M=(e,t)=>{const s=e.getModel().getFormMode();return{onDataChanged:(n,r)=>{var a;return e.isReady()&&(t.selectionMode||(e.setValue(n??[],!1,!0,!0),e.setDirty(!0))),(a=t.onDataChanged)==null?void 0:a.call(t,n,r,e)},onActiveRowChanged:(n,r)=>{var a;return(a=t.onActiveRowChanged)==null?void 0:a.call(t,n,r,e)},onSelectionChange:(n,r,a,o,g)=>{var c;return e.getModel().isFormReady()&&(t.selectionMode&&(e.setValue(n??[],!1,!0,!0),e.setDirty(!0)),e.setTouched(!0)),(c=t.onSelectionChange)==null?void 0:c.call(t,n,r,a,o,g,e)},onDataLoading:(n,r)=>{var a;return e.setReady(!1),(a=t.onDataLoading)==null?void 0:a.call(t,n,r,e)},onDataLoaded:(n,r)=>{var o;e.setReady(!0);const a=e.getProps();return a.selectionMode||e.setValue(n??[],!1,!0,!0),(o=a.onDataLoaded)==null?void 0:o.call(a,n,r,e)},onDataProcessed:(n,r)=>{var o;const a=e.getProps();return a.selectionMode&&r.setSelectedRows(e.getValue()),(o=a.onDataProcessed)==null?void 0:o.call(a,n,r,e)},onDataLoadError:(n,r,a)=>{var o;return e.setReady(!1),(o=t.onDataLoadError)==null?void 0:o.call(t,n,r,a,e)},onDataFetch:!t.onDataFetch||s==="create"&&!t.fetchInCreateMode?void 0:(n,r)=>t.onDataFetch(n,r,e),onDataFetching:t.onDataFetching?(n,r,a)=>t.onDataFetching(n,r,a,e):void 0,onDataFetchResponse:t.onDataFetchResponse?(n,r,a)=>{var o;return((o=t==null?void 0:t.onDataFetchResponse)==null?void 0:o.call(t,n,r,a,e))??n}:void 0,onMenuVisibilityChanged:t.onMenuVisibilityChanged?(n,r)=>{var a;return(a=t==null?void 0:t.onMenuVisibilityChanged)==null?void 0:a.call(t,n,r,e)}:void 0,onDelete:t.onDelete?(n,r)=>{var a;return(a=t==null?void 0:t.onDelete)==null?void 0:a.call(t,n,r,e)}:void 0}};class H extends R{constructor(){super(...arguments);D(this,"gridApi",{})}render(){const u=this.getProps();return u.apiRef&&(this.gridApi=u.apiRef),i.jsx(S,{field:this,gridApi:this.gridApi})}getGridApi(){return this.gridApi}setValue(u,s,n,r){const a=this.getProps();return!r&&!a.selectionMode&&this.gridApi.setDataSet(u),super.setValue(u,s,n)}setDataSet(u,s){this.getProps().selectionMode?this.gridApi.setDataSet(u):this.setValue(u,s)}getDataSet(){return this.gridApi.getDataSet()}}export{H as T};
