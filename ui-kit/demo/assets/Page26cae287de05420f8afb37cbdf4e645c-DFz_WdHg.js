const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CyWR1QGj.js","assets/default-highlight-DReNbQFQ.js","assets/index-D8v8ynpz.js"])))=>i.map(i=>d[i]);
import{j as e,r as t,D as i,_ as n}from"./index-D8v8ynpz.js";import{D as r}from"./isArray-BED9qbCT.js";import{I as o}from"./inputField-DnoCNLOB.js";import{T as d}from"./treeSelectField-BF9wsYak.js";import{P as l}from"./useApiGetGroupsOnly-eOCHJ9EP.js";import{d as s}from"./dFormModal-BdurZTse.js";import{P as m,C as a}from"./pageLayout-CP4XPFwB.js";import{d as p,c}from"./darcula-BqMdvqtY.js";import"./buttonsRow-4PdtnNz6.js";import"./messageBox-B0gUtOZX.js";import"./index-CW9-W7Rk.js";import"./baseField-JCmhvzfL.js";import"./index-WJomNUJj.js";import"./SearchOutlined-BnMgzI0N.js";import"./defaultButtonsProps-CET-ft4_.js";import"./PlusOutlined-GlG2akss.js";import"./useShowArrow-CtiRjLW-.js";import"./useIcons-DGwTBMSK.js";import"./index-DTSzZx5I.js";import"./modal-D28EARKj.js";const u=()=>{const t=f();return e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:"Пример TreeSelect с асинхронной формой редактирования"}),e.jsx("p",{children:"Для данного примера операция завершится ошибкой с вероятностью 30%"}),e.jsx("div",{style:{maxWidth:500},children:e.jsx(r,{...t})})]})},h={},f=()=>{const e=F();return t.useMemo((()=>({formId:"Test form",confirmChanges:!0,fieldsProps:{departments:{component:d,apiRef:h,label:"Подразделения",confirmDelete:!0,dataSet:j,editFormProps:e,onDelete:()=>new Promise(((e,t)=>{setTimeout((()=>{Math.random()<.3?t({message:"Тестовая ошибка удаления строк",code:400}):e({data:{result:"OK"}})}),2e3)}))}},buttons:null})),[e])},F=()=>t.useMemo((()=>({onFormInit:e=>{const t=e.model,i=t.getField("parent"),n=h.getDataSet();if("update"!==t.getFormMode())return void i.updateProps({dataSet:n});const r=t.getFormDataSet().id,o=s(n);l(r,o,{key:"id",children:"children"}),i.updateProps({dataSet:o})},formId:"EditForm",confirmChanges:!0,fieldsProps:{title:{component:o,label:"Подразделение"},parent:{component:d,label:"Родитель"}},onSubmit:(e,t)=>new Promise(((e,i)=>{setTimeout((()=>{Math.random()<.3?i({message:"Тестовая ошибка сохранения",code:400}):e({data:t})}),3e3)}))})),[]),j=[{id:"01",title:"Департамент аналитики данных",children:[{id:"01-01",title:"Управление аналитики продаж",children:[{id:"01-01-01",title:"Отдел продаж север"},{id:"01-01-02",title:"Отдел продаж юг"},{id:"01-01-03",title:"Отдел продаж запад"}]},{id:"01-02",title:"Управление аналитики закупок",children:[{id:"01-02-01",title:"Отдел закупок север"},{id:"01-02-02",title:"Отдел закупок юг"},{id:"01-02-03",title:"Отдел закупок запад"}]},{id:"01-03",title:"Управление аналитики производства",children:[{id:"01-03-01",title:"Отдел производства север"},{id:"01-03-02",title:"Отдел производства юг"},{id:"01-03-03",title:"Отдел производства запад"}]}]},{id:"02",title:"Департамент инженерных работ",children:[{id:"02-01",title:"Управление строительства",children:[{id:"02-01-01",title:"Отдел строительства север"},{id:"02-01-02",title:"Отдел строительства юг"},{id:"02-01-03",title:"Отдел строительства запад"}]},{id:"02-02",title:"Управление демонтажа",children:[{id:"02-02-01",title:"Отдел демонтажа север"},{id:"02-02-02",title:"Отдел демонтажа юг"},{id:"02-02-03",title:"Отдел демонтажа запад"}]},{id:"02-03",title:"Управление реконструкции",children:[{id:"02-03-01",title:"Отдел реконструкции север"},{id:"02-03-02",title:"Отдел реконструкции юг"},{id:"02-03-03",title:"Отдел реконструкции запад"}]}]},{id:"03",title:"Департамент проектных работ",children:[{id:"03-01",title:"Управление проектирования",children:[{id:"03-01-01",title:"Отдел проектирования север"},{id:"03-01-02",title:"Отдел проектирования юг"},{id:"03-01-03",title:"Отдел проектирования запад"}]},{id:"03-02",title:"Управление согласования",children:[{id:"03-02-01",title:"Отдел согласования север"},{id:"03-02-02",title:"Отдел согласования юг"},{id:"03-02-03",title:"Отдел согласования запад"}]},{id:"03-03",title:"Управление анализа проектов",children:[{id:"03-03-01",title:"Отдел анализа север"},{id:"03-03-02",title:"Отдел анализа юг"},{id:"03-03-03",title:"Отдел анализа запад"}]}]}],P=t.lazy((()=>n((()=>import("./index-CyWR1QGj.js").then((e=>e.dw))),__vite__mapDeps([0,1,2])).then((e=>({default:e.Prism}))))),S=n=>e.jsxs(m,{children:[e.jsx(u,{}),e.jsx(i,{}),e.jsx("div",{children:e.jsx(a,{items:[{key:1,label:"Show source",children:e.jsx(t.Suspense,{fallback:e.jsx("div",{children:"Loading source..."}),children:e.jsx(P,{language:"tsx",style:n.darkMode?p:c,showLineNumbers:!0,children:"\nimport React, {useMemo} from 'react';\nimport {DForm, IDFormProps} from @krinopotam/ui-kit/dForm';\nimport {IDFormModalProps} from @krinopotam/ui-kit/dFormModal';\nimport {IInputFieldProps, InputField} from @krinopotam/ui-kit/dForm/fields/input/inputField';\nimport {ITreeSelectFieldProps, TreeSelectField} from @krinopotam/ui-kit/dForm/fields/treeSelect/treeSelectField';\nimport {CloneObject} from '@krinopotam/js-helpers';\nimport {removeFromTree} from @krinopotam/ui-kit/_shared/hooks/treeComponentApiMethods/serviceMethods/removeFromTree';\nimport {ITreeSelectApi} from @krinopotam/ui-kit/treeSelect';\nexport const TreeSelectWithFormAsync = (): React.JSX.Element => {\n    const formProps = useFormProps();\n    return (\n        <>\n            <div style={{maxWidth: 500}}>\n                <DForm {...formProps} />\n            </div>\n        </>\n    );\n};\nconst departmentsApi = {} as ITreeSelectApi;\nconst useFormProps = () => {\n    const treeEditFormProps = useTreeEditFormProps();\n    return useMemo(\n        (): IDFormProps => ({\n            formId: 'Test form',\n            confirmChanges: true,\n            fieldsProps: {\n                departments: {\n                    component: TreeSelectField,\n                    apiRef: departmentsApi,\n                    label: 'Подразделения',\n                    confirmDelete: true,\n                    dataSet: dataSet,\n                    editFormProps: treeEditFormProps,\n                    onDelete: () => {\n                        return new Promise((resolve, reject) => {\n                            setTimeout(() => {\n                                if (Math.random() < 0.3) reject({message: 'Тестовая ошибка удаления строк', code: 400});\n                                else resolve({data: {result: 'OK'}});\n                            }, 2000);\n                        });\n                    },\n                } satisfies ITreeSelectFieldProps,\n            },\n            buttons: null,\n        }),\n        [treeEditFormProps]\n    );\n};\nconst useTreeEditFormProps = () => {\n    return useMemo(\n        (): IDFormModalProps => ({\n            onFormInit: formApi => {\n                const model = formApi.model;\n                const field = model.getField('parent');\n                const data = departmentsApi.getDataSet();\n                const formMode = model.getFormMode();\n                if (formMode !== 'update') {\n                    field.updateProps({dataSet: data});\n                    return;\n                }\n                /** modify dataset for update to avoid the possibility of a parent node choosing itself or its own child node */\n                const id = model.getFormDataSet()['id'];\n                const clonedData = CloneObject(data);\n                removeFromTree(id, clonedData, {key: 'id', children: 'children'});\n                field.updateProps({dataSet: clonedData});\n            },\n            formId: 'EditForm',\n            confirmChanges: true,\n            fieldsProps: {\n                title: {component: InputField, label: 'Подразделение'} satisfies IInputFieldProps,\n                parent: {\n                    component: TreeSelectField,\n                    label: 'Родитель',\n                } satisfies ITreeSelectFieldProps,\n            },\n            onSubmit: (_values, dataSet) => {\n                return new Promise((resolve, reject) => {\n                    setTimeout(() => {\n                        if (Math.random() < 0.3) reject({message: 'Тестовая ошибка сохранения', code: 400});\n                        else resolve({data: dataSet});\n                    }, 3000);\n                });\n            },\n        }),\n        []\n    );\n};\nconst dataSet = [\n    {\n        id: '01',\n        title: 'Департамент аналитики данных',\n        children: [\n            {\n                id: '01-01',\n                title: 'Управление аналитики продаж',\n                children: [\n                    {id: '01-01-01', title: 'Отдел продаж север'},\n                    {id: '01-01-02', title: 'Отдел продаж юг'},\n                    {id: '01-01-03', title: 'Отдел продаж запад'},\n                ],\n            },\n            {\n                id: '01-02',\n                title: 'Управление аналитики закупок',\n                children: [\n                    {id: '01-02-01', title: 'Отдел закупок север'},\n                    {id: '01-02-02', title: 'Отдел закупок юг'},\n                    {id: '01-02-03', title: 'Отдел закупок запад'},\n                ],\n            },\n            {\n                id: '01-03',\n                title: 'Управление аналитики производства',\n                children: [\n                    {id: '01-03-01', title: 'Отдел производства север'},\n                    {id: '01-03-02', title: 'Отдел производства юг'},\n                    {id: '01-03-03', title: 'Отдел производства запад'},\n                ],\n            },\n        ],\n    },\n    {\n        id: '02',\n        title: 'Департамент инженерных работ',\n        children: [\n            {\n                id: '02-01',\n                title: 'Управление строительства',\n                children: [\n                    {id: '02-01-01', title: 'Отдел строительства север'},\n                    {id: '02-01-02', title: 'Отдел строительства юг'},\n                    {id: '02-01-03', title: 'Отдел строительства запад'},\n                ],\n            },\n            {\n                id: '02-02',\n                title: 'Управление демонтажа',\n                children: [\n                    {id: '02-02-01', title: 'Отдел демонтажа север'},\n                    {id: '02-02-02', title: 'Отдел демонтажа юг'},\n                    {id: '02-02-03', title: 'Отдел демонтажа запад'},\n                ],\n            },\n            {\n                id: '02-03',\n                title: 'Управление реконструкции',\n                children: [\n                    {id: '02-03-01', title: 'Отдел реконструкции север'},\n                    {id: '02-03-02', title: 'Отдел реконструкции юг'},\n                    {id: '02-03-03', title: 'Отдел реконструкции запад'},\n                ],\n            },\n        ],\n    },\n    {\n        id: '03',\n        title: 'Департамент проектных работ',\n        children: [\n            {\n                id: '03-01',\n                title: 'Управление проектирования',\n                children: [\n                    {id: '03-01-01', title: 'Отдел проектирования север'},\n                    {id: '03-01-02', title: 'Отдел проектирования юг'},\n                    {id: '03-01-03', title: 'Отдел проектирования запад'},\n                ],\n            },\n            {\n                id: '03-02',\n                title: 'Управление согласования',\n                children: [\n                    {id: '03-02-01', title: 'Отдел согласования север'},\n                    {id: '03-02-02', title: 'Отдел согласования юг'},\n                    {id: '03-02-03', title: 'Отдел согласования запад'},\n                ],\n            },\n            {\n                id: '03-03',\n                title: 'Управление анализа проектов',\n                children: [\n                    {id: '03-03-01', title: 'Отдел анализа север'},\n                    {id: '03-03-02', title: 'Отдел анализа юг'},\n                    {id: '03-03-03', title: 'Отдел анализа запад'},\n                ],\n            },\n        ],\n    },\n];\n"})})}]})})]});export{S as Page26cae287de05420f8afb37cbdf4e645c,S as default};
