import{j as b,bp as O,r as s,a as B}from"./index-353109d5.js";import{f as l,G as E,h as z,i as W,H as V,j as G,m as I,k as L,D as N,c as Y,M as X,l as M,u as U,e as $}from"./index-1664f5a0.js";const{useToken:K}=O,_=({onMouseResize:t,resizable:e,children:c,style:n,colorType:u})=>{const{token:i}=K(),h=J(i,u);return b.jsxs("div",{children:[b.jsx("div",{style:{borderTopWidth:1,borderTopStyle:"solid",borderTopColor:h,...n},children:c}),e?b.jsx(q,{onMouseDown:t}):null]})},q=t=>b.jsx("div",{className:"resize-handle",...t,children:b.jsx("div",{className:"resize-handle-inner"})}),J=(t,e)=>{let c=t.colorFillSecondary;return e==="info"?c=t.colorInfoHover:e==="success"?c=t.colorSuccessHover:e==="warning"?c=t.colorWarningHover:e==="danger"&&(c=t.colorErrorHover),c};/**
 * @Modal
 * @version 0.0.0.3
 * @link omegatester@gmail.com
 * @author Maksim Zaytsev
 * @license MIT
 */const Q=(t,e)=>{s.useEffect(()=>(e?l.pushToStack(t):l.removeFromStack(t),()=>{l.removeFromStack(t)}),[e,t])},Z=(t,e,c,n,u,i,h)=>{const[S,g]=s.useState(!1),[a,x]=s.useState({initWidth:0,initBodyHeight:0,mouseDownX:0,mouseDownY:0}),T=s.useCallback(y=>{var f;if(y.preventDefault(),!e&&y.target instanceof HTMLElement){const C=(f=y.target.closest(".custom-antd-modal"))==null?void 0:f.querySelector(".ant-modal-body");C&&(e=C.clientHeight)}if(!t&&y.target instanceof HTMLElement){const C=y.target.closest(".custom-antd-modal");C&&(t=C.clientWidth)}x({initWidth:t,initBodyHeight:e,mouseDownX:y.clientX,mouseDownY:y.clientY}),g(!0)},[t,e,g,x]);return s.useEffect(()=>{const y=f=>{if(S){const{initWidth:C,mouseDownX:R,initBodyHeight:H,mouseDownY:k}=a,v=f.clientX-R,j=f.clientY-k;let D=C+v*2;u&&D>u&&(D=u),n&&D<n&&(D=n);let w=H+j*2;return h&&w>h&&(w=h),i&&w<i&&(w=i),c({width:D,bodyHeight:w})}};return window.addEventListener("mousemove",y,{passive:!0}),()=>window.removeEventListener("mousemove",y)},[a,S,c,n,u,i,h]),s.useEffect(()=>{const y=()=>{g(!1)};return window.addEventListener("mouseup",y),()=>window.removeEventListener("mouseup",y)},[g]),T},d=({resizable:t=!0,headerStyle:e,footerStyle:c,...n})=>{const[u]=s.useState(n.modalId??"modal-"+E());Q(u,!!n.open);const i=s.useRef({}),h=s.useRef();s.useEffect(()=>{n.open&&(h.current=document.activeElement)},[n.open]);const S=s.useCallback(k=>{var v,j,D,w;k?(j=(v=i.current)==null?void 0:v.onParentComponentRendered)==null||j.call(v):(D=h.current)==null||D.focus(),(w=n.onAfterOpenChange)==null||w.call(n,k)},[n]),[g,a]=s.useState({width:n.width??0,bodyHeight:n.bodyHeight??0}),x=Z(g.width,g.bodyHeight,a,n.minWidth??200,n.maxWidth??5e3,n.bodyMinHeight??50,n.bodyMaxHeight??5e3),T=A({bodyStyle:n.bodyStyle,bodyHeight:g.bodyHeight,bodyMaxHeight:n.bodyMaxHeight,bodyMinHeight:n.bodyMinHeight,notScrollable:n.notScrollable}),y=24,f=24,C={paddingLeft:y,paddingRight:f,paddingTop:5,paddingBottom:5,...e},R={paddingTop:20,paddingLeft:y,paddingRight:f,paddingBottom:20,...c},[H]=s.useState("draggable-"+E());return b.jsx(z,{...n,width:g.width||void 0,styles:{body:T,footer:{margin:0}},className:B("custom-antd-modal",n.className),modalRender:k=>W(k,H,i),title:b.jsx(V,{draggableId:H,icon:n.headerIcon,title:n.title,colorType:n.colorType,style:C}),footer:b.jsx(_,{onMouseResize:x,resizable:t,style:R,colorType:n.colorType,children:n.footer}),afterOpenChange:S})},A=({bodyStyle:t,bodyHeight:e,bodyMaxHeight:c,bodyMinHeight:n,notScrollable:u})=>{const i={...t,padding:"0 24px 0 24px",overflowY:u?"hidden":"auto"};return e&&(i.height=e),c&&(i.maxHeight=c),n&&(i.minHeight=n),i},r=(t,e,c,n,u)=>{e.getFormId=F(t),e.buttonsApi=n,e.getFormProps=P(c),e.setFormProps=p(c,u),e.open=o(e),e.close=ee(e),e.forceClose=m(e)},F=t=>s.useCallback(()=>t,[t]),P=t=>s.useCallback(()=>t,[t]),p=(t,e)=>s.useCallback(c=>{e({...t,...c})},[t,e]),o=t=>s.useCallback((e,c)=>{var h,S;if(!e){console.warn("The form mode is not set");return}const n=c??t.getFormProps().dataSet,u=n?G(n):void 0,i=t.getFormProps();((h=i.onOpen)==null?void 0:h.call(i,t,u))!==!1&&(t.setFormProps({isOpened:!0,formMode:e,dataSet:u}),(S=i.onOpened)==null||S.call(i,t,u))},[t]),m=t=>s.useCallback(()=>{var c,n;const e=t.getFormProps();if(((c=e.onClosing)==null?void 0:c.call(e,t))===!1)return!1;t.setFormProps({isOpened:!1}),(n=e.onClosed)==null||n.call(e,t)},[t]),ee=t=>s.useCallback(()=>{var c;const e=t.getFormProps();if(((c=e.onClosing)==null?void 0:c.call(e,t))!==!1){if(t.model.isFormDirty()&&e.confirmChanges){I.confirm({content:e.closeFormConfirmMessage??"Отменить сделанные изменения?",okText:"Да",cancelText:"Нет",onOk:()=>{t.forceClose()}});return}t.forceClose()}},[t]),te=({formId:t,buttons:e,buttonsApi:c,formApi:n,formProps:u,modalFormProps:i})=>{const[h]=s.useState(t??"dFormModal-"+E()),S=i.formMode??"create",g=ne(S,i.title);return b.jsx(d,{modalId:h,open:i.isOpened,onCancel:n.close,centered:!0,destroyOnClose:!0,footer:b.jsx(L,{buttons:e,colorType:i.colorType,buttonsApi:c,arrowsSelection:i.arrowsButtonsSelection,context:n}),footerStyle:i.footerStyle,maskClosable:!1,keyboard:!1,bodyHeight:i.bodyHeight,bodyMinHeight:i.bodyMinHeight,bodyMaxHeight:i.bodyMaxHeight,width:i.width,minWidth:i.minWidth,maxWidth:i.maxWidth,notScrollable:i.notScrollable,resizable:i.resizable!==!1,title:g,headerIcon:i.headerIcon,headerStyle:i.headerStyle,colorType:u.colorType,children:i.isOpened?b.jsx(N,{apiRef:n,...u,formStyle:{height:"100%",...u.formStyle},containerStyle:{height:"100%",...u.containerStyle}}):null})},ne=(t,e)=>e||(t==="view"?"Просмотр":t==="create"?"Создание":t==="clone"?"Клонирование":t==="update"?"Редактирование":"&nbsp;"),ce=(t,e)=>s.useMemo(()=>({onFormDirtyStateChanged:c=>{var n;return(n=e==null?void 0:e.onFormDirtyStateChanged)==null?void 0:n.call(e,c,t)},onFormReadOnlyStateChanged:c=>{var n;return(n=e==null?void 0:e.onFormReadOnlyStateChanged)==null?void 0:n.call(e,c,t)},onFormInit:()=>{var c;return(c=e==null?void 0:e.onFormInit)==null?void 0:c.call(e,t)},onFormModelInitialized:()=>{var c;return(c=e==null?void 0:e.onFormModelInitialized)==null?void 0:c.call(e,t)},onFormReadyStateChanged:c=>{var n;return(n=e==null?void 0:e.onFormReadyStateChanged)==null?void 0:n.call(e,c,t)},onFormValuesChanged:(c,n)=>{var u;return(u=e==null?void 0:e.onFormValuesChanged)==null?void 0:u.call(e,c,n,t)},onFormValidated:(c,n,u)=>{var i;return(i=e==null?void 0:e.onFormValidated)==null?void 0:i.call(e,c,n,u,t)},onFormHasErrors:(c,n)=>{var u;return(u=e==null?void 0:e.onFormHasErrors)==null?void 0:u.call(e,c,n,t)},onFormHasNoErrors:c=>{var n;return(n=e==null?void 0:e.onFormHasNoErrors)==null?void 0:n.call(e,c,t)},onDataFetch:()=>{var c;return(c=e==null?void 0:e.onDataFetch)==null?void 0:c.call(e,t)},onDataFetchSuccess:c=>{var n;return(n=e==null?void 0:e.onDataFetchSuccess)==null?void 0:n.call(e,c,t)},onDataFetchError:c=>{var u;if(((u=e==null?void 0:e.onDataFetchError)==null?void 0:u.call(e,c,t))===!1)return!1;const n=I.confirm({content:b.jsxs(b.Fragment,{children:[b.jsx("p",{children:b.jsx("b",{children:c.message})}),c.stack&&Y()?b.jsx("p",{children:c.stack}):"",b.jsx("p",{children:"Попробовать снова?"})]}),colorType:"danger",buttons:{ok:{onClick:()=>{n.destroy(),t.model.fetchData()}},cancel:{onClick:()=>{var i;n.destroy(),(i=t.forceClose)==null||i.call(t)}}}});return!1},onDataFetchComplete:()=>{var c;return(c=e==null?void 0:e.onDataFetchComplete)==null?void 0:c.call(e,t)},onSubmitValidation:(c,n)=>{var u;return(u=e==null?void 0:e.onSubmitValidation)==null?void 0:u.call(e,c,n,t)},onSubmit:c=>{var n,u,i,h,S,g,a;return(u=(n=t.buttonsApi).disabled)==null||u.call(n,"ok",!0),(h=(i=t.buttonsApi).disabled)==null||h.call(i,"cancel",!0),e.confirmChanges||(g=(S=t.buttonsApi).loading)==null||g.call(S,"ok",!0),(a=e==null?void 0:e.onSubmit)==null?void 0:a.call(e,c,t)},onSubmitSuccess:(c,n)=>{var u;if(((u=e==null?void 0:e.onSubmitSuccess)==null?void 0:u.call(e,c,n,t))===!1)return!1;t.forceClose()},onSubmitError:(c,n)=>{var u;return(u=e==null?void 0:e.onSubmitError)==null?void 0:u.call(e,c,n,t)},onSubmitComplete:(c,n)=>{var u,i,h,S,g,a,x;if(((u=e==null?void 0:e.onSubmitComplete)==null?void 0:u.call(e,c,n,t))===!1)return!1;(h=(i=t.buttonsApi).disabled)==null||h.call(i,"ok",!1),(g=(S=t.buttonsApi).disabled)==null||g.call(S,"cancel",!1),(x=(a=t.buttonsApi).loading)==null||x.call(a,"ok",!1)},onDataSetChange:c=>{var n;return(n=e==null?void 0:e.onDataSetChange)==null?void 0:n.call(e,c,t)}}),[t,e]),ie=(t,e)=>s.useMemo(()=>{const c={ok:{position:"right",active:e.formMode!=="view",hidden:e.formMode==="view",title:"ОК",hotKeys:[{key:"enter",ctrl:!0},{key:"s",ctrl:!0},{key:"ы",ctrl:!0}],onClick:()=>{t.submitForm()}},cancel:{position:"right",title:"Отмена",hotKeys:[{key:"escape"}],active:e.formMode==="view",onClick:()=>{t.close()}}};return X(c,e.buttons)},[t,e.buttons,e.formMode]),ge=t=>{M();const[e]=s.useState(t.formId??"dFormModal-"+E()),[c,n]=U(t),[u,i]=s.useState(c.apiRef||{}),[h]=s.useState({}),S=ie(u,c);r(e,u,c,h,n);const g=ce(u,c),[,a]=ue(c,g);return s.useEffect(()=>()=>{i({})},[]),b.jsx(te,{formId:e,formApi:u,modalFormProps:c,formProps:a,buttons:S,buttonsApi:h})},ue=(t,e)=>s.useMemo(()=>{const[c,n]=$(t,{title:!0,width:!0,minWidth:!0,maxWidth:!0,bodyHeight:!0,bodyMinHeight:!0,bodyMaxHeight:!0,bodyStyle:!0,notScrollable:!0,resizable:!0,isOpened:!0,headerStyle:!0,headerIcon:!0,footerStyle:!0,closeFormConfirmMessage:!0});return n.buttons=null,[c,{...n,...e}]},[e,t]);export{ge as D,d as M};
