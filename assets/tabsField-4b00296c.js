var g=Object.defineProperty;var T=(s,i,e)=>i in s?g(s,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[i]=e;var c=(s,i,e)=>(T(s,typeof i!="symbol"?i+"":i,e),e);import{r as p,j as l,bn as R}from"./index-23555c5c.js";import{F,T as _,s as y,a as S}from"./index-e5590f2c.js";const{useToken:H}=R,x=({field:s})=>{p.useEffect(()=>{s.setReady(!0)},[s]);const i=s.getProps(),e=s.getTabsRootFields();p.useSyncExternalStore(s.subscribe.bind(s),s.getSnapshot.bind(s));let t=s.getActiveTab();const r=C(s);if(!s.hasVisibleChildren())return l.jsx(l.Fragment,{children:" "});const n={};i.panelsHeight&&(n.height=i.panelsHeight),i.panelsMinHeight&&(n.minHeight=i.panelsMinHeight),i.panelsMaxHeight&&(n.height=i.panelsMaxHeight);const d=[];for(const a in e){if(t||(t=a),!s.tabHasVisibleChildren(a))continue;const u=e[a],f={};i.autoHeightResize&&(f.height="100%"),d.push({key:a,tabKey:a,label:a,className:i.autoHeightResize?"auto-height":"",forceRender:!0,disabled:s.isDisabled(),style:{...f,...i.tabsStyle},children:l.jsx(F,{fields:u,formProps:s.getFormProps(),subscribe:s.tabSubscribe(a),getSnapshot:s.getTabSnapshot(a),containerStyle:n}),active:t===a})}const o=(a,u)=>M(a,u,s),h={};i.width&&(h.width=i.width),i.autoHeightResize&&(h.height="100%");const b={...h,...i.style};return l.jsx(_,{type:i.type??"card",tabBarStyle:i.tabBarStyle,size:i.size??"small",items:d,style:b,renderTabBar:o,onChange:r})},C=s=>p.useCallback(i=>{s.setActiveTab(i)},[s]),M=(s,i,e)=>{const{token:t}=H(),r=e.getFormProps(),n={...s.style};n.backgroundColor=t.colorBgElevated,n.height=(r==null?void 0:r.tabsHeight)??35;const o={height:r.contentIndent??0,backgroundColor:n.backgroundColor};return e.getParent()?l.jsxs(l.Fragment,{children:[l.jsx("div",{style:o}),l.jsx(i,{...s,style:n})]}):l.jsxs(y,{style:{zIndex:15},children:[l.jsx("div",{style:o}),l.jsx(i,{...s,style:n})]})};class j extends S{constructor(){super(...arguments);c(this,"_tabsFieldsMap",{});c(this,"_tabsRootFields",{});c(this,"_activeTab","");c(this,"_disabledTabs",{});c(this,"_hiddenTabs",{});c(this,"_readOnlyTabs",{});c(this,"_tabRenderListeners",{});c(this,"_tabRenderSnapshots",{})}initChildrenFields(){const e=this.getProps();if(!e.tabs)return[{},{}];this._tabsRootFields={};for(const t in e.tabs){const r=e.tabs[t],[n,d]=this.getModel().prepareFieldCollection(r,this);this._tabsRootFields[t]=d,this._tabsFieldsMap[t]=n,this._tabRenderSnapshots[t]={},this._tabRenderListeners[t]=[],this.fieldsMap={...this.fieldsMap,...n},this.rootFields={...this.rootFields,...d}}return[this.fieldsMap,this.rootFields]}getValue(){}setValue(){}canHaveValue(){return!1}render(){return l.jsx(x,{field:this})}renderField(){return this.parent?super.renderField():this.render()}getTabsFieldsMap(){return this._tabsFieldsMap}getTabsRootFields(){return this._tabsRootFields}isTabDisabled(e){return!!this._disabledTabs[e]}setTabDisabled(e,t,r,n){var h,b;if(this.isTabDisabled(e)===t)return;const o=this._tabsRootFields[e];if(o){this._disabledTabs[e]=t;for(const a in o)o[a].setDisabled(t,r,!0);r||(b=(h=this.getProps()).onTabDisabledStateChanged)==null||b.call(h,e,t,this),n||this.emitRender()}}isTabReadOnly(e){return!!this._readOnlyTabs[e]||this.model.getFormMode()==="view"}setTabReadOnly(e,t,r,n){var h,b;if(this.isTabReadOnly(e)===t)return;const o=this._tabsRootFields[e];if(o){this._readOnlyTabs[e]=t;for(const a in o)o[a].setReadOnly(t,r,n);r||(b=(h=this.getProps()).onTabReadOnlyStateChanged)==null||b.call(h,e,t,this),n||this.emitRender()}}isTabHidden(e){return!!this._hiddenTabs[e]}setTabHidden(e,t,r,n){var h,b;if(this.isTabHidden(e)===t)return;const o=this._tabsRootFields[e];if(o){this._hiddenTabs[e]=t;for(const a in o)o[a].setHidden(t,r,n);r||(b=(h=this.getProps()).onTabHiddenStateChanged)==null||b.call(h,e,t,this),n||this.emitRender()}}getActiveTab(){return this._activeTab}setActiveTab(e,t,r){var n,d;this._tabsFieldsMap[e]&&(this._activeTab=e,t||(d=(n=this.getProps()).onActiveTabChanged)==null||d.call(n,e,this),r||this.emitRender())}tabHasVisibleChildren(e){const t=this._tabsRootFields[e];for(const r in t){const n=this.rootFields[r];if(!n.isContainer()&&!n.isHidden()||n.hasVisibleChildren())return!0}return!1}setDisabled(e,t,r){if(this.isDisabled()!==e){for(const d in this._tabsFieldsMap)this.setTabDisabled(d,e,t,!0);super.setDisabled(e,t,r)}}setReadOnly(e,t,r){if(this.isReadOnly()!==e){for(const d in this._tabsFieldsMap)this.setTabReadOnly(d,e,t,!0);super.setReadOnly(e,t,r)}}tabSubscribe(e){return t=>(this._tabRenderListeners[e]=[...this._tabRenderListeners[e],t],()=>{this._tabRenderListeners[e]=this._tabRenderListeners[e].filter(r=>r!==t)})}getTabSnapshot(e){return()=>this._tabRenderSnapshots[e]}emitTabRender(e){this._tabRenderSnapshots[e]={};for(const t of this._tabRenderListeners[e])t()}}export{j as T};
